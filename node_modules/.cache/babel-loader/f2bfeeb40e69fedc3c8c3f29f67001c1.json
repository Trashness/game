{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _defineProperty from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _asyncToGenerator from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { jsx as _jsx, Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { useEffect, useState } from 'react';\nimport { utils } from 'ethers';\nimport { getChainById } from '../helpers';\nimport { useEthers, useBlockNumber, useConfig, useUpdateConfig, useLocalStorage } from '../hooks';\nimport multicallABI from '../constants/abi/MultiCall.json';\nimport multicall2ABI from '../constants/abi/MultiCall2.json';\nimport { deployContract } from '../helpers/contract';\nvar LocalMulticallState;\n(function (LocalMulticallState) {\n  LocalMulticallState[LocalMulticallState[\"Unknown\"] = 0] = \"Unknown\";\n  LocalMulticallState[LocalMulticallState[\"NonLocal\"] = 1] = \"NonLocal\";\n  LocalMulticallState[LocalMulticallState[\"Deploying\"] = 2] = \"Deploying\";\n  LocalMulticallState[LocalMulticallState[\"Deployed\"] = 3] = \"Deployed\";\n  LocalMulticallState[LocalMulticallState[\"Error\"] = 4] = \"Error\";\n})(LocalMulticallState || (LocalMulticallState = {}));\nexport function LocalMulticallProvider(_ref) {\n  var children = _ref.children;\n  var updateConfig = useUpdateConfig();\n  var _useEthers = useEthers(),\n    library = _useEthers.library,\n    chainId = _useEthers.chainId;\n  var _useLocalStorage = useLocalStorage('local_multicall_address' + chainId),\n    _useLocalStorage2 = _slicedToArray(_useLocalStorage, 3),\n    setMulticallAddress = _useLocalStorage2[1],\n    getCurrent = _useLocalStorage2[2];\n  var _useConfig = useConfig(),\n    multicallAddresses = _useConfig.multicallAddresses,\n    multicallVersion = _useConfig.multicallVersion;\n  var _useState = useState(LocalMulticallState.Unknown),\n    _useState2 = _slicedToArray(_useState, 2),\n    localMulticallState = _useState2[0],\n    setLocalMulticallState = _useState2[1];\n  var _useState3 = useState(),\n    _useState4 = _slicedToArray(_useState3, 2),\n    multicallBlockNumber = _useState4[0],\n    setMulticallBlockNumber = _useState4[1];\n  var blockNumber = useBlockNumber();\n  useEffect(function () {\n    var _a;\n    if (!library || !chainId) {\n      setLocalMulticallState(LocalMulticallState.Unknown);\n    } else if (!((_a = getChainById(chainId)) === null || _a === void 0 ? void 0 : _a.isLocalChain)) {\n      setLocalMulticallState(LocalMulticallState.NonLocal);\n    } else if (multicallAddresses && multicallAddresses[chainId]) {\n      setLocalMulticallState(LocalMulticallState.Deployed);\n    } else if (localMulticallState !== LocalMulticallState.Deploying) {\n      var checkDeployed = /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n          var multicallAddress, multicallCode, signer, deployMulticall;\n          return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n            while (1) switch (_context2.prev = _context2.next) {\n              case 0:\n                multicallAddress = getCurrent();\n                if (!(typeof multicallAddress === 'string' && utils.isAddress(multicallAddress))) {\n                  _context2.next = 8;\n                  break;\n                }\n                _context2.next = 4;\n                return library.getCode(multicallAddress);\n              case 4:\n                multicallCode = _context2.sent;\n                if (!(multicallCode !== '0x')) {\n                  _context2.next = 8;\n                  break;\n                }\n                updateConfig({\n                  multicallAddresses: _defineProperty({}, chainId, multicallAddress)\n                });\n                return _context2.abrupt(\"return\");\n              case 8:\n                signer = library && 'getSigner' in library ? library.getSigner() : undefined;\n                if (signer) {\n                  _context2.next = 12;\n                  break;\n                }\n                setLocalMulticallState(LocalMulticallState.Error);\n                return _context2.abrupt(\"return\");\n              case 12:\n                setLocalMulticallState(LocalMulticallState.Deploying);\n                deployMulticall = /*#__PURE__*/function () {\n                  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n                    var _yield$deployContract, contractAddress, _blockNumber;\n                    return _regeneratorRuntime().wrap(function _callee$(_context) {\n                      while (1) switch (_context.prev = _context.next) {\n                        case 0:\n                          _context.prev = 0;\n                          _context.next = 3;\n                          return deployContract(multicallVersion === 1 ? multicallABI : multicall2ABI, signer);\n                        case 3:\n                          _yield$deployContract = _context.sent;\n                          contractAddress = _yield$deployContract.contractAddress;\n                          _blockNumber = _yield$deployContract.blockNumber;\n                          updateConfig({\n                            multicallAddresses: _defineProperty({}, chainId, contractAddress)\n                          });\n                          setMulticallAddress(contractAddress);\n                          setMulticallBlockNumber(_blockNumber);\n                          setLocalMulticallState(LocalMulticallState.Deployed);\n                          _context.next = 15;\n                          break;\n                        case 12:\n                          _context.prev = 12;\n                          _context.t0 = _context[\"catch\"](0);\n                          setLocalMulticallState(LocalMulticallState.Error);\n                        case 15:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }, _callee, null, [[0, 12]]);\n                  }));\n                  return function deployMulticall() {\n                    return _ref3.apply(this, arguments);\n                  };\n                }();\n                void deployMulticall();\n              case 15:\n              case \"end\":\n                return _context2.stop();\n            }\n          }, _callee2);\n        }));\n        return function checkDeployed() {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n      void checkDeployed();\n    }\n  }, [library, chainId]);\n  var awaitingMulticallBlock = multicallBlockNumber && blockNumber && blockNumber < multicallBlockNumber;\n  if (localMulticallState === LocalMulticallState.Deploying || localMulticallState === LocalMulticallState.Deployed && awaitingMulticallBlock) {\n    return _jsx(\"div\", {\n      children: \"Deploying multicall...\"\n    });\n  } else if (localMulticallState === LocalMulticallState.Error) {\n    return _jsx(\"div\", {\n      children: \"Error deploying multicall contract\"\n    });\n  } else {\n    return _jsx(_Fragment, {\n      children: children\n    });\n  }\n}","map":{"version":3,"sources":["../../../../src/providers/LocalMulticallProvider.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { jsx as _jsx, Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { useEffect, useState } from 'react';\nimport { utils } from 'ethers';\nimport { getChainById } from '../helpers';\nimport { useEthers, useBlockNumber, useConfig, useUpdateConfig, useLocalStorage } from '../hooks';\nimport multicallABI from '../constants/abi/MultiCall.json';\nimport multicall2ABI from '../constants/abi/MultiCall2.json';\nimport { deployContract } from '../helpers/contract';\nvar LocalMulticallState;\n(function (LocalMulticallState) {\n    LocalMulticallState[LocalMulticallState[\"Unknown\"] = 0] = \"Unknown\";\n    LocalMulticallState[LocalMulticallState[\"NonLocal\"] = 1] = \"NonLocal\";\n    LocalMulticallState[LocalMulticallState[\"Deploying\"] = 2] = \"Deploying\";\n    LocalMulticallState[LocalMulticallState[\"Deployed\"] = 3] = \"Deployed\";\n    LocalMulticallState[LocalMulticallState[\"Error\"] = 4] = \"Error\";\n})(LocalMulticallState || (LocalMulticallState = {}));\nexport function LocalMulticallProvider({ children }) {\n    const updateConfig = useUpdateConfig();\n    const { library, chainId } = useEthers();\n    const [, setMulticallAddress, getCurrent] = useLocalStorage('local_multicall_address' + chainId);\n    const { multicallAddresses, multicallVersion } = useConfig();\n    const [localMulticallState, setLocalMulticallState] = useState(LocalMulticallState.Unknown);\n    const [multicallBlockNumber, setMulticallBlockNumber] = useState();\n    const blockNumber = useBlockNumber();\n    useEffect(() => {\n        var _a;\n        if (!library || !chainId) {\n            setLocalMulticallState(LocalMulticallState.Unknown);\n        }\n        else if (!((_a = getChainById(chainId)) === null || _a === void 0 ? void 0 : _a.isLocalChain)) {\n            setLocalMulticallState(LocalMulticallState.NonLocal);\n        }\n        else if (multicallAddresses && multicallAddresses[chainId]) {\n            setLocalMulticallState(LocalMulticallState.Deployed);\n        }\n        else if (localMulticallState !== LocalMulticallState.Deploying) {\n            const checkDeployed = async () => {\n                const multicallAddress = getCurrent();\n                if (typeof multicallAddress === 'string' && utils.isAddress(multicallAddress)) {\n                    const multicallCode = await library.getCode(multicallAddress);\n                    if (multicallCode !== '0x') {\n                        updateConfig({ multicallAddresses: { [chainId]: multicallAddress } });\n                        return;\n                    }\n                }\n                const signer = library && 'getSigner' in library ? library.getSigner() : undefined;\n                if (!signer) {\n                    setLocalMulticallState(LocalMulticallState.Error);\n                    return;\n                }\n                setLocalMulticallState(LocalMulticallState.Deploying);\n                const deployMulticall = async () => {\n                    try {\n                        const { contractAddress, blockNumber } = await deployContract(multicallVersion === 1 ? multicallABI : multicall2ABI, signer);\n                        updateConfig({ multicallAddresses: { [chainId]: contractAddress } });\n                        setMulticallAddress(contractAddress);\n                        setMulticallBlockNumber(blockNumber);\n                        setLocalMulticallState(LocalMulticallState.Deployed);\n                    }\n                    catch (_a) {\n                        setLocalMulticallState(LocalMulticallState.Error);\n                    }\n                };\n                void deployMulticall();\n            };\n            void checkDeployed();\n        }\n    }, [library, chainId]);\n    const awaitingMulticallBlock = multicallBlockNumber && blockNumber && blockNumber < multicallBlockNumber;\n    if (localMulticallState === LocalMulticallState.Deploying ||\n        (localMulticallState === LocalMulticallState.Deployed && awaitingMulticallBlock)) {\n        return _jsx(\"div\", { children: \"Deploying multicall...\" });\n    }\n    else if (localMulticallState === LocalMulticallState.Error) {\n        return _jsx(\"div\", { children: \"Error deploying multicall contract\" });\n    }\n    else {\n        return _jsx(_Fragment, { children: children });\n    }\n}\n//# sourceMappingURL=LocalMulticallProvider.js.map"]},"metadata":{},"sourceType":"module"}