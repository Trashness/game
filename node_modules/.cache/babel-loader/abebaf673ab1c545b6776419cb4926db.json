{"ast":null,"code":"'use client';\n\nimport _objectSpread from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _slicedToArray from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _objectWithoutProperties from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";\nvar _excluded = [\"client\", \"children\", \"persistOptions\", \"onSuccess\"];\nimport { extends as _extends } from './_virtual/_rollupPluginBabelHelpers.esm.js';\nimport * as React from 'react';\nimport { persistQueryClient } from '@tanstack/query-persist-client-core';\nimport { QueryClientProvider, IsRestoringProvider } from '@tanstack/react-query';\nvar PersistQueryClientProvider = function PersistQueryClientProvider(_ref) {\n  var client = _ref.client,\n    children = _ref.children,\n    persistOptions = _ref.persistOptions,\n    onSuccess = _ref.onSuccess,\n    props = _objectWithoutProperties(_ref, _excluded);\n  var _React$useState = React.useState(true),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    isRestoring = _React$useState2[0],\n    setIsRestoring = _React$useState2[1];\n  var refs = React.useRef({\n    persistOptions: persistOptions,\n    onSuccess: onSuccess\n  });\n  React.useEffect(function () {\n    refs.current = {\n      persistOptions: persistOptions,\n      onSuccess: onSuccess\n    };\n  });\n  React.useEffect(function () {\n    var isStale = false;\n    setIsRestoring(true);\n    var _persistQueryClient = persistQueryClient(_objectSpread(_objectSpread({}, refs.current.persistOptions), {}, {\n        queryClient: client\n      })),\n      _persistQueryClient2 = _slicedToArray(_persistQueryClient, 2),\n      unsubscribe = _persistQueryClient2[0],\n      promise = _persistQueryClient2[1];\n    promise.then(function () {\n      if (!isStale) {\n        refs.current.onSuccess == null ? void 0 : refs.current.onSuccess();\n        setIsRestoring(false);\n      }\n    });\n    return function () {\n      isStale = true;\n      unsubscribe();\n    };\n  }, [client]);\n  return /*#__PURE__*/React.createElement(QueryClientProvider, _extends({\n    client: client\n  }, props), /*#__PURE__*/React.createElement(IsRestoringProvider, {\n    value: isRestoring\n  }, children));\n};\nexport { PersistQueryClientProvider };","map":{"version":3,"sources":["../../src/PersistQueryClientProvider.tsx"],"names":["onSuccess","queryClient","isStale"],"mappings":";;;;;;;;;;AAaO,IAAA,0BAAA,GAAA,SAAA,0BAAA,CAAA,IAAA,EAAoC;EAAA,I;;;;;;;;;EAQzC,IAAA,IAAA,GAAA,KAAA,CAAA,MAAA,CAAA;;IAA4CA,SAAAA,EAAAA;EAAlB,CAAA,CAAA;;;;MAGSA,SAAAA,EAAAA;;;;;;IAMjC,IAAA,mBAAA,GAAA,kBAAA,CAAA,aAAA,CAAA,aAAA,KAAA,IAAA,CAAA,OAAA,CAAA,cAAA;QAEEC,WAAAA,EAAAA;MAAAA,GAFgD;MAAA,oBAAA,GAAA,cAAA,CAAA,mBAAA;MAAlD,WAAA,GAAA,oBAAA;MAAA,OAAA,GAAA,oBAAA;;;;;MASG;;IAGH,OAAA,YAAA;MACEC,OAAAA,GAAAA,IAAAA;;;;EAKJ,OAAA,aAAA,KAAA,CAAA,aAAA,CAAA,mBAAA,EAAA,QAAA,CAAA;IACuB,MAAA,EAAA;;IACE,KAAA,EAAA;;AAG1B,CAAA","sourcesContent":["'use client'\nimport * as React from 'react'\n\nimport type { PersistQueryClientOptions } from '@tanstack/query-persist-client-core'\nimport { persistQueryClient } from '@tanstack/query-persist-client-core'\nimport type { QueryClientProviderProps } from '@tanstack/react-query'\nimport { QueryClientProvider, IsRestoringProvider } from '@tanstack/react-query'\n\nexport type PersistQueryClientProviderProps = QueryClientProviderProps & {\n  persistOptions: Omit<PersistQueryClientOptions, 'queryClient'>\n  onSuccess?: () => void\n}\n\nexport const PersistQueryClientProvider = ({\n  client,\n  children,\n  persistOptions,\n  onSuccess,\n  ...props\n}: PersistQueryClientProviderProps): JSX.Element => {\n  const [isRestoring, setIsRestoring] = React.useState(true)\n  const refs = React.useRef({ persistOptions, onSuccess })\n\n  React.useEffect(() => {\n    refs.current = { persistOptions, onSuccess }\n  })\n\n  React.useEffect(() => {\n    let isStale = false\n    setIsRestoring(true)\n    const [unsubscribe, promise] = persistQueryClient({\n      ...refs.current.persistOptions,\n      queryClient: client,\n    })\n\n    promise.then(() => {\n      if (!isStale) {\n        refs.current.onSuccess?.()\n        setIsRestoring(false)\n      }\n    })\n\n    return () => {\n      isStale = true\n      unsubscribe()\n    }\n  }, [client])\n\n  return (\n    <QueryClientProvider client={client} {...props}>\n      <IsRestoringProvider value={isRestoring}>{children}</IsRestoringProvider>\n    </QueryClientProvider>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}