{"ast":null,"code":"\"use strict\";\n\n/**\n * Returns a Promise that resolves to the value of window.ethereum if it is\n * set within the given timeout, or null.\n * The Promise will not reject, but an error will be thrown if invalid options\n * are provided.\n *\n * @param options - Options bag.\n * @param options.mustBeMetaMask - Whether to only look for MetaMask providers.\n * Default: false\n * @param options.silent - Whether to silence console errors. Does not affect\n * thrown errors. Default: false\n * @param options.timeout - Milliseconds to wait for 'ethereum#initialized' to\n * be dispatched. Default: 3000\n * @returns A Promise that resolves with the Provider if it is detected within\n * given timeout, otherwise null.\n */\nfunction detectEthereumProvider() {\n  var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n    _ref$mustBeMetaMask = _ref.mustBeMetaMask,\n    mustBeMetaMask = _ref$mustBeMetaMask === void 0 ? false : _ref$mustBeMetaMask,\n    _ref$silent = _ref.silent,\n    silent = _ref$silent === void 0 ? false : _ref$silent,\n    _ref$timeout = _ref.timeout,\n    timeout = _ref$timeout === void 0 ? 3000 : _ref$timeout;\n  _validateInputs();\n  var handled = false;\n  return new Promise(function (resolve) {\n    if (window.ethereum) {\n      handleEthereum();\n    } else {\n      window.addEventListener('ethereum#initialized', handleEthereum, {\n        once: true\n      });\n      setTimeout(function () {\n        handleEthereum();\n      }, timeout);\n    }\n    function handleEthereum() {\n      if (handled) {\n        return;\n      }\n      handled = true;\n      window.removeEventListener('ethereum#initialized', handleEthereum);\n      var _window = window,\n        ethereum = _window.ethereum;\n      if (ethereum && (!mustBeMetaMask || ethereum.isMetaMask)) {\n        resolve(ethereum);\n      } else {\n        var message = mustBeMetaMask && ethereum ? 'Non-MetaMask window.ethereum detected.' : 'Unable to detect window.ethereum.';\n        !silent && console.error('@metamask/detect-provider:', message);\n        resolve(null);\n      }\n    }\n  });\n  function _validateInputs() {\n    if (typeof mustBeMetaMask !== 'boolean') {\n      throw new Error(\"@metamask/detect-provider: Expected option 'mustBeMetaMask' to be a boolean.\");\n    }\n    if (typeof silent !== 'boolean') {\n      throw new Error(\"@metamask/detect-provider: Expected option 'silent' to be a boolean.\");\n    }\n    if (typeof timeout !== 'number') {\n      throw new Error(\"@metamask/detect-provider: Expected option 'timeout' to be a number.\");\n    }\n  }\n}\nmodule.exports = detectEthereumProvider;","map":{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":";;AAgBA;;;;;;;;;;;;;;;AAeG;AACH,SAAS,sBAAsB,CAAA,EAIzB;EAAA,IAAA,IAAA,GAAA,SAAA,CAAA,MAAA,QAAA,SAAA,QAAA,SAAA,GAAA,SAAA,MAAF,CAAA,CAAE;IAAA,mBAAA,GAAA,IAAA,CAHJ,cAAc;IAAd,cAAc,GAAA,mBAAA,cAAG,KAAK,GAAA,mBAAA;IAAA,WAAA,GAAA,IAAA,CACtB,MAAM;IAAN,MAAM,GAAA,WAAA,cAAG,KAAK,GAAA,WAAA;IAAA,YAAA,GAAA,IAAA,CACd,OAAO;IAAP,OAAO,GAAA,YAAA,cAAG,IAAI,GAAA,YAAA;EAGd,eAAe,EAAE;EAEjB,IAAI,OAAO,GAAG,KAAK;EAEnB,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAI;IAC7B,IAAK,MAAiB,CAAC,QAAQ,EAAE;MAE/B,cAAc,EAAE;KAEjB,MAAM;MAEL,MAAM,CAAC,gBAAgB,CACrB,sBAAsB,EACtB,cAAc,EACd;QAAE,IAAI,EAAE;MAAI,CAAE,CACf;MAED,UAAU,CAAC,YAAK;QACd,cAAc,EAAE;MAClB,CAAC,EAAE,OAAO,CAAC;IACZ;IAED,SAAS,cAAc,CAAA,EAAA;MAErB,IAAI,OAAO,EAAE;QACX;MACD;MACD,OAAO,GAAG,IAAI;MAEd,MAAM,CAAC,mBAAmB,CAAC,sBAAsB,EAAE,cAAc,CAAC;MAElE,IAAA,OAAA,GAAqB,MAAgB;QAA7B,QAAQ,GAAA,OAAA,CAAR,QAAQ;MAEhB,IAAI,QAAQ,KAAK,CAAC,cAAc,IAAI,QAAQ,CAAC,UAAU,CAAC,EAAE;QACxD,OAAO,CAAC,QAAwB,CAAC;OAClC,MAAM;QAEL,IAAM,OAAO,GAAG,cAAc,IAAI,QAAQ,GACtC,wCAAwC,GACxC,mCAAmC;QAEvC,CAAC,MAAM,IAAI,OAAO,CAAC,KAAK,CAAC,4BAA4B,EAAE,OAAO,CAAC;QAC/D,OAAO,CAAC,IAAI,CAAC;MACd;IACH;EACF,CAAC,CAAC;EAEF,SAAS,eAAe,CAAA,EAAA;IACtB,IAAI,OAAO,cAAc,KAAK,SAAS,EAAE;MACvC,MAAM,IAAI,KAAK,gFAAgF;IAChG;IACD,IAAI,OAAO,MAAM,KAAK,SAAS,EAAE;MAC/B,MAAM,IAAI,KAAK,wEAAwE;IACxF;IACD,IAAI,OAAO,OAAO,KAAK,QAAQ,EAAE;MAC/B,MAAM,IAAI,KAAK,wEAAwE;IACxF;EACH;AACF;AAlFA,MAAA,CAAA,OAAA,GAAS,sBAAsB","sourcesContent":["interface MetaMaskEthereumProvider {\n  isMetaMask?: boolean;\n  once(eventName: string | symbol, listener: (...args: any[]) => void): this;\n  on(eventName: string | symbol, listener: (...args: any[]) => void): this;\n  off(eventName: string | symbol, listener: (...args: any[]) => void): this;\n  addListener(eventName: string | symbol, listener: (...args: any[]) => void): this;\n  removeListener(eventName: string | symbol, listener: (...args: any[]) => void): this;\n  removeAllListeners(event?: string | symbol): this;\n}\n\ninterface Window {\n  ethereum?: MetaMaskEthereumProvider;\n}\n\nexport = detectEthereumProvider;\n\n/**\n * Returns a Promise that resolves to the value of window.ethereum if it is\n * set within the given timeout, or null.\n * The Promise will not reject, but an error will be thrown if invalid options\n * are provided.\n *\n * @param options - Options bag.\n * @param options.mustBeMetaMask - Whether to only look for MetaMask providers.\n * Default: false\n * @param options.silent - Whether to silence console errors. Does not affect\n * thrown errors. Default: false\n * @param options.timeout - Milliseconds to wait for 'ethereum#initialized' to\n * be dispatched. Default: 3000\n * @returns A Promise that resolves with the Provider if it is detected within\n * given timeout, otherwise null.\n */\nfunction detectEthereumProvider<T = MetaMaskEthereumProvider>({\n  mustBeMetaMask = false,\n  silent = false,\n  timeout = 3000,\n} = {}): Promise<T | null> {\n\n  _validateInputs();\n\n  let handled = false;\n\n  return new Promise((resolve) => {\n    if ((window as Window).ethereum) {\n\n      handleEthereum();\n\n    } else {\n\n      window.addEventListener(\n        'ethereum#initialized',\n        handleEthereum,\n        { once: true },\n      );\n\n      setTimeout(() => {\n        handleEthereum();\n      }, timeout);\n    }\n\n    function handleEthereum() {\n\n      if (handled) {\n        return;\n      }\n      handled = true;\n\n      window.removeEventListener('ethereum#initialized', handleEthereum);\n\n      const { ethereum } = window as Window;\n\n      if (ethereum && (!mustBeMetaMask || ethereum.isMetaMask)) {\n        resolve(ethereum as unknown as T);\n      } else {\n\n        const message = mustBeMetaMask && ethereum\n          ? 'Non-MetaMask window.ethereum detected.'\n          : 'Unable to detect window.ethereum.';\n\n        !silent && console.error('@metamask/detect-provider:', message);\n        resolve(null);\n      }\n    }\n  });\n\n  function _validateInputs() {\n    if (typeof mustBeMetaMask !== 'boolean') {\n      throw new Error(`@metamask/detect-provider: Expected option 'mustBeMetaMask' to be a boolean.`);\n    }\n    if (typeof silent !== 'boolean') {\n      throw new Error(`@metamask/detect-provider: Expected option 'silent' to be a boolean.`);\n    }\n    if (typeof timeout !== 'number') {\n      throw new Error(`@metamask/detect-provider: Expected option 'timeout' to be a number.`);\n    }\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"script"}