{"ast":null,"code":"import _assertThisInitialized from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _toConsumableArray from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _regeneratorRuntime from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _createForOfIteratorHelper from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport ae from \"pino\";\nimport { RELAYER_DEFAULT_PROTOCOL as ce, RELAYER_EVENTS as F, EXPIRER_EVENTS as le, Store as z, Core as pe } from \"@walletconnect/core\";\nimport { getDefaultLoggerOptions as he, generateChildLogger as de, getLoggerContext as ge } from \"@walletconnect/logger\";\nimport { IEngine as me, ISignClient as we } from \"@walletconnect/types\";\nimport { TYPE_1 as ue, createDelayedPromise as v, engineEvent as p, getInternalError as c, calcExpiry as _, isValidObject as j, getRequiredNamespacesFromNamespaces as ye, getSdkError as R, isSessionCompatible as Se, isExpired as f, isValidParams as y, isUndefined as D, isValidRelays as Ee, isValidRequiredNamespaces as Ie, isValidNamespaces as Y, isConformingNamespaces as B, isValidString as A, isValidErrorReason as _e, isValidRelay as Re, isValidController as Ne, isValidNamespacesChainId as Q, isValidRequest as qe, isValidNamespacesRequest as Pe, isValidRequestExpiry as ve, isValidResponse as fe, isValidEvent as Oe, isValidNamespacesEvent as Ve, parseExpirerTarget as Te, isValidId as xe, getAppMetadata as De } from \"@walletconnect/utils\";\nimport Ae, { EventEmitter as be } from \"events\";\nimport { THIRTY_DAYS as Le, SEVEN_DAYS as W, FIVE_MINUTES as w, ONE_DAY as O, THIRTY_SECONDS as Z } from \"@walletconnect/time\";\nimport { isJsonRpcResult as N, isJsonRpcError as q, formatJsonRpcRequest as Ce, formatJsonRpcResult as Ge, formatJsonRpcError as $e, isJsonRpcRequest as Me, isJsonRpcResponse as Ue } from \"@walletconnect/jsonrpc-utils\";\nvar k = \"wc\",\n  X = 2,\n  J = \"client\",\n  C = \"\".concat(k, \"@\").concat(X, \":\").concat(J, \":\"),\n  G = {\n    name: J,\n    logger: \"error\",\n    controller: !1,\n    relayUrl: \"wss://relay.walletconnect.com\"\n  },\n  Ke = {\n    session_proposal: \"session_proposal\",\n    session_update: \"session_update\",\n    session_extend: \"session_extend\",\n    session_ping: \"session_ping\",\n    session_delete: \"session_delete\",\n    session_expire: \"session_expire\",\n    session_request: \"session_request\",\n    session_request_sent: \"session_request_sent\",\n    session_event: \"session_event\",\n    proposal_expire: \"proposal_expire\"\n  },\n  ze = {\n    database: \":memory:\"\n  },\n  je = {\n    created: \"history_created\",\n    updated: \"history_updated\",\n    deleted: \"history_deleted\",\n    sync: \"history_sync\"\n  },\n  Ye = \"history\",\n  ke = \"0.3\",\n  ee = \"proposal\",\n  Xe = Le,\n  se = \"Proposal expired\",\n  te = \"session\",\n  b = W,\n  ie = \"engine\",\n  V = {\n    wc_sessionPropose: {\n      req: {\n        ttl: w,\n        prompt: !0,\n        tag: 1100\n      },\n      res: {\n        ttl: w,\n        prompt: !1,\n        tag: 1101\n      }\n    },\n    wc_sessionSettle: {\n      req: {\n        ttl: w,\n        prompt: !1,\n        tag: 1102\n      },\n      res: {\n        ttl: w,\n        prompt: !1,\n        tag: 1103\n      }\n    },\n    wc_sessionUpdate: {\n      req: {\n        ttl: O,\n        prompt: !1,\n        tag: 1104\n      },\n      res: {\n        ttl: O,\n        prompt: !1,\n        tag: 1105\n      }\n    },\n    wc_sessionExtend: {\n      req: {\n        ttl: O,\n        prompt: !1,\n        tag: 1106\n      },\n      res: {\n        ttl: O,\n        prompt: !1,\n        tag: 1107\n      }\n    },\n    wc_sessionRequest: {\n      req: {\n        ttl: w,\n        prompt: !0,\n        tag: 1108\n      },\n      res: {\n        ttl: w,\n        prompt: !1,\n        tag: 1109\n      }\n    },\n    wc_sessionEvent: {\n      req: {\n        ttl: w,\n        prompt: !0,\n        tag: 1110\n      },\n      res: {\n        ttl: w,\n        prompt: !1,\n        tag: 1111\n      }\n    },\n    wc_sessionDelete: {\n      req: {\n        ttl: O,\n        prompt: !1,\n        tag: 1112\n      },\n      res: {\n        ttl: O,\n        prompt: !1,\n        tag: 1113\n      }\n    },\n    wc_sessionPing: {\n      req: {\n        ttl: Z,\n        prompt: !1,\n        tag: 1114\n      },\n      res: {\n        ttl: Z,\n        prompt: !1,\n        tag: 1115\n      }\n    }\n  },\n  $ = {\n    min: w,\n    max: W\n  },\n  ne = \"request\";\nvar Je = Object.defineProperty,\n  He = Object.defineProperties,\n  Fe = Object.getOwnPropertyDescriptors,\n  oe = Object.getOwnPropertySymbols,\n  Be = Object.prototype.hasOwnProperty,\n  Qe = Object.prototype.propertyIsEnumerable,\n  re = function re(d, n, e) {\n    return n in d ? Je(d, n, {\n      enumerable: !0,\n      configurable: !0,\n      writable: !0,\n      value: e\n    }) : d[n] = e;\n  },\n  u = function u(d, n) {\n    for (var e in n || (n = {})) Be.call(n, e) && re(d, e, n[e]);\n    if (oe) {\n      var _iterator = _createForOfIteratorHelper(oe(n)),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var e = _step.value;\n          Qe.call(n, e) && re(d, e, n[e]);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n    return d;\n  },\n  H = function H(d, n) {\n    return He(d, Fe(n));\n  };\nvar We = /*#__PURE__*/function (_me) {\n  _inherits(We, _me);\n  var _super = _createSuper(We);\n  function We(n) {\n    var _this;\n    _classCallCheck(this, We);\n    _this = _super.call(this, n), _this.name = ie, _this.events = new Ae(), _this.initialized = !1, _this.ignoredPayloadTypes = [ue], _this.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            _context.t0 = _this.initialized;\n            if (_context.t0) {\n              _context.next = 8;\n              break;\n            }\n            _context.next = 4;\n            return _this.cleanup();\n          case 4:\n            _this.registerRelayerEvents();\n            _this.registerExpirerEvents();\n            _this.client.core.pairing.register({\n              methods: Object.keys(V)\n            });\n            _this.initialized = !0;\n          case 8:\n          case \"end\":\n            return _context.stop();\n        }\n      }, _callee);\n    })), _this.connect = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(e) {\n        var s, t, i, o, r, a, l, h, S, _yield$_this$client$c, I, g, m, P, _v, E, T, U, _c, _I, L, K;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _this.isInitialized();\n              s = H(u({}, e), {\n                requiredNamespaces: e.requiredNamespaces || {},\n                optionalNamespaces: e.optionalNamespaces || {}\n              });\n              _context3.next = 4;\n              return _this.isValidConnect(s);\n            case 4:\n              t = s.pairingTopic, i = s.requiredNamespaces, o = s.optionalNamespaces, r = s.sessionProperties, a = s.relays;\n              l = t, S = !1;\n              if (!(l && (S = _this.client.core.pairing.pairings.get(l).active), !l || !S)) {\n                _context3.next = 13;\n                break;\n              }\n              _context3.next = 9;\n              return _this.client.core.pairing.create();\n            case 9:\n              _yield$_this$client$c = _context3.sent;\n              I = _yield$_this$client$c.topic;\n              g = _yield$_this$client$c.uri;\n              l = I, h = g;\n            case 13:\n              _context3.next = 15;\n              return _this.client.core.crypto.generateKeyPair();\n            case 15:\n              m = _context3.sent;\n              P = u({\n                requiredNamespaces: i,\n                optionalNamespaces: o,\n                relays: a !== null && a !== void 0 ? a : [{\n                  protocol: ce\n                }],\n                proposer: {\n                  publicKey: m,\n                  metadata: _this.client.metadata\n                }\n              }, r && {\n                sessionProperties: r\n              });\n              _v = v(w, se);\n              E = _v.reject;\n              T = _v.resolve;\n              U = _v.done;\n              if (!(_this.events.once(p(\"session_connect\"), /*#__PURE__*/function () {\n                var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(_ref3) {\n                  var I, g, x;\n                  return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n                    while (1) switch (_context2.prev = _context2.next) {\n                      case 0:\n                        I = _ref3.error, g = _ref3.session;\n                        if (!I) {\n                          _context2.next = 5;\n                          break;\n                        }\n                        E(I);\n                        _context2.next = 17;\n                        break;\n                      case 5:\n                        if (!g) {\n                          _context2.next = 17;\n                          break;\n                        }\n                        g.self.publicKey = m;\n                        x = H(u({}, g), {\n                          requiredNamespaces: g.requiredNamespaces,\n                          optionalNamespaces: g.optionalNamespaces\n                        });\n                        _context2.next = 10;\n                        return _this.client.session.set(g.topic, x);\n                      case 10:\n                        _context2.next = 12;\n                        return _this.setExpiry(g.topic, g.expiry);\n                      case 12:\n                        _context2.t0 = l;\n                        if (!_context2.t0) {\n                          _context2.next = 16;\n                          break;\n                        }\n                        _context2.next = 16;\n                        return _this.client.core.pairing.updateMetadata({\n                          topic: l,\n                          metadata: g.peer.metadata\n                        });\n                      case 16:\n                        T(x);\n                      case 17:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }, _callee2);\n                }));\n                return function (_x2) {\n                  return _ref4.apply(this, arguments);\n                };\n              }()), !l)) {\n                _context3.next = 24;\n                break;\n              }\n              _c = c(\"NO_MATCHING_KEY\", \"connect() pairing topic: \".concat(l)), _I = _c.message;\n              throw new Error(_I);\n            case 24:\n              _context3.next = 26;\n              return _this.sendRequest(l, \"wc_sessionPropose\", P);\n            case 26:\n              L = _context3.sent;\n              K = _(w);\n              _context3.next = 30;\n              return _this.setProposal(L, u({\n                id: L,\n                expiry: K\n              }, P));\n            case 30:\n              return _context3.abrupt(\"return\", {\n                uri: h,\n                approval: U\n              });\n            case 31:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3);\n      }));\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }(), _this.pair = /*#__PURE__*/function () {\n      var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(e) {\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _this.isInitialized();\n              _context4.next = 3;\n              return _this.client.core.pairing.pair(e);\n            case 3:\n              return _context4.abrupt(\"return\", _context4.sent);\n            case 4:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4);\n      }));\n      return function (_x3) {\n        return _ref5.apply(this, arguments);\n      };\n    }(), _this.approve = /*#__PURE__*/function () {\n      var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5(e) {\n        var s, t, i, o, r, a, l, h, S, m, P, E, T, U, _v2, L, K, I, g;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _this.isInitialized();\n              _context5.next = 3;\n              return _this.isValidApprove(e);\n            case 3:\n              s = e.id, t = e.relayProtocol, i = e.namespaces, o = e.sessionProperties, r = _this.client.proposal.get(s);\n              a = r.pairingTopic, l = r.proposer, h = r.requiredNamespaces, S = r.optionalNamespaces;\n              j(h) || (h = ye(i, \"approve()\"));\n              _context5.next = 8;\n              return _this.client.core.crypto.generateKeyPair();\n            case 8:\n              m = _context5.sent;\n              P = l.publicKey;\n              _context5.next = 12;\n              return _this.client.core.crypto.generateSharedKey(m, P);\n            case 12:\n              E = _context5.sent;\n              _context5.t0 = a && s;\n              if (!_context5.t0) {\n                _context5.next = 23;\n                break;\n              }\n              _context5.next = 17;\n              return _this.client.core.pairing.updateMetadata({\n                topic: a,\n                metadata: l.metadata\n              });\n            case 17:\n              _context5.next = 19;\n              return _this.sendResult(s, a, {\n                relay: {\n                  protocol: t !== null && t !== void 0 ? t : \"irn\"\n                },\n                responderPublicKey: m\n              });\n            case 19:\n              _context5.next = 21;\n              return _this.client.proposal.delete(s, R(\"USER_DISCONNECTED\"));\n            case 21:\n              _context5.next = 23;\n              return _this.client.core.pairing.activate({\n                topic: a\n              });\n            case 23:\n              T = u({\n                relay: {\n                  protocol: t !== null && t !== void 0 ? t : \"irn\"\n                },\n                namespaces: i,\n                requiredNamespaces: h,\n                optionalNamespaces: S,\n                controller: {\n                  publicKey: m,\n                  metadata: _this.client.metadata\n                },\n                expiry: _(b)\n              }, o && {\n                sessionProperties: o\n              });\n              _context5.next = 26;\n              return _this.client.core.relayer.subscribe(E);\n            case 26:\n              _context5.next = 28;\n              return _this.sendRequest(E, \"wc_sessionSettle\", T);\n            case 28:\n              U = _context5.sent;\n              _v2 = v();\n              L = _v2.done;\n              K = _v2.resolve;\n              I = _v2.reject;\n              _this.events.once(p(\"session_approve\", U), function (_ref7) {\n                var x = _ref7.error;\n                x ? I(x) : K(_this.client.session.get(E));\n              });\n              g = H(u({}, T), {\n                topic: E,\n                acknowledged: !1,\n                self: T.controller,\n                peer: {\n                  publicKey: l.publicKey,\n                  metadata: l.metadata\n                },\n                controller: m\n              });\n              _context5.next = 37;\n              return _this.client.session.set(E, g);\n            case 37:\n              _context5.next = 39;\n              return _this.setExpiry(E, _(b));\n            case 39:\n              return _context5.abrupt(\"return\", {\n                topic: E,\n                acknowledged: L\n              });\n            case 40:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5);\n      }));\n      return function (_x4) {\n        return _ref6.apply(this, arguments);\n      };\n    }(), _this.reject = /*#__PURE__*/function () {\n      var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6(e) {\n        var s, t, _this$client$proposal, i;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              _this.isInitialized();\n              _context6.next = 3;\n              return _this.isValidReject(e);\n            case 3:\n              s = e.id, t = e.reason, _this$client$proposal = _this.client.proposal.get(s), i = _this$client$proposal.pairingTopic;\n              _context6.t0 = i;\n              if (!_context6.t0) {\n                _context6.next = 10;\n                break;\n              }\n              _context6.next = 8;\n              return _this.sendError(s, i, t);\n            case 8:\n              _context6.next = 10;\n              return _this.client.proposal.delete(s, R(\"USER_DISCONNECTED\"));\n            case 10:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee6);\n      }));\n      return function (_x5) {\n        return _ref8.apply(this, arguments);\n      };\n    }(), _this.update = /*#__PURE__*/function () {\n      var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7(e) {\n        var s, t, i, _v3, o, r, a;\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              _this.isInitialized();\n              _context7.next = 3;\n              return _this.isValidUpdate(e);\n            case 3:\n              s = e.topic;\n              t = e.namespaces;\n              _context7.next = 7;\n              return _this.sendRequest(s, \"wc_sessionUpdate\", {\n                namespaces: t\n              });\n            case 7:\n              i = _context7.sent;\n              _v3 = v();\n              o = _v3.done;\n              r = _v3.resolve;\n              a = _v3.reject;\n              _this.events.once(p(\"session_update\", i), function (_ref10) {\n                var l = _ref10.error;\n                l ? a(l) : r();\n              });\n              _context7.next = 15;\n              return _this.client.session.update(s, {\n                namespaces: t\n              });\n            case 15:\n              return _context7.abrupt(\"return\", {\n                acknowledged: o\n              });\n            case 16:\n            case \"end\":\n              return _context7.stop();\n          }\n        }, _callee7);\n      }));\n      return function (_x6) {\n        return _ref9.apply(this, arguments);\n      };\n    }(), _this.extend = /*#__PURE__*/function () {\n      var _ref11 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8(e) {\n        var s, t, _v4, i, o, r;\n        return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              _this.isInitialized();\n              _context8.next = 3;\n              return _this.isValidExtend(e);\n            case 3:\n              s = e.topic;\n              _context8.next = 6;\n              return _this.sendRequest(s, \"wc_sessionExtend\", {});\n            case 6:\n              t = _context8.sent;\n              _v4 = v();\n              i = _v4.done;\n              o = _v4.resolve;\n              r = _v4.reject;\n              _this.events.once(p(\"session_extend\", t), function (_ref12) {\n                var a = _ref12.error;\n                a ? r(a) : o();\n              });\n              _context8.next = 14;\n              return _this.setExpiry(s, _(b));\n            case 14:\n              return _context8.abrupt(\"return\", {\n                acknowledged: i\n              });\n            case 15:\n            case \"end\":\n              return _context8.stop();\n          }\n        }, _callee8);\n      }));\n      return function (_x7) {\n        return _ref11.apply(this, arguments);\n      };\n    }(), _this.request = /*#__PURE__*/function () {\n      var _ref13 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee9(e) {\n        var s, t, i, o, r, _v5, a, l, h;\n        return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n          while (1) switch (_context9.prev = _context9.next) {\n            case 0:\n              _this.isInitialized();\n              _context9.next = 3;\n              return _this.isValidRequest(e);\n            case 3:\n              s = e.chainId;\n              t = e.request;\n              i = e.topic;\n              o = e.expiry;\n              _context9.next = 9;\n              return _this.sendRequest(i, \"wc_sessionRequest\", {\n                request: t,\n                chainId: s\n              }, o);\n            case 9:\n              r = _context9.sent;\n              _v5 = v(o);\n              a = _v5.done;\n              l = _v5.resolve;\n              h = _v5.reject;\n              _this.events.once(p(\"session_request\", r), function (_ref14) {\n                var S = _ref14.error,\n                  m = _ref14.result;\n                S ? h(S) : l(m);\n              });\n              _this.client.events.emit(\"session_request_sent\", {\n                topic: i,\n                request: t,\n                chainId: s,\n                id: r\n              });\n              _context9.next = 18;\n              return a();\n            case 18:\n              return _context9.abrupt(\"return\", _context9.sent);\n            case 19:\n            case \"end\":\n              return _context9.stop();\n          }\n        }, _callee9);\n      }));\n      return function (_x8) {\n        return _ref13.apply(this, arguments);\n      };\n    }(), _this.respond = /*#__PURE__*/function () {\n      var _ref15 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee10(e) {\n        var s, t, i;\n        return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n          while (1) switch (_context10.prev = _context10.next) {\n            case 0:\n              _this.isInitialized();\n              _context10.next = 3;\n              return _this.isValidRespond(e);\n            case 3:\n              s = e.topic, t = e.response, i = t.id;\n              if (!N(t)) {\n                _context10.next = 9;\n                break;\n              }\n              _context10.next = 7;\n              return _this.sendResult(i, s, t.result);\n            case 7:\n              _context10.next = 13;\n              break;\n            case 9:\n              _context10.t0 = q(t);\n              if (!_context10.t0) {\n                _context10.next = 13;\n                break;\n              }\n              _context10.next = 13;\n              return _this.sendError(i, s, t.error);\n            case 13:\n              _this.deletePendingSessionRequest(e.response.id, {\n                message: \"fulfilled\",\n                code: 0\n              });\n            case 14:\n            case \"end\":\n              return _context10.stop();\n          }\n        }, _callee10);\n      }));\n      return function (_x9) {\n        return _ref15.apply(this, arguments);\n      };\n    }(), _this.ping = /*#__PURE__*/function () {\n      var _ref16 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee11(e) {\n        var s, t, _v6, i, o, r;\n        return _regeneratorRuntime().wrap(function _callee11$(_context11) {\n          while (1) switch (_context11.prev = _context11.next) {\n            case 0:\n              _this.isInitialized();\n              _context11.next = 3;\n              return _this.isValidPing(e);\n            case 3:\n              s = e.topic;\n              if (!_this.client.session.keys.includes(s)) {\n                _context11.next = 17;\n                break;\n              }\n              _context11.next = 7;\n              return _this.sendRequest(s, \"wc_sessionPing\", {});\n            case 7:\n              t = _context11.sent;\n              _v6 = v();\n              i = _v6.done;\n              o = _v6.resolve;\n              r = _v6.reject;\n              _this.events.once(p(\"session_ping\", t), function (_ref17) {\n                var a = _ref17.error;\n                a ? r(a) : o();\n              });\n              _context11.next = 15;\n              return i();\n            case 15:\n              _context11.next = 21;\n              break;\n            case 17:\n              _context11.t0 = _this.client.core.pairing.pairings.keys.includes(s);\n              if (!_context11.t0) {\n                _context11.next = 21;\n                break;\n              }\n              _context11.next = 21;\n              return _this.client.core.pairing.ping({\n                topic: s\n              });\n            case 21:\n            case \"end\":\n              return _context11.stop();\n          }\n        }, _callee11);\n      }));\n      return function (_x10) {\n        return _ref16.apply(this, arguments);\n      };\n    }(), _this.emit = /*#__PURE__*/function () {\n      var _ref18 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee12(e) {\n        var s, t, i;\n        return _regeneratorRuntime().wrap(function _callee12$(_context12) {\n          while (1) switch (_context12.prev = _context12.next) {\n            case 0:\n              _this.isInitialized();\n              _context12.next = 3;\n              return _this.isValidEmit(e);\n            case 3:\n              s = e.topic, t = e.event, i = e.chainId;\n              _context12.next = 6;\n              return _this.sendRequest(s, \"wc_sessionEvent\", {\n                event: t,\n                chainId: i\n              });\n            case 6:\n            case \"end\":\n              return _context12.stop();\n          }\n        }, _callee12);\n      }));\n      return function (_x11) {\n        return _ref18.apply(this, arguments);\n      };\n    }(), _this.disconnect = /*#__PURE__*/function () {\n      var _ref19 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee13(e) {\n        var s;\n        return _regeneratorRuntime().wrap(function _callee13$(_context13) {\n          while (1) switch (_context13.prev = _context13.next) {\n            case 0:\n              _this.isInitialized();\n              _context13.next = 3;\n              return _this.isValidDisconnect(e);\n            case 3:\n              s = e.topic;\n              if (!_this.client.session.keys.includes(s)) {\n                _context13.next = 11;\n                break;\n              }\n              _context13.next = 7;\n              return _this.sendRequest(s, \"wc_sessionDelete\", R(\"USER_DISCONNECTED\"));\n            case 7:\n              _context13.next = 9;\n              return _this.deleteSession(s);\n            case 9:\n              _context13.next = 13;\n              break;\n            case 11:\n              _context13.next = 13;\n              return _this.client.core.pairing.disconnect({\n                topic: s\n              });\n            case 13:\n            case \"end\":\n              return _context13.stop();\n          }\n        }, _callee13);\n      }));\n      return function (_x12) {\n        return _ref19.apply(this, arguments);\n      };\n    }(), _this.find = function (e) {\n      return _this.isInitialized(), _this.client.session.getAll().filter(function (s) {\n        return Se(s, e);\n      });\n    }, _this.getPendingSessionRequests = function () {\n      return _this.isInitialized(), _this.client.pendingRequest.getAll();\n    }, _this.deleteSession = /*#__PURE__*/function () {\n      var _ref20 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee14(e, s) {\n        var _this$client$session$, t;\n        return _regeneratorRuntime().wrap(function _callee14$(_context14) {\n          while (1) switch (_context14.prev = _context14.next) {\n            case 0:\n              _this$client$session$ = _this.client.session.get(e), t = _this$client$session$.self;\n              _context14.next = 3;\n              return _this.client.core.relayer.unsubscribe(e);\n            case 3:\n              _context14.next = 5;\n              return Promise.all([_this.client.session.delete(e, R(\"USER_DISCONNECTED\")), _this.client.core.crypto.deleteKeyPair(t.publicKey), _this.client.core.crypto.deleteSymKey(e), s ? Promise.resolve() : _this.client.core.expirer.del(e)]);\n            case 5:\n            case \"end\":\n              return _context14.stop();\n          }\n        }, _callee14);\n      }));\n      return function (_x13, _x14) {\n        return _ref20.apply(this, arguments);\n      };\n    }(), _this.deleteProposal = /*#__PURE__*/function () {\n      var _ref21 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee15(e, s) {\n        return _regeneratorRuntime().wrap(function _callee15$(_context15) {\n          while (1) switch (_context15.prev = _context15.next) {\n            case 0:\n              _context15.next = 2;\n              return Promise.all([_this.client.proposal.delete(e, R(\"USER_DISCONNECTED\")), s ? Promise.resolve() : _this.client.core.expirer.del(e)]);\n            case 2:\n            case \"end\":\n              return _context15.stop();\n          }\n        }, _callee15);\n      }));\n      return function (_x15, _x16) {\n        return _ref21.apply(this, arguments);\n      };\n    }(), _this.deletePendingSessionRequest = /*#__PURE__*/function () {\n      var _ref22 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee16(e, s) {\n        var t,\n          _args16 = arguments;\n        return _regeneratorRuntime().wrap(function _callee16$(_context16) {\n          while (1) switch (_context16.prev = _context16.next) {\n            case 0:\n              t = _args16.length > 2 && _args16[2] !== undefined ? _args16[2] : !1;\n              _context16.next = 3;\n              return Promise.all([_this.client.pendingRequest.delete(e, s), t ? Promise.resolve() : _this.client.core.expirer.del(e)]);\n            case 3:\n            case \"end\":\n              return _context16.stop();\n          }\n        }, _callee16);\n      }));\n      return function (_x17, _x18) {\n        return _ref22.apply(this, arguments);\n      };\n    }(), _this.setExpiry = /*#__PURE__*/function () {\n      var _ref23 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee17(e, s) {\n        return _regeneratorRuntime().wrap(function _callee17$(_context17) {\n          while (1) switch (_context17.prev = _context17.next) {\n            case 0:\n              _context17.t0 = _this.client.session.keys.includes(e);\n              if (!_context17.t0) {\n                _context17.next = 4;\n                break;\n              }\n              _context17.next = 4;\n              return _this.client.session.update(e, {\n                expiry: s\n              });\n            case 4:\n              _this.client.core.expirer.set(e, s);\n            case 5:\n            case \"end\":\n              return _context17.stop();\n          }\n        }, _callee17);\n      }));\n      return function (_x19, _x20) {\n        return _ref23.apply(this, arguments);\n      };\n    }(), _this.setProposal = /*#__PURE__*/function () {\n      var _ref24 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee18(e, s) {\n        return _regeneratorRuntime().wrap(function _callee18$(_context18) {\n          while (1) switch (_context18.prev = _context18.next) {\n            case 0:\n              _context18.next = 2;\n              return _this.client.proposal.set(e, s);\n            case 2:\n              _this.client.core.expirer.set(e, s.expiry);\n            case 3:\n            case \"end\":\n              return _context18.stop();\n          }\n        }, _callee18);\n      }));\n      return function (_x21, _x22) {\n        return _ref24.apply(this, arguments);\n      };\n    }(), _this.setPendingSessionRequest = /*#__PURE__*/function () {\n      var _ref25 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee19(e) {\n        var s, t, i, o;\n        return _regeneratorRuntime().wrap(function _callee19$(_context19) {\n          while (1) switch (_context19.prev = _context19.next) {\n            case 0:\n              s = V.wc_sessionRequest.req.ttl, t = e.id, i = e.topic, o = e.params;\n              _context19.next = 3;\n              return _this.client.pendingRequest.set(t, {\n                id: t,\n                topic: i,\n                params: o\n              });\n            case 3:\n              s && _this.client.core.expirer.set(t, _(s));\n            case 4:\n            case \"end\":\n              return _context19.stop();\n          }\n        }, _callee19);\n      }));\n      return function (_x23) {\n        return _ref25.apply(this, arguments);\n      };\n    }(), _this.sendRequest = /*#__PURE__*/function () {\n      var _ref26 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee20(e, s, t, i) {\n        var o, r, a;\n        return _regeneratorRuntime().wrap(function _callee20$(_context20) {\n          while (1) switch (_context20.prev = _context20.next) {\n            case 0:\n              o = Ce(s, t);\n              _context20.next = 3;\n              return _this.client.core.crypto.encode(e, o);\n            case 3:\n              r = _context20.sent;\n              a = V[s].req;\n              return _context20.abrupt(\"return\", (i && (a.ttl = i), _this.client.core.history.set(e, o), _this.client.core.relayer.publish(e, r, a), o.id));\n            case 6:\n            case \"end\":\n              return _context20.stop();\n          }\n        }, _callee20);\n      }));\n      return function (_x24, _x25, _x26, _x27) {\n        return _ref26.apply(this, arguments);\n      };\n    }(), _this.sendResult = /*#__PURE__*/function () {\n      var _ref27 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee21(e, s, t) {\n        var i, o, r, a;\n        return _regeneratorRuntime().wrap(function _callee21$(_context21) {\n          while (1) switch (_context21.prev = _context21.next) {\n            case 0:\n              i = Ge(e, t);\n              _context21.next = 3;\n              return _this.client.core.crypto.encode(s, i);\n            case 3:\n              o = _context21.sent;\n              _context21.next = 6;\n              return _this.client.core.history.get(s, e);\n            case 6:\n              r = _context21.sent;\n              a = V[r.request.method].res;\n              _this.client.core.relayer.publish(s, o, a);\n              _context21.next = 11;\n              return _this.client.core.history.resolve(i);\n            case 11:\n            case \"end\":\n              return _context21.stop();\n          }\n        }, _callee21);\n      }));\n      return function (_x28, _x29, _x30) {\n        return _ref27.apply(this, arguments);\n      };\n    }(), _this.sendError = /*#__PURE__*/function () {\n      var _ref28 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee22(e, s, t) {\n        var i, o, r, a;\n        return _regeneratorRuntime().wrap(function _callee22$(_context22) {\n          while (1) switch (_context22.prev = _context22.next) {\n            case 0:\n              i = $e(e, t);\n              _context22.next = 3;\n              return _this.client.core.crypto.encode(s, i);\n            case 3:\n              o = _context22.sent;\n              _context22.next = 6;\n              return _this.client.core.history.get(s, e);\n            case 6:\n              r = _context22.sent;\n              a = V[r.request.method].res;\n              _this.client.core.relayer.publish(s, o, a);\n              _context22.next = 11;\n              return _this.client.core.history.resolve(i);\n            case 11:\n            case \"end\":\n              return _context22.stop();\n          }\n        }, _callee22);\n      }));\n      return function (_x31, _x32, _x33) {\n        return _ref28.apply(this, arguments);\n      };\n    }(), _this.cleanup = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee23() {\n      var e, s;\n      return _regeneratorRuntime().wrap(function _callee23$(_context23) {\n        while (1) switch (_context23.prev = _context23.next) {\n          case 0:\n            e = [], s = [];\n            _this.client.session.getAll().forEach(function (t) {\n              f(t.expiry) && e.push(t.topic);\n            });\n            _this.client.proposal.getAll().forEach(function (t) {\n              f(t.expiry) && s.push(t.id);\n            });\n            _context23.next = 5;\n            return Promise.all([].concat(_toConsumableArray(e.map(function (t) {\n              return _this.deleteSession(t);\n            })), _toConsumableArray(s.map(function (t) {\n              return _this.deleteProposal(t);\n            }))));\n          case 5:\n          case \"end\":\n            return _context23.stop();\n        }\n      }, _callee23);\n    })), _this.onRelayEventRequest = function (e) {\n      var s = e.topic,\n        t = e.payload,\n        i = t.method;\n      switch (i) {\n        case \"wc_sessionPropose\":\n          return _this.onSessionProposeRequest(s, t);\n        case \"wc_sessionSettle\":\n          return _this.onSessionSettleRequest(s, t);\n        case \"wc_sessionUpdate\":\n          return _this.onSessionUpdateRequest(s, t);\n        case \"wc_sessionExtend\":\n          return _this.onSessionExtendRequest(s, t);\n        case \"wc_sessionPing\":\n          return _this.onSessionPingRequest(s, t);\n        case \"wc_sessionDelete\":\n          return _this.onSessionDeleteRequest(s, t);\n        case \"wc_sessionRequest\":\n          return _this.onSessionRequest(s, t);\n        case \"wc_sessionEvent\":\n          return _this.onSessionEventRequest(s, t);\n        default:\n          return _this.client.logger.info(\"Unsupported request method \".concat(i));\n      }\n    }, _this.onRelayEventResponse = /*#__PURE__*/function () {\n      var _ref30 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee24(e) {\n        var s, t, i;\n        return _regeneratorRuntime().wrap(function _callee24$(_context24) {\n          while (1) switch (_context24.prev = _context24.next) {\n            case 0:\n              s = e.topic;\n              t = e.payload;\n              _context24.next = 4;\n              return _this.client.core.history.get(s, t.id);\n            case 4:\n              i = _context24.sent.request.method;\n              _context24.t0 = i;\n              _context24.next = _context24.t0 === \"wc_sessionPropose\" ? 8 : _context24.t0 === \"wc_sessionSettle\" ? 9 : _context24.t0 === \"wc_sessionUpdate\" ? 10 : _context24.t0 === \"wc_sessionExtend\" ? 11 : _context24.t0 === \"wc_sessionPing\" ? 12 : _context24.t0 === \"wc_sessionRequest\" ? 13 : 14;\n              break;\n            case 8:\n              return _context24.abrupt(\"return\", _this.onSessionProposeResponse(s, t));\n            case 9:\n              return _context24.abrupt(\"return\", _this.onSessionSettleResponse(s, t));\n            case 10:\n              return _context24.abrupt(\"return\", _this.onSessionUpdateResponse(s, t));\n            case 11:\n              return _context24.abrupt(\"return\", _this.onSessionExtendResponse(s, t));\n            case 12:\n              return _context24.abrupt(\"return\", _this.onSessionPingResponse(s, t));\n            case 13:\n              return _context24.abrupt(\"return\", _this.onSessionRequestResponse(s, t));\n            case 14:\n              return _context24.abrupt(\"return\", _this.client.logger.info(\"Unsupported response method \".concat(i)));\n            case 15:\n            case \"end\":\n              return _context24.stop();\n          }\n        }, _callee24);\n      }));\n      return function (_x34) {\n        return _ref30.apply(this, arguments);\n      };\n    }(), _this.onSessionProposeRequest = /*#__PURE__*/function () {\n      var _ref31 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee25(e, s) {\n        var t, i, o, r;\n        return _regeneratorRuntime().wrap(function _callee25$(_context25) {\n          while (1) switch (_context25.prev = _context25.next) {\n            case 0:\n              t = s.params, i = s.id;\n              _context25.prev = 1;\n              _this.isValidConnect(u({}, s.params));\n              o = _(w), r = u({\n                id: i,\n                pairingTopic: e,\n                expiry: o\n              }, t);\n              _context25.next = 6;\n              return _this.setProposal(i, r);\n            case 6:\n              _this.client.events.emit(\"session_proposal\", {\n                id: i,\n                params: r\n              });\n              _context25.next = 14;\n              break;\n            case 9:\n              _context25.prev = 9;\n              _context25.t0 = _context25[\"catch\"](1);\n              _context25.next = 13;\n              return _this.sendError(i, e, _context25.t0);\n            case 13:\n              _this.client.logger.error(_context25.t0);\n            case 14:\n            case \"end\":\n              return _context25.stop();\n          }\n        }, _callee25, null, [[1, 9]]);\n      }));\n      return function (_x35, _x36) {\n        return _ref31.apply(this, arguments);\n      };\n    }(), _this.onSessionProposeResponse = /*#__PURE__*/function () {\n      var _ref32 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee26(e, s) {\n        var t, i, o, r, a, l, h;\n        return _regeneratorRuntime().wrap(function _callee26$(_context26) {\n          while (1) switch (_context26.prev = _context26.next) {\n            case 0:\n              t = s.id;\n              if (!N(s)) {\n                _context26.next = 22;\n                break;\n              }\n              i = s.result;\n              _this.client.logger.trace({\n                type: \"method\",\n                method: \"onSessionProposeResponse\",\n                result: i\n              });\n              o = _this.client.proposal.get(t);\n              _this.client.logger.trace({\n                type: \"method\",\n                method: \"onSessionProposeResponse\",\n                proposal: o\n              });\n              r = o.proposer.publicKey;\n              _this.client.logger.trace({\n                type: \"method\",\n                method: \"onSessionProposeResponse\",\n                selfPublicKey: r\n              });\n              a = i.responderPublicKey;\n              _this.client.logger.trace({\n                type: \"method\",\n                method: \"onSessionProposeResponse\",\n                peerPublicKey: a\n              });\n              _context26.next = 12;\n              return _this.client.core.crypto.generateSharedKey(r, a);\n            case 12:\n              l = _context26.sent;\n              _this.client.logger.trace({\n                type: \"method\",\n                method: \"onSessionProposeResponse\",\n                sessionTopic: l\n              });\n              _context26.next = 16;\n              return _this.client.core.relayer.subscribe(l);\n            case 16:\n              h = _context26.sent;\n              _this.client.logger.trace({\n                type: \"method\",\n                method: \"onSessionProposeResponse\",\n                subscriptionId: h\n              });\n              _context26.next = 20;\n              return _this.client.core.pairing.activate({\n                topic: e\n              });\n            case 20:\n              _context26.next = 27;\n              break;\n            case 22:\n              _context26.t0 = q(s);\n              if (!_context26.t0) {\n                _context26.next = 27;\n                break;\n              }\n              _context26.next = 26;\n              return _this.client.proposal.delete(t, R(\"USER_DISCONNECTED\"));\n            case 26:\n              _this.events.emit(p(\"session_connect\"), {\n                error: s.error\n              });\n            case 27:\n            case \"end\":\n              return _context26.stop();\n          }\n        }, _callee26);\n      }));\n      return function (_x37, _x38) {\n        return _ref32.apply(this, arguments);\n      };\n    }(), _this.onSessionSettleRequest = /*#__PURE__*/function () {\n      var _ref33 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee27(e, s) {\n        var t, i, _s$params, o, r, a, l, h, S, m, P;\n        return _regeneratorRuntime().wrap(function _callee27$(_context27) {\n          while (1) switch (_context27.prev = _context27.next) {\n            case 0:\n              t = s.id, i = s.params;\n              _context27.prev = 1;\n              _this.isValidSessionSettleRequest(i);\n              _s$params = s.params, o = _s$params.relay, r = _s$params.controller, a = _s$params.expiry, l = _s$params.namespaces, h = _s$params.requiredNamespaces, S = _s$params.optionalNamespaces, m = _s$params.sessionProperties, P = u({\n                topic: e,\n                relay: o,\n                expiry: a,\n                namespaces: l,\n                acknowledged: !0,\n                requiredNamespaces: h,\n                optionalNamespaces: S,\n                controller: r.publicKey,\n                self: {\n                  publicKey: \"\",\n                  metadata: _this.client.metadata\n                },\n                peer: {\n                  publicKey: r.publicKey,\n                  metadata: r.metadata\n                }\n              }, m && {\n                sessionProperties: m\n              });\n              _context27.next = 6;\n              return _this.sendResult(s.id, e, !0);\n            case 6:\n              _this.events.emit(p(\"session_connect\"), {\n                session: P\n              });\n              _context27.next = 14;\n              break;\n            case 9:\n              _context27.prev = 9;\n              _context27.t0 = _context27[\"catch\"](1);\n              _context27.next = 13;\n              return _this.sendError(t, e, _context27.t0);\n            case 13:\n              _this.client.logger.error(_context27.t0);\n            case 14:\n            case \"end\":\n              return _context27.stop();\n          }\n        }, _callee27, null, [[1, 9]]);\n      }));\n      return function (_x39, _x40) {\n        return _ref33.apply(this, arguments);\n      };\n    }(), _this.onSessionSettleResponse = /*#__PURE__*/function () {\n      var _ref34 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee28(e, s) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee28$(_context28) {\n          while (1) switch (_context28.prev = _context28.next) {\n            case 0:\n              t = s.id;\n              if (!N(s)) {\n                _context28.next = 7;\n                break;\n              }\n              _context28.next = 4;\n              return _this.client.session.update(e, {\n                acknowledged: !0\n              });\n            case 4:\n              _this.events.emit(p(\"session_approve\", t), {});\n              _context28.next = 12;\n              break;\n            case 7:\n              _context28.t0 = q(s);\n              if (!_context28.t0) {\n                _context28.next = 12;\n                break;\n              }\n              _context28.next = 11;\n              return _this.client.session.delete(e, R(\"USER_DISCONNECTED\"));\n            case 11:\n              _this.events.emit(p(\"session_approve\", t), {\n                error: s.error\n              });\n            case 12:\n            case \"end\":\n              return _context28.stop();\n          }\n        }, _callee28);\n      }));\n      return function (_x41, _x42) {\n        return _ref34.apply(this, arguments);\n      };\n    }(), _this.onSessionUpdateRequest = /*#__PURE__*/function () {\n      var _ref35 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee29(e, s) {\n        var t, i;\n        return _regeneratorRuntime().wrap(function _callee29$(_context29) {\n          while (1) switch (_context29.prev = _context29.next) {\n            case 0:\n              t = s.params, i = s.id;\n              _context29.prev = 1;\n              _this.isValidUpdate(u({\n                topic: e\n              }, t));\n              _context29.next = 5;\n              return _this.client.session.update(e, {\n                namespaces: t.namespaces\n              });\n            case 5:\n              _context29.next = 7;\n              return _this.sendResult(i, e, !0);\n            case 7:\n              _this.client.events.emit(\"session_update\", {\n                id: i,\n                topic: e,\n                params: t\n              });\n              _context29.next = 15;\n              break;\n            case 10:\n              _context29.prev = 10;\n              _context29.t0 = _context29[\"catch\"](1);\n              _context29.next = 14;\n              return _this.sendError(i, e, _context29.t0);\n            case 14:\n              _this.client.logger.error(_context29.t0);\n            case 15:\n            case \"end\":\n              return _context29.stop();\n          }\n        }, _callee29, null, [[1, 10]]);\n      }));\n      return function (_x43, _x44) {\n        return _ref35.apply(this, arguments);\n      };\n    }(), _this.onSessionUpdateResponse = function (e, s) {\n      var t = s.id;\n      N(s) ? _this.events.emit(p(\"session_update\", t), {}) : q(s) && _this.events.emit(p(\"session_update\", t), {\n        error: s.error\n      });\n    }, _this.onSessionExtendRequest = /*#__PURE__*/function () {\n      var _ref36 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee30(e, s) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee30$(_context30) {\n          while (1) switch (_context30.prev = _context30.next) {\n            case 0:\n              t = s.id;\n              _context30.prev = 1;\n              _this.isValidExtend({\n                topic: e\n              });\n              _context30.next = 5;\n              return _this.setExpiry(e, _(b));\n            case 5:\n              _context30.next = 7;\n              return _this.sendResult(t, e, !0);\n            case 7:\n              _this.client.events.emit(\"session_extend\", {\n                id: t,\n                topic: e\n              });\n              _context30.next = 15;\n              break;\n            case 10:\n              _context30.prev = 10;\n              _context30.t0 = _context30[\"catch\"](1);\n              _context30.next = 14;\n              return _this.sendError(t, e, _context30.t0);\n            case 14:\n              _this.client.logger.error(_context30.t0);\n            case 15:\n            case \"end\":\n              return _context30.stop();\n          }\n        }, _callee30, null, [[1, 10]]);\n      }));\n      return function (_x45, _x46) {\n        return _ref36.apply(this, arguments);\n      };\n    }(), _this.onSessionExtendResponse = function (e, s) {\n      var t = s.id;\n      N(s) ? _this.events.emit(p(\"session_extend\", t), {}) : q(s) && _this.events.emit(p(\"session_extend\", t), {\n        error: s.error\n      });\n    }, _this.onSessionPingRequest = /*#__PURE__*/function () {\n      var _ref37 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee31(e, s) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee31$(_context31) {\n          while (1) switch (_context31.prev = _context31.next) {\n            case 0:\n              t = s.id;\n              _context31.prev = 1;\n              _this.isValidPing({\n                topic: e\n              });\n              _context31.next = 5;\n              return _this.sendResult(t, e, !0);\n            case 5:\n              _this.client.events.emit(\"session_ping\", {\n                id: t,\n                topic: e\n              });\n              _context31.next = 13;\n              break;\n            case 8:\n              _context31.prev = 8;\n              _context31.t0 = _context31[\"catch\"](1);\n              _context31.next = 12;\n              return _this.sendError(t, e, _context31.t0);\n            case 12:\n              _this.client.logger.error(_context31.t0);\n            case 13:\n            case \"end\":\n              return _context31.stop();\n          }\n        }, _callee31, null, [[1, 8]]);\n      }));\n      return function (_x47, _x48) {\n        return _ref37.apply(this, arguments);\n      };\n    }(), _this.onSessionPingResponse = function (e, s) {\n      var t = s.id;\n      setTimeout(function () {\n        N(s) ? _this.events.emit(p(\"session_ping\", t), {}) : q(s) && _this.events.emit(p(\"session_ping\", t), {\n          error: s.error\n        });\n      }, 500);\n    }, _this.onSessionDeleteRequest = /*#__PURE__*/function () {\n      var _ref38 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee33(e, s) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee33$(_context33) {\n          while (1) switch (_context33.prev = _context33.next) {\n            case 0:\n              t = s.id;\n              _context33.prev = 1;\n              _this.isValidDisconnect({\n                topic: e,\n                reason: s.params\n              });\n              _this.client.core.relayer.once(F.publish, /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee32() {\n                return _regeneratorRuntime().wrap(function _callee32$(_context32) {\n                  while (1) switch (_context32.prev = _context32.next) {\n                    case 0:\n                      _context32.next = 2;\n                      return _this.deleteSession(e);\n                    case 2:\n                    case \"end\":\n                      return _context32.stop();\n                  }\n                }, _callee32);\n              })));\n              _context33.next = 6;\n              return _this.sendResult(t, e, !0);\n            case 6:\n              _this.client.events.emit(\"session_delete\", {\n                id: t,\n                topic: e\n              });\n              _context33.next = 14;\n              break;\n            case 9:\n              _context33.prev = 9;\n              _context33.t0 = _context33[\"catch\"](1);\n              _context33.next = 13;\n              return _this.sendError(t, e, _context33.t0);\n            case 13:\n              _this.client.logger.error(_context33.t0);\n            case 14:\n            case \"end\":\n              return _context33.stop();\n          }\n        }, _callee33, null, [[1, 9]]);\n      }));\n      return function (_x49, _x50) {\n        return _ref38.apply(this, arguments);\n      };\n    }(), _this.onSessionRequest = /*#__PURE__*/function () {\n      var _ref40 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee34(e, s) {\n        var t, i;\n        return _regeneratorRuntime().wrap(function _callee34$(_context34) {\n          while (1) switch (_context34.prev = _context34.next) {\n            case 0:\n              t = s.id, i = s.params;\n              _context34.prev = 1;\n              _this.isValidRequest(u({\n                topic: e\n              }, i));\n              _context34.next = 5;\n              return _this.setPendingSessionRequest({\n                id: t,\n                topic: e,\n                params: i\n              });\n            case 5:\n              _this.client.events.emit(\"session_request\", {\n                id: t,\n                topic: e,\n                params: i\n              });\n              _context34.next = 13;\n              break;\n            case 8:\n              _context34.prev = 8;\n              _context34.t0 = _context34[\"catch\"](1);\n              _context34.next = 12;\n              return _this.sendError(t, e, _context34.t0);\n            case 12:\n              _this.client.logger.error(_context34.t0);\n            case 13:\n            case \"end\":\n              return _context34.stop();\n          }\n        }, _callee34, null, [[1, 8]]);\n      }));\n      return function (_x51, _x52) {\n        return _ref40.apply(this, arguments);\n      };\n    }(), _this.onSessionRequestResponse = function (e, s) {\n      var t = s.id;\n      N(s) ? _this.events.emit(p(\"session_request\", t), {\n        result: s.result\n      }) : q(s) && _this.events.emit(p(\"session_request\", t), {\n        error: s.error\n      });\n    }, _this.onSessionEventRequest = /*#__PURE__*/function () {\n      var _ref41 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee35(e, s) {\n        var t, i;\n        return _regeneratorRuntime().wrap(function _callee35$(_context35) {\n          while (1) switch (_context35.prev = _context35.next) {\n            case 0:\n              t = s.id, i = s.params;\n              _context35.prev = 1;\n              _this.isValidEmit(u({\n                topic: e\n              }, i)), _this.client.events.emit(\"session_event\", {\n                id: t,\n                topic: e,\n                params: i\n              });\n              _context35.next = 10;\n              break;\n            case 5:\n              _context35.prev = 5;\n              _context35.t0 = _context35[\"catch\"](1);\n              _context35.next = 9;\n              return _this.sendError(t, e, _context35.t0);\n            case 9:\n              _this.client.logger.error(_context35.t0);\n            case 10:\n            case \"end\":\n              return _context35.stop();\n          }\n        }, _callee35, null, [[1, 5]]);\n      }));\n      return function (_x53, _x54) {\n        return _ref41.apply(this, arguments);\n      };\n    }(), _this.isValidConnect = /*#__PURE__*/function () {\n      var _ref42 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee36(e) {\n        var _c2, a, s, t, i, o, r, _c3, _a;\n        return _regeneratorRuntime().wrap(function _callee36$(_context36) {\n          while (1) switch (_context36.prev = _context36.next) {\n            case 0:\n              if (y(e)) {\n                _context36.next = 3;\n                break;\n              }\n              _c2 = c(\"MISSING_OR_INVALID\", \"connect() params: \".concat(JSON.stringify(e))), a = _c2.message;\n              throw new Error(a);\n            case 3:\n              s = e.pairingTopic, t = e.requiredNamespaces, i = e.optionalNamespaces, o = e.sessionProperties, r = e.relays;\n              _context36.t0 = D(s);\n              if (_context36.t0) {\n                _context36.next = 8;\n                break;\n              }\n              _context36.next = 8;\n              return _this.isValidPairingTopic(s);\n            case 8:\n              if (Ee(r, !0)) {\n                _context36.next = 11;\n                break;\n              }\n              _c3 = c(\"MISSING_OR_INVALID\", \"connect() relays: \".concat(r)), _a = _c3.message;\n              throw new Error(_a);\n            case 11:\n              !D(t) && j(t) !== 0 && _this.validateNamespaces(t, \"requiredNamespaces\"), !D(i) && j(i) !== 0 && _this.validateNamespaces(i, \"optionalNamespaces\"), D(o) || _this.validateSessionProps(o, \"sessionProperties\");\n            case 12:\n            case \"end\":\n              return _context36.stop();\n          }\n        }, _callee36);\n      }));\n      return function (_x55) {\n        return _ref42.apply(this, arguments);\n      };\n    }(), _this.validateNamespaces = function (e, s) {\n      var t = Ie(e, \"connect()\", s);\n      if (t) throw new Error(t.message);\n    }, _this.isValidApprove = /*#__PURE__*/function () {\n      var _ref43 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee37(e) {\n        var s, t, i, o, r, a, l, _c4, h;\n        return _regeneratorRuntime().wrap(function _callee37$(_context37) {\n          while (1) switch (_context37.prev = _context37.next) {\n            case 0:\n              if (y(e)) {\n                _context37.next = 2;\n                break;\n              }\n              throw new Error(c(\"MISSING_OR_INVALID\", \"approve() params: \".concat(e)).message);\n            case 2:\n              s = e.id, t = e.namespaces, i = e.relayProtocol, o = e.sessionProperties;\n              _context37.next = 5;\n              return _this.isValidProposalId(s);\n            case 5:\n              r = _this.client.proposal.get(s), a = Y(t, \"approve()\");\n              if (!a) {\n                _context37.next = 8;\n                break;\n              }\n              throw new Error(a.message);\n            case 8:\n              l = B(r.requiredNamespaces, t, \"approve()\");\n              if (!l) {\n                _context37.next = 11;\n                break;\n              }\n              throw new Error(l.message);\n            case 11:\n              if (A(i, !0)) {\n                _context37.next = 14;\n                break;\n              }\n              _c4 = c(\"MISSING_OR_INVALID\", \"approve() relayProtocol: \".concat(i)), h = _c4.message;\n              throw new Error(h);\n            case 14:\n              D(o) || _this.validateSessionProps(o, \"sessionProperties\");\n            case 15:\n            case \"end\":\n              return _context37.stop();\n          }\n        }, _callee37);\n      }));\n      return function (_x56) {\n        return _ref43.apply(this, arguments);\n      };\n    }(), _this.isValidReject = /*#__PURE__*/function () {\n      var _ref44 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee38(e) {\n        var _c5, i, s, t, _c6, _i;\n        return _regeneratorRuntime().wrap(function _callee38$(_context38) {\n          while (1) switch (_context38.prev = _context38.next) {\n            case 0:\n              if (y(e)) {\n                _context38.next = 3;\n                break;\n              }\n              _c5 = c(\"MISSING_OR_INVALID\", \"reject() params: \".concat(e)), i = _c5.message;\n              throw new Error(i);\n            case 3:\n              s = e.id, t = e.reason;\n              _context38.next = 6;\n              return _this.isValidProposalId(s);\n            case 6:\n              if (_e(t)) {\n                _context38.next = 9;\n                break;\n              }\n              _c6 = c(\"MISSING_OR_INVALID\", \"reject() reason: \".concat(JSON.stringify(t))), _i = _c6.message;\n              throw new Error(_i);\n            case 9:\n            case \"end\":\n              return _context38.stop();\n          }\n        }, _callee38);\n      }));\n      return function (_x57) {\n        return _ref44.apply(this, arguments);\n      };\n    }(), _this.isValidSessionSettleRequest = function (e) {\n      if (!y(e)) {\n        var _c7 = c(\"MISSING_OR_INVALID\", \"onSessionSettleRequest() params: \".concat(e)),\n          l = _c7.message;\n        throw new Error(l);\n      }\n      var s = e.relay,\n        t = e.controller,\n        i = e.namespaces,\n        o = e.expiry;\n      if (!Re(s)) {\n        var _c8 = c(\"MISSING_OR_INVALID\", \"onSessionSettleRequest() relay protocol should be a string\"),\n          _l = _c8.message;\n        throw new Error(_l);\n      }\n      var r = Ne(t, \"onSessionSettleRequest()\");\n      if (r) throw new Error(r.message);\n      var a = Y(i, \"onSessionSettleRequest()\");\n      if (a) throw new Error(a.message);\n      if (f(o)) {\n        var _c9 = c(\"EXPIRED\", \"onSessionSettleRequest()\"),\n          _l2 = _c9.message;\n        throw new Error(_l2);\n      }\n    }, _this.isValidUpdate = /*#__PURE__*/function () {\n      var _ref45 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee39(e) {\n        var _c10, a, s, t, i, o, r;\n        return _regeneratorRuntime().wrap(function _callee39$(_context39) {\n          while (1) switch (_context39.prev = _context39.next) {\n            case 0:\n              if (y(e)) {\n                _context39.next = 3;\n                break;\n              }\n              _c10 = c(\"MISSING_OR_INVALID\", \"update() params: \".concat(e)), a = _c10.message;\n              throw new Error(a);\n            case 3:\n              s = e.topic, t = e.namespaces;\n              _context39.next = 6;\n              return _this.isValidSessionTopic(s);\n            case 6:\n              i = _this.client.session.get(s), o = Y(t, \"update()\");\n              if (!o) {\n                _context39.next = 9;\n                break;\n              }\n              throw new Error(o.message);\n            case 9:\n              r = B(i.requiredNamespaces, t, \"update()\");\n              if (!r) {\n                _context39.next = 12;\n                break;\n              }\n              throw new Error(r.message);\n            case 12:\n            case \"end\":\n              return _context39.stop();\n          }\n        }, _callee39);\n      }));\n      return function (_x58) {\n        return _ref45.apply(this, arguments);\n      };\n    }(), _this.isValidExtend = /*#__PURE__*/function () {\n      var _ref46 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee40(e) {\n        var _c11, t, s;\n        return _regeneratorRuntime().wrap(function _callee40$(_context40) {\n          while (1) switch (_context40.prev = _context40.next) {\n            case 0:\n              if (y(e)) {\n                _context40.next = 3;\n                break;\n              }\n              _c11 = c(\"MISSING_OR_INVALID\", \"extend() params: \".concat(e)), t = _c11.message;\n              throw new Error(t);\n            case 3:\n              s = e.topic;\n              _context40.next = 6;\n              return _this.isValidSessionTopic(s);\n            case 6:\n            case \"end\":\n              return _context40.stop();\n          }\n        }, _callee40);\n      }));\n      return function (_x59) {\n        return _ref46.apply(this, arguments);\n      };\n    }(), _this.isValidRequest = /*#__PURE__*/function () {\n      var _ref47 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee41(e) {\n        var _c12, a, s, t, i, o, _this$client$session$2, r, _c13, _a2, _c14, _a3, _c15, _a4, _c16, _a5;\n        return _regeneratorRuntime().wrap(function _callee41$(_context41) {\n          while (1) switch (_context41.prev = _context41.next) {\n            case 0:\n              if (y(e)) {\n                _context41.next = 3;\n                break;\n              }\n              _c12 = c(\"MISSING_OR_INVALID\", \"request() params: \".concat(e)), a = _c12.message;\n              throw new Error(a);\n            case 3:\n              s = e.topic, t = e.request, i = e.chainId, o = e.expiry;\n              _context41.next = 6;\n              return _this.isValidSessionTopic(s);\n            case 6:\n              _this$client$session$2 = _this.client.session.get(s), r = _this$client$session$2.namespaces;\n              if (Q(r, i)) {\n                _context41.next = 10;\n                break;\n              }\n              _c13 = c(\"MISSING_OR_INVALID\", \"request() chainId: \".concat(i)), _a2 = _c13.message;\n              throw new Error(_a2);\n            case 10:\n              if (qe(t)) {\n                _context41.next = 13;\n                break;\n              }\n              _c14 = c(\"MISSING_OR_INVALID\", \"request() \".concat(JSON.stringify(t))), _a3 = _c14.message;\n              throw new Error(_a3);\n            case 13:\n              if (Pe(r, i, t.method)) {\n                _context41.next = 16;\n                break;\n              }\n              _c15 = c(\"MISSING_OR_INVALID\", \"request() method: \".concat(t.method)), _a4 = _c15.message;\n              throw new Error(_a4);\n            case 16:\n              if (!(o && !ve(o, $))) {\n                _context41.next = 19;\n                break;\n              }\n              _c16 = c(\"MISSING_OR_INVALID\", \"request() expiry: \".concat(o, \". Expiry must be a number (in seconds) between \").concat($.min, \" and \").concat($.max)), _a5 = _c16.message;\n              throw new Error(_a5);\n            case 19:\n            case \"end\":\n              return _context41.stop();\n          }\n        }, _callee41);\n      }));\n      return function (_x60) {\n        return _ref47.apply(this, arguments);\n      };\n    }(), _this.isValidRespond = /*#__PURE__*/function () {\n      var _ref48 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee42(e) {\n        var _c17, i, s, t, _c18, _i2;\n        return _regeneratorRuntime().wrap(function _callee42$(_context42) {\n          while (1) switch (_context42.prev = _context42.next) {\n            case 0:\n              if (y(e)) {\n                _context42.next = 3;\n                break;\n              }\n              _c17 = c(\"MISSING_OR_INVALID\", \"respond() params: \".concat(e)), i = _c17.message;\n              throw new Error(i);\n            case 3:\n              s = e.topic, t = e.response;\n              _context42.next = 6;\n              return _this.isValidSessionTopic(s);\n            case 6:\n              if (fe(t)) {\n                _context42.next = 9;\n                break;\n              }\n              _c18 = c(\"MISSING_OR_INVALID\", \"respond() response: \".concat(JSON.stringify(t))), _i2 = _c18.message;\n              throw new Error(_i2);\n            case 9:\n            case \"end\":\n              return _context42.stop();\n          }\n        }, _callee42);\n      }));\n      return function (_x61) {\n        return _ref48.apply(this, arguments);\n      };\n    }(), _this.isValidPing = /*#__PURE__*/function () {\n      var _ref49 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee43(e) {\n        var _c19, t, s;\n        return _regeneratorRuntime().wrap(function _callee43$(_context43) {\n          while (1) switch (_context43.prev = _context43.next) {\n            case 0:\n              if (y(e)) {\n                _context43.next = 3;\n                break;\n              }\n              _c19 = c(\"MISSING_OR_INVALID\", \"ping() params: \".concat(e)), t = _c19.message;\n              throw new Error(t);\n            case 3:\n              s = e.topic;\n              _context43.next = 6;\n              return _this.isValidSessionOrPairingTopic(s);\n            case 6:\n            case \"end\":\n              return _context43.stop();\n          }\n        }, _callee43);\n      }));\n      return function (_x62) {\n        return _ref49.apply(this, arguments);\n      };\n    }(), _this.isValidEmit = /*#__PURE__*/function () {\n      var _ref50 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee44(e) {\n        var _c20, r, s, t, i, _this$client$session$3, o, _c21, _r, _c22, _r2, _c23, _r3;\n        return _regeneratorRuntime().wrap(function _callee44$(_context44) {\n          while (1) switch (_context44.prev = _context44.next) {\n            case 0:\n              if (y(e)) {\n                _context44.next = 3;\n                break;\n              }\n              _c20 = c(\"MISSING_OR_INVALID\", \"emit() params: \".concat(e)), r = _c20.message;\n              throw new Error(r);\n            case 3:\n              s = e.topic, t = e.event, i = e.chainId;\n              _context44.next = 6;\n              return _this.isValidSessionTopic(s);\n            case 6:\n              _this$client$session$3 = _this.client.session.get(s), o = _this$client$session$3.namespaces;\n              if (Q(o, i)) {\n                _context44.next = 10;\n                break;\n              }\n              _c21 = c(\"MISSING_OR_INVALID\", \"emit() chainId: \".concat(i)), _r = _c21.message;\n              throw new Error(_r);\n            case 10:\n              if (Oe(t)) {\n                _context44.next = 13;\n                break;\n              }\n              _c22 = c(\"MISSING_OR_INVALID\", \"emit() event: \".concat(JSON.stringify(t))), _r2 = _c22.message;\n              throw new Error(_r2);\n            case 13:\n              if (Ve(o, i, t.name)) {\n                _context44.next = 16;\n                break;\n              }\n              _c23 = c(\"MISSING_OR_INVALID\", \"emit() event: \".concat(JSON.stringify(t))), _r3 = _c23.message;\n              throw new Error(_r3);\n            case 16:\n            case \"end\":\n              return _context44.stop();\n          }\n        }, _callee44);\n      }));\n      return function (_x63) {\n        return _ref50.apply(this, arguments);\n      };\n    }(), _this.isValidDisconnect = /*#__PURE__*/function () {\n      var _ref51 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee45(e) {\n        var _c24, t, s;\n        return _regeneratorRuntime().wrap(function _callee45$(_context45) {\n          while (1) switch (_context45.prev = _context45.next) {\n            case 0:\n              if (y(e)) {\n                _context45.next = 3;\n                break;\n              }\n              _c24 = c(\"MISSING_OR_INVALID\", \"disconnect() params: \".concat(e)), t = _c24.message;\n              throw new Error(t);\n            case 3:\n              s = e.topic;\n              _context45.next = 6;\n              return _this.isValidSessionOrPairingTopic(s);\n            case 6:\n            case \"end\":\n              return _context45.stop();\n          }\n        }, _callee45);\n      }));\n      return function (_x64) {\n        return _ref51.apply(this, arguments);\n      };\n    }(), _this.validateSessionProps = function (e, s) {\n      Object.values(e).forEach(function (t) {\n        if (!A(t, !1)) {\n          var _c25 = c(\"MISSING_OR_INVALID\", \"\".concat(s, \" must be in Record<string, string> format. Received: \").concat(JSON.stringify(t))),\n            i = _c25.message;\n          throw new Error(i);\n        }\n      });\n    };\n    return _this;\n  }\n  _createClass(We, [{\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c26 = c(\"NOT_INITIALIZED\", this.name),\n          n = _c26.message;\n        throw new Error(n);\n      }\n    }\n  }, {\n    key: \"registerRelayerEvents\",\n    value: function registerRelayerEvents() {\n      var _this2 = this;\n      this.client.core.relayer.on(F.message, /*#__PURE__*/function () {\n        var _ref52 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee46(n) {\n          var e, s, t;\n          return _regeneratorRuntime().wrap(function _callee46$(_context46) {\n            while (1) switch (_context46.prev = _context46.next) {\n              case 0:\n                e = n.topic, s = n.message;\n                if (!_this2.ignoredPayloadTypes.includes(_this2.client.core.crypto.getPayloadType(s))) {\n                  _context46.next = 3;\n                  break;\n                }\n                return _context46.abrupt(\"return\");\n              case 3:\n                _context46.next = 5;\n                return _this2.client.core.crypto.decode(e, s);\n              case 5:\n                t = _context46.sent;\n                if (!Me(t)) {\n                  _context46.next = 10;\n                  break;\n                }\n                _this2.client.core.history.set(e, t), _this2.onRelayEventRequest({\n                  topic: e,\n                  payload: t\n                });\n                _context46.next = 15;\n                break;\n              case 10:\n                _context46.t0 = Ue(t);\n                if (!_context46.t0) {\n                  _context46.next = 15;\n                  break;\n                }\n                _context46.next = 14;\n                return _this2.client.core.history.resolve(t);\n              case 14:\n                _this2.onRelayEventResponse({\n                  topic: e,\n                  payload: t\n                });\n              case 15:\n              case \"end\":\n                return _context46.stop();\n            }\n          }, _callee46);\n        }));\n        return function (_x65) {\n          return _ref52.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"registerExpirerEvents\",\n    value: function registerExpirerEvents() {\n      var _this3 = this;\n      this.client.core.expirer.on(le.expired, /*#__PURE__*/function () {\n        var _ref53 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee47(n) {\n          var _Te, e, s;\n          return _regeneratorRuntime().wrap(function _callee47$(_context47) {\n            while (1) switch (_context47.prev = _context47.next) {\n              case 0:\n                _Te = Te(n.target), e = _Te.topic, s = _Te.id;\n                if (!(s && _this3.client.pendingRequest.keys.includes(s))) {\n                  _context47.next = 5;\n                  break;\n                }\n                _context47.next = 4;\n                return _this3.deletePendingSessionRequest(s, c(\"EXPIRED\"), !0);\n              case 4:\n                return _context47.abrupt(\"return\", _context47.sent);\n              case 5:\n                if (!e) {\n                  _context47.next = 13;\n                  break;\n                }\n                _context47.t0 = _this3.client.session.keys.includes(e);\n                if (!_context47.t0) {\n                  _context47.next = 11;\n                  break;\n                }\n                _context47.next = 10;\n                return _this3.deleteSession(e, !0);\n              case 10:\n                _this3.client.events.emit(\"session_expire\", {\n                  topic: e\n                });\n              case 11:\n                _context47.next = 18;\n                break;\n              case 13:\n                _context47.t1 = s;\n                if (!_context47.t1) {\n                  _context47.next = 18;\n                  break;\n                }\n                _context47.next = 17;\n                return _this3.deleteProposal(s, !0);\n              case 17:\n                _this3.client.events.emit(\"proposal_expire\", {\n                  id: s\n                });\n              case 18:\n              case \"end\":\n                return _context47.stop();\n            }\n          }, _callee47);\n        }));\n        return function (_x66) {\n          return _ref53.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"isValidPairingTopic\",\n    value: function isValidPairingTopic(n) {\n      if (!A(n, !1)) {\n        var _c27 = c(\"MISSING_OR_INVALID\", \"pairing topic should be a string: \".concat(n)),\n          e = _c27.message;\n        throw new Error(e);\n      }\n      if (!this.client.core.pairing.pairings.keys.includes(n)) {\n        var _c28 = c(\"NO_MATCHING_KEY\", \"pairing topic doesn't exist: \".concat(n)),\n          _e2 = _c28.message;\n        throw new Error(_e2);\n      }\n      if (f(this.client.core.pairing.pairings.get(n).expiry)) {\n        var _c29 = c(\"EXPIRED\", \"pairing topic: \".concat(n)),\n          _e3 = _c29.message;\n        throw new Error(_e3);\n      }\n    }\n  }, {\n    key: \"isValidSessionTopic\",\n    value: function () {\n      var _isValidSessionTopic = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee48(n) {\n        var _c30, e, _c31, _e4, _c32, _e5;\n        return _regeneratorRuntime().wrap(function _callee48$(_context48) {\n          while (1) switch (_context48.prev = _context48.next) {\n            case 0:\n              if (A(n, !1)) {\n                _context48.next = 3;\n                break;\n              }\n              _c30 = c(\"MISSING_OR_INVALID\", \"session topic should be a string: \".concat(n)), e = _c30.message;\n              throw new Error(e);\n            case 3:\n              if (this.client.session.keys.includes(n)) {\n                _context48.next = 6;\n                break;\n              }\n              _c31 = c(\"NO_MATCHING_KEY\", \"session topic doesn't exist: \".concat(n)), _e4 = _c31.message;\n              throw new Error(_e4);\n            case 6:\n              if (!f(this.client.session.get(n).expiry)) {\n                _context48.next = 11;\n                break;\n              }\n              _context48.next = 9;\n              return this.deleteSession(n);\n            case 9:\n              _c32 = c(\"EXPIRED\", \"session topic: \".concat(n)), _e5 = _c32.message;\n              throw new Error(_e5);\n            case 11:\n            case \"end\":\n              return _context48.stop();\n          }\n        }, _callee48, this);\n      }));\n      function isValidSessionTopic(_x67) {\n        return _isValidSessionTopic.apply(this, arguments);\n      }\n      return isValidSessionTopic;\n    }()\n  }, {\n    key: \"isValidSessionOrPairingTopic\",\n    value: function () {\n      var _isValidSessionOrPairingTopic = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee49(n) {\n        var _c33, e, _c34, _e6;\n        return _regeneratorRuntime().wrap(function _callee49$(_context49) {\n          while (1) switch (_context49.prev = _context49.next) {\n            case 0:\n              if (!this.client.session.keys.includes(n)) {\n                _context49.next = 5;\n                break;\n              }\n              _context49.next = 3;\n              return this.isValidSessionTopic(n);\n            case 3:\n              _context49.next = 16;\n              break;\n            case 5:\n              if (!this.client.core.pairing.pairings.keys.includes(n)) {\n                _context49.next = 9;\n                break;\n              }\n              this.isValidPairingTopic(n);\n              _context49.next = 16;\n              break;\n            case 9:\n              if (!A(n, !1)) {\n                _context49.next = 14;\n                break;\n              }\n              _c33 = c(\"NO_MATCHING_KEY\", \"session or pairing topic doesn't exist: \".concat(n)), e = _c33.message;\n              throw new Error(e);\n            case 14:\n              _c34 = c(\"MISSING_OR_INVALID\", \"session or pairing topic should be a string: \".concat(n)), _e6 = _c34.message;\n              throw new Error(_e6);\n            case 16:\n            case \"end\":\n              return _context49.stop();\n          }\n        }, _callee49, this);\n      }));\n      function isValidSessionOrPairingTopic(_x68) {\n        return _isValidSessionOrPairingTopic.apply(this, arguments);\n      }\n      return isValidSessionOrPairingTopic;\n    }()\n  }, {\n    key: \"isValidProposalId\",\n    value: function () {\n      var _isValidProposalId = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee50(n) {\n        var _c35, e, _c36, _e7, _c37, _e8;\n        return _regeneratorRuntime().wrap(function _callee50$(_context50) {\n          while (1) switch (_context50.prev = _context50.next) {\n            case 0:\n              if (xe(n)) {\n                _context50.next = 3;\n                break;\n              }\n              _c35 = c(\"MISSING_OR_INVALID\", \"proposal id should be a number: \".concat(n)), e = _c35.message;\n              throw new Error(e);\n            case 3:\n              if (this.client.proposal.keys.includes(n)) {\n                _context50.next = 6;\n                break;\n              }\n              _c36 = c(\"NO_MATCHING_KEY\", \"proposal id doesn't exist: \".concat(n)), _e7 = _c36.message;\n              throw new Error(_e7);\n            case 6:\n              if (!f(this.client.proposal.get(n).expiry)) {\n                _context50.next = 11;\n                break;\n              }\n              _context50.next = 9;\n              return this.deleteProposal(n);\n            case 9:\n              _c37 = c(\"EXPIRED\", \"proposal id: \".concat(n)), _e8 = _c37.message;\n              throw new Error(_e8);\n            case 11:\n            case \"end\":\n              return _context50.stop();\n          }\n        }, _callee50, this);\n      }));\n      function isValidProposalId(_x69) {\n        return _isValidProposalId.apply(this, arguments);\n      }\n      return isValidProposalId;\n    }()\n  }]);\n  return We;\n}(me);\nvar Ze = /*#__PURE__*/function (_z) {\n  _inherits(Ze, _z);\n  var _super2 = _createSuper(Ze);\n  function Ze(n, e) {\n    var _this4;\n    _classCallCheck(this, Ze);\n    _this4 = _super2.call(this, n, e, ee, C), _this4.core = n, _this4.logger = e;\n    return _this4;\n  }\n  return _createClass(Ze);\n}(z);\nvar es = /*#__PURE__*/function (_z2) {\n  _inherits(es, _z2);\n  var _super3 = _createSuper(es);\n  function es(n, e) {\n    var _this5;\n    _classCallCheck(this, es);\n    _this5 = _super3.call(this, n, e, te, C), _this5.core = n, _this5.logger = e;\n    return _this5;\n  }\n  return _createClass(es);\n}(z);\nvar ss = /*#__PURE__*/function (_z3) {\n  _inherits(ss, _z3);\n  var _super4 = _createSuper(ss);\n  function ss(n, e) {\n    var _this6;\n    _classCallCheck(this, ss);\n    _this6 = _super4.call(this, n, e, ne, C, function (s) {\n      return s.id;\n    }), _this6.core = n, _this6.logger = e;\n    return _this6;\n  }\n  return _createClass(ss);\n}(z);\nvar M = /*#__PURE__*/function (_we) {\n  _inherits(M, _we);\n  var _super5 = _createSuper(M);\n  function M(n) {\n    var _this7;\n    _classCallCheck(this, M);\n    _this7 = _super5.call(this, n), _this7.protocol = k, _this7.version = X, _this7.name = G.name, _this7.events = new be(), _this7.on = function (s, t) {\n      return _this7.events.on(s, t);\n    }, _this7.once = function (s, t) {\n      return _this7.events.once(s, t);\n    }, _this7.off = function (s, t) {\n      return _this7.events.off(s, t);\n    }, _this7.removeListener = function (s, t) {\n      return _this7.events.removeListener(s, t);\n    }, _this7.removeAllListeners = function (s) {\n      return _this7.events.removeAllListeners(s);\n    }, _this7.connect = /*#__PURE__*/function () {\n      var _ref54 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee51(s) {\n        return _regeneratorRuntime().wrap(function _callee51$(_context51) {\n          while (1) switch (_context51.prev = _context51.next) {\n            case 0:\n              _context51.prev = 0;\n              _context51.next = 3;\n              return _this7.engine.connect(s);\n            case 3:\n              return _context51.abrupt(\"return\", _context51.sent);\n            case 6:\n              _context51.prev = 6;\n              _context51.t0 = _context51[\"catch\"](0);\n              throw _this7.logger.error(_context51.t0.message), _context51.t0;\n            case 9:\n            case \"end\":\n              return _context51.stop();\n          }\n        }, _callee51, null, [[0, 6]]);\n      }));\n      return function (_x70) {\n        return _ref54.apply(this, arguments);\n      };\n    }(), _this7.pair = /*#__PURE__*/function () {\n      var _ref55 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee52(s) {\n        return _regeneratorRuntime().wrap(function _callee52$(_context52) {\n          while (1) switch (_context52.prev = _context52.next) {\n            case 0:\n              _context52.prev = 0;\n              _context52.next = 3;\n              return _this7.engine.pair(s);\n            case 3:\n              return _context52.abrupt(\"return\", _context52.sent);\n            case 6:\n              _context52.prev = 6;\n              _context52.t0 = _context52[\"catch\"](0);\n              throw _this7.logger.error(_context52.t0.message), _context52.t0;\n            case 9:\n            case \"end\":\n              return _context52.stop();\n          }\n        }, _callee52, null, [[0, 6]]);\n      }));\n      return function (_x71) {\n        return _ref55.apply(this, arguments);\n      };\n    }(), _this7.approve = /*#__PURE__*/function () {\n      var _ref56 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee53(s) {\n        return _regeneratorRuntime().wrap(function _callee53$(_context53) {\n          while (1) switch (_context53.prev = _context53.next) {\n            case 0:\n              _context53.prev = 0;\n              _context53.next = 3;\n              return _this7.engine.approve(s);\n            case 3:\n              return _context53.abrupt(\"return\", _context53.sent);\n            case 6:\n              _context53.prev = 6;\n              _context53.t0 = _context53[\"catch\"](0);\n              throw _this7.logger.error(_context53.t0.message), _context53.t0;\n            case 9:\n            case \"end\":\n              return _context53.stop();\n          }\n        }, _callee53, null, [[0, 6]]);\n      }));\n      return function (_x72) {\n        return _ref56.apply(this, arguments);\n      };\n    }(), _this7.reject = /*#__PURE__*/function () {\n      var _ref57 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee54(s) {\n        return _regeneratorRuntime().wrap(function _callee54$(_context54) {\n          while (1) switch (_context54.prev = _context54.next) {\n            case 0:\n              _context54.prev = 0;\n              _context54.next = 3;\n              return _this7.engine.reject(s);\n            case 3:\n              return _context54.abrupt(\"return\", _context54.sent);\n            case 6:\n              _context54.prev = 6;\n              _context54.t0 = _context54[\"catch\"](0);\n              throw _this7.logger.error(_context54.t0.message), _context54.t0;\n            case 9:\n            case \"end\":\n              return _context54.stop();\n          }\n        }, _callee54, null, [[0, 6]]);\n      }));\n      return function (_x73) {\n        return _ref57.apply(this, arguments);\n      };\n    }(), _this7.update = /*#__PURE__*/function () {\n      var _ref58 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee55(s) {\n        return _regeneratorRuntime().wrap(function _callee55$(_context55) {\n          while (1) switch (_context55.prev = _context55.next) {\n            case 0:\n              _context55.prev = 0;\n              _context55.next = 3;\n              return _this7.engine.update(s);\n            case 3:\n              return _context55.abrupt(\"return\", _context55.sent);\n            case 6:\n              _context55.prev = 6;\n              _context55.t0 = _context55[\"catch\"](0);\n              throw _this7.logger.error(_context55.t0.message), _context55.t0;\n            case 9:\n            case \"end\":\n              return _context55.stop();\n          }\n        }, _callee55, null, [[0, 6]]);\n      }));\n      return function (_x74) {\n        return _ref58.apply(this, arguments);\n      };\n    }(), _this7.extend = /*#__PURE__*/function () {\n      var _ref59 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee56(s) {\n        return _regeneratorRuntime().wrap(function _callee56$(_context56) {\n          while (1) switch (_context56.prev = _context56.next) {\n            case 0:\n              _context56.prev = 0;\n              _context56.next = 3;\n              return _this7.engine.extend(s);\n            case 3:\n              return _context56.abrupt(\"return\", _context56.sent);\n            case 6:\n              _context56.prev = 6;\n              _context56.t0 = _context56[\"catch\"](0);\n              throw _this7.logger.error(_context56.t0.message), _context56.t0;\n            case 9:\n            case \"end\":\n              return _context56.stop();\n          }\n        }, _callee56, null, [[0, 6]]);\n      }));\n      return function (_x75) {\n        return _ref59.apply(this, arguments);\n      };\n    }(), _this7.request = /*#__PURE__*/function () {\n      var _ref60 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee57(s) {\n        return _regeneratorRuntime().wrap(function _callee57$(_context57) {\n          while (1) switch (_context57.prev = _context57.next) {\n            case 0:\n              _context57.prev = 0;\n              _context57.next = 3;\n              return _this7.engine.request(s);\n            case 3:\n              return _context57.abrupt(\"return\", _context57.sent);\n            case 6:\n              _context57.prev = 6;\n              _context57.t0 = _context57[\"catch\"](0);\n              throw _this7.logger.error(_context57.t0.message), _context57.t0;\n            case 9:\n            case \"end\":\n              return _context57.stop();\n          }\n        }, _callee57, null, [[0, 6]]);\n      }));\n      return function (_x76) {\n        return _ref60.apply(this, arguments);\n      };\n    }(), _this7.respond = /*#__PURE__*/function () {\n      var _ref61 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee58(s) {\n        return _regeneratorRuntime().wrap(function _callee58$(_context58) {\n          while (1) switch (_context58.prev = _context58.next) {\n            case 0:\n              _context58.prev = 0;\n              _context58.next = 3;\n              return _this7.engine.respond(s);\n            case 3:\n              return _context58.abrupt(\"return\", _context58.sent);\n            case 6:\n              _context58.prev = 6;\n              _context58.t0 = _context58[\"catch\"](0);\n              throw _this7.logger.error(_context58.t0.message), _context58.t0;\n            case 9:\n            case \"end\":\n              return _context58.stop();\n          }\n        }, _callee58, null, [[0, 6]]);\n      }));\n      return function (_x77) {\n        return _ref61.apply(this, arguments);\n      };\n    }(), _this7.ping = /*#__PURE__*/function () {\n      var _ref62 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee59(s) {\n        return _regeneratorRuntime().wrap(function _callee59$(_context59) {\n          while (1) switch (_context59.prev = _context59.next) {\n            case 0:\n              _context59.prev = 0;\n              _context59.next = 3;\n              return _this7.engine.ping(s);\n            case 3:\n              return _context59.abrupt(\"return\", _context59.sent);\n            case 6:\n              _context59.prev = 6;\n              _context59.t0 = _context59[\"catch\"](0);\n              throw _this7.logger.error(_context59.t0.message), _context59.t0;\n            case 9:\n            case \"end\":\n              return _context59.stop();\n          }\n        }, _callee59, null, [[0, 6]]);\n      }));\n      return function (_x78) {\n        return _ref62.apply(this, arguments);\n      };\n    }(), _this7.emit = /*#__PURE__*/function () {\n      var _ref63 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee60(s) {\n        return _regeneratorRuntime().wrap(function _callee60$(_context60) {\n          while (1) switch (_context60.prev = _context60.next) {\n            case 0:\n              _context60.prev = 0;\n              _context60.next = 3;\n              return _this7.engine.emit(s);\n            case 3:\n              return _context60.abrupt(\"return\", _context60.sent);\n            case 6:\n              _context60.prev = 6;\n              _context60.t0 = _context60[\"catch\"](0);\n              throw _this7.logger.error(_context60.t0.message), _context60.t0;\n            case 9:\n            case \"end\":\n              return _context60.stop();\n          }\n        }, _callee60, null, [[0, 6]]);\n      }));\n      return function (_x79) {\n        return _ref63.apply(this, arguments);\n      };\n    }(), _this7.disconnect = /*#__PURE__*/function () {\n      var _ref64 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee61(s) {\n        return _regeneratorRuntime().wrap(function _callee61$(_context61) {\n          while (1) switch (_context61.prev = _context61.next) {\n            case 0:\n              _context61.prev = 0;\n              _context61.next = 3;\n              return _this7.engine.disconnect(s);\n            case 3:\n              return _context61.abrupt(\"return\", _context61.sent);\n            case 6:\n              _context61.prev = 6;\n              _context61.t0 = _context61[\"catch\"](0);\n              throw _this7.logger.error(_context61.t0.message), _context61.t0;\n            case 9:\n            case \"end\":\n              return _context61.stop();\n          }\n        }, _callee61, null, [[0, 6]]);\n      }));\n      return function (_x80) {\n        return _ref64.apply(this, arguments);\n      };\n    }(), _this7.find = function (s) {\n      try {\n        return _this7.engine.find(s);\n      } catch (t) {\n        throw _this7.logger.error(t.message), t;\n      }\n    }, _this7.getPendingSessionRequests = function () {\n      try {\n        return _this7.engine.getPendingSessionRequests();\n      } catch (s) {\n        throw _this7.logger.error(s.message), s;\n      }\n    }, _this7.name = (n === null || n === void 0 ? void 0 : n.name) || G.name, _this7.metadata = (n === null || n === void 0 ? void 0 : n.metadata) || De();\n    var e = typeof (n === null || n === void 0 ? void 0 : n.logger) < \"u\" && typeof (n === null || n === void 0 ? void 0 : n.logger) != \"string\" ? n.logger : ae(he({\n      level: (n === null || n === void 0 ? void 0 : n.logger) || G.logger\n    }));\n    _this7.core = (n === null || n === void 0 ? void 0 : n.core) || new pe(n), _this7.logger = de(e, _this7.name), _this7.session = new es(_this7.core, _this7.logger), _this7.proposal = new Ze(_this7.core, _this7.logger), _this7.pendingRequest = new ss(_this7.core, _this7.logger), _this7.engine = new We(_assertThisInitialized(_this7));\n    return _this7;\n  }\n  _createClass(M, [{\n    key: \"context\",\n    get: function get() {\n      return ge(this.logger);\n    }\n  }, {\n    key: \"pairing\",\n    get: function get() {\n      return this.core.pairing.pairings;\n    }\n  }, {\n    key: \"initialize\",\n    value: function () {\n      var _initialize = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee62() {\n        return _regeneratorRuntime().wrap(function _callee62$(_context62) {\n          while (1) switch (_context62.prev = _context62.next) {\n            case 0:\n              this.logger.trace(\"Initialized\");\n              _context62.prev = 1;\n              _context62.next = 4;\n              return this.core.start();\n            case 4:\n              _context62.next = 6;\n              return this.session.init();\n            case 6:\n              _context62.next = 8;\n              return this.proposal.init();\n            case 8:\n              _context62.next = 10;\n              return this.pendingRequest.init();\n            case 10:\n              _context62.next = 12;\n              return this.engine.init();\n            case 12:\n              this.logger.info(\"SignClient Initialization Success\");\n              _context62.next = 18;\n              break;\n            case 15:\n              _context62.prev = 15;\n              _context62.t0 = _context62[\"catch\"](1);\n              throw this.logger.info(\"SignClient Initialization Failure\"), this.logger.error(_context62.t0.message), _context62.t0;\n            case 18:\n            case \"end\":\n              return _context62.stop();\n          }\n        }, _callee62, this, [[1, 15]]);\n      }));\n      function initialize() {\n        return _initialize.apply(this, arguments);\n      }\n      return initialize;\n    }()\n  }], [{\n    key: \"init\",\n    value: function () {\n      var _init = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee63(n) {\n        var e;\n        return _regeneratorRuntime().wrap(function _callee63$(_context63) {\n          while (1) switch (_context63.prev = _context63.next) {\n            case 0:\n              e = new M(n);\n              _context63.next = 3;\n              return e.initialize();\n            case 3:\n              return _context63.abrupt(\"return\", e);\n            case 4:\n            case \"end\":\n              return _context63.stop();\n          }\n        }, _callee63);\n      }));\n      function init(_x81) {\n        return _init.apply(this, arguments);\n      }\n      return init;\n    }()\n  }]);\n  return M;\n}(we);\nvar ts = M;\nexport { ie as ENGINE_CONTEXT, V as ENGINE_RPC_OPTS, Ye as HISTORY_CONTEXT, je as HISTORY_EVENTS, ke as HISTORY_STORAGE_VERSION, ee as PROPOSAL_CONTEXT, Xe as PROPOSAL_EXPIRY, se as PROPOSAL_EXPIRY_MESSAGE, ne as REQUEST_CONTEXT, te as SESSION_CONTEXT, b as SESSION_EXPIRY, $ as SESSION_REQUEST_EXPIRY_BOUNDARIES, J as SIGN_CLIENT_CONTEXT, G as SIGN_CLIENT_DEFAULT, Ke as SIGN_CLIENT_EVENTS, k as SIGN_CLIENT_PROTOCOL, ze as SIGN_CLIENT_STORAGE_OPTIONS, C as SIGN_CLIENT_STORAGE_PREFIX, X as SIGN_CLIENT_VERSION, ts as SignClient, M as default };","map":{"version":3,"sources":[],"names":[],"mappings":"","sourcesContent":["import ae from\"pino\";import{RELAYER_DEFAULT_PROTOCOL as ce,RELAYER_EVENTS as F,EXPIRER_EVENTS as le,Store as z,Core as pe}from\"@walletconnect/core\";import{getDefaultLoggerOptions as he,generateChildLogger as de,getLoggerContext as ge}from\"@walletconnect/logger\";import{IEngine as me,ISignClient as we}from\"@walletconnect/types\";import{TYPE_1 as ue,createDelayedPromise as v,engineEvent as p,getInternalError as c,calcExpiry as _,isValidObject as j,getRequiredNamespacesFromNamespaces as ye,getSdkError as R,isSessionCompatible as Se,isExpired as f,isValidParams as y,isUndefined as D,isValidRelays as Ee,isValidRequiredNamespaces as Ie,isValidNamespaces as Y,isConformingNamespaces as B,isValidString as A,isValidErrorReason as _e,isValidRelay as Re,isValidController as Ne,isValidNamespacesChainId as Q,isValidRequest as qe,isValidNamespacesRequest as Pe,isValidRequestExpiry as ve,isValidResponse as fe,isValidEvent as Oe,isValidNamespacesEvent as Ve,parseExpirerTarget as Te,isValidId as xe,getAppMetadata as De}from\"@walletconnect/utils\";import Ae,{EventEmitter as be}from\"events\";import{THIRTY_DAYS as Le,SEVEN_DAYS as W,FIVE_MINUTES as w,ONE_DAY as O,THIRTY_SECONDS as Z}from\"@walletconnect/time\";import{isJsonRpcResult as N,isJsonRpcError as q,formatJsonRpcRequest as Ce,formatJsonRpcResult as Ge,formatJsonRpcError as $e,isJsonRpcRequest as Me,isJsonRpcResponse as Ue}from\"@walletconnect/jsonrpc-utils\";const k=\"wc\",X=2,J=\"client\",C=`${k}@${X}:${J}:`,G={name:J,logger:\"error\",controller:!1,relayUrl:\"wss://relay.walletconnect.com\"},Ke={session_proposal:\"session_proposal\",session_update:\"session_update\",session_extend:\"session_extend\",session_ping:\"session_ping\",session_delete:\"session_delete\",session_expire:\"session_expire\",session_request:\"session_request\",session_request_sent:\"session_request_sent\",session_event:\"session_event\",proposal_expire:\"proposal_expire\"},ze={database:\":memory:\"},je={created:\"history_created\",updated:\"history_updated\",deleted:\"history_deleted\",sync:\"history_sync\"},Ye=\"history\",ke=\"0.3\",ee=\"proposal\",Xe=Le,se=\"Proposal expired\",te=\"session\",b=W,ie=\"engine\",V={wc_sessionPropose:{req:{ttl:w,prompt:!0,tag:1100},res:{ttl:w,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:w,prompt:!1,tag:1102},res:{ttl:w,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:O,prompt:!1,tag:1104},res:{ttl:O,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:O,prompt:!1,tag:1106},res:{ttl:O,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:w,prompt:!0,tag:1108},res:{ttl:w,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:w,prompt:!0,tag:1110},res:{ttl:w,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:O,prompt:!1,tag:1112},res:{ttl:O,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Z,prompt:!1,tag:1114},res:{ttl:Z,prompt:!1,tag:1115}}},$={min:w,max:W},ne=\"request\";var Je=Object.defineProperty,He=Object.defineProperties,Fe=Object.getOwnPropertyDescriptors,oe=Object.getOwnPropertySymbols,Be=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable,re=(d,n,e)=>n in d?Je(d,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[n]=e,u=(d,n)=>{for(var e in n||(n={}))Be.call(n,e)&&re(d,e,n[e]);if(oe)for(var e of oe(n))Qe.call(n,e)&&re(d,e,n[e]);return d},H=(d,n)=>He(d,Fe(n));class We extends me{constructor(n){super(n),this.name=ie,this.events=new Ae,this.initialized=!1,this.ignoredPayloadTypes=[ue],this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(V)}),this.initialized=!0)},this.connect=async e=>{this.isInitialized();const s=H(u({},e),{requiredNamespaces:e.requiredNamespaces||{},optionalNamespaces:e.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:t,requiredNamespaces:i,optionalNamespaces:o,sessionProperties:r,relays:a}=s;let l=t,h,S=!1;if(l&&(S=this.client.core.pairing.pairings.get(l).active),!l||!S){const{topic:I,uri:g}=await this.client.core.pairing.create();l=I,h=g}const m=await this.client.core.crypto.generateKeyPair(),P=u({requiredNamespaces:i,optionalNamespaces:o,relays:a??[{protocol:ce}],proposer:{publicKey:m,metadata:this.client.metadata}},r&&{sessionProperties:r}),{reject:E,resolve:T,done:U}=v(w,se);if(this.events.once(p(\"session_connect\"),async({error:I,session:g})=>{if(I)E(I);else if(g){g.self.publicKey=m;const x=H(u({},g),{requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces});await this.client.session.set(g.topic,x),await this.setExpiry(g.topic,g.expiry),l&&await this.client.core.pairing.updateMetadata({topic:l,metadata:g.peer.metadata}),T(x)}}),!l){const{message:I}=c(\"NO_MATCHING_KEY\",`connect() pairing topic: ${l}`);throw new Error(I)}const L=await this.sendRequest(l,\"wc_sessionPropose\",P),K=_(w);return await this.setProposal(L,u({id:L,expiry:K},P)),{uri:h,approval:U}},this.pair=async e=>(this.isInitialized(),await this.client.core.pairing.pair(e)),this.approve=async e=>{this.isInitialized(),await this.isValidApprove(e);const{id:s,relayProtocol:t,namespaces:i,sessionProperties:o}=e,r=this.client.proposal.get(s);let{pairingTopic:a,proposer:l,requiredNamespaces:h,optionalNamespaces:S}=r;j(h)||(h=ye(i,\"approve()\"));const m=await this.client.core.crypto.generateKeyPair(),P=l.publicKey,E=await this.client.core.crypto.generateSharedKey(m,P);a&&s&&(await this.client.core.pairing.updateMetadata({topic:a,metadata:l.metadata}),await this.sendResult(s,a,{relay:{protocol:t??\"irn\"},responderPublicKey:m}),await this.client.proposal.delete(s,R(\"USER_DISCONNECTED\")),await this.client.core.pairing.activate({topic:a}));const T=u({relay:{protocol:t??\"irn\"},namespaces:i,requiredNamespaces:h,optionalNamespaces:S,controller:{publicKey:m,metadata:this.client.metadata},expiry:_(b)},o&&{sessionProperties:o});await this.client.core.relayer.subscribe(E);const U=await this.sendRequest(E,\"wc_sessionSettle\",T),{done:L,resolve:K,reject:I}=v();this.events.once(p(\"session_approve\",U),({error:x})=>{x?I(x):K(this.client.session.get(E))});const g=H(u({},T),{topic:E,acknowledged:!1,self:T.controller,peer:{publicKey:l.publicKey,metadata:l.metadata},controller:m});return await this.client.session.set(E,g),await this.setExpiry(E,_(b)),{topic:E,acknowledged:L}},this.reject=async e=>{this.isInitialized(),await this.isValidReject(e);const{id:s,reason:t}=e,{pairingTopic:i}=this.client.proposal.get(s);i&&(await this.sendError(s,i,t),await this.client.proposal.delete(s,R(\"USER_DISCONNECTED\")))},this.update=async e=>{this.isInitialized(),await this.isValidUpdate(e);const{topic:s,namespaces:t}=e,i=await this.sendRequest(s,\"wc_sessionUpdate\",{namespaces:t}),{done:o,resolve:r,reject:a}=v();return this.events.once(p(\"session_update\",i),({error:l})=>{l?a(l):r()}),await this.client.session.update(s,{namespaces:t}),{acknowledged:o}},this.extend=async e=>{this.isInitialized(),await this.isValidExtend(e);const{topic:s}=e,t=await this.sendRequest(s,\"wc_sessionExtend\",{}),{done:i,resolve:o,reject:r}=v();return this.events.once(p(\"session_extend\",t),({error:a})=>{a?r(a):o()}),await this.setExpiry(s,_(b)),{acknowledged:i}},this.request=async e=>{this.isInitialized(),await this.isValidRequest(e);const{chainId:s,request:t,topic:i,expiry:o}=e,r=await this.sendRequest(i,\"wc_sessionRequest\",{request:t,chainId:s},o),{done:a,resolve:l,reject:h}=v(o);return this.events.once(p(\"session_request\",r),({error:S,result:m})=>{S?h(S):l(m)}),this.client.events.emit(\"session_request_sent\",{topic:i,request:t,chainId:s,id:r}),await a()},this.respond=async e=>{this.isInitialized(),await this.isValidRespond(e);const{topic:s,response:t}=e,{id:i}=t;N(t)?await this.sendResult(i,s,t.result):q(t)&&await this.sendError(i,s,t.error),this.deletePendingSessionRequest(e.response.id,{message:\"fulfilled\",code:0})},this.ping=async e=>{this.isInitialized(),await this.isValidPing(e);const{topic:s}=e;if(this.client.session.keys.includes(s)){const t=await this.sendRequest(s,\"wc_sessionPing\",{}),{done:i,resolve:o,reject:r}=v();this.events.once(p(\"session_ping\",t),({error:a})=>{a?r(a):o()}),await i()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async e=>{this.isInitialized(),await this.isValidEmit(e);const{topic:s,event:t,chainId:i}=e;await this.sendRequest(s,\"wc_sessionEvent\",{event:t,chainId:i})},this.disconnect=async e=>{this.isInitialized(),await this.isValidDisconnect(e);const{topic:s}=e;this.client.session.keys.includes(s)?(await this.sendRequest(s,\"wc_sessionDelete\",R(\"USER_DISCONNECTED\")),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=e=>(this.isInitialized(),this.client.session.getAll().filter(s=>Se(s,e))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.deleteSession=async(e,s)=>{const{self:t}=this.client.session.get(e);await this.client.core.relayer.unsubscribe(e),await Promise.all([this.client.session.delete(e,R(\"USER_DISCONNECTED\")),this.client.core.crypto.deleteKeyPair(t.publicKey),this.client.core.crypto.deleteSymKey(e),s?Promise.resolve():this.client.core.expirer.del(e)])},this.deleteProposal=async(e,s)=>{await Promise.all([this.client.proposal.delete(e,R(\"USER_DISCONNECTED\")),s?Promise.resolve():this.client.core.expirer.del(e)])},this.deletePendingSessionRequest=async(e,s,t=!1)=>{await Promise.all([this.client.pendingRequest.delete(e,s),t?Promise.resolve():this.client.core.expirer.del(e)])},this.setExpiry=async(e,s)=>{this.client.session.keys.includes(e)&&await this.client.session.update(e,{expiry:s}),this.client.core.expirer.set(e,s)},this.setProposal=async(e,s)=>{await this.client.proposal.set(e,s),this.client.core.expirer.set(e,s.expiry)},this.setPendingSessionRequest=async e=>{const s=V.wc_sessionRequest.req.ttl,{id:t,topic:i,params:o}=e;await this.client.pendingRequest.set(t,{id:t,topic:i,params:o}),s&&this.client.core.expirer.set(t,_(s))},this.sendRequest=async(e,s,t,i)=>{const o=Ce(s,t),r=await this.client.core.crypto.encode(e,o),a=V[s].req;return i&&(a.ttl=i),this.client.core.history.set(e,o),this.client.core.relayer.publish(e,r,a),o.id},this.sendResult=async(e,s,t)=>{const i=Ge(e,t),o=await this.client.core.crypto.encode(s,i),r=await this.client.core.history.get(s,e),a=V[r.request.method].res;this.client.core.relayer.publish(s,o,a),await this.client.core.history.resolve(i)},this.sendError=async(e,s,t)=>{const i=$e(e,t),o=await this.client.core.crypto.encode(s,i),r=await this.client.core.history.get(s,e),a=V[r.request.method].res;this.client.core.relayer.publish(s,o,a),await this.client.core.history.resolve(i)},this.cleanup=async()=>{const e=[],s=[];this.client.session.getAll().forEach(t=>{f(t.expiry)&&e.push(t.topic)}),this.client.proposal.getAll().forEach(t=>{f(t.expiry)&&s.push(t.id)}),await Promise.all([...e.map(t=>this.deleteSession(t)),...s.map(t=>this.deleteProposal(t))])},this.onRelayEventRequest=e=>{const{topic:s,payload:t}=e,i=t.method;switch(i){case\"wc_sessionPropose\":return this.onSessionProposeRequest(s,t);case\"wc_sessionSettle\":return this.onSessionSettleRequest(s,t);case\"wc_sessionUpdate\":return this.onSessionUpdateRequest(s,t);case\"wc_sessionExtend\":return this.onSessionExtendRequest(s,t);case\"wc_sessionPing\":return this.onSessionPingRequest(s,t);case\"wc_sessionDelete\":return this.onSessionDeleteRequest(s,t);case\"wc_sessionRequest\":return this.onSessionRequest(s,t);case\"wc_sessionEvent\":return this.onSessionEventRequest(s,t);default:return this.client.logger.info(`Unsupported request method ${i}`)}},this.onRelayEventResponse=async e=>{const{topic:s,payload:t}=e,i=(await this.client.core.history.get(s,t.id)).request.method;switch(i){case\"wc_sessionPropose\":return this.onSessionProposeResponse(s,t);case\"wc_sessionSettle\":return this.onSessionSettleResponse(s,t);case\"wc_sessionUpdate\":return this.onSessionUpdateResponse(s,t);case\"wc_sessionExtend\":return this.onSessionExtendResponse(s,t);case\"wc_sessionPing\":return this.onSessionPingResponse(s,t);case\"wc_sessionRequest\":return this.onSessionRequestResponse(s,t);default:return this.client.logger.info(`Unsupported response method ${i}`)}},this.onSessionProposeRequest=async(e,s)=>{const{params:t,id:i}=s;try{this.isValidConnect(u({},s.params));const o=_(w),r=u({id:i,pairingTopic:e,expiry:o},t);await this.setProposal(i,r),this.client.events.emit(\"session_proposal\",{id:i,params:r})}catch(o){await this.sendError(i,e,o),this.client.logger.error(o)}},this.onSessionProposeResponse=async(e,s)=>{const{id:t}=s;if(N(s)){const{result:i}=s;this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",result:i});const o=this.client.proposal.get(t);this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",proposal:o});const r=o.proposer.publicKey;this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",selfPublicKey:r});const a=i.responderPublicKey;this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",peerPublicKey:a});const l=await this.client.core.crypto.generateSharedKey(r,a);this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",sessionTopic:l});const h=await this.client.core.relayer.subscribe(l);this.client.logger.trace({type:\"method\",method:\"onSessionProposeResponse\",subscriptionId:h}),await this.client.core.pairing.activate({topic:e})}else q(s)&&(await this.client.proposal.delete(t,R(\"USER_DISCONNECTED\")),this.events.emit(p(\"session_connect\"),{error:s.error}))},this.onSessionSettleRequest=async(e,s)=>{const{id:t,params:i}=s;try{this.isValidSessionSettleRequest(i);const{relay:o,controller:r,expiry:a,namespaces:l,requiredNamespaces:h,optionalNamespaces:S,sessionProperties:m}=s.params,P=u({topic:e,relay:o,expiry:a,namespaces:l,acknowledged:!0,requiredNamespaces:h,optionalNamespaces:S,controller:r.publicKey,self:{publicKey:\"\",metadata:this.client.metadata},peer:{publicKey:r.publicKey,metadata:r.metadata}},m&&{sessionProperties:m});await this.sendResult(s.id,e,!0),this.events.emit(p(\"session_connect\"),{session:P})}catch(o){await this.sendError(t,e,o),this.client.logger.error(o)}},this.onSessionSettleResponse=async(e,s)=>{const{id:t}=s;N(s)?(await this.client.session.update(e,{acknowledged:!0}),this.events.emit(p(\"session_approve\",t),{})):q(s)&&(await this.client.session.delete(e,R(\"USER_DISCONNECTED\")),this.events.emit(p(\"session_approve\",t),{error:s.error}))},this.onSessionUpdateRequest=async(e,s)=>{const{params:t,id:i}=s;try{this.isValidUpdate(u({topic:e},t)),await this.client.session.update(e,{namespaces:t.namespaces}),await this.sendResult(i,e,!0),this.client.events.emit(\"session_update\",{id:i,topic:e,params:t})}catch(o){await this.sendError(i,e,o),this.client.logger.error(o)}},this.onSessionUpdateResponse=(e,s)=>{const{id:t}=s;N(s)?this.events.emit(p(\"session_update\",t),{}):q(s)&&this.events.emit(p(\"session_update\",t),{error:s.error})},this.onSessionExtendRequest=async(e,s)=>{const{id:t}=s;try{this.isValidExtend({topic:e}),await this.setExpiry(e,_(b)),await this.sendResult(t,e,!0),this.client.events.emit(\"session_extend\",{id:t,topic:e})}catch(i){await this.sendError(t,e,i),this.client.logger.error(i)}},this.onSessionExtendResponse=(e,s)=>{const{id:t}=s;N(s)?this.events.emit(p(\"session_extend\",t),{}):q(s)&&this.events.emit(p(\"session_extend\",t),{error:s.error})},this.onSessionPingRequest=async(e,s)=>{const{id:t}=s;try{this.isValidPing({topic:e}),await this.sendResult(t,e,!0),this.client.events.emit(\"session_ping\",{id:t,topic:e})}catch(i){await this.sendError(t,e,i),this.client.logger.error(i)}},this.onSessionPingResponse=(e,s)=>{const{id:t}=s;setTimeout(()=>{N(s)?this.events.emit(p(\"session_ping\",t),{}):q(s)&&this.events.emit(p(\"session_ping\",t),{error:s.error})},500)},this.onSessionDeleteRequest=async(e,s)=>{const{id:t}=s;try{this.isValidDisconnect({topic:e,reason:s.params}),this.client.core.relayer.once(F.publish,async()=>{await this.deleteSession(e)}),await this.sendResult(t,e,!0),this.client.events.emit(\"session_delete\",{id:t,topic:e})}catch(i){await this.sendError(t,e,i),this.client.logger.error(i)}},this.onSessionRequest=async(e,s)=>{const{id:t,params:i}=s;try{this.isValidRequest(u({topic:e},i)),await this.setPendingSessionRequest({id:t,topic:e,params:i}),this.client.events.emit(\"session_request\",{id:t,topic:e,params:i})}catch(o){await this.sendError(t,e,o),this.client.logger.error(o)}},this.onSessionRequestResponse=(e,s)=>{const{id:t}=s;N(s)?this.events.emit(p(\"session_request\",t),{result:s.result}):q(s)&&this.events.emit(p(\"session_request\",t),{error:s.error})},this.onSessionEventRequest=async(e,s)=>{const{id:t,params:i}=s;try{this.isValidEmit(u({topic:e},i)),this.client.events.emit(\"session_event\",{id:t,topic:e,params:i})}catch(o){await this.sendError(t,e,o),this.client.logger.error(o)}},this.isValidConnect=async e=>{if(!y(e)){const{message:a}=c(\"MISSING_OR_INVALID\",`connect() params: ${JSON.stringify(e)}`);throw new Error(a)}const{pairingTopic:s,requiredNamespaces:t,optionalNamespaces:i,sessionProperties:o,relays:r}=e;if(D(s)||await this.isValidPairingTopic(s),!Ee(r,!0)){const{message:a}=c(\"MISSING_OR_INVALID\",`connect() relays: ${r}`);throw new Error(a)}!D(t)&&j(t)!==0&&this.validateNamespaces(t,\"requiredNamespaces\"),!D(i)&&j(i)!==0&&this.validateNamespaces(i,\"optionalNamespaces\"),D(o)||this.validateSessionProps(o,\"sessionProperties\")},this.validateNamespaces=(e,s)=>{const t=Ie(e,\"connect()\",s);if(t)throw new Error(t.message)},this.isValidApprove=async e=>{if(!y(e))throw new Error(c(\"MISSING_OR_INVALID\",`approve() params: ${e}`).message);const{id:s,namespaces:t,relayProtocol:i,sessionProperties:o}=e;await this.isValidProposalId(s);const r=this.client.proposal.get(s),a=Y(t,\"approve()\");if(a)throw new Error(a.message);const l=B(r.requiredNamespaces,t,\"approve()\");if(l)throw new Error(l.message);if(!A(i,!0)){const{message:h}=c(\"MISSING_OR_INVALID\",`approve() relayProtocol: ${i}`);throw new Error(h)}D(o)||this.validateSessionProps(o,\"sessionProperties\")},this.isValidReject=async e=>{if(!y(e)){const{message:i}=c(\"MISSING_OR_INVALID\",`reject() params: ${e}`);throw new Error(i)}const{id:s,reason:t}=e;if(await this.isValidProposalId(s),!_e(t)){const{message:i}=c(\"MISSING_OR_INVALID\",`reject() reason: ${JSON.stringify(t)}`);throw new Error(i)}},this.isValidSessionSettleRequest=e=>{if(!y(e)){const{message:l}=c(\"MISSING_OR_INVALID\",`onSessionSettleRequest() params: ${e}`);throw new Error(l)}const{relay:s,controller:t,namespaces:i,expiry:o}=e;if(!Re(s)){const{message:l}=c(\"MISSING_OR_INVALID\",\"onSessionSettleRequest() relay protocol should be a string\");throw new Error(l)}const r=Ne(t,\"onSessionSettleRequest()\");if(r)throw new Error(r.message);const a=Y(i,\"onSessionSettleRequest()\");if(a)throw new Error(a.message);if(f(o)){const{message:l}=c(\"EXPIRED\",\"onSessionSettleRequest()\");throw new Error(l)}},this.isValidUpdate=async e=>{if(!y(e)){const{message:a}=c(\"MISSING_OR_INVALID\",`update() params: ${e}`);throw new Error(a)}const{topic:s,namespaces:t}=e;await this.isValidSessionTopic(s);const i=this.client.session.get(s),o=Y(t,\"update()\");if(o)throw new Error(o.message);const r=B(i.requiredNamespaces,t,\"update()\");if(r)throw new Error(r.message)},this.isValidExtend=async e=>{if(!y(e)){const{message:t}=c(\"MISSING_OR_INVALID\",`extend() params: ${e}`);throw new Error(t)}const{topic:s}=e;await this.isValidSessionTopic(s)},this.isValidRequest=async e=>{if(!y(e)){const{message:a}=c(\"MISSING_OR_INVALID\",`request() params: ${e}`);throw new Error(a)}const{topic:s,request:t,chainId:i,expiry:o}=e;await this.isValidSessionTopic(s);const{namespaces:r}=this.client.session.get(s);if(!Q(r,i)){const{message:a}=c(\"MISSING_OR_INVALID\",`request() chainId: ${i}`);throw new Error(a)}if(!qe(t)){const{message:a}=c(\"MISSING_OR_INVALID\",`request() ${JSON.stringify(t)}`);throw new Error(a)}if(!Pe(r,i,t.method)){const{message:a}=c(\"MISSING_OR_INVALID\",`request() method: ${t.method}`);throw new Error(a)}if(o&&!ve(o,$)){const{message:a}=c(\"MISSING_OR_INVALID\",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${$.min} and ${$.max}`);throw new Error(a)}},this.isValidRespond=async e=>{if(!y(e)){const{message:i}=c(\"MISSING_OR_INVALID\",`respond() params: ${e}`);throw new Error(i)}const{topic:s,response:t}=e;if(await this.isValidSessionTopic(s),!fe(t)){const{message:i}=c(\"MISSING_OR_INVALID\",`respond() response: ${JSON.stringify(t)}`);throw new Error(i)}},this.isValidPing=async e=>{if(!y(e)){const{message:t}=c(\"MISSING_OR_INVALID\",`ping() params: ${e}`);throw new Error(t)}const{topic:s}=e;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async e=>{if(!y(e)){const{message:r}=c(\"MISSING_OR_INVALID\",`emit() params: ${e}`);throw new Error(r)}const{topic:s,event:t,chainId:i}=e;await this.isValidSessionTopic(s);const{namespaces:o}=this.client.session.get(s);if(!Q(o,i)){const{message:r}=c(\"MISSING_OR_INVALID\",`emit() chainId: ${i}`);throw new Error(r)}if(!Oe(t)){const{message:r}=c(\"MISSING_OR_INVALID\",`emit() event: ${JSON.stringify(t)}`);throw new Error(r)}if(!Ve(o,i,t.name)){const{message:r}=c(\"MISSING_OR_INVALID\",`emit() event: ${JSON.stringify(t)}`);throw new Error(r)}},this.isValidDisconnect=async e=>{if(!y(e)){const{message:t}=c(\"MISSING_OR_INVALID\",`disconnect() params: ${e}`);throw new Error(t)}const{topic:s}=e;await this.isValidSessionOrPairingTopic(s)},this.validateSessionProps=(e,s)=>{Object.values(e).forEach(t=>{if(!A(t,!1)){const{message:i}=c(\"MISSING_OR_INVALID\",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(t)}`);throw new Error(i)}})}}isInitialized(){if(!this.initialized){const{message:n}=c(\"NOT_INITIALIZED\",this.name);throw new Error(n)}}registerRelayerEvents(){this.client.core.relayer.on(F.message,async n=>{const{topic:e,message:s}=n;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const t=await this.client.core.crypto.decode(e,s);Me(t)?(this.client.core.history.set(e,t),this.onRelayEventRequest({topic:e,payload:t})):Ue(t)&&(await this.client.core.history.resolve(t),this.onRelayEventResponse({topic:e,payload:t}))})}registerExpirerEvents(){this.client.core.expirer.on(le.expired,async n=>{const{topic:e,id:s}=Te(n.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,c(\"EXPIRED\"),!0);e?this.client.session.keys.includes(e)&&(await this.deleteSession(e,!0),this.client.events.emit(\"session_expire\",{topic:e})):s&&(await this.deleteProposal(s,!0),this.client.events.emit(\"proposal_expire\",{id:s}))})}isValidPairingTopic(n){if(!A(n,!1)){const{message:e}=c(\"MISSING_OR_INVALID\",`pairing topic should be a string: ${n}`);throw new Error(e)}if(!this.client.core.pairing.pairings.keys.includes(n)){const{message:e}=c(\"NO_MATCHING_KEY\",`pairing topic doesn't exist: ${n}`);throw new Error(e)}if(f(this.client.core.pairing.pairings.get(n).expiry)){const{message:e}=c(\"EXPIRED\",`pairing topic: ${n}`);throw new Error(e)}}async isValidSessionTopic(n){if(!A(n,!1)){const{message:e}=c(\"MISSING_OR_INVALID\",`session topic should be a string: ${n}`);throw new Error(e)}if(!this.client.session.keys.includes(n)){const{message:e}=c(\"NO_MATCHING_KEY\",`session topic doesn't exist: ${n}`);throw new Error(e)}if(f(this.client.session.get(n).expiry)){await this.deleteSession(n);const{message:e}=c(\"EXPIRED\",`session topic: ${n}`);throw new Error(e)}}async isValidSessionOrPairingTopic(n){if(this.client.session.keys.includes(n))await this.isValidSessionTopic(n);else if(this.client.core.pairing.pairings.keys.includes(n))this.isValidPairingTopic(n);else if(A(n,!1)){const{message:e}=c(\"NO_MATCHING_KEY\",`session or pairing topic doesn't exist: ${n}`);throw new Error(e)}else{const{message:e}=c(\"MISSING_OR_INVALID\",`session or pairing topic should be a string: ${n}`);throw new Error(e)}}async isValidProposalId(n){if(!xe(n)){const{message:e}=c(\"MISSING_OR_INVALID\",`proposal id should be a number: ${n}`);throw new Error(e)}if(!this.client.proposal.keys.includes(n)){const{message:e}=c(\"NO_MATCHING_KEY\",`proposal id doesn't exist: ${n}`);throw new Error(e)}if(f(this.client.proposal.get(n).expiry)){await this.deleteProposal(n);const{message:e}=c(\"EXPIRED\",`proposal id: ${n}`);throw new Error(e)}}}class Ze extends z{constructor(n,e){super(n,e,ee,C),this.core=n,this.logger=e}}class es extends z{constructor(n,e){super(n,e,te,C),this.core=n,this.logger=e}}class ss extends z{constructor(n,e){super(n,e,ne,C,s=>s.id),this.core=n,this.logger=e}}class M extends we{constructor(n){super(n),this.protocol=k,this.version=X,this.name=G.name,this.events=new be,this.on=(s,t)=>this.events.on(s,t),this.once=(s,t)=>this.events.once(s,t),this.off=(s,t)=>this.events.off(s,t),this.removeListener=(s,t)=>this.events.removeListener(s,t),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(t){throw this.logger.error(t.message),t}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(t){throw this.logger.error(t.message),t}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(t){throw this.logger.error(t.message),t}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(t){throw this.logger.error(t.message),t}},this.update=async s=>{try{return await this.engine.update(s)}catch(t){throw this.logger.error(t.message),t}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(t){throw this.logger.error(t.message),t}},this.request=async s=>{try{return await this.engine.request(s)}catch(t){throw this.logger.error(t.message),t}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(t){throw this.logger.error(t.message),t}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(t){throw this.logger.error(t.message),t}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(t){throw this.logger.error(t.message),t}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(t){throw this.logger.error(t.message),t}},this.find=s=>{try{return this.engine.find(s)}catch(t){throw this.logger.error(t.message),t}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=n?.name||G.name,this.metadata=n?.metadata||De();const e=typeof n?.logger<\"u\"&&typeof n?.logger!=\"string\"?n.logger:ae(he({level:n?.logger||G.logger}));this.core=n?.core||new pe(n),this.logger=de(e,this.name),this.session=new es(this.core,this.logger),this.proposal=new Ze(this.core,this.logger),this.pendingRequest=new ss(this.core,this.logger),this.engine=new We(this)}static async init(n){const e=new M(n);return await e.initialize(),e}get context(){return ge(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace(\"Initialized\");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.logger.info(\"SignClient Initialization Success\")}catch(n){throw this.logger.info(\"SignClient Initialization Failure\"),this.logger.error(n.message),n}}}const ts=M;export{ie as ENGINE_CONTEXT,V as ENGINE_RPC_OPTS,Ye as HISTORY_CONTEXT,je as HISTORY_EVENTS,ke as HISTORY_STORAGE_VERSION,ee as PROPOSAL_CONTEXT,Xe as PROPOSAL_EXPIRY,se as PROPOSAL_EXPIRY_MESSAGE,ne as REQUEST_CONTEXT,te as SESSION_CONTEXT,b as SESSION_EXPIRY,$ as SESSION_REQUEST_EXPIRY_BOUNDARIES,J as SIGN_CLIENT_CONTEXT,G as SIGN_CLIENT_DEFAULT,Ke as SIGN_CLIENT_EVENTS,k as SIGN_CLIENT_PROTOCOL,ze as SIGN_CLIENT_STORAGE_OPTIONS,C as SIGN_CLIENT_STORAGE_PREFIX,X as SIGN_CLIENT_VERSION,ts as SignClient,M as default};\n//# sourceMappingURL=index.es.js.map\n"]},"metadata":{},"sourceType":"module"}