{"ast":null,"code":"import _assertThisInitialized from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _toConsumableArray from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _inherits from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _regeneratorRuntime from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _createForOfIteratorHelper from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _defineProperty from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _objectSpread from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _classCallCheck from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport Ot, { EventEmitter as A } from \"events\";\nimport ue from \"pino\";\nimport At from \"@walletconnect/keyvaluestorage\";\nimport { HEARTBEAT_EVENTS as H, HeartBeat as zt } from \"@walletconnect/heartbeat\";\nimport { generateChildLogger as w, getLoggerContext as v, getDefaultLoggerOptions as le } from \"@walletconnect/logger\";\nimport { IMessageTracker as Nt, IPublisher as Ut, ISubscriber as Lt, IRelayer as Ft, IStore as Mt, IJsonRpcHistory as $t, IExpirer as Kt, ICore as kt } from \"@walletconnect/types\";\nimport { safeJsonStringify as Bt, safeJsonParse as jt } from \"@walletconnect/safe-json\";\nimport * as k from \"@walletconnect/relay-auth\";\nimport { getInternalError as c, mapToObj as de, objToMap as ge, generateKeyPair as Vt, generateRandomBytes32 as X, deriveSymKey as qt, hashKey as Gt, validateEncoding as Yt, isTypeOneEnvelope as pe, encrypt as Jt, validateDecoding as Ht, decrypt as Xt, deserialize as Wt, decodeTypeByte as Zt, hashMessage as B, getRelayProtocolName as W, createExpiringPromise as j, getRelayProtocolApi as V, isUndefined as Z, getSdkError as L, isValidArray as Qt, formatRelayRpcUrl as ei, isProposalStruct as ti, isSessionStruct as ii, TYPE_1 as si, calcExpiry as Q, formatUri as ri, parseUri as ni, createDelayedPromise as ai, engineEvent as ee, isExpired as De, isValidParams as te, isValidUrl as oi, isValidString as hi, parseExpirerTarget as ci, formatTopicTarget as ui, formatIdTarget as li } from \"@walletconnect/utils\";\nimport { ONE_DAY as z, SIX_HOURS as di, ONE_SECOND as gi, THIRTY_DAYS as ie, FIVE_SECONDS as pi, THIRTY_SECONDS as ye, Watch as Di, toMiliseconds as be, FIVE_MINUTES as me } from \"@walletconnect/time\";\nimport { JsonRpcProvider as yi } from \"@walletconnect/jsonrpc-provider\";\nimport { isJsonRpcRequest as Ee, formatJsonRpcResult as fe, formatJsonRpcRequest as we, formatJsonRpcError as bi, isJsonRpcResult as mi, isJsonRpcError as ve, isJsonRpcResponse as Ei } from \"@walletconnect/jsonrpc-utils\";\nimport fi from \"@walletconnect/jsonrpc-ws-connection\";\nimport wi from \"lodash.isequal\";\nfunction vi(r, e) {\n  if (r.length >= 255) throw new TypeError(\"Alphabet too long\");\n  for (var t = new Uint8Array(256), i = 0; i < t.length; i++) t[i] = 255;\n  for (var s = 0; s < r.length; s++) {\n    var n = r.charAt(s),\n      a = n.charCodeAt(0);\n    if (t[a] !== 255) throw new TypeError(n + \" is ambiguous\");\n    t[a] = s;\n  }\n  var o = r.length,\n    h = r.charAt(0),\n    d = Math.log(o) / Math.log(256),\n    l = Math.log(256) / Math.log(o);\n  function g(u) {\n    if (u instanceof Uint8Array || (ArrayBuffer.isView(u) ? u = new Uint8Array(u.buffer, u.byteOffset, u.byteLength) : Array.isArray(u) && (u = Uint8Array.from(u))), !(u instanceof Uint8Array)) throw new TypeError(\"Expected Uint8Array\");\n    if (u.length === 0) return \"\";\n    for (var y = 0, O = 0, E = 0, _ = u.length; E !== _ && u[E] === 0;) E++, y++;\n    for (var R = (_ - E) * l + 1 >>> 0, b = new Uint8Array(R); E !== _;) {\n      for (var S = u[E], x = 0, f = R - 1; (S !== 0 || x < O) && f !== -1; f--, x++) S += 256 * b[f] >>> 0, b[f] = S % o >>> 0, S = S / o >>> 0;\n      if (S !== 0) throw new Error(\"Non-zero carry\");\n      O = x, E++;\n    }\n    for (var T = R - O; T !== R && b[T] === 0;) T++;\n    for (var K = h.repeat(y); T < R; ++T) K += r.charAt(b[T]);\n    return K;\n  }\n  function U(u) {\n    if (typeof u != \"string\") throw new TypeError(\"Expected String\");\n    if (u.length === 0) return new Uint8Array();\n    var y = 0;\n    if (u[y] !== \" \") {\n      for (var O = 0, E = 0; u[y] === h;) O++, y++;\n      for (var _ = (u.length - y) * d + 1 >>> 0, R = new Uint8Array(_); u[y];) {\n        var b = t[u.charCodeAt(y)];\n        if (b === 255) return;\n        for (var S = 0, x = _ - 1; (b !== 0 || S < E) && x !== -1; x--, S++) b += o * R[x] >>> 0, R[x] = b % 256 >>> 0, b = b / 256 >>> 0;\n        if (b !== 0) throw new Error(\"Non-zero carry\");\n        E = S, y++;\n      }\n      if (u[y] !== \" \") {\n        for (var f = _ - E; f !== _ && R[f] === 0;) f++;\n        for (var T = new Uint8Array(O + (_ - f)), K = O; f !== _;) T[K++] = R[f++];\n        return T;\n      }\n    }\n  }\n  function J(u) {\n    var y = U(u);\n    if (y) return y;\n    throw new Error(\"Non-\".concat(e, \" character\"));\n  }\n  return {\n    encode: g,\n    decodeUnsafe: U,\n    decode: J\n  };\n}\nvar Ii = vi,\n  Ci = Ii;\nvar Ie = function Ie(r) {\n    if (r instanceof Uint8Array && r.constructor.name === \"Uint8Array\") return r;\n    if (r instanceof ArrayBuffer) return new Uint8Array(r);\n    if (ArrayBuffer.isView(r)) return new Uint8Array(r.buffer, r.byteOffset, r.byteLength);\n    throw new Error(\"Unknown type, must be binary type\");\n  },\n  _i = function _i(r) {\n    return new TextEncoder().encode(r);\n  },\n  Ri = function Ri(r) {\n    return new TextDecoder().decode(r);\n  };\nvar Si = /*#__PURE__*/function () {\n  function Si(e, t, i) {\n    _classCallCheck(this, Si);\n    this.name = e, this.prefix = t, this.baseEncode = i;\n  }\n  _createClass(Si, [{\n    key: \"encode\",\n    value: function encode(e) {\n      if (e instanceof Uint8Array) return \"\".concat(this.prefix).concat(this.baseEncode(e));\n      throw Error(\"Unknown type, must be binary type\");\n    }\n  }]);\n  return Si;\n}();\nvar Ti = /*#__PURE__*/function () {\n  function Ti(e, t, i) {\n    _classCallCheck(this, Ti);\n    if (this.name = e, this.prefix = t, t.codePointAt(0) === void 0) throw new Error(\"Invalid prefix character\");\n    this.prefixCodePoint = t.codePointAt(0), this.baseDecode = i;\n  }\n  _createClass(Ti, [{\n    key: \"decode\",\n    value: function decode(e) {\n      if (typeof e == \"string\") {\n        if (e.codePointAt(0) !== this.prefixCodePoint) throw Error(\"Unable to decode multibase string \".concat(JSON.stringify(e), \", \").concat(this.name, \" decoder only supports inputs prefixed with \").concat(this.prefix));\n        return this.baseDecode(e.slice(this.prefix.length));\n      } else throw Error(\"Can only multibase decode strings\");\n    }\n  }, {\n    key: \"or\",\n    value: function or(e) {\n      return Ce(this, e);\n    }\n  }]);\n  return Ti;\n}();\nvar Pi = /*#__PURE__*/function () {\n  function Pi(e) {\n    _classCallCheck(this, Pi);\n    this.decoders = e;\n  }\n  _createClass(Pi, [{\n    key: \"or\",\n    value: function or(e) {\n      return Ce(this, e);\n    }\n  }, {\n    key: \"decode\",\n    value: function decode(e) {\n      var t = e[0],\n        i = this.decoders[t];\n      if (i) return i.decode(e);\n      throw RangeError(\"Unable to decode multibase string \".concat(JSON.stringify(e), \", only inputs prefixed with \").concat(Object.keys(this.decoders), \" are supported\"));\n    }\n  }]);\n  return Pi;\n}();\nvar Ce = function Ce(r, e) {\n  return new Pi(_objectSpread(_objectSpread({}, r.decoders || _defineProperty({}, r.prefix, r)), e.decoders || _defineProperty({}, e.prefix, e)));\n};\nvar xi = /*#__PURE__*/function () {\n  function xi(e, t, i, s) {\n    _classCallCheck(this, xi);\n    this.name = e, this.prefix = t, this.baseEncode = i, this.baseDecode = s, this.encoder = new Si(e, t, i), this.decoder = new Ti(e, t, s);\n  }\n  _createClass(xi, [{\n    key: \"encode\",\n    value: function encode(e) {\n      return this.encoder.encode(e);\n    }\n  }, {\n    key: \"decode\",\n    value: function decode(e) {\n      return this.decoder.decode(e);\n    }\n  }]);\n  return xi;\n}();\nvar q = function q(_ref3) {\n    var r = _ref3.name,\n      e = _ref3.prefix,\n      t = _ref3.encode,\n      i = _ref3.decode;\n    return new xi(r, e, t, i);\n  },\n  F = function F(_ref4) {\n    var r = _ref4.prefix,\n      e = _ref4.name,\n      t = _ref4.alphabet;\n    var _Ci = Ci(t, e),\n      i = _Ci.encode,\n      s = _Ci.decode;\n    return q({\n      prefix: r,\n      name: e,\n      encode: i,\n      decode: function decode(n) {\n        return Ie(s(n));\n      }\n    });\n  },\n  Oi = function Oi(r, e, t, i) {\n    var s = {};\n    for (var l = 0; l < e.length; ++l) s[e[l]] = l;\n    var n = r.length;\n    for (; r[n - 1] === \"=\";) --n;\n    var a = new Uint8Array(n * t / 8 | 0);\n    var o = 0,\n      h = 0,\n      d = 0;\n    for (var _l = 0; _l < n; ++_l) {\n      var g = s[r[_l]];\n      if (g === void 0) throw new SyntaxError(\"Non-\".concat(i, \" character\"));\n      h = h << t | g, o += t, o >= 8 && (o -= 8, a[d++] = 255 & h >> o);\n    }\n    if (o >= t || 255 & h << 8 - o) throw new SyntaxError(\"Unexpected end of data\");\n    return a;\n  },\n  Ai = function Ai(r, e, t) {\n    var i = e[e.length - 1] === \"=\",\n      s = (1 << t) - 1;\n    var n = \"\",\n      a = 0,\n      o = 0;\n    for (var h = 0; h < r.length; ++h) for (o = o << 8 | r[h], a += 8; a > t;) a -= t, n += e[s & o >> a];\n    if (a && (n += e[s & o << t - a]), i) for (; n.length * t & 7;) n += \"=\";\n    return n;\n  },\n  p = function p(_ref5) {\n    var r = _ref5.name,\n      e = _ref5.prefix,\n      t = _ref5.bitsPerChar,\n      i = _ref5.alphabet;\n    return q({\n      prefix: e,\n      name: r,\n      encode: function encode(s) {\n        return Ai(s, i, t);\n      },\n      decode: function decode(s) {\n        return Oi(s, i, t, r);\n      }\n    });\n  },\n  zi = q({\n    prefix: \"\\0\",\n    name: \"identity\",\n    encode: function encode(r) {\n      return Ri(r);\n    },\n    decode: function decode(r) {\n      return _i(r);\n    }\n  });\nvar Ni = Object.freeze({\n  __proto__: null,\n  identity: zi\n});\nvar Ui = p({\n  prefix: \"0\",\n  name: \"base2\",\n  alphabet: \"01\",\n  bitsPerChar: 1\n});\nvar Li = Object.freeze({\n  __proto__: null,\n  base2: Ui\n});\nvar Fi = p({\n  prefix: \"7\",\n  name: \"base8\",\n  alphabet: \"01234567\",\n  bitsPerChar: 3\n});\nvar Mi = Object.freeze({\n  __proto__: null,\n  base8: Fi\n});\nvar $i = F({\n  prefix: \"9\",\n  name: \"base10\",\n  alphabet: \"0123456789\"\n});\nvar Ki = Object.freeze({\n  __proto__: null,\n  base10: $i\n});\nvar ki = p({\n    prefix: \"f\",\n    name: \"base16\",\n    alphabet: \"0123456789abcdef\",\n    bitsPerChar: 4\n  }),\n  Bi = p({\n    prefix: \"F\",\n    name: \"base16upper\",\n    alphabet: \"0123456789ABCDEF\",\n    bitsPerChar: 4\n  });\nvar ji = Object.freeze({\n  __proto__: null,\n  base16: ki,\n  base16upper: Bi\n});\nvar Vi = p({\n    prefix: \"b\",\n    name: \"base32\",\n    alphabet: \"abcdefghijklmnopqrstuvwxyz234567\",\n    bitsPerChar: 5\n  }),\n  qi = p({\n    prefix: \"B\",\n    name: \"base32upper\",\n    alphabet: \"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\",\n    bitsPerChar: 5\n  }),\n  Gi = p({\n    prefix: \"c\",\n    name: \"base32pad\",\n    alphabet: \"abcdefghijklmnopqrstuvwxyz234567=\",\n    bitsPerChar: 5\n  }),\n  Yi = p({\n    prefix: \"C\",\n    name: \"base32padupper\",\n    alphabet: \"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=\",\n    bitsPerChar: 5\n  }),\n  Ji = p({\n    prefix: \"v\",\n    name: \"base32hex\",\n    alphabet: \"0123456789abcdefghijklmnopqrstuv\",\n    bitsPerChar: 5\n  }),\n  Hi = p({\n    prefix: \"V\",\n    name: \"base32hexupper\",\n    alphabet: \"0123456789ABCDEFGHIJKLMNOPQRSTUV\",\n    bitsPerChar: 5\n  }),\n  Xi = p({\n    prefix: \"t\",\n    name: \"base32hexpad\",\n    alphabet: \"0123456789abcdefghijklmnopqrstuv=\",\n    bitsPerChar: 5\n  }),\n  Wi = p({\n    prefix: \"T\",\n    name: \"base32hexpadupper\",\n    alphabet: \"0123456789ABCDEFGHIJKLMNOPQRSTUV=\",\n    bitsPerChar: 5\n  }),\n  Zi = p({\n    prefix: \"h\",\n    name: \"base32z\",\n    alphabet: \"ybndrfg8ejkmcpqxot1uwisza345h769\",\n    bitsPerChar: 5\n  });\nvar Qi = Object.freeze({\n  __proto__: null,\n  base32: Vi,\n  base32upper: qi,\n  base32pad: Gi,\n  base32padupper: Yi,\n  base32hex: Ji,\n  base32hexupper: Hi,\n  base32hexpad: Xi,\n  base32hexpadupper: Wi,\n  base32z: Zi\n});\nvar es = F({\n    prefix: \"k\",\n    name: \"base36\",\n    alphabet: \"0123456789abcdefghijklmnopqrstuvwxyz\"\n  }),\n  ts = F({\n    prefix: \"K\",\n    name: \"base36upper\",\n    alphabet: \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n  });\nvar is = Object.freeze({\n  __proto__: null,\n  base36: es,\n  base36upper: ts\n});\nvar ss = F({\n    name: \"base58btc\",\n    prefix: \"z\",\n    alphabet: \"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz\"\n  }),\n  rs = F({\n    name: \"base58flickr\",\n    prefix: \"Z\",\n    alphabet: \"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ\"\n  });\nvar ns = Object.freeze({\n  __proto__: null,\n  base58btc: ss,\n  base58flickr: rs\n});\nvar as = p({\n    prefix: \"m\",\n    name: \"base64\",\n    alphabet: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",\n    bitsPerChar: 6\n  }),\n  os = p({\n    prefix: \"M\",\n    name: \"base64pad\",\n    alphabet: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",\n    bitsPerChar: 6\n  }),\n  hs = p({\n    prefix: \"u\",\n    name: \"base64url\",\n    alphabet: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_\",\n    bitsPerChar: 6\n  }),\n  cs = p({\n    prefix: \"U\",\n    name: \"base64urlpad\",\n    alphabet: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=\",\n    bitsPerChar: 6\n  });\nvar us = Object.freeze({\n  __proto__: null,\n  base64: as,\n  base64pad: os,\n  base64url: hs,\n  base64urlpad: cs\n});\nvar _e = Array.from(\"\\uD83D\\uDE80\\uD83E\\uDE90\\u2604\\uD83D\\uDEF0\\uD83C\\uDF0C\\uD83C\\uDF11\\uD83C\\uDF12\\uD83C\\uDF13\\uD83C\\uDF14\\uD83C\\uDF15\\uD83C\\uDF16\\uD83C\\uDF17\\uD83C\\uDF18\\uD83C\\uDF0D\\uD83C\\uDF0F\\uD83C\\uDF0E\\uD83D\\uDC09\\u2600\\uD83D\\uDCBB\\uD83D\\uDDA5\\uD83D\\uDCBE\\uD83D\\uDCBF\\uD83D\\uDE02\\u2764\\uD83D\\uDE0D\\uD83E\\uDD23\\uD83D\\uDE0A\\uD83D\\uDE4F\\uD83D\\uDC95\\uD83D\\uDE2D\\uD83D\\uDE18\\uD83D\\uDC4D\\uD83D\\uDE05\\uD83D\\uDC4F\\uD83D\\uDE01\\uD83D\\uDD25\\uD83E\\uDD70\\uD83D\\uDC94\\uD83D\\uDC96\\uD83D\\uDC99\\uD83D\\uDE22\\uD83E\\uDD14\\uD83D\\uDE06\\uD83D\\uDE44\\uD83D\\uDCAA\\uD83D\\uDE09\\u263A\\uD83D\\uDC4C\\uD83E\\uDD17\\uD83D\\uDC9C\\uD83D\\uDE14\\uD83D\\uDE0E\\uD83D\\uDE07\\uD83C\\uDF39\\uD83E\\uDD26\\uD83C\\uDF89\\uD83D\\uDC9E\\u270C\\u2728\\uD83E\\uDD37\\uD83D\\uDE31\\uD83D\\uDE0C\\uD83C\\uDF38\\uD83D\\uDE4C\\uD83D\\uDE0B\\uD83D\\uDC97\\uD83D\\uDC9A\\uD83D\\uDE0F\\uD83D\\uDC9B\\uD83D\\uDE42\\uD83D\\uDC93\\uD83E\\uDD29\\uD83D\\uDE04\\uD83D\\uDE00\\uD83D\\uDDA4\\uD83D\\uDE03\\uD83D\\uDCAF\\uD83D\\uDE48\\uD83D\\uDC47\\uD83C\\uDFB6\\uD83D\\uDE12\\uD83E\\uDD2D\\u2763\\uD83D\\uDE1C\\uD83D\\uDC8B\\uD83D\\uDC40\\uD83D\\uDE2A\\uD83D\\uDE11\\uD83D\\uDCA5\\uD83D\\uDE4B\\uD83D\\uDE1E\\uD83D\\uDE29\\uD83D\\uDE21\\uD83E\\uDD2A\\uD83D\\uDC4A\\uD83E\\uDD73\\uD83D\\uDE25\\uD83E\\uDD24\\uD83D\\uDC49\\uD83D\\uDC83\\uD83D\\uDE33\\u270B\\uD83D\\uDE1A\\uD83D\\uDE1D\\uD83D\\uDE34\\uD83C\\uDF1F\\uD83D\\uDE2C\\uD83D\\uDE43\\uD83C\\uDF40\\uD83C\\uDF37\\uD83D\\uDE3B\\uD83D\\uDE13\\u2B50\\u2705\\uD83E\\uDD7A\\uD83C\\uDF08\\uD83D\\uDE08\\uD83E\\uDD18\\uD83D\\uDCA6\\u2714\\uD83D\\uDE23\\uD83C\\uDFC3\\uD83D\\uDC90\\u2639\\uD83C\\uDF8A\\uD83D\\uDC98\\uD83D\\uDE20\\u261D\\uD83D\\uDE15\\uD83C\\uDF3A\\uD83C\\uDF82\\uD83C\\uDF3B\\uD83D\\uDE10\\uD83D\\uDD95\\uD83D\\uDC9D\\uD83D\\uDE4A\\uD83D\\uDE39\\uD83D\\uDDE3\\uD83D\\uDCAB\\uD83D\\uDC80\\uD83D\\uDC51\\uD83C\\uDFB5\\uD83E\\uDD1E\\uD83D\\uDE1B\\uD83D\\uDD34\\uD83D\\uDE24\\uD83C\\uDF3C\\uD83D\\uDE2B\\u26BD\\uD83E\\uDD19\\u2615\\uD83C\\uDFC6\\uD83E\\uDD2B\\uD83D\\uDC48\\uD83D\\uDE2E\\uD83D\\uDE46\\uD83C\\uDF7B\\uD83C\\uDF43\\uD83D\\uDC36\\uD83D\\uDC81\\uD83D\\uDE32\\uD83C\\uDF3F\\uD83E\\uDDE1\\uD83C\\uDF81\\u26A1\\uD83C\\uDF1E\\uD83C\\uDF88\\u274C\\u270A\\uD83D\\uDC4B\\uD83D\\uDE30\\uD83E\\uDD28\\uD83D\\uDE36\\uD83E\\uDD1D\\uD83D\\uDEB6\\uD83D\\uDCB0\\uD83C\\uDF53\\uD83D\\uDCA2\\uD83E\\uDD1F\\uD83D\\uDE41\\uD83D\\uDEA8\\uD83D\\uDCA8\\uD83E\\uDD2C\\u2708\\uD83C\\uDF80\\uD83C\\uDF7A\\uD83E\\uDD13\\uD83D\\uDE19\\uD83D\\uDC9F\\uD83C\\uDF31\\uD83D\\uDE16\\uD83D\\uDC76\\uD83E\\uDD74\\u25B6\\u27A1\\u2753\\uD83D\\uDC8E\\uD83D\\uDCB8\\u2B07\\uD83D\\uDE28\\uD83C\\uDF1A\\uD83E\\uDD8B\\uD83D\\uDE37\\uD83D\\uDD7A\\u26A0\\uD83D\\uDE45\\uD83D\\uDE1F\\uD83D\\uDE35\\uD83D\\uDC4E\\uD83E\\uDD32\\uD83E\\uDD20\\uD83E\\uDD27\\uD83D\\uDCCC\\uD83D\\uDD35\\uD83D\\uDC85\\uD83E\\uDDD0\\uD83D\\uDC3E\\uD83C\\uDF52\\uD83D\\uDE17\\uD83E\\uDD11\\uD83C\\uDF0A\\uD83E\\uDD2F\\uD83D\\uDC37\\u260E\\uD83D\\uDCA7\\uD83D\\uDE2F\\uD83D\\uDC86\\uD83D\\uDC46\\uD83C\\uDFA4\\uD83D\\uDE47\\uD83C\\uDF51\\u2744\\uD83C\\uDF34\\uD83D\\uDCA3\\uD83D\\uDC38\\uD83D\\uDC8C\\uD83D\\uDCCD\\uD83E\\uDD40\\uD83E\\uDD22\\uD83D\\uDC45\\uD83D\\uDCA1\\uD83D\\uDCA9\\uD83D\\uDC50\\uD83D\\uDCF8\\uD83D\\uDC7B\\uD83E\\uDD10\\uD83E\\uDD2E\\uD83C\\uDFBC\\uD83E\\uDD75\\uD83D\\uDEA9\\uD83C\\uDF4E\\uD83C\\uDF4A\\uD83D\\uDC7C\\uD83D\\uDC8D\\uD83D\\uDCE3\\uD83E\\uDD42\"),\n  ls = _e.reduce(function (r, e, t) {\n    return r[t] = e, r;\n  }, []),\n  ds = _e.reduce(function (r, e, t) {\n    return r[e.codePointAt(0)] = t, r;\n  }, []);\nfunction gs(r) {\n  return r.reduce(function (e, t) {\n    return e += ls[t], e;\n  }, \"\");\n}\nfunction ps(r) {\n  var e = [];\n  var _iterator = _createForOfIteratorHelper(r),\n    _step;\n  try {\n    for (_iterator.s(); !(_step = _iterator.n()).done;) {\n      var t = _step.value;\n      var i = ds[t.codePointAt(0)];\n      if (i === void 0) throw new Error(\"Non-base256emoji character: \".concat(t));\n      e.push(i);\n    }\n  } catch (err) {\n    _iterator.e(err);\n  } finally {\n    _iterator.f();\n  }\n  return new Uint8Array(e);\n}\nvar Ds = q({\n  prefix: \"\\uD83D\\uDE80\",\n  name: \"base256emoji\",\n  encode: gs,\n  decode: ps\n});\nvar ys = Object.freeze({\n    __proto__: null,\n    base256emoji: Ds\n  }),\n  bs = Se,\n  Re = 128,\n  ms = 127,\n  Es = ~ms,\n  fs = Math.pow(2, 31);\nfunction Se(r, e, t) {\n  e = e || [], t = t || 0;\n  for (var i = t; r >= fs;) e[t++] = r & 255 | Re, r /= 128;\n  for (; r & Es;) e[t++] = r & 255 | Re, r >>>= 7;\n  return e[t] = r | 0, Se.bytes = t - i + 1, e;\n}\nvar ws = se,\n  vs = 128,\n  Te = 127;\nfunction se(r, i) {\n  var t = 0,\n    i = i || 0,\n    s = 0,\n    n = i,\n    a,\n    o = r.length;\n  do {\n    if (n >= o) throw se.bytes = 0, new RangeError(\"Could not decode varint\");\n    a = r[n++], t += s < 28 ? (a & Te) << s : (a & Te) * Math.pow(2, s), s += 7;\n  } while (a >= vs);\n  return se.bytes = n - i, t;\n}\nvar Is = Math.pow(2, 7),\n  Cs = Math.pow(2, 14),\n  _s = Math.pow(2, 21),\n  Rs = Math.pow(2, 28),\n  Ss = Math.pow(2, 35),\n  Ts = Math.pow(2, 42),\n  Ps = Math.pow(2, 49),\n  xs = Math.pow(2, 56),\n  Os = Math.pow(2, 63),\n  As = function As(r) {\n    return r < Is ? 1 : r < Cs ? 2 : r < _s ? 3 : r < Rs ? 4 : r < Ss ? 5 : r < Ts ? 6 : r < Ps ? 7 : r < xs ? 8 : r < Os ? 9 : 10;\n  },\n  zs = {\n    encode: bs,\n    decode: ws,\n    encodingLength: As\n  },\n  Pe = zs;\nvar xe = function xe(r, e) {\n    var t = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    return Pe.encode(r, e, t), e;\n  },\n  Oe = function Oe(r) {\n    return Pe.encodingLength(r);\n  },\n  re = function re(r, e) {\n    var t = e.byteLength,\n      i = Oe(r),\n      s = i + Oe(t),\n      n = new Uint8Array(s + t);\n    return xe(r, n, 0), xe(t, n, i), n.set(e, s), new Ns(r, t, e, n);\n  };\nvar Ns = /*#__PURE__*/_createClass(function Ns(e, t, i, s) {\n  _classCallCheck(this, Ns);\n  this.code = e, this.size = t, this.digest = i, this.bytes = s;\n});\nvar Ae = function Ae(_ref6) {\n  var r = _ref6.name,\n    e = _ref6.code,\n    t = _ref6.encode;\n  return new Us(r, e, t);\n};\nvar Us = /*#__PURE__*/function () {\n  function Us(e, t, i) {\n    _classCallCheck(this, Us);\n    this.name = e, this.code = t, this.encode = i;\n  }\n  _createClass(Us, [{\n    key: \"digest\",\n    value: function digest(e) {\n      var _this = this;\n      if (e instanceof Uint8Array) {\n        var t = this.encode(e);\n        return t instanceof Uint8Array ? re(this.code, t) : t.then(function (i) {\n          return re(_this.code, i);\n        });\n      } else throw Error(\"Unknown type, must be binary type\");\n    }\n  }]);\n  return Us;\n}();\nvar ze = function ze(r) {\n    return /*#__PURE__*/function () {\n      var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(e) {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.t0 = Uint8Array;\n              _context.next = 3;\n              return crypto.subtle.digest(r, e);\n            case 3:\n              _context.t1 = _context.sent;\n              return _context.abrupt(\"return\", new _context.t0(_context.t1));\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function (_x) {\n        return _ref7.apply(this, arguments);\n      };\n    }();\n  },\n  Ls = Ae({\n    name: \"sha2-256\",\n    code: 18,\n    encode: ze(\"SHA-256\")\n  }),\n  Fs = Ae({\n    name: \"sha2-512\",\n    code: 19,\n    encode: ze(\"SHA-512\")\n  });\nvar Ms = Object.freeze({\n  __proto__: null,\n  sha256: Ls,\n  sha512: Fs\n});\nvar Ne = 0,\n  $s = \"identity\",\n  Ue = Ie,\n  Ks = function Ks(r) {\n    return re(Ne, Ue(r));\n  },\n  ks = {\n    code: Ne,\n    name: $s,\n    encode: Ue,\n    digest: Ks\n  };\nvar Bs = Object.freeze({\n  __proto__: null,\n  identity: ks\n});\nnew TextEncoder(), new TextDecoder();\nvar Le = _objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({}, Ni), Li), Mi), Ki), ji), Qi), is), ns), us), ys);\n_objectSpread(_objectSpread({}, Ms), Bs);\nfunction js() {\n  var r = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n  return globalThis.Buffer != null && globalThis.Buffer.allocUnsafe != null ? globalThis.Buffer.allocUnsafe(r) : new Uint8Array(r);\n}\nfunction Fe(r, e, t, i) {\n  return {\n    name: r,\n    prefix: e,\n    encoder: {\n      name: r,\n      prefix: e,\n      encode: t\n    },\n    decoder: {\n      decode: i\n    }\n  };\n}\nvar Me = Fe(\"utf8\", \"u\", function (r) {\n    return \"u\" + new TextDecoder(\"utf8\").decode(r);\n  }, function (r) {\n    return new TextEncoder().encode(r.substring(1));\n  }),\n  ne = Fe(\"ascii\", \"a\", function (r) {\n    var e = \"a\";\n    for (var t = 0; t < r.length; t++) e += String.fromCharCode(r[t]);\n    return e;\n  }, function (r) {\n    r = r.substring(1);\n    var e = js(r.length);\n    for (var t = 0; t < r.length; t++) e[t] = r.charCodeAt(t);\n    return e;\n  }),\n  Vs = _objectSpread({\n    utf8: Me,\n    \"utf-8\": Me,\n    hex: Le.base16,\n    latin1: ne,\n    ascii: ne,\n    binary: ne\n  }, Le);\nfunction qs(r) {\n  var e = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"utf8\";\n  var t = Vs[e];\n  if (!t) throw new Error(\"Unsupported encoding \\\"\".concat(e, \"\\\"\"));\n  return (e === \"utf8\" || e === \"utf-8\") && globalThis.Buffer != null && globalThis.Buffer.from != null ? globalThis.Buffer.from(r, \"utf8\") : t.decoder.decode(\"\".concat(t.prefix).concat(r));\n}\nvar ae = \"wc\",\n  $e = 2,\n  G = \"core\",\n  P = \"\".concat(ae, \"@\", 2, \":\").concat(G, \":\"),\n  Ke = {\n    name: G,\n    logger: \"error\"\n  },\n  ke = {\n    database: \":memory:\"\n  },\n  Be = \"crypto\",\n  oe = \"client_ed25519_seed\",\n  je = z,\n  Ve = \"keychain\",\n  qe = \"0.3\",\n  Ge = \"messages\",\n  Ye = \"0.3\",\n  Je = di,\n  He = \"publisher\",\n  Xe = \"irn\",\n  We = \"error\",\n  he = \"wss://relay.walletconnect.com\",\n  Ze = \"relayer\",\n  D = {\n    message: \"relayer_message\",\n    connect: \"relayer_connect\",\n    disconnect: \"relayer_disconnect\",\n    error: \"relayer_error\",\n    connection_stalled: \"relayer_connection_stalled\",\n    transport_closed: \"relayer_transport_closed\",\n    publish: \"relayer_publish\"\n  },\n  Qe = \"_subscription\",\n  M = {\n    payload: \"payload\",\n    connect: \"connect\",\n    disconnect: \"disconnect\",\n    error: \"error\"\n  },\n  et = gi,\n  Gs = {\n    database: \":memory:\"\n  },\n  tt = \"2.5.2\",\n  it = \"0.3\",\n  I = {\n    created: \"subscription_created\",\n    deleted: \"subscription_deleted\",\n    expired: \"subscription_expired\",\n    disabled: \"subscription_disabled\",\n    sync: \"subscription_sync\",\n    resubscribed: \"subscription_resubscribed\"\n  },\n  Ys = ie,\n  st = \"subscription\",\n  rt = \"0.3\",\n  nt = pi * 1e3,\n  at = \"pairing\",\n  ot = \"0.3\",\n  Js = ie,\n  N = {\n    wc_pairingDelete: {\n      req: {\n        ttl: z,\n        prompt: !1,\n        tag: 1e3\n      },\n      res: {\n        ttl: z,\n        prompt: !1,\n        tag: 1001\n      }\n    },\n    wc_pairingPing: {\n      req: {\n        ttl: ye,\n        prompt: !1,\n        tag: 1002\n      },\n      res: {\n        ttl: ye,\n        prompt: !1,\n        tag: 1003\n      }\n    },\n    unregistered_method: {\n      req: {\n        ttl: z,\n        prompt: !1,\n        tag: 0\n      },\n      res: {\n        ttl: z,\n        prompt: !1,\n        tag: 0\n      }\n    }\n  },\n  C = {\n    created: \"history_created\",\n    updated: \"history_updated\",\n    deleted: \"history_deleted\",\n    sync: \"history_sync\"\n  },\n  ht = \"history\",\n  ct = \"0.3\",\n  ut = \"expirer\",\n  m = {\n    created: \"expirer_created\",\n    deleted: \"expirer_deleted\",\n    expired: \"expirer_expired\",\n    sync: \"expirer_sync\"\n  },\n  lt = \"0.3\",\n  Hs = z;\nvar dt = /*#__PURE__*/function () {\n  function dt(e, t) {\n    var _this2 = this;\n    _classCallCheck(this, dt);\n    this.core = e, this.logger = t, this.keychain = new Map(), this.name = Ve, this.version = qe, this.initialized = !1, this.storagePrefix = P, this.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n      var i;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            if (_this2.initialized) {\n              _context2.next = 5;\n              break;\n            }\n            _context2.next = 3;\n            return _this2.getKeyChain();\n          case 3:\n            i = _context2.sent;\n            typeof i < \"u\" && (_this2.keychain = i), _this2.initialized = !0;\n          case 5:\n          case \"end\":\n            return _context2.stop();\n        }\n      }, _callee2);\n    })), this.has = function (i) {\n      return _this2.isInitialized(), _this2.keychain.has(i);\n    }, this.set = /*#__PURE__*/function () {\n      var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(i, s) {\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _this2.isInitialized();\n              _this2.keychain.set(i, s);\n              _context3.next = 4;\n              return _this2.persist();\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3);\n      }));\n      return function (_x2, _x3) {\n        return _ref9.apply(this, arguments);\n      };\n    }(), this.get = function (i) {\n      _this2.isInitialized();\n      var s = _this2.keychain.get(i);\n      if (typeof s > \"u\") {\n        var _c = c(\"NO_MATCHING_KEY\", \"\".concat(_this2.name, \": \").concat(i)),\n          n = _c.message;\n        throw new Error(n);\n      }\n      return s;\n    }, this.del = /*#__PURE__*/function () {\n      var _ref10 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(i) {\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _this2.isInitialized();\n              _this2.keychain.delete(i);\n              _context4.next = 4;\n              return _this2.persist();\n            case 4:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4);\n      }));\n      return function (_x4) {\n        return _ref10.apply(this, arguments);\n      };\n    }(), this.core = e, this.logger = w(t, this.name);\n  }\n  _createClass(dt, [{\n    key: \"context\",\n    get: function get() {\n      return v(this.logger);\n    }\n  }, {\n    key: \"storageKey\",\n    get: function get() {\n      return this.storagePrefix + this.version + \"//\" + this.name;\n    }\n  }, {\n    key: \"setKeyChain\",\n    value: function () {\n      var _setKeyChain = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5(e) {\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return this.core.storage.setItem(this.storageKey, de(e));\n            case 2:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, this);\n      }));\n      function setKeyChain(_x5) {\n        return _setKeyChain.apply(this, arguments);\n      }\n      return setKeyChain;\n    }()\n  }, {\n    key: \"getKeyChain\",\n    value: function () {\n      var _getKeyChain = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n        var e;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return this.core.storage.getItem(this.storageKey);\n            case 2:\n              e = _context6.sent;\n              return _context6.abrupt(\"return\", typeof e < \"u\" ? ge(e) : void 0);\n            case 4:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee6, this);\n      }));\n      function getKeyChain() {\n        return _getKeyChain.apply(this, arguments);\n      }\n      return getKeyChain;\n    }()\n  }, {\n    key: \"persist\",\n    value: function () {\n      var _persist = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              _context7.next = 2;\n              return this.setKeyChain(this.keychain);\n            case 2:\n            case \"end\":\n              return _context7.stop();\n          }\n        }, _callee7, this);\n      }));\n      function persist() {\n        return _persist.apply(this, arguments);\n      }\n      return persist;\n    }()\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c2 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c2.message;\n        throw new Error(e);\n      }\n    }\n  }]);\n  return dt;\n}();\nvar gt = /*#__PURE__*/function () {\n  function gt(e, t, i) {\n    var _this3 = this;\n    _classCallCheck(this, gt);\n    this.core = e, this.logger = t, this.name = Be, this.initialized = !1, this.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {\n      return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n        while (1) switch (_context8.prev = _context8.next) {\n          case 0:\n            _context8.t0 = _this3.initialized;\n            if (_context8.t0) {\n              _context8.next = 5;\n              break;\n            }\n            _context8.next = 4;\n            return _this3.keychain.init();\n          case 4:\n            _this3.initialized = !0;\n          case 5:\n          case \"end\":\n            return _context8.stop();\n        }\n      }, _callee8);\n    })), this.hasKeys = function (s) {\n      return _this3.isInitialized(), _this3.keychain.has(s);\n    }, this.getClientId = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee9() {\n      var s, n;\n      return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n        while (1) switch (_context9.prev = _context9.next) {\n          case 0:\n            _this3.isInitialized();\n            _context9.next = 3;\n            return _this3.getClientSeed();\n          case 3:\n            s = _context9.sent;\n            n = k.generateKeyPair(s);\n            return _context9.abrupt(\"return\", k.encodeIss(n.publicKey));\n          case 6:\n          case \"end\":\n            return _context9.stop();\n        }\n      }, _callee9);\n    })), this.generateKeyPair = function () {\n      _this3.isInitialized();\n      var s = Vt();\n      return _this3.setPrivateKey(s.publicKey, s.privateKey);\n    }, this.signJWT = /*#__PURE__*/function () {\n      var _ref13 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee10(s) {\n        var n, a, o, h;\n        return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n          while (1) switch (_context10.prev = _context10.next) {\n            case 0:\n              _this3.isInitialized();\n              _context10.next = 3;\n              return _this3.getClientSeed();\n            case 3:\n              n = _context10.sent;\n              a = k.generateKeyPair(n);\n              o = X();\n              h = je;\n              _context10.next = 9;\n              return k.signJWT(o, s, h, a);\n            case 9:\n              return _context10.abrupt(\"return\", _context10.sent);\n            case 10:\n            case \"end\":\n              return _context10.stop();\n          }\n        }, _callee10);\n      }));\n      return function (_x6) {\n        return _ref13.apply(this, arguments);\n      };\n    }(), this.generateSharedKey = function (s, n, a) {\n      _this3.isInitialized();\n      var o = _this3.getPrivateKey(s),\n        h = qt(o, n);\n      return _this3.setSymKey(h, a);\n    }, this.setSymKey = /*#__PURE__*/function () {\n      var _ref14 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee11(s, n) {\n        var a;\n        return _regeneratorRuntime().wrap(function _callee11$(_context11) {\n          while (1) switch (_context11.prev = _context11.next) {\n            case 0:\n              _this3.isInitialized();\n              a = n || Gt(s);\n              _context11.next = 4;\n              return _this3.keychain.set(a, s);\n            case 4:\n              return _context11.abrupt(\"return\", a);\n            case 5:\n            case \"end\":\n              return _context11.stop();\n          }\n        }, _callee11);\n      }));\n      return function (_x7, _x8) {\n        return _ref14.apply(this, arguments);\n      };\n    }(), this.deleteKeyPair = /*#__PURE__*/function () {\n      var _ref15 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee12(s) {\n        return _regeneratorRuntime().wrap(function _callee12$(_context12) {\n          while (1) switch (_context12.prev = _context12.next) {\n            case 0:\n              _this3.isInitialized();\n              _context12.next = 3;\n              return _this3.keychain.del(s);\n            case 3:\n            case \"end\":\n              return _context12.stop();\n          }\n        }, _callee12);\n      }));\n      return function (_x9) {\n        return _ref15.apply(this, arguments);\n      };\n    }(), this.deleteSymKey = /*#__PURE__*/function () {\n      var _ref16 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee13(s) {\n        return _regeneratorRuntime().wrap(function _callee13$(_context13) {\n          while (1) switch (_context13.prev = _context13.next) {\n            case 0:\n              _this3.isInitialized();\n              _context13.next = 3;\n              return _this3.keychain.del(s);\n            case 3:\n            case \"end\":\n              return _context13.stop();\n          }\n        }, _callee13);\n      }));\n      return function (_x10) {\n        return _ref16.apply(this, arguments);\n      };\n    }(), this.encode = /*#__PURE__*/function () {\n      var _ref17 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee14(s, n, a) {\n        var o, h, U, J, d, l, g;\n        return _regeneratorRuntime().wrap(function _callee14$(_context14) {\n          while (1) switch (_context14.prev = _context14.next) {\n            case 0:\n              _this3.isInitialized();\n              o = Yt(a), h = Bt(n);\n              if (!pe(o)) {\n                _context14.next = 7;\n                break;\n              }\n              U = o.senderPublicKey, J = o.receiverPublicKey;\n              _context14.next = 6;\n              return _this3.generateSharedKey(U, J);\n            case 6:\n              s = _context14.sent;\n            case 7:\n              d = _this3.getSymKey(s), l = o.type, g = o.senderPublicKey;\n              return _context14.abrupt(\"return\", Jt({\n                type: l,\n                symKey: d,\n                message: h,\n                senderPublicKey: g\n              }));\n            case 9:\n            case \"end\":\n              return _context14.stop();\n          }\n        }, _callee14);\n      }));\n      return function (_x11, _x12, _x13) {\n        return _ref17.apply(this, arguments);\n      };\n    }(), this.decode = /*#__PURE__*/function () {\n      var _ref18 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee15(s, n, a) {\n        var o, l, g, h, d;\n        return _regeneratorRuntime().wrap(function _callee15$(_context15) {\n          while (1) switch (_context15.prev = _context15.next) {\n            case 0:\n              _this3.isInitialized();\n              o = Ht(n, a);\n              if (!pe(o)) {\n                _context15.next = 7;\n                break;\n              }\n              l = o.receiverPublicKey, g = o.senderPublicKey;\n              _context15.next = 6;\n              return _this3.generateSharedKey(l, g);\n            case 6:\n              s = _context15.sent;\n            case 7:\n              h = _this3.getSymKey(s), d = Xt({\n                symKey: h,\n                encoded: n\n              });\n              return _context15.abrupt(\"return\", jt(d));\n            case 9:\n            case \"end\":\n              return _context15.stop();\n          }\n        }, _callee15);\n      }));\n      return function (_x14, _x15, _x16) {\n        return _ref18.apply(this, arguments);\n      };\n    }(), this.core = e, this.logger = w(t, this.name), this.keychain = i || new dt(this.core, this.logger);\n  }\n  _createClass(gt, [{\n    key: \"context\",\n    get: function get() {\n      return v(this.logger);\n    }\n  }, {\n    key: \"getPayloadType\",\n    value: function getPayloadType(e) {\n      var t = Wt(e);\n      return Zt(t.type);\n    }\n  }, {\n    key: \"setPrivateKey\",\n    value: function () {\n      var _setPrivateKey = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee16(e, t) {\n        return _regeneratorRuntime().wrap(function _callee16$(_context16) {\n          while (1) switch (_context16.prev = _context16.next) {\n            case 0:\n              _context16.next = 2;\n              return this.keychain.set(e, t);\n            case 2:\n              return _context16.abrupt(\"return\", e);\n            case 3:\n            case \"end\":\n              return _context16.stop();\n          }\n        }, _callee16, this);\n      }));\n      function setPrivateKey(_x17, _x18) {\n        return _setPrivateKey.apply(this, arguments);\n      }\n      return setPrivateKey;\n    }()\n  }, {\n    key: \"getPrivateKey\",\n    value: function getPrivateKey(e) {\n      return this.keychain.get(e);\n    }\n  }, {\n    key: \"getClientSeed\",\n    value: function () {\n      var _getClientSeed = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee17() {\n        var e;\n        return _regeneratorRuntime().wrap(function _callee17$(_context17) {\n          while (1) switch (_context17.prev = _context17.next) {\n            case 0:\n              e = \"\";\n              _context17.prev = 1;\n              e = this.keychain.get(oe);\n              _context17.next = 10;\n              break;\n            case 5:\n              _context17.prev = 5;\n              _context17.t0 = _context17[\"catch\"](1);\n              e = X();\n              _context17.next = 10;\n              return this.keychain.set(oe, e);\n            case 10:\n              return _context17.abrupt(\"return\", qs(e, \"base16\"));\n            case 11:\n            case \"end\":\n              return _context17.stop();\n          }\n        }, _callee17, this, [[1, 5]]);\n      }));\n      function getClientSeed() {\n        return _getClientSeed.apply(this, arguments);\n      }\n      return getClientSeed;\n    }()\n  }, {\n    key: \"getSymKey\",\n    value: function getSymKey(e) {\n      return this.keychain.get(e);\n    }\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c3 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c3.message;\n        throw new Error(e);\n      }\n    }\n  }]);\n  return gt;\n}();\nvar pt = /*#__PURE__*/function (_Nt) {\n  _inherits(pt, _Nt);\n  var _super = _createSuper(pt);\n  function pt(e, t) {\n    var _this4;\n    _classCallCheck(this, pt);\n    _this4 = _super.call(this, e, t), _this4.logger = e, _this4.core = t, _this4.messages = new Map(), _this4.name = Ge, _this4.version = Ye, _this4.initialized = !1, _this4.storagePrefix = P, _this4.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee18() {\n      var i;\n      return _regeneratorRuntime().wrap(function _callee18$(_context18) {\n        while (1) switch (_context18.prev = _context18.next) {\n          case 0:\n            if (_this4.initialized) {\n              _context18.next = 15;\n              break;\n            }\n            _this4.logger.trace(\"Initialized\");\n            _context18.prev = 2;\n            _context18.next = 5;\n            return _this4.getRelayerMessages();\n          case 5:\n            i = _context18.sent;\n            typeof i < \"u\" && (_this4.messages = i), _this4.logger.debug(\"Successfully Restored records for \".concat(_this4.name)), _this4.logger.trace({\n              type: \"method\",\n              method: \"restore\",\n              size: _this4.messages.size\n            });\n            _context18.next = 12;\n            break;\n          case 9:\n            _context18.prev = 9;\n            _context18.t0 = _context18[\"catch\"](2);\n            _this4.logger.debug(\"Failed to Restore records for \".concat(_this4.name)), _this4.logger.error(_context18.t0);\n          case 12:\n            _context18.prev = 12;\n            _this4.initialized = !0;\n            return _context18.finish(12);\n          case 15:\n          case \"end\":\n            return _context18.stop();\n        }\n      }, _callee18, null, [[2, 9, 12, 15]]);\n    })), _this4.set = /*#__PURE__*/function () {\n      var _ref20 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee19(i, s) {\n        var n, a;\n        return _regeneratorRuntime().wrap(function _callee19$(_context19) {\n          while (1) switch (_context19.prev = _context19.next) {\n            case 0:\n              _this4.isInitialized();\n              n = B(s);\n              a = _this4.messages.get(i);\n              typeof a > \"u\" && (a = {});\n              _context19.t0 = typeof a[n] < \"u\";\n              if (_context19.t0) {\n                _context19.next = 10;\n                break;\n              }\n              a[n] = s;\n              _this4.messages.set(i, a);\n              _context19.next = 10;\n              return _this4.persist();\n            case 10:\n              return _context19.abrupt(\"return\", n);\n            case 11:\n            case \"end\":\n              return _context19.stop();\n          }\n        }, _callee19);\n      }));\n      return function (_x19, _x20) {\n        return _ref20.apply(this, arguments);\n      };\n    }(), _this4.get = function (i) {\n      _this4.isInitialized();\n      var s = _this4.messages.get(i);\n      return typeof s > \"u\" && (s = {}), s;\n    }, _this4.has = function (i, s) {\n      _this4.isInitialized();\n      var n = _this4.get(i),\n        a = B(s);\n      return typeof n[a] < \"u\";\n    }, _this4.del = /*#__PURE__*/function () {\n      var _ref21 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee20(i) {\n        return _regeneratorRuntime().wrap(function _callee20$(_context20) {\n          while (1) switch (_context20.prev = _context20.next) {\n            case 0:\n              _this4.isInitialized();\n              _this4.messages.delete(i);\n              _context20.next = 4;\n              return _this4.persist();\n            case 4:\n            case \"end\":\n              return _context20.stop();\n          }\n        }, _callee20);\n      }));\n      return function (_x21) {\n        return _ref21.apply(this, arguments);\n      };\n    }(), _this4.logger = w(e, _this4.name), _this4.core = t;\n    return _this4;\n  }\n  _createClass(pt, [{\n    key: \"context\",\n    get: function get() {\n      return v(this.logger);\n    }\n  }, {\n    key: \"storageKey\",\n    get: function get() {\n      return this.storagePrefix + this.version + \"//\" + this.name;\n    }\n  }, {\n    key: \"setRelayerMessages\",\n    value: function () {\n      var _setRelayerMessages = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee21(e) {\n        return _regeneratorRuntime().wrap(function _callee21$(_context21) {\n          while (1) switch (_context21.prev = _context21.next) {\n            case 0:\n              _context21.next = 2;\n              return this.core.storage.setItem(this.storageKey, de(e));\n            case 2:\n            case \"end\":\n              return _context21.stop();\n          }\n        }, _callee21, this);\n      }));\n      function setRelayerMessages(_x22) {\n        return _setRelayerMessages.apply(this, arguments);\n      }\n      return setRelayerMessages;\n    }()\n  }, {\n    key: \"getRelayerMessages\",\n    value: function () {\n      var _getRelayerMessages = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee22() {\n        var e;\n        return _regeneratorRuntime().wrap(function _callee22$(_context22) {\n          while (1) switch (_context22.prev = _context22.next) {\n            case 0:\n              _context22.next = 2;\n              return this.core.storage.getItem(this.storageKey);\n            case 2:\n              e = _context22.sent;\n              return _context22.abrupt(\"return\", typeof e < \"u\" ? ge(e) : void 0);\n            case 4:\n            case \"end\":\n              return _context22.stop();\n          }\n        }, _callee22, this);\n      }));\n      function getRelayerMessages() {\n        return _getRelayerMessages.apply(this, arguments);\n      }\n      return getRelayerMessages;\n    }()\n  }, {\n    key: \"persist\",\n    value: function () {\n      var _persist2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee23() {\n        return _regeneratorRuntime().wrap(function _callee23$(_context23) {\n          while (1) switch (_context23.prev = _context23.next) {\n            case 0:\n              _context23.next = 2;\n              return this.setRelayerMessages(this.messages);\n            case 2:\n            case \"end\":\n              return _context23.stop();\n          }\n        }, _callee23, this);\n      }));\n      function persist() {\n        return _persist2.apply(this, arguments);\n      }\n      return persist;\n    }()\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c4 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c4.message;\n        throw new Error(e);\n      }\n    }\n  }]);\n  return pt;\n}(Nt);\nvar Xs = /*#__PURE__*/function (_Ut) {\n  _inherits(Xs, _Ut);\n  var _super2 = _createSuper(Xs);\n  function Xs(e, t) {\n    var _this5;\n    _classCallCheck(this, Xs);\n    _this5 = _super2.call(this, e, t), _this5.relayer = e, _this5.logger = t, _this5.events = new A(), _this5.name = He, _this5.queue = new Map(), _this5.publishTimeout = 1e4, _this5.publish = /*#__PURE__*/function () {\n      var _ref22 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee24(i, s, n) {\n        var a, o, h, d, l, g;\n        return _regeneratorRuntime().wrap(function _callee24$(_context24) {\n          while (1) switch (_context24.prev = _context24.next) {\n            case 0:\n              _this5.logger.debug(\"Publishing Payload\"), _this5.logger.trace({\n                type: \"method\",\n                method: \"publish\",\n                params: {\n                  topic: i,\n                  message: s,\n                  opts: n\n                }\n              });\n              _context24.prev = 1;\n              a = (n === null || n === void 0 ? void 0 : n.ttl) || Je, o = W(n), h = (n === null || n === void 0 ? void 0 : n.prompt) || !1, d = (n === null || n === void 0 ? void 0 : n.tag) || 0, l = {\n                topic: i,\n                message: s,\n                opts: {\n                  ttl: a,\n                  relay: o,\n                  prompt: h,\n                  tag: d\n                }\n              }, g = B(s);\n              _this5.queue.set(g, l);\n              _context24.prev = 4;\n              _context24.next = 7;\n              return j(_this5.rpcPublish(i, s, a, o, h, d), _this5.publishTimeout);\n            case 7:\n              _context24.next = 9;\n              return _context24.sent;\n            case 9:\n              _this5.relayer.events.emit(D.publish, l);\n              _context24.next = 16;\n              break;\n            case 12:\n              _context24.prev = 12;\n              _context24.t0 = _context24[\"catch\"](4);\n              _this5.logger.debug(\"Publishing Payload stalled\"), _this5.relayer.events.emit(D.connection_stalled);\n              return _context24.abrupt(\"return\");\n            case 16:\n              _this5.onPublish(g, l), _this5.logger.debug(\"Successfully Published Payload\"), _this5.logger.trace({\n                type: \"method\",\n                method: \"publish\",\n                params: {\n                  topic: i,\n                  message: s,\n                  opts: n\n                }\n              });\n              _context24.next = 22;\n              break;\n            case 19:\n              _context24.prev = 19;\n              _context24.t1 = _context24[\"catch\"](1);\n              throw _this5.logger.debug(\"Failed to Publish Payload\"), _this5.logger.error(_context24.t1), _context24.t1;\n            case 22:\n            case \"end\":\n              return _context24.stop();\n          }\n        }, _callee24, null, [[1, 19], [4, 12]]);\n      }));\n      return function (_x23, _x24, _x25) {\n        return _ref22.apply(this, arguments);\n      };\n    }(), _this5.on = function (i, s) {\n      _this5.events.on(i, s);\n    }, _this5.once = function (i, s) {\n      _this5.events.once(i, s);\n    }, _this5.off = function (i, s) {\n      _this5.events.off(i, s);\n    }, _this5.removeListener = function (i, s) {\n      _this5.events.removeListener(i, s);\n    }, _this5.relayer = e, _this5.logger = w(t, _this5.name), _this5.registerEventListeners();\n    return _this5;\n  }\n  _createClass(Xs, [{\n    key: \"context\",\n    get: function get() {\n      return v(this.logger);\n    }\n  }, {\n    key: \"rpcPublish\",\n    value: function rpcPublish(e, t, i, s, n, a) {\n      var o, h, d, l;\n      var g = {\n        method: V(s.protocol).publish,\n        params: {\n          topic: e,\n          message: t,\n          ttl: i,\n          prompt: n,\n          tag: a\n        }\n      };\n      return Z((o = g.params) == null ? void 0 : o.prompt) && ((h = g.params) == null || delete h.prompt), Z((d = g.params) == null ? void 0 : d.tag) && ((l = g.params) == null || delete l.tag), this.logger.debug(\"Outgoing Relay Payload\"), this.logger.trace({\n        type: \"message\",\n        direction: \"outgoing\",\n        request: g\n      }), this.relayer.request(g);\n    }\n  }, {\n    key: \"onPublish\",\n    value: function onPublish(e, t) {\n      this.queue.delete(e);\n    }\n  }, {\n    key: \"checkQueue\",\n    value: function checkQueue() {\n      var _this6 = this;\n      this.queue.forEach( /*#__PURE__*/function () {\n        var _ref23 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee25(e) {\n          var t, i, s;\n          return _regeneratorRuntime().wrap(function _callee25$(_context25) {\n            while (1) switch (_context25.prev = _context25.next) {\n              case 0:\n                t = e.topic, i = e.message, s = e.opts;\n                _context25.next = 3;\n                return _this6.publish(t, i, s);\n              case 3:\n              case \"end\":\n                return _context25.stop();\n            }\n          }, _callee25);\n        }));\n        return function (_x26) {\n          return _ref23.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"registerEventListeners\",\n    value: function registerEventListeners() {\n      var _this7 = this;\n      this.relayer.core.heartbeat.on(H.pulse, function () {\n        _this7.checkQueue();\n      });\n    }\n  }]);\n  return Xs;\n}(Ut);\nvar Ws = /*#__PURE__*/function () {\n  function Ws() {\n    var _this8 = this;\n    _classCallCheck(this, Ws);\n    this.map = new Map(), this.set = function (e, t) {\n      var i = _this8.get(e);\n      _this8.exists(e, t) || _this8.map.set(e, [].concat(_toConsumableArray(i), [t]));\n    }, this.get = function (e) {\n      return _this8.map.get(e) || [];\n    }, this.exists = function (e, t) {\n      return _this8.get(e).includes(t);\n    }, this.delete = function (e, t) {\n      if (typeof t > \"u\") {\n        _this8.map.delete(e);\n        return;\n      }\n      if (!_this8.map.has(e)) return;\n      var i = _this8.get(e);\n      if (!_this8.exists(e, t)) return;\n      var s = i.filter(function (n) {\n        return n !== t;\n      });\n      if (!s.length) {\n        _this8.map.delete(e);\n        return;\n      }\n      _this8.map.set(e, s);\n    }, this.clear = function () {\n      _this8.map.clear();\n    };\n  }\n  _createClass(Ws, [{\n    key: \"topics\",\n    get: function get() {\n      return Array.from(this.map.keys());\n    }\n  }]);\n  return Ws;\n}();\nvar Zs = Object.defineProperty,\n  Qs = Object.defineProperties,\n  er = Object.getOwnPropertyDescriptors,\n  Dt = Object.getOwnPropertySymbols,\n  tr = Object.prototype.hasOwnProperty,\n  ir = Object.prototype.propertyIsEnumerable,\n  yt = function yt(r, e, t) {\n    return e in r ? Zs(r, e, {\n      enumerable: !0,\n      configurable: !0,\n      writable: !0,\n      value: t\n    }) : r[e] = t;\n  },\n  $ = function $(r, e) {\n    for (var t in e || (e = {})) tr.call(e, t) && yt(r, t, e[t]);\n    if (Dt) {\n      var _iterator2 = _createForOfIteratorHelper(Dt(e)),\n        _step2;\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var t = _step2.value;\n          ir.call(e, t) && yt(r, t, e[t]);\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n    }\n    return r;\n  },\n  ce = function ce(r, e) {\n    return Qs(r, er(e));\n  };\nvar bt = /*#__PURE__*/function (_Lt) {\n  _inherits(bt, _Lt);\n  var _super3 = _createSuper(bt);\n  function bt(e, t) {\n    var _this9;\n    _classCallCheck(this, bt);\n    _this9 = _super3.call(this, e, t), _this9.relayer = e, _this9.logger = t, _this9.subscriptions = new Map(), _this9.topicMap = new Ws(), _this9.events = new A(), _this9.name = st, _this9.version = rt, _this9.pending = new Map(), _this9.cached = [], _this9.initialized = !1, _this9.pendingSubscriptionWatchLabel = \"pending_sub_watch_label\", _this9.pollingInterval = 20, _this9.storagePrefix = P, _this9.subscribeTimeout = 1e4, _this9.restartInProgress = !1, _this9.batchSubscribeTopicsLimit = 500, _this9.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee26() {\n      return _regeneratorRuntime().wrap(function _callee26$(_context26) {\n        while (1) switch (_context26.prev = _context26.next) {\n          case 0:\n            _context26.t0 = _this9.initialized;\n            if (_context26.t0) {\n              _context26.next = 10;\n              break;\n            }\n            _this9.logger.trace(\"Initialized\");\n            _context26.next = 5;\n            return _this9.restart();\n          case 5:\n            _this9.registerEventListeners();\n            _this9.onEnable();\n            _context26.next = 9;\n            return _this9.relayer.core.crypto.getClientId();\n          case 9:\n            _this9.clientId = _context26.sent;\n          case 10:\n          case \"end\":\n            return _context26.stop();\n        }\n      }, _callee26);\n    })), _this9.subscribe = /*#__PURE__*/function () {\n      var _ref25 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee27(i, s) {\n        var n, a, o;\n        return _regeneratorRuntime().wrap(function _callee27$(_context27) {\n          while (1) switch (_context27.prev = _context27.next) {\n            case 0:\n              _context27.next = 2;\n              return _this9.restartToComplete();\n            case 2:\n              _this9.isInitialized();\n              _this9.logger.debug(\"Subscribing Topic\");\n              _this9.logger.trace({\n                type: \"method\",\n                method: \"subscribe\",\n                params: {\n                  topic: i,\n                  opts: s\n                }\n              });\n              _context27.prev = 5;\n              n = W(s), a = {\n                topic: i,\n                relay: n\n              };\n              _this9.pending.set(i, a);\n              _context27.next = 10;\n              return _this9.rpcSubscribe(i, n);\n            case 10:\n              o = _context27.sent;\n              return _context27.abrupt(\"return\", (_this9.onSubscribe(o, a), _this9.logger.debug(\"Successfully Subscribed Topic\"), _this9.logger.trace({\n                type: \"method\",\n                method: \"subscribe\",\n                params: {\n                  topic: i,\n                  opts: s\n                }\n              }), o));\n            case 14:\n              _context27.prev = 14;\n              _context27.t0 = _context27[\"catch\"](5);\n              throw _this9.logger.debug(\"Failed to Subscribe Topic\"), _this9.logger.error(_context27.t0), _context27.t0;\n            case 17:\n            case \"end\":\n              return _context27.stop();\n          }\n        }, _callee27, null, [[5, 14]]);\n      }));\n      return function (_x27, _x28) {\n        return _ref25.apply(this, arguments);\n      };\n    }(), _this9.unsubscribe = /*#__PURE__*/function () {\n      var _ref26 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee28(i, s) {\n        return _regeneratorRuntime().wrap(function _callee28$(_context28) {\n          while (1) switch (_context28.prev = _context28.next) {\n            case 0:\n              _context28.next = 2;\n              return _this9.restartToComplete();\n            case 2:\n              _this9.isInitialized();\n              if (!(typeof (s === null || s === void 0 ? void 0 : s.id) < \"u\")) {\n                _context28.next = 8;\n                break;\n              }\n              _context28.next = 6;\n              return _this9.unsubscribeById(i, s.id, s);\n            case 6:\n              _context28.next = 10;\n              break;\n            case 8:\n              _context28.next = 10;\n              return _this9.unsubscribeByTopic(i, s);\n            case 10:\n            case \"end\":\n              return _context28.stop();\n          }\n        }, _callee28);\n      }));\n      return function (_x29, _x30) {\n        return _ref26.apply(this, arguments);\n      };\n    }(), _this9.isSubscribed = /*#__PURE__*/function () {\n      var _ref27 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee29(i) {\n        return _regeneratorRuntime().wrap(function _callee29$(_context29) {\n          while (1) switch (_context29.prev = _context29.next) {\n            case 0:\n              if (!_this9.topics.includes(i)) {\n                _context29.next = 4;\n                break;\n              }\n              _context29.t0 = !0;\n              _context29.next = 7;\n              break;\n            case 4:\n              _context29.next = 6;\n              return new Promise(function (s, n) {\n                var a = new Di();\n                a.start(_this9.pendingSubscriptionWatchLabel);\n                var o = setInterval(function () {\n                  !_this9.pending.has(i) && _this9.topics.includes(i) && (clearInterval(o), a.stop(_this9.pendingSubscriptionWatchLabel), s(!0)), a.elapsed(_this9.pendingSubscriptionWatchLabel) >= nt && (clearInterval(o), a.stop(_this9.pendingSubscriptionWatchLabel), n(!1));\n                }, _this9.pollingInterval);\n              });\n            case 6:\n              _context29.t0 = _context29.sent;\n            case 7:\n              return _context29.abrupt(\"return\", _context29.t0);\n            case 8:\n            case \"end\":\n              return _context29.stop();\n          }\n        }, _callee29);\n      }));\n      return function (_x31) {\n        return _ref27.apply(this, arguments);\n      };\n    }(), _this9.on = function (i, s) {\n      _this9.events.on(i, s);\n    }, _this9.once = function (i, s) {\n      _this9.events.once(i, s);\n    }, _this9.off = function (i, s) {\n      _this9.events.off(i, s);\n    }, _this9.removeListener = function (i, s) {\n      _this9.events.removeListener(i, s);\n    }, _this9.restart = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee30() {\n      return _regeneratorRuntime().wrap(function _callee30$(_context30) {\n        while (1) switch (_context30.prev = _context30.next) {\n          case 0:\n            _this9.restartInProgress = !0;\n            _context30.next = 3;\n            return _this9.restore();\n          case 3:\n            _context30.next = 5;\n            return _this9.reset();\n          case 5:\n            _this9.restartInProgress = !1;\n          case 6:\n          case \"end\":\n            return _context30.stop();\n        }\n      }, _callee30);\n    })), _this9.relayer = e, _this9.logger = w(t, _this9.name), _this9.clientId = \"\";\n    return _this9;\n  }\n  _createClass(bt, [{\n    key: \"context\",\n    get: function get() {\n      return v(this.logger);\n    }\n  }, {\n    key: \"storageKey\",\n    get: function get() {\n      return this.storagePrefix + this.version + \"//\" + this.name;\n    }\n  }, {\n    key: \"length\",\n    get: function get() {\n      return this.subscriptions.size;\n    }\n  }, {\n    key: \"ids\",\n    get: function get() {\n      return Array.from(this.subscriptions.keys());\n    }\n  }, {\n    key: \"values\",\n    get: function get() {\n      return Array.from(this.subscriptions.values());\n    }\n  }, {\n    key: \"topics\",\n    get: function get() {\n      return this.topicMap.topics;\n    }\n  }, {\n    key: \"hasSubscription\",\n    value: function hasSubscription(e, t) {\n      var i = !1;\n      try {\n        i = this.getSubscription(e).topic === t;\n      } catch (_unused3) {}\n      return i;\n    }\n  }, {\n    key: \"onEnable\",\n    value: function onEnable() {\n      this.cached = [], this.initialized = !0;\n    }\n  }, {\n    key: \"onDisable\",\n    value: function onDisable() {\n      this.cached = this.values, this.subscriptions.clear(), this.topicMap.clear();\n    }\n  }, {\n    key: \"unsubscribeByTopic\",\n    value: function () {\n      var _unsubscribeByTopic = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee32(e, t) {\n        var _this10 = this;\n        var i;\n        return _regeneratorRuntime().wrap(function _callee32$(_context32) {\n          while (1) switch (_context32.prev = _context32.next) {\n            case 0:\n              i = this.topicMap.get(e);\n              _context32.next = 3;\n              return Promise.all(i.map( /*#__PURE__*/function () {\n                var _ref29 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee31(s) {\n                  return _regeneratorRuntime().wrap(function _callee31$(_context31) {\n                    while (1) switch (_context31.prev = _context31.next) {\n                      case 0:\n                        _context31.next = 2;\n                        return _this10.unsubscribeById(e, s, t);\n                      case 2:\n                        return _context31.abrupt(\"return\", _context31.sent);\n                      case 3:\n                      case \"end\":\n                        return _context31.stop();\n                    }\n                  }, _callee31);\n                }));\n                return function (_x34) {\n                  return _ref29.apply(this, arguments);\n                };\n              }()));\n            case 3:\n            case \"end\":\n              return _context32.stop();\n          }\n        }, _callee32, this);\n      }));\n      function unsubscribeByTopic(_x32, _x33) {\n        return _unsubscribeByTopic.apply(this, arguments);\n      }\n      return unsubscribeByTopic;\n    }()\n  }, {\n    key: \"unsubscribeById\",\n    value: function () {\n      var _unsubscribeById = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee33(e, t, i) {\n        var s, n;\n        return _regeneratorRuntime().wrap(function _callee33$(_context33) {\n          while (1) switch (_context33.prev = _context33.next) {\n            case 0:\n              this.logger.debug(\"Unsubscribing Topic\"), this.logger.trace({\n                type: \"method\",\n                method: \"unsubscribe\",\n                params: {\n                  topic: e,\n                  id: t,\n                  opts: i\n                }\n              });\n              _context33.prev = 1;\n              s = W(i);\n              _context33.next = 5;\n              return this.rpcUnsubscribe(e, t, s);\n            case 5:\n              n = L(\"USER_DISCONNECTED\", \"\".concat(this.name, \", \").concat(e));\n              _context33.next = 8;\n              return this.onUnsubscribe(e, t, n);\n            case 8:\n              this.logger.debug(\"Successfully Unsubscribed Topic\");\n              this.logger.trace({\n                type: \"method\",\n                method: \"unsubscribe\",\n                params: {\n                  topic: e,\n                  id: t,\n                  opts: i\n                }\n              });\n              _context33.next = 15;\n              break;\n            case 12:\n              _context33.prev = 12;\n              _context33.t0 = _context33[\"catch\"](1);\n              throw this.logger.debug(\"Failed to Unsubscribe Topic\"), this.logger.error(_context33.t0), _context33.t0;\n            case 15:\n            case \"end\":\n              return _context33.stop();\n          }\n        }, _callee33, this, [[1, 12]]);\n      }));\n      function unsubscribeById(_x35, _x36, _x37) {\n        return _unsubscribeById.apply(this, arguments);\n      }\n      return unsubscribeById;\n    }()\n  }, {\n    key: \"rpcSubscribe\",\n    value: function () {\n      var _rpcSubscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee34(e, t) {\n        var i;\n        return _regeneratorRuntime().wrap(function _callee34$(_context34) {\n          while (1) switch (_context34.prev = _context34.next) {\n            case 0:\n              i = {\n                method: V(t.protocol).subscribe,\n                params: {\n                  topic: e\n                }\n              };\n              this.logger.debug(\"Outgoing Relay Payload\"), this.logger.trace({\n                type: \"payload\",\n                direction: \"outgoing\",\n                request: i\n              });\n              _context34.prev = 2;\n              _context34.next = 5;\n              return j(this.relayer.request(i), this.subscribeTimeout);\n            case 5:\n              _context34.next = 7;\n              return _context34.sent;\n            case 7:\n              _context34.next = 12;\n              break;\n            case 9:\n              _context34.prev = 9;\n              _context34.t0 = _context34[\"catch\"](2);\n              this.logger.debug(\"Outgoing Relay Subscribe Payload stalled\"), this.relayer.events.emit(D.connection_stalled);\n            case 12:\n              return _context34.abrupt(\"return\", B(e + this.clientId));\n            case 13:\n            case \"end\":\n              return _context34.stop();\n          }\n        }, _callee34, this, [[2, 9]]);\n      }));\n      function rpcSubscribe(_x38, _x39) {\n        return _rpcSubscribe.apply(this, arguments);\n      }\n      return rpcSubscribe;\n    }()\n  }, {\n    key: \"rpcBatchSubscribe\",\n    value: function () {\n      var _rpcBatchSubscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee35(e) {\n        var t, i;\n        return _regeneratorRuntime().wrap(function _callee35$(_context35) {\n          while (1) switch (_context35.prev = _context35.next) {\n            case 0:\n              if (e.length) {\n                _context35.next = 2;\n                break;\n              }\n              return _context35.abrupt(\"return\");\n            case 2:\n              t = e[0].relay, i = {\n                method: V(t.protocol).batchSubscribe,\n                params: {\n                  topics: e.map(function (s) {\n                    return s.topic;\n                  })\n                }\n              };\n              this.logger.debug(\"Outgoing Relay Payload\"), this.logger.trace({\n                type: \"payload\",\n                direction: \"outgoing\",\n                request: i\n              });\n              _context35.prev = 4;\n              _context35.next = 7;\n              return j(this.relayer.request(i), this.subscribeTimeout);\n            case 7:\n              _context35.next = 9;\n              return _context35.sent;\n            case 9:\n              return _context35.abrupt(\"return\", _context35.sent);\n            case 12:\n              _context35.prev = 12;\n              _context35.t0 = _context35[\"catch\"](4);\n              this.logger.debug(\"Outgoing Relay Payload stalled\"), this.relayer.events.emit(D.connection_stalled);\n            case 15:\n            case \"end\":\n              return _context35.stop();\n          }\n        }, _callee35, this, [[4, 12]]);\n      }));\n      function rpcBatchSubscribe(_x40) {\n        return _rpcBatchSubscribe.apply(this, arguments);\n      }\n      return rpcBatchSubscribe;\n    }()\n  }, {\n    key: \"rpcUnsubscribe\",\n    value: function rpcUnsubscribe(e, t, i) {\n      var s = {\n        method: V(i.protocol).unsubscribe,\n        params: {\n          topic: e,\n          id: t\n        }\n      };\n      return this.logger.debug(\"Outgoing Relay Payload\"), this.logger.trace({\n        type: \"payload\",\n        direction: \"outgoing\",\n        request: s\n      }), this.relayer.request(s);\n    }\n  }, {\n    key: \"onSubscribe\",\n    value: function onSubscribe(e, t) {\n      this.setSubscription(e, ce($({}, t), {\n        id: e\n      })), this.pending.delete(t.topic);\n    }\n  }, {\n    key: \"onBatchSubscribe\",\n    value: function onBatchSubscribe(e) {\n      var _this11 = this;\n      e.length && e.forEach(function (t) {\n        _this11.setSubscription(t.id, $({}, t)), _this11.pending.delete(t.topic);\n      });\n    }\n  }, {\n    key: \"onUnsubscribe\",\n    value: function () {\n      var _onUnsubscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee36(e, t, i) {\n        return _regeneratorRuntime().wrap(function _callee36$(_context36) {\n          while (1) switch (_context36.prev = _context36.next) {\n            case 0:\n              this.events.removeAllListeners(t);\n              this.hasSubscription(t, e) && this.deleteSubscription(t, i);\n              _context36.next = 4;\n              return this.relayer.messages.del(e);\n            case 4:\n            case \"end\":\n              return _context36.stop();\n          }\n        }, _callee36, this);\n      }));\n      function onUnsubscribe(_x41, _x42, _x43) {\n        return _onUnsubscribe.apply(this, arguments);\n      }\n      return onUnsubscribe;\n    }()\n  }, {\n    key: \"setRelayerSubscriptions\",\n    value: function () {\n      var _setRelayerSubscriptions = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee37(e) {\n        return _regeneratorRuntime().wrap(function _callee37$(_context37) {\n          while (1) switch (_context37.prev = _context37.next) {\n            case 0:\n              _context37.next = 2;\n              return this.relayer.core.storage.setItem(this.storageKey, e);\n            case 2:\n            case \"end\":\n              return _context37.stop();\n          }\n        }, _callee37, this);\n      }));\n      function setRelayerSubscriptions(_x44) {\n        return _setRelayerSubscriptions.apply(this, arguments);\n      }\n      return setRelayerSubscriptions;\n    }()\n  }, {\n    key: \"getRelayerSubscriptions\",\n    value: function () {\n      var _getRelayerSubscriptions = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee38() {\n        return _regeneratorRuntime().wrap(function _callee38$(_context38) {\n          while (1) switch (_context38.prev = _context38.next) {\n            case 0:\n              _context38.next = 2;\n              return this.relayer.core.storage.getItem(this.storageKey);\n            case 2:\n              return _context38.abrupt(\"return\", _context38.sent);\n            case 3:\n            case \"end\":\n              return _context38.stop();\n          }\n        }, _callee38, this);\n      }));\n      function getRelayerSubscriptions() {\n        return _getRelayerSubscriptions.apply(this, arguments);\n      }\n      return getRelayerSubscriptions;\n    }()\n  }, {\n    key: \"setSubscription\",\n    value: function setSubscription(e, t) {\n      this.subscriptions.has(e) || (this.logger.debug(\"Setting subscription\"), this.logger.trace({\n        type: \"method\",\n        method: \"setSubscription\",\n        id: e,\n        subscription: t\n      }), this.addSubscription(e, t));\n    }\n  }, {\n    key: \"addSubscription\",\n    value: function addSubscription(e, t) {\n      this.subscriptions.set(e, $({}, t)), this.topicMap.set(t.topic, e), this.events.emit(I.created, t);\n    }\n  }, {\n    key: \"getSubscription\",\n    value: function getSubscription(e) {\n      this.logger.debug(\"Getting subscription\"), this.logger.trace({\n        type: \"method\",\n        method: \"getSubscription\",\n        id: e\n      });\n      var t = this.subscriptions.get(e);\n      if (!t) {\n        var _c5 = c(\"NO_MATCHING_KEY\", \"\".concat(this.name, \": \").concat(e)),\n          i = _c5.message;\n        throw new Error(i);\n      }\n      return t;\n    }\n  }, {\n    key: \"deleteSubscription\",\n    value: function deleteSubscription(e, t) {\n      this.logger.debug(\"Deleting subscription\"), this.logger.trace({\n        type: \"method\",\n        method: \"deleteSubscription\",\n        id: e,\n        reason: t\n      });\n      var i = this.getSubscription(e);\n      this.subscriptions.delete(e), this.topicMap.delete(i.topic, e), this.events.emit(I.deleted, ce($({}, i), {\n        reason: t\n      }));\n    }\n  }, {\n    key: \"persist\",\n    value: function () {\n      var _persist3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee39() {\n        return _regeneratorRuntime().wrap(function _callee39$(_context39) {\n          while (1) switch (_context39.prev = _context39.next) {\n            case 0:\n              _context39.next = 2;\n              return this.setRelayerSubscriptions(this.values);\n            case 2:\n              this.events.emit(I.sync);\n            case 3:\n            case \"end\":\n              return _context39.stop();\n          }\n        }, _callee39, this);\n      }));\n      function persist() {\n        return _persist3.apply(this, arguments);\n      }\n      return persist;\n    }()\n  }, {\n    key: \"reset\",\n    value: function () {\n      var _reset = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee40() {\n        var e, t, i;\n        return _regeneratorRuntime().wrap(function _callee40$(_context40) {\n          while (1) switch (_context40.prev = _context40.next) {\n            case 0:\n              if (this.cached.length) {\n                _context40.next = 2;\n                break;\n              }\n              return _context40.abrupt(\"return\");\n            case 2:\n              e = Math.ceil(this.cached.length / this.batchSubscribeTopicsLimit);\n              t = 0;\n            case 4:\n              if (!(t < e)) {\n                _context40.next = 11;\n                break;\n              }\n              i = this.cached.splice(0, this.batchSubscribeTopicsLimit);\n              _context40.next = 8;\n              return this.batchSubscribe(i);\n            case 8:\n              t++;\n              _context40.next = 4;\n              break;\n            case 11:\n              this.events.emit(I.resubscribed);\n            case 12:\n            case \"end\":\n              return _context40.stop();\n          }\n        }, _callee40, this);\n      }));\n      function reset() {\n        return _reset.apply(this, arguments);\n      }\n      return reset;\n    }()\n  }, {\n    key: \"restore\",\n    value: function () {\n      var _restore = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee41() {\n        var e, _c6, t;\n        return _regeneratorRuntime().wrap(function _callee41$(_context41) {\n          while (1) switch (_context41.prev = _context41.next) {\n            case 0:\n              _context41.prev = 0;\n              _context41.next = 3;\n              return this.getRelayerSubscriptions();\n            case 3:\n              e = _context41.sent;\n              if (!(typeof e > \"u\" || !e.length)) {\n                _context41.next = 6;\n                break;\n              }\n              return _context41.abrupt(\"return\");\n            case 6:\n              if (!this.subscriptions.size) {\n                _context41.next = 9;\n                break;\n              }\n              _c6 = c(\"RESTORE_WILL_OVERRIDE\", this.name), t = _c6.message;\n              throw this.logger.error(t), this.logger.error(\"\".concat(this.name, \": \").concat(JSON.stringify(this.values))), new Error(t);\n            case 9:\n              this.cached = e, this.logger.debug(\"Successfully Restored subscriptions for \".concat(this.name)), this.logger.trace({\n                type: \"method\",\n                method: \"restore\",\n                subscriptions: this.values\n              });\n              _context41.next = 15;\n              break;\n            case 12:\n              _context41.prev = 12;\n              _context41.t0 = _context41[\"catch\"](0);\n              this.logger.debug(\"Failed to Restore subscriptions for \".concat(this.name)), this.logger.error(_context41.t0);\n            case 15:\n            case \"end\":\n              return _context41.stop();\n          }\n        }, _callee41, this, [[0, 12]]);\n      }));\n      function restore() {\n        return _restore.apply(this, arguments);\n      }\n      return restore;\n    }()\n  }, {\n    key: \"batchSubscribe\",\n    value: function () {\n      var _batchSubscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee42(e) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee42$(_context42) {\n          while (1) switch (_context42.prev = _context42.next) {\n            case 0:\n              if (e.length) {\n                _context42.next = 2;\n                break;\n              }\n              return _context42.abrupt(\"return\");\n            case 2:\n              _context42.next = 4;\n              return this.rpcBatchSubscribe(e);\n            case 4:\n              t = _context42.sent;\n              Qt(t) && this.onBatchSubscribe(t.map(function (i, s) {\n                return ce($({}, e[s]), {\n                  id: i\n                });\n              }));\n            case 6:\n            case \"end\":\n              return _context42.stop();\n          }\n        }, _callee42, this);\n      }));\n      function batchSubscribe(_x45) {\n        return _batchSubscribe.apply(this, arguments);\n      }\n      return batchSubscribe;\n    }()\n  }, {\n    key: \"onConnect\",\n    value: function () {\n      var _onConnect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee43() {\n        return _regeneratorRuntime().wrap(function _callee43$(_context43) {\n          while (1) switch (_context43.prev = _context43.next) {\n            case 0:\n              _context43.t0 = this.restartInProgress;\n              if (_context43.t0) {\n                _context43.next = 5;\n                break;\n              }\n              _context43.next = 4;\n              return this.restart();\n            case 4:\n              this.onEnable();\n            case 5:\n            case \"end\":\n              return _context43.stop();\n          }\n        }, _callee43, this);\n      }));\n      function onConnect() {\n        return _onConnect.apply(this, arguments);\n      }\n      return onConnect;\n    }()\n  }, {\n    key: \"onDisconnect\",\n    value: function onDisconnect() {\n      this.onDisable();\n    }\n  }, {\n    key: \"checkPending\",\n    value: function () {\n      var _checkPending = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee44() {\n        var e;\n        return _regeneratorRuntime().wrap(function _callee44$(_context44) {\n          while (1) switch (_context44.prev = _context44.next) {\n            case 0:\n              if (!this.relayer.transportExplicitlyClosed) {\n                _context44.next = 2;\n                break;\n              }\n              return _context44.abrupt(\"return\");\n            case 2:\n              e = [];\n              this.pending.forEach(function (t) {\n                e.push(t);\n              });\n              _context44.next = 6;\n              return this.batchSubscribe(e);\n            case 6:\n            case \"end\":\n              return _context44.stop();\n          }\n        }, _callee44, this);\n      }));\n      function checkPending() {\n        return _checkPending.apply(this, arguments);\n      }\n      return checkPending;\n    }()\n  }, {\n    key: \"registerEventListeners\",\n    value: function registerEventListeners() {\n      var _this12 = this;\n      this.relayer.core.heartbeat.on(H.pulse, /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee45() {\n        return _regeneratorRuntime().wrap(function _callee45$(_context45) {\n          while (1) switch (_context45.prev = _context45.next) {\n            case 0:\n              _context45.next = 2;\n              return _this12.checkPending();\n            case 2:\n            case \"end\":\n              return _context45.stop();\n          }\n        }, _callee45);\n      }))), this.relayer.on(D.connect, /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee46() {\n        return _regeneratorRuntime().wrap(function _callee46$(_context46) {\n          while (1) switch (_context46.prev = _context46.next) {\n            case 0:\n              _context46.next = 2;\n              return _this12.onConnect();\n            case 2:\n            case \"end\":\n              return _context46.stop();\n          }\n        }, _callee46);\n      }))), this.relayer.on(D.disconnect, function () {\n        _this12.onDisconnect();\n      }), this.events.on(I.created, /*#__PURE__*/function () {\n        var _ref32 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee47(e) {\n          var t;\n          return _regeneratorRuntime().wrap(function _callee47$(_context47) {\n            while (1) switch (_context47.prev = _context47.next) {\n              case 0:\n                t = I.created;\n                _this12.logger.info(\"Emitting \".concat(t));\n                _this12.logger.debug({\n                  type: \"event\",\n                  event: t,\n                  data: e\n                });\n                _context47.next = 5;\n                return _this12.persist();\n              case 5:\n              case \"end\":\n                return _context47.stop();\n            }\n          }, _callee47);\n        }));\n        return function (_x46) {\n          return _ref32.apply(this, arguments);\n        };\n      }()), this.events.on(I.deleted, /*#__PURE__*/function () {\n        var _ref33 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee48(e) {\n          var t;\n          return _regeneratorRuntime().wrap(function _callee48$(_context48) {\n            while (1) switch (_context48.prev = _context48.next) {\n              case 0:\n                t = I.deleted;\n                _this12.logger.info(\"Emitting \".concat(t));\n                _this12.logger.debug({\n                  type: \"event\",\n                  event: t,\n                  data: e\n                });\n                _context48.next = 5;\n                return _this12.persist();\n              case 5:\n              case \"end\":\n                return _context48.stop();\n            }\n          }, _callee48);\n        }));\n        return function (_x47) {\n          return _ref33.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c7 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c7.message;\n        throw new Error(e);\n      }\n    }\n  }, {\n    key: \"restartToComplete\",\n    value: function () {\n      var _restartToComplete = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee49() {\n        var _this13 = this;\n        return _regeneratorRuntime().wrap(function _callee49$(_context49) {\n          while (1) switch (_context49.prev = _context49.next) {\n            case 0:\n              _context49.t0 = this.restartInProgress;\n              if (!_context49.t0) {\n                _context49.next = 4;\n                break;\n              }\n              _context49.next = 4;\n              return new Promise(function (e) {\n                var t = setInterval(function () {\n                  _this13.restartInProgress || (clearInterval(t), e());\n                }, _this13.pollingInterval);\n              });\n            case 4:\n            case \"end\":\n              return _context49.stop();\n          }\n        }, _callee49, this);\n      }));\n      function restartToComplete() {\n        return _restartToComplete.apply(this, arguments);\n      }\n      return restartToComplete;\n    }()\n  }]);\n  return bt;\n}(Lt);\nvar sr = Object.defineProperty,\n  mt = Object.getOwnPropertySymbols,\n  rr = Object.prototype.hasOwnProperty,\n  nr = Object.prototype.propertyIsEnumerable,\n  Et = function Et(r, e, t) {\n    return e in r ? sr(r, e, {\n      enumerable: !0,\n      configurable: !0,\n      writable: !0,\n      value: t\n    }) : r[e] = t;\n  },\n  ar = function ar(r, e) {\n    for (var t in e || (e = {})) rr.call(e, t) && Et(r, t, e[t]);\n    if (mt) {\n      var _iterator3 = _createForOfIteratorHelper(mt(e)),\n        _step3;\n      try {\n        for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n          var t = _step3.value;\n          nr.call(e, t) && Et(r, t, e[t]);\n        }\n      } catch (err) {\n        _iterator3.e(err);\n      } finally {\n        _iterator3.f();\n      }\n    }\n    return r;\n  };\nvar ft = /*#__PURE__*/function (_Ft) {\n  _inherits(ft, _Ft);\n  var _super4 = _createSuper(ft);\n  function ft(e) {\n    var _this14;\n    _classCallCheck(this, ft);\n    _this14 = _super4.call(this, e), _this14.protocol = \"wc\", _this14.version = 2, _this14.events = new A(), _this14.name = Ze, _this14.transportExplicitlyClosed = !1, _this14.initialized = !1, _this14.reconnecting = !1, _this14.connectionStatusPollingInterval = 20, _this14.staleConnectionErrors = [\"socket hang up\", \"socket stalled\"], _this14.request = /*#__PURE__*/function () {\n      var _ref34 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee50(t) {\n        return _regeneratorRuntime().wrap(function _callee50$(_context50) {\n          while (1) switch (_context50.prev = _context50.next) {\n            case 0:\n              _this14.logger.debug(\"Publishing Request Payload\");\n              _context50.prev = 1;\n              _context50.next = 4;\n              return _this14.toEstablishConnection();\n            case 4:\n              _context50.next = 6;\n              return _this14.provider.request(t);\n            case 6:\n              return _context50.abrupt(\"return\", _context50.sent);\n            case 9:\n              _context50.prev = 9;\n              _context50.t0 = _context50[\"catch\"](1);\n              throw _this14.logger.debug(\"Failed to Publish Request\"), _this14.logger.error(_context50.t0), _context50.t0;\n            case 12:\n            case \"end\":\n              return _context50.stop();\n          }\n        }, _callee50, null, [[1, 9]]);\n      }));\n      return function (_x48) {\n        return _ref34.apply(this, arguments);\n      };\n    }(), _this14.core = e.core, _this14.logger = typeof e.logger < \"u\" && typeof e.logger != \"string\" ? w(e.logger, _this14.name) : ue(le({\n      level: e.logger || We\n    })), _this14.messages = new pt(_this14.logger, e.core), _this14.subscriber = new bt(_assertThisInitialized(_this14), _this14.logger), _this14.publisher = new Xs(_assertThisInitialized(_this14), _this14.logger), _this14.relayUrl = (e === null || e === void 0 ? void 0 : e.relayUrl) || he, _this14.projectId = e.projectId, _this14.provider = {};\n    return _this14;\n  }\n  _createClass(ft, [{\n    key: \"init\",\n    value: function () {\n      var _init = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee51() {\n        return _regeneratorRuntime().wrap(function _callee51$(_context51) {\n          while (1) switch (_context51.prev = _context51.next) {\n            case 0:\n              this.logger.trace(\"Initialized\");\n              _context51.next = 3;\n              return this.createProvider();\n            case 3:\n              _context51.next = 5;\n              return Promise.all([this.messages.init(), this.transportOpen(), this.subscriber.init()]);\n            case 5:\n              this.registerEventListeners();\n              this.initialized = !0;\n            case 7:\n            case \"end\":\n              return _context51.stop();\n          }\n        }, _callee51, this);\n      }));\n      function init() {\n        return _init.apply(this, arguments);\n      }\n      return init;\n    }()\n  }, {\n    key: \"context\",\n    get: function get() {\n      return v(this.logger);\n    }\n  }, {\n    key: \"connected\",\n    get: function get() {\n      return this.provider.connection.connected;\n    }\n  }, {\n    key: \"connecting\",\n    get: function get() {\n      return this.provider.connection.connecting;\n    }\n  }, {\n    key: \"publish\",\n    value: function () {\n      var _publish = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee52(e, t, i) {\n        return _regeneratorRuntime().wrap(function _callee52$(_context52) {\n          while (1) switch (_context52.prev = _context52.next) {\n            case 0:\n              this.isInitialized();\n              _context52.next = 3;\n              return this.publisher.publish(e, t, i);\n            case 3:\n              _context52.next = 5;\n              return this.recordMessageEvent({\n                topic: e,\n                message: t,\n                publishedAt: Date.now()\n              });\n            case 5:\n            case \"end\":\n              return _context52.stop();\n          }\n        }, _callee52, this);\n      }));\n      function publish(_x49, _x50, _x51) {\n        return _publish.apply(this, arguments);\n      }\n      return publish;\n    }()\n  }, {\n    key: \"subscribe\",\n    value: function () {\n      var _subscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee54(e, t) {\n        var _this15 = this;\n        var i;\n        return _regeneratorRuntime().wrap(function _callee54$(_context54) {\n          while (1) switch (_context54.prev = _context54.next) {\n            case 0:\n              this.isInitialized();\n              i = \"\";\n              _context54.next = 4;\n              return Promise.all([new Promise(function (s) {\n                _this15.subscriber.once(I.created, function (n) {\n                  n.topic === e && s();\n                });\n              }), new Promise( /*#__PURE__*/function () {\n                var _ref35 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee53(s) {\n                  return _regeneratorRuntime().wrap(function _callee53$(_context53) {\n                    while (1) switch (_context53.prev = _context53.next) {\n                      case 0:\n                        _context53.next = 2;\n                        return _this15.subscriber.subscribe(e, t);\n                      case 2:\n                        i = _context53.sent;\n                        s();\n                      case 4:\n                      case \"end\":\n                        return _context53.stop();\n                    }\n                  }, _callee53);\n                }));\n                return function (_x54) {\n                  return _ref35.apply(this, arguments);\n                };\n              }())]);\n            case 4:\n              return _context54.abrupt(\"return\", i);\n            case 5:\n            case \"end\":\n              return _context54.stop();\n          }\n        }, _callee54, this);\n      }));\n      function subscribe(_x52, _x53) {\n        return _subscribe.apply(this, arguments);\n      }\n      return subscribe;\n    }()\n  }, {\n    key: \"unsubscribe\",\n    value: function () {\n      var _unsubscribe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee55(e, t) {\n        return _regeneratorRuntime().wrap(function _callee55$(_context55) {\n          while (1) switch (_context55.prev = _context55.next) {\n            case 0:\n              this.isInitialized();\n              _context55.next = 3;\n              return this.subscriber.unsubscribe(e, t);\n            case 3:\n            case \"end\":\n              return _context55.stop();\n          }\n        }, _callee55, this);\n      }));\n      function unsubscribe(_x55, _x56) {\n        return _unsubscribe.apply(this, arguments);\n      }\n      return unsubscribe;\n    }()\n  }, {\n    key: \"on\",\n    value: function on(e, t) {\n      this.events.on(e, t);\n    }\n  }, {\n    key: \"once\",\n    value: function once(e, t) {\n      this.events.once(e, t);\n    }\n  }, {\n    key: \"off\",\n    value: function off(e, t) {\n      this.events.off(e, t);\n    }\n  }, {\n    key: \"removeListener\",\n    value: function removeListener(e, t) {\n      this.events.removeListener(e, t);\n    }\n  }, {\n    key: \"transportClose\",\n    value: function () {\n      var _transportClose = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee56() {\n        return _regeneratorRuntime().wrap(function _callee56$(_context56) {\n          while (1) switch (_context56.prev = _context56.next) {\n            case 0:\n              this.transportExplicitlyClosed = !0;\n              _context56.t0 = this.connected;\n              if (!_context56.t0) {\n                _context56.next = 6;\n                break;\n              }\n              _context56.next = 5;\n              return this.provider.disconnect();\n            case 5:\n              this.events.emit(D.transport_closed);\n            case 6:\n            case \"end\":\n              return _context56.stop();\n          }\n        }, _callee56, this);\n      }));\n      function transportClose() {\n        return _transportClose.apply(this, arguments);\n      }\n      return transportClose;\n    }()\n  }, {\n    key: \"transportOpen\",\n    value: function () {\n      var _transportOpen = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee58(e) {\n        var _this16 = this;\n        var i;\n        return _regeneratorRuntime().wrap(function _callee58$(_context58) {\n          while (1) switch (_context58.prev = _context58.next) {\n            case 0:\n              if (this.reconnecting) {\n                _context58.next = 23;\n                break;\n              }\n              this.relayUrl = e || this.relayUrl, this.transportExplicitlyClosed = !1, this.reconnecting = !0;\n              _context58.prev = 2;\n              _context58.t0 = Promise;\n              _context58.t1 = new Promise(function (t) {\n                _this16.initialized || t(), _this16.subscriber.once(I.resubscribed, function () {\n                  t();\n                });\n              });\n              _context58.next = 7;\n              return Promise.race([new Promise( /*#__PURE__*/function () {\n                var _ref36 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee57(t, i) {\n                  return _regeneratorRuntime().wrap(function _callee57$(_context57) {\n                    while (1) switch (_context57.prev = _context57.next) {\n                      case 0:\n                        _context57.next = 2;\n                        return j(_this16.provider.connect(), 5e3, \"socket stalled\").catch(function (s) {\n                          return i(s);\n                        }).then(function () {\n                          return t();\n                        }).finally(function () {\n                          return _this16.removeListener(D.transport_closed, _this16.rejectTransportOpen);\n                        });\n                      case 2:\n                      case \"end\":\n                        return _context57.stop();\n                    }\n                  }, _callee57);\n                }));\n                return function (_x58, _x59) {\n                  return _ref36.apply(this, arguments);\n                };\n              }()), new Promise(function (t) {\n                return _this16.once(D.transport_closed, _this16.rejectTransportOpen);\n              })]);\n            case 7:\n              _context58.t2 = _context58.sent;\n              _context58.t3 = [_context58.t1, _context58.t2];\n              _context58.next = 11;\n              return _context58.t0.all.call(_context58.t0, _context58.t3);\n            case 11:\n              _context58.next = 20;\n              break;\n            case 13:\n              _context58.prev = 13;\n              _context58.t4 = _context58[\"catch\"](2);\n              this.logger.error(_context58.t4);\n              i = _context58.t4;\n              if (this.isConnectionStalled(i.message)) {\n                _context58.next = 19;\n                break;\n              }\n              throw _context58.t4;\n            case 19:\n              this.events.emit(D.transport_closed);\n            case 20:\n              _context58.prev = 20;\n              this.reconnecting = !1;\n              return _context58.finish(20);\n            case 23:\n            case \"end\":\n              return _context58.stop();\n          }\n        }, _callee58, this, [[2, 13, 20, 23]]);\n      }));\n      function transportOpen(_x57) {\n        return _transportOpen.apply(this, arguments);\n      }\n      return transportOpen;\n    }()\n  }, {\n    key: \"restartTransport\",\n    value: function () {\n      var _restartTransport = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee59(e) {\n        return _regeneratorRuntime().wrap(function _callee59$(_context59) {\n          while (1) switch (_context59.prev = _context59.next) {\n            case 0:\n              _context59.t0 = this.transportExplicitlyClosed;\n              if (_context59.t0) {\n                _context59.next = 9;\n                break;\n              }\n              this.relayUrl = e || this.relayUrl;\n              _context59.next = 5;\n              return this.transportClose();\n            case 5:\n              _context59.next = 7;\n              return this.createProvider();\n            case 7:\n              _context59.next = 9;\n              return this.transportOpen();\n            case 9:\n            case \"end\":\n              return _context59.stop();\n          }\n        }, _callee59, this);\n      }));\n      function restartTransport(_x60) {\n        return _restartTransport.apply(this, arguments);\n      }\n      return restartTransport;\n    }()\n  }, {\n    key: \"isConnectionStalled\",\n    value: function isConnectionStalled(e) {\n      return this.staleConnectionErrors.some(function (t) {\n        return e.includes(t);\n      });\n    }\n  }, {\n    key: \"rejectTransportOpen\",\n    value: function rejectTransportOpen() {\n      throw new Error(\"closeTransport called before connection was established\");\n    }\n  }, {\n    key: \"createProvider\",\n    value: function () {\n      var _createProvider = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee60() {\n        var e;\n        return _regeneratorRuntime().wrap(function _callee60$(_context60) {\n          while (1) switch (_context60.prev = _context60.next) {\n            case 0:\n              _context60.next = 2;\n              return this.core.crypto.signJWT(this.relayUrl);\n            case 2:\n              e = _context60.sent;\n              this.provider = new yi(new fi(ei({\n                sdkVersion: tt,\n                protocol: this.protocol,\n                version: this.version,\n                relayUrl: this.relayUrl,\n                projectId: this.projectId,\n                auth: e,\n                useOnCloseEvent: !0\n              }))), this.registerProviderListeners();\n            case 4:\n            case \"end\":\n              return _context60.stop();\n          }\n        }, _callee60, this);\n      }));\n      function createProvider() {\n        return _createProvider.apply(this, arguments);\n      }\n      return createProvider;\n    }()\n  }, {\n    key: \"recordMessageEvent\",\n    value: function () {\n      var _recordMessageEvent = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee61(e) {\n        var t, i;\n        return _regeneratorRuntime().wrap(function _callee61$(_context61) {\n          while (1) switch (_context61.prev = _context61.next) {\n            case 0:\n              t = e.topic, i = e.message;\n              _context61.next = 3;\n              return this.messages.set(t, i);\n            case 3:\n            case \"end\":\n              return _context61.stop();\n          }\n        }, _callee61, this);\n      }));\n      function recordMessageEvent(_x61) {\n        return _recordMessageEvent.apply(this, arguments);\n      }\n      return recordMessageEvent;\n    }()\n  }, {\n    key: \"shouldIgnoreMessageEvent\",\n    value: function () {\n      var _shouldIgnoreMessageEvent = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee62(e) {\n        var t, i;\n        return _regeneratorRuntime().wrap(function _callee62$(_context62) {\n          while (1) switch (_context62.prev = _context62.next) {\n            case 0:\n              t = e.topic, i = e.message;\n              _context62.next = 3;\n              return this.subscriber.isSubscribed(t);\n            case 3:\n              if (!_context62.sent) {\n                _context62.next = 7;\n                break;\n              }\n              _context62.t0 = this.messages.has(t, i);\n              _context62.next = 8;\n              break;\n            case 7:\n              _context62.t0 = !0;\n            case 8:\n              return _context62.abrupt(\"return\", _context62.t0);\n            case 9:\n            case \"end\":\n              return _context62.stop();\n          }\n        }, _callee62, this);\n      }));\n      function shouldIgnoreMessageEvent(_x62) {\n        return _shouldIgnoreMessageEvent.apply(this, arguments);\n      }\n      return shouldIgnoreMessageEvent;\n    }()\n  }, {\n    key: \"onProviderPayload\",\n    value: function () {\n      var _onProviderPayload = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee63(e) {\n        var t, _t$data, i, s, n, a;\n        return _regeneratorRuntime().wrap(function _callee63$(_context63) {\n          while (1) switch (_context63.prev = _context63.next) {\n            case 0:\n              if (!(this.logger.debug(\"Incoming Relay Payload\"), this.logger.trace({\n                type: \"payload\",\n                direction: \"incoming\",\n                payload: e\n              }), Ee(e))) {\n                _context63.next = 11;\n                break;\n              }\n              if (e.method.endsWith(Qe)) {\n                _context63.next = 3;\n                break;\n              }\n              return _context63.abrupt(\"return\");\n            case 3:\n              t = e.params, _t$data = t.data, i = _t$data.topic, s = _t$data.message, n = _t$data.publishedAt, a = {\n                topic: i,\n                message: s,\n                publishedAt: n\n              };\n              this.logger.debug(\"Emitting Relayer Payload\");\n              this.logger.trace(ar({\n                type: \"event\",\n                event: t.id\n              }, a));\n              this.events.emit(t.id, a);\n              _context63.next = 9;\n              return this.acknowledgePayload(e);\n            case 9:\n              _context63.next = 11;\n              return this.onMessageEvent(a);\n            case 11:\n            case \"end\":\n              return _context63.stop();\n          }\n        }, _callee63, this);\n      }));\n      function onProviderPayload(_x63) {\n        return _onProviderPayload.apply(this, arguments);\n      }\n      return onProviderPayload;\n    }()\n  }, {\n    key: \"onMessageEvent\",\n    value: function () {\n      var _onMessageEvent = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee64(e) {\n        return _regeneratorRuntime().wrap(function _callee64$(_context64) {\n          while (1) switch (_context64.prev = _context64.next) {\n            case 0:\n              _context64.next = 2;\n              return this.shouldIgnoreMessageEvent(e);\n            case 2:\n              _context64.t0 = _context64.sent;\n              if (_context64.t0) {\n                _context64.next = 7;\n                break;\n              }\n              this.events.emit(D.message, e);\n              _context64.next = 7;\n              return this.recordMessageEvent(e);\n            case 7:\n            case \"end\":\n              return _context64.stop();\n          }\n        }, _callee64, this);\n      }));\n      function onMessageEvent(_x64) {\n        return _onMessageEvent.apply(this, arguments);\n      }\n      return onMessageEvent;\n    }()\n  }, {\n    key: \"acknowledgePayload\",\n    value: function () {\n      var _acknowledgePayload = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee65(e) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee65$(_context65) {\n          while (1) switch (_context65.prev = _context65.next) {\n            case 0:\n              t = fe(e.id, !0);\n              _context65.next = 3;\n              return this.provider.connection.send(t);\n            case 3:\n            case \"end\":\n              return _context65.stop();\n          }\n        }, _callee65, this);\n      }));\n      function acknowledgePayload(_x65) {\n        return _acknowledgePayload.apply(this, arguments);\n      }\n      return acknowledgePayload;\n    }()\n  }, {\n    key: \"registerProviderListeners\",\n    value: function registerProviderListeners() {\n      var _this17 = this;\n      this.provider.on(M.payload, function (e) {\n        return _this17.onProviderPayload(e);\n      }), this.provider.on(M.connect, function () {\n        _this17.events.emit(D.connect);\n      }), this.provider.on(M.disconnect, function () {\n        _this17.onProviderDisconnect();\n      }), this.provider.on(M.error, function (e) {\n        _this17.logger.error(e), _this17.events.emit(D.error, e);\n      });\n    }\n  }, {\n    key: \"registerEventListeners\",\n    value: function registerEventListeners() {\n      var _this18 = this;\n      this.events.on(D.connection_stalled, /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee66() {\n        return _regeneratorRuntime().wrap(function _callee66$(_context66) {\n          while (1) switch (_context66.prev = _context66.next) {\n            case 0:\n              _context66.next = 2;\n              return _this18.restartTransport();\n            case 2:\n            case \"end\":\n              return _context66.stop();\n          }\n        }, _callee66);\n      })));\n    }\n  }, {\n    key: \"onProviderDisconnect\",\n    value: function onProviderDisconnect() {\n      this.events.emit(D.disconnect), this.attemptToReconnect();\n    }\n  }, {\n    key: \"attemptToReconnect\",\n    value: function attemptToReconnect() {\n      var _this19 = this;\n      this.transportExplicitlyClosed || setTimeout( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee67() {\n        return _regeneratorRuntime().wrap(function _callee67$(_context67) {\n          while (1) switch (_context67.prev = _context67.next) {\n            case 0:\n              _context67.next = 2;\n              return _this19.restartTransport();\n            case 2:\n            case \"end\":\n              return _context67.stop();\n          }\n        }, _callee67);\n      })), be(et));\n    }\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c8 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c8.message;\n        throw new Error(e);\n      }\n    }\n  }, {\n    key: \"toEstablishConnection\",\n    value: function () {\n      var _toEstablishConnection = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee68() {\n        var _this20 = this;\n        return _regeneratorRuntime().wrap(function _callee68$(_context68) {\n          while (1) switch (_context68.prev = _context68.next) {\n            case 0:\n              if (this.connected) {\n                _context68.next = 7;\n                break;\n              }\n              if (!this.connecting) {\n                _context68.next = 5;\n                break;\n              }\n              _context68.next = 4;\n              return new Promise(function (e) {\n                var t = setInterval(function () {\n                  _this20.connected && (clearInterval(t), e());\n                }, _this20.connectionStatusPollingInterval);\n              });\n            case 4:\n              return _context68.abrupt(\"return\", _context68.sent);\n            case 5:\n              _context68.next = 7;\n              return this.restartTransport();\n            case 7:\n            case \"end\":\n              return _context68.stop();\n          }\n        }, _callee68, this);\n      }));\n      function toEstablishConnection() {\n        return _toEstablishConnection.apply(this, arguments);\n      }\n      return toEstablishConnection;\n    }()\n  }]);\n  return ft;\n}(Ft);\nvar or = Object.defineProperty,\n  wt = Object.getOwnPropertySymbols,\n  hr = Object.prototype.hasOwnProperty,\n  cr = Object.prototype.propertyIsEnumerable,\n  vt = function vt(r, e, t) {\n    return e in r ? or(r, e, {\n      enumerable: !0,\n      configurable: !0,\n      writable: !0,\n      value: t\n    }) : r[e] = t;\n  },\n  It = function It(r, e) {\n    for (var t in e || (e = {})) hr.call(e, t) && vt(r, t, e[t]);\n    if (wt) {\n      var _iterator4 = _createForOfIteratorHelper(wt(e)),\n        _step4;\n      try {\n        for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n          var t = _step4.value;\n          cr.call(e, t) && vt(r, t, e[t]);\n        }\n      } catch (err) {\n        _iterator4.e(err);\n      } finally {\n        _iterator4.f();\n      }\n    }\n    return r;\n  };\nvar Ct = /*#__PURE__*/function (_Mt) {\n  _inherits(Ct, _Mt);\n  var _super5 = _createSuper(Ct);\n  function Ct(e, t, i) {\n    var _this21;\n    var s = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : P;\n    var n = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : void 0;\n    _classCallCheck(this, Ct);\n    _this21 = _super5.call(this, e, t, i, s), _this21.core = e, _this21.logger = t, _this21.name = i, _this21.map = new Map(), _this21.version = it, _this21.cached = [], _this21.initialized = !1, _this21.storagePrefix = P, _this21.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee69() {\n      return _regeneratorRuntime().wrap(function _callee69$(_context69) {\n        while (1) switch (_context69.prev = _context69.next) {\n          case 0:\n            _context69.t0 = _this21.initialized;\n            if (_context69.t0) {\n              _context69.next = 8;\n              break;\n            }\n            _this21.logger.trace(\"Initialized\");\n            _context69.next = 5;\n            return _this21.restore();\n          case 5:\n            _this21.cached.forEach(function (a) {\n              _this21.getKey && a !== null && !Z(a) ? _this21.map.set(_this21.getKey(a), a) : ti(a) ? _this21.map.set(a.id, a) : ii(a) && _this21.map.set(a.topic, a);\n            });\n            _this21.cached = [];\n            _this21.initialized = !0;\n          case 8:\n          case \"end\":\n            return _context69.stop();\n        }\n      }, _callee69);\n    })), _this21.set = /*#__PURE__*/function () {\n      var _ref40 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee70(a, o) {\n        return _regeneratorRuntime().wrap(function _callee70$(_context70) {\n          while (1) switch (_context70.prev = _context70.next) {\n            case 0:\n              _this21.isInitialized();\n              if (!_this21.map.has(a)) {\n                _context70.next = 6;\n                break;\n              }\n              _context70.next = 4;\n              return _this21.update(a, o);\n            case 4:\n              _context70.next = 11;\n              break;\n            case 6:\n              _this21.logger.debug(\"Setting value\");\n              _this21.logger.trace({\n                type: \"method\",\n                method: \"set\",\n                key: a,\n                value: o\n              });\n              _this21.map.set(a, o);\n              _context70.next = 11;\n              return _this21.persist();\n            case 11:\n            case \"end\":\n              return _context70.stop();\n          }\n        }, _callee70);\n      }));\n      return function (_x66, _x67) {\n        return _ref40.apply(this, arguments);\n      };\n    }(), _this21.get = function (a) {\n      return _this21.isInitialized(), _this21.logger.debug(\"Getting value\"), _this21.logger.trace({\n        type: \"method\",\n        method: \"get\",\n        key: a\n      }), _this21.getData(a);\n    }, _this21.getAll = function (a) {\n      return _this21.isInitialized(), a ? _this21.values.filter(function (o) {\n        return Object.keys(a).every(function (h) {\n          return wi(o[h], a[h]);\n        });\n      }) : _this21.values;\n    }, _this21.update = /*#__PURE__*/function () {\n      var _ref41 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee71(a, o) {\n        var h;\n        return _regeneratorRuntime().wrap(function _callee71$(_context71) {\n          while (1) switch (_context71.prev = _context71.next) {\n            case 0:\n              _this21.isInitialized(), _this21.logger.debug(\"Updating value\"), _this21.logger.trace({\n                type: \"method\",\n                method: \"update\",\n                key: a,\n                update: o\n              });\n              h = It(It({}, _this21.getData(a)), o);\n              _this21.map.set(a, h);\n              _context71.next = 5;\n              return _this21.persist();\n            case 5:\n            case \"end\":\n              return _context71.stop();\n          }\n        }, _callee71);\n      }));\n      return function (_x68, _x69) {\n        return _ref41.apply(this, arguments);\n      };\n    }(), _this21.delete = /*#__PURE__*/function () {\n      var _ref42 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee72(a, o) {\n        return _regeneratorRuntime().wrap(function _callee72$(_context72) {\n          while (1) switch (_context72.prev = _context72.next) {\n            case 0:\n              _this21.isInitialized();\n              _context72.t0 = _this21.map.has(a);\n              if (!_context72.t0) {\n                _context72.next = 8;\n                break;\n              }\n              _this21.logger.debug(\"Deleting value\");\n              _this21.logger.trace({\n                type: \"method\",\n                method: \"delete\",\n                key: a,\n                reason: o\n              });\n              _this21.map.delete(a);\n              _context72.next = 8;\n              return _this21.persist();\n            case 8:\n            case \"end\":\n              return _context72.stop();\n          }\n        }, _callee72);\n      }));\n      return function (_x70, _x71) {\n        return _ref42.apply(this, arguments);\n      };\n    }(), _this21.logger = w(t, _this21.name), _this21.storagePrefix = s, _this21.getKey = n;\n    return _this21;\n  }\n  _createClass(Ct, [{\n    key: \"context\",\n    get: function get() {\n      return v(this.logger);\n    }\n  }, {\n    key: \"storageKey\",\n    get: function get() {\n      return this.storagePrefix + this.version + \"//\" + this.name;\n    }\n  }, {\n    key: \"length\",\n    get: function get() {\n      return this.map.size;\n    }\n  }, {\n    key: \"keys\",\n    get: function get() {\n      return Array.from(this.map.keys());\n    }\n  }, {\n    key: \"values\",\n    get: function get() {\n      return Array.from(this.map.values());\n    }\n  }, {\n    key: \"setDataStore\",\n    value: function () {\n      var _setDataStore = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee73(e) {\n        return _regeneratorRuntime().wrap(function _callee73$(_context73) {\n          while (1) switch (_context73.prev = _context73.next) {\n            case 0:\n              _context73.next = 2;\n              return this.core.storage.setItem(this.storageKey, e);\n            case 2:\n            case \"end\":\n              return _context73.stop();\n          }\n        }, _callee73, this);\n      }));\n      function setDataStore(_x72) {\n        return _setDataStore.apply(this, arguments);\n      }\n      return setDataStore;\n    }()\n  }, {\n    key: \"getDataStore\",\n    value: function () {\n      var _getDataStore = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee74() {\n        return _regeneratorRuntime().wrap(function _callee74$(_context74) {\n          while (1) switch (_context74.prev = _context74.next) {\n            case 0:\n              _context74.next = 2;\n              return this.core.storage.getItem(this.storageKey);\n            case 2:\n              return _context74.abrupt(\"return\", _context74.sent);\n            case 3:\n            case \"end\":\n              return _context74.stop();\n          }\n        }, _callee74, this);\n      }));\n      function getDataStore() {\n        return _getDataStore.apply(this, arguments);\n      }\n      return getDataStore;\n    }()\n  }, {\n    key: \"getData\",\n    value: function getData(e) {\n      var t = this.map.get(e);\n      if (!t) {\n        var _c9 = c(\"NO_MATCHING_KEY\", \"\".concat(this.name, \": \").concat(e)),\n          i = _c9.message;\n        throw this.logger.error(i), new Error(i);\n      }\n      return t;\n    }\n  }, {\n    key: \"persist\",\n    value: function () {\n      var _persist4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee75() {\n        return _regeneratorRuntime().wrap(function _callee75$(_context75) {\n          while (1) switch (_context75.prev = _context75.next) {\n            case 0:\n              _context75.next = 2;\n              return this.setDataStore(this.values);\n            case 2:\n            case \"end\":\n              return _context75.stop();\n          }\n        }, _callee75, this);\n      }));\n      function persist() {\n        return _persist4.apply(this, arguments);\n      }\n      return persist;\n    }()\n  }, {\n    key: \"restore\",\n    value: function () {\n      var _restore2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee76() {\n        var e, _c10, t;\n        return _regeneratorRuntime().wrap(function _callee76$(_context76) {\n          while (1) switch (_context76.prev = _context76.next) {\n            case 0:\n              _context76.prev = 0;\n              _context76.next = 3;\n              return this.getDataStore();\n            case 3:\n              e = _context76.sent;\n              if (!(typeof e > \"u\" || !e.length)) {\n                _context76.next = 6;\n                break;\n              }\n              return _context76.abrupt(\"return\");\n            case 6:\n              if (!this.map.size) {\n                _context76.next = 9;\n                break;\n              }\n              _c10 = c(\"RESTORE_WILL_OVERRIDE\", this.name), t = _c10.message;\n              throw this.logger.error(t), new Error(t);\n            case 9:\n              this.cached = e, this.logger.debug(\"Successfully Restored value for \".concat(this.name)), this.logger.trace({\n                type: \"method\",\n                method: \"restore\",\n                value: this.values\n              });\n              _context76.next = 15;\n              break;\n            case 12:\n              _context76.prev = 12;\n              _context76.t0 = _context76[\"catch\"](0);\n              this.logger.debug(\"Failed to Restore value for \".concat(this.name)), this.logger.error(_context76.t0);\n            case 15:\n            case \"end\":\n              return _context76.stop();\n          }\n        }, _callee76, this, [[0, 12]]);\n      }));\n      function restore() {\n        return _restore2.apply(this, arguments);\n      }\n      return restore;\n    }()\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c11 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c11.message;\n        throw new Error(e);\n      }\n    }\n  }]);\n  return Ct;\n}(Mt);\nvar _t = /*#__PURE__*/function () {\n  function _t(e, t) {\n    var _this22 = this;\n    _classCallCheck(this, _t);\n    this.core = e, this.logger = t, this.name = at, this.version = ot, this.events = new Ot(), this.initialized = !1, this.storagePrefix = P, this.ignoredPayloadTypes = [si], this.registeredMethods = [], this.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee77() {\n      return _regeneratorRuntime().wrap(function _callee77$(_context77) {\n        while (1) switch (_context77.prev = _context77.next) {\n          case 0:\n            _context77.t0 = _this22.initialized;\n            if (_context77.t0) {\n              _context77.next = 10;\n              break;\n            }\n            _context77.next = 4;\n            return _this22.pairings.init();\n          case 4:\n            _context77.next = 6;\n            return _this22.cleanup();\n          case 6:\n            _this22.registerRelayerEvents();\n            _this22.registerExpirerEvents();\n            _this22.initialized = !0;\n            _this22.logger.trace(\"Initialized\");\n          case 10:\n          case \"end\":\n            return _context77.stop();\n        }\n      }, _callee77);\n    })), this.register = function (_ref44) {\n      var i = _ref44.methods;\n      _this22.isInitialized(), _this22.registeredMethods = _toConsumableArray(new Set([].concat(_toConsumableArray(_this22.registeredMethods), _toConsumableArray(i))));\n    }, this.create = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee78() {\n      var i, s, n, a, o, h;\n      return _regeneratorRuntime().wrap(function _callee78$(_context78) {\n        while (1) switch (_context78.prev = _context78.next) {\n          case 0:\n            _this22.isInitialized();\n            i = X();\n            _context78.next = 4;\n            return _this22.core.crypto.setSymKey(i);\n          case 4:\n            s = _context78.sent;\n            n = Q(me);\n            a = {\n              protocol: Xe\n            };\n            o = {\n              topic: s,\n              expiry: n,\n              relay: a,\n              active: !1\n            };\n            h = ri({\n              protocol: _this22.core.protocol,\n              version: _this22.core.version,\n              topic: s,\n              symKey: i,\n              relay: a\n            });\n            _context78.next = 11;\n            return _this22.pairings.set(s, o);\n          case 11:\n            _context78.next = 13;\n            return _this22.core.relayer.subscribe(s);\n          case 13:\n            _this22.core.expirer.set(s, n);\n            return _context78.abrupt(\"return\", {\n              topic: s,\n              uri: h\n            });\n          case 15:\n          case \"end\":\n            return _context78.stop();\n        }\n      }, _callee78);\n    })), this.pair = /*#__PURE__*/function () {\n      var _ref46 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee79(i) {\n        var _ni, s, n, a, o, h;\n        return _regeneratorRuntime().wrap(function _callee79$(_context79) {\n          while (1) switch (_context79.prev = _context79.next) {\n            case 0:\n              _this22.isInitialized(), _this22.isValidPair(i);\n              _ni = ni(i.uri), s = _ni.topic, n = _ni.symKey, a = _ni.relay;\n              if (!_this22.pairings.keys.includes(s)) {\n                _context79.next = 4;\n                break;\n              }\n              throw new Error(\"Pairing already exists: \".concat(s));\n            case 4:\n              if (!_this22.core.crypto.hasKeys(s)) {\n                _context79.next = 6;\n                break;\n              }\n              throw new Error(\"Keychain already exists: \".concat(s));\n            case 6:\n              o = Q(me), h = {\n                topic: s,\n                relay: a,\n                expiry: o,\n                active: !1\n              };\n              _context79.next = 9;\n              return _this22.pairings.set(s, h);\n            case 9:\n              _context79.next = 11;\n              return _this22.core.crypto.setSymKey(n, s);\n            case 11:\n              _context79.next = 13;\n              return _this22.core.relayer.subscribe(s, {\n                relay: a\n              });\n            case 13:\n              _this22.core.expirer.set(s, o);\n              _context79.t0 = i.activatePairing;\n              if (!_context79.t0) {\n                _context79.next = 18;\n                break;\n              }\n              _context79.next = 18;\n              return _this22.activate({\n                topic: s\n              });\n            case 18:\n              return _context79.abrupt(\"return\", h);\n            case 19:\n            case \"end\":\n              return _context79.stop();\n          }\n        }, _callee79);\n      }));\n      return function (_x73) {\n        return _ref46.apply(this, arguments);\n      };\n    }(), this.activate = /*#__PURE__*/function () {\n      var _ref48 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee80(_ref47) {\n        var i, s;\n        return _regeneratorRuntime().wrap(function _callee80$(_context80) {\n          while (1) switch (_context80.prev = _context80.next) {\n            case 0:\n              i = _ref47.topic;\n              _this22.isInitialized();\n              s = Q(ie);\n              _context80.next = 5;\n              return _this22.pairings.update(i, {\n                active: !0,\n                expiry: s\n              });\n            case 5:\n              _this22.core.expirer.set(i, s);\n            case 6:\n            case \"end\":\n              return _context80.stop();\n          }\n        }, _callee80);\n      }));\n      return function (_x74) {\n        return _ref48.apply(this, arguments);\n      };\n    }(), this.ping = /*#__PURE__*/function () {\n      var _ref49 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee81(i) {\n        var s, n, _ai, a, o, h;\n        return _regeneratorRuntime().wrap(function _callee81$(_context81) {\n          while (1) switch (_context81.prev = _context81.next) {\n            case 0:\n              _this22.isInitialized();\n              _context81.next = 3;\n              return _this22.isValidPing(i);\n            case 3:\n              s = i.topic;\n              if (!_this22.pairings.keys.includes(s)) {\n                _context81.next = 15;\n                break;\n              }\n              _context81.next = 7;\n              return _this22.sendRequest(s, \"wc_pairingPing\", {});\n            case 7:\n              n = _context81.sent;\n              _ai = ai();\n              a = _ai.done;\n              o = _ai.resolve;\n              h = _ai.reject;\n              _this22.events.once(ee(\"pairing_ping\", n), function (_ref50) {\n                var d = _ref50.error;\n                d ? h(d) : o();\n              });\n              _context81.next = 15;\n              return a();\n            case 15:\n            case \"end\":\n              return _context81.stop();\n          }\n        }, _callee81);\n      }));\n      return function (_x75) {\n        return _ref49.apply(this, arguments);\n      };\n    }(), this.updateExpiry = /*#__PURE__*/function () {\n      var _ref52 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee82(_ref51) {\n        var i, s;\n        return _regeneratorRuntime().wrap(function _callee82$(_context82) {\n          while (1) switch (_context82.prev = _context82.next) {\n            case 0:\n              i = _ref51.topic, s = _ref51.expiry;\n              _this22.isInitialized();\n              _context82.next = 4;\n              return _this22.pairings.update(i, {\n                expiry: s\n              });\n            case 4:\n            case \"end\":\n              return _context82.stop();\n          }\n        }, _callee82);\n      }));\n      return function (_x76) {\n        return _ref52.apply(this, arguments);\n      };\n    }(), this.updateMetadata = /*#__PURE__*/function () {\n      var _ref54 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee83(_ref53) {\n        var i, s;\n        return _regeneratorRuntime().wrap(function _callee83$(_context83) {\n          while (1) switch (_context83.prev = _context83.next) {\n            case 0:\n              i = _ref53.topic, s = _ref53.metadata;\n              _this22.isInitialized();\n              _context83.next = 4;\n              return _this22.pairings.update(i, {\n                peerMetadata: s\n              });\n            case 4:\n            case \"end\":\n              return _context83.stop();\n          }\n        }, _callee83);\n      }));\n      return function (_x77) {\n        return _ref54.apply(this, arguments);\n      };\n    }(), this.getPairings = function () {\n      return _this22.isInitialized(), _this22.pairings.values;\n    }, this.disconnect = /*#__PURE__*/function () {\n      var _ref55 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee84(i) {\n        var s;\n        return _regeneratorRuntime().wrap(function _callee84$(_context84) {\n          while (1) switch (_context84.prev = _context84.next) {\n            case 0:\n              _this22.isInitialized();\n              _context84.next = 3;\n              return _this22.isValidDisconnect(i);\n            case 3:\n              s = i.topic;\n              _context84.t0 = _this22.pairings.keys.includes(s);\n              if (!_context84.t0) {\n                _context84.next = 10;\n                break;\n              }\n              _context84.next = 8;\n              return _this22.sendRequest(s, \"wc_pairingDelete\", L(\"USER_DISCONNECTED\"));\n            case 8:\n              _context84.next = 10;\n              return _this22.deletePairing(s);\n            case 10:\n            case \"end\":\n              return _context84.stop();\n          }\n        }, _callee84);\n      }));\n      return function (_x78) {\n        return _ref55.apply(this, arguments);\n      };\n    }(), this.sendRequest = /*#__PURE__*/function () {\n      var _ref56 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee85(i, s, n) {\n        var a, o, h;\n        return _regeneratorRuntime().wrap(function _callee85$(_context85) {\n          while (1) switch (_context85.prev = _context85.next) {\n            case 0:\n              a = we(s, n);\n              _context85.next = 3;\n              return _this22.core.crypto.encode(i, a);\n            case 3:\n              o = _context85.sent;\n              h = N[s].req;\n              _this22.core.history.set(i, a);\n              _context85.next = 8;\n              return _this22.core.relayer.publish(i, o, h);\n            case 8:\n              return _context85.abrupt(\"return\", a.id);\n            case 9:\n            case \"end\":\n              return _context85.stop();\n          }\n        }, _callee85);\n      }));\n      return function (_x79, _x80, _x81) {\n        return _ref56.apply(this, arguments);\n      };\n    }(), this.sendResult = /*#__PURE__*/function () {\n      var _ref57 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee86(i, s, n) {\n        var a, o, h, d;\n        return _regeneratorRuntime().wrap(function _callee86$(_context86) {\n          while (1) switch (_context86.prev = _context86.next) {\n            case 0:\n              a = fe(i, n);\n              _context86.next = 3;\n              return _this22.core.crypto.encode(s, a);\n            case 3:\n              o = _context86.sent;\n              _context86.next = 6;\n              return _this22.core.history.get(s, i);\n            case 6:\n              h = _context86.sent;\n              d = N[h.request.method].res;\n              _context86.next = 10;\n              return _this22.core.relayer.publish(s, o, d);\n            case 10:\n              _context86.next = 12;\n              return _this22.core.history.resolve(a);\n            case 12:\n            case \"end\":\n              return _context86.stop();\n          }\n        }, _callee86);\n      }));\n      return function (_x82, _x83, _x84) {\n        return _ref57.apply(this, arguments);\n      };\n    }(), this.sendError = /*#__PURE__*/function () {\n      var _ref58 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee87(i, s, n) {\n        var a, o, h, d;\n        return _regeneratorRuntime().wrap(function _callee87$(_context87) {\n          while (1) switch (_context87.prev = _context87.next) {\n            case 0:\n              a = bi(i, n);\n              _context87.next = 3;\n              return _this22.core.crypto.encode(s, a);\n            case 3:\n              o = _context87.sent;\n              _context87.next = 6;\n              return _this22.core.history.get(s, i);\n            case 6:\n              h = _context87.sent;\n              d = N[h.request.method] ? N[h.request.method].res : N.unregistered_method.res;\n              _context87.next = 10;\n              return _this22.core.relayer.publish(s, o, d);\n            case 10:\n              _context87.next = 12;\n              return _this22.core.history.resolve(a);\n            case 12:\n            case \"end\":\n              return _context87.stop();\n          }\n        }, _callee87);\n      }));\n      return function (_x85, _x86, _x87) {\n        return _ref58.apply(this, arguments);\n      };\n    }(), this.deletePairing = /*#__PURE__*/function () {\n      var _ref59 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee88(i, s) {\n        return _regeneratorRuntime().wrap(function _callee88$(_context88) {\n          while (1) switch (_context88.prev = _context88.next) {\n            case 0:\n              _context88.next = 2;\n              return _this22.core.relayer.unsubscribe(i);\n            case 2:\n              _context88.next = 4;\n              return Promise.all([_this22.pairings.delete(i, L(\"USER_DISCONNECTED\")), _this22.core.crypto.deleteSymKey(i), s ? Promise.resolve() : _this22.core.expirer.del(i)]);\n            case 4:\n            case \"end\":\n              return _context88.stop();\n          }\n        }, _callee88);\n      }));\n      return function (_x88, _x89) {\n        return _ref59.apply(this, arguments);\n      };\n    }(), this.cleanup = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee89() {\n      var i;\n      return _regeneratorRuntime().wrap(function _callee89$(_context89) {\n        while (1) switch (_context89.prev = _context89.next) {\n          case 0:\n            i = _this22.pairings.getAll().filter(function (s) {\n              return De(s.expiry);\n            });\n            _context89.next = 3;\n            return Promise.all(i.map(function (s) {\n              return _this22.deletePairing(s.topic);\n            }));\n          case 3:\n          case \"end\":\n            return _context89.stop();\n        }\n      }, _callee89);\n    })), this.onRelayEventRequest = function (i) {\n      var s = i.topic,\n        n = i.payload,\n        a = n.method;\n      if (_this22.pairings.keys.includes(s)) switch (a) {\n        case \"wc_pairingPing\":\n          return _this22.onPairingPingRequest(s, n);\n        case \"wc_pairingDelete\":\n          return _this22.onPairingDeleteRequest(s, n);\n        default:\n          return _this22.onUnknownRpcMethodRequest(s, n);\n      }\n    }, this.onRelayEventResponse = /*#__PURE__*/function () {\n      var _ref61 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee90(i) {\n        var s, n, a;\n        return _regeneratorRuntime().wrap(function _callee90$(_context90) {\n          while (1) switch (_context90.prev = _context90.next) {\n            case 0:\n              s = i.topic;\n              n = i.payload;\n              _context90.next = 4;\n              return _this22.core.history.get(s, n.id);\n            case 4:\n              a = _context90.sent.request.method;\n              if (!_this22.pairings.keys.includes(s)) {\n                _context90.next = 11;\n                break;\n              }\n              _context90.t0 = a;\n              _context90.next = _context90.t0 === \"wc_pairingPing\" ? 9 : 10;\n              break;\n            case 9:\n              return _context90.abrupt(\"return\", _this22.onPairingPingResponse(s, n));\n            case 10:\n              return _context90.abrupt(\"return\", _this22.onUnknownRpcMethodResponse(a));\n            case 11:\n            case \"end\":\n              return _context90.stop();\n          }\n        }, _callee90);\n      }));\n      return function (_x90) {\n        return _ref61.apply(this, arguments);\n      };\n    }(), this.onPairingPingRequest = /*#__PURE__*/function () {\n      var _ref62 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee91(i, s) {\n        var n;\n        return _regeneratorRuntime().wrap(function _callee91$(_context91) {\n          while (1) switch (_context91.prev = _context91.next) {\n            case 0:\n              n = s.id;\n              _context91.prev = 1;\n              _this22.isValidPing({\n                topic: i\n              });\n              _context91.next = 5;\n              return _this22.sendResult(n, i, !0);\n            case 5:\n              _this22.events.emit(\"pairing_ping\", {\n                id: n,\n                topic: i\n              });\n              _context91.next = 13;\n              break;\n            case 8:\n              _context91.prev = 8;\n              _context91.t0 = _context91[\"catch\"](1);\n              _context91.next = 12;\n              return _this22.sendError(n, i, _context91.t0);\n            case 12:\n              _this22.logger.error(_context91.t0);\n            case 13:\n            case \"end\":\n              return _context91.stop();\n          }\n        }, _callee91, null, [[1, 8]]);\n      }));\n      return function (_x91, _x92) {\n        return _ref62.apply(this, arguments);\n      };\n    }(), this.onPairingPingResponse = function (i, s) {\n      var n = s.id;\n      setTimeout(function () {\n        mi(s) ? _this22.events.emit(ee(\"pairing_ping\", n), {}) : ve(s) && _this22.events.emit(ee(\"pairing_ping\", n), {\n          error: s.error\n        });\n      }, 500);\n    }, this.onPairingDeleteRequest = /*#__PURE__*/function () {\n      var _ref63 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee92(i, s) {\n        var n;\n        return _regeneratorRuntime().wrap(function _callee92$(_context92) {\n          while (1) switch (_context92.prev = _context92.next) {\n            case 0:\n              n = s.id;\n              _context92.prev = 1;\n              _this22.isValidDisconnect({\n                topic: i\n              });\n              _context92.next = 5;\n              return _this22.deletePairing(i);\n            case 5:\n              _this22.events.emit(\"pairing_delete\", {\n                id: n,\n                topic: i\n              });\n              _context92.next = 13;\n              break;\n            case 8:\n              _context92.prev = 8;\n              _context92.t0 = _context92[\"catch\"](1);\n              _context92.next = 12;\n              return _this22.sendError(n, i, _context92.t0);\n            case 12:\n              _this22.logger.error(_context92.t0);\n            case 13:\n            case \"end\":\n              return _context92.stop();\n          }\n        }, _callee92, null, [[1, 8]]);\n      }));\n      return function (_x93, _x94) {\n        return _ref63.apply(this, arguments);\n      };\n    }(), this.onUnknownRpcMethodRequest = /*#__PURE__*/function () {\n      var _ref64 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee93(i, s) {\n        var n, a, o;\n        return _regeneratorRuntime().wrap(function _callee93$(_context93) {\n          while (1) switch (_context93.prev = _context93.next) {\n            case 0:\n              n = s.id, a = s.method;\n              _context93.prev = 1;\n              if (!_this22.registeredMethods.includes(a)) {\n                _context93.next = 4;\n                break;\n              }\n              return _context93.abrupt(\"return\");\n            case 4:\n              o = L(\"WC_METHOD_UNSUPPORTED\", a);\n              _context93.next = 7;\n              return _this22.sendError(n, i, o);\n            case 7:\n              _this22.logger.error(o);\n              _context93.next = 15;\n              break;\n            case 10:\n              _context93.prev = 10;\n              _context93.t0 = _context93[\"catch\"](1);\n              _context93.next = 14;\n              return _this22.sendError(n, i, _context93.t0);\n            case 14:\n              _this22.logger.error(_context93.t0);\n            case 15:\n            case \"end\":\n              return _context93.stop();\n          }\n        }, _callee93, null, [[1, 10]]);\n      }));\n      return function (_x95, _x96) {\n        return _ref64.apply(this, arguments);\n      };\n    }(), this.onUnknownRpcMethodResponse = function (i) {\n      _this22.registeredMethods.includes(i) || _this22.logger.error(L(\"WC_METHOD_UNSUPPORTED\", i));\n    }, this.isValidPair = function (i) {\n      if (!te(i)) {\n        var _c12 = c(\"MISSING_OR_INVALID\", \"pair() params: \".concat(i)),\n          s = _c12.message;\n        throw new Error(s);\n      }\n      if (!oi(i.uri)) {\n        var _c13 = c(\"MISSING_OR_INVALID\", \"pair() uri: \".concat(i.uri)),\n          _s2 = _c13.message;\n        throw new Error(_s2);\n      }\n    }, this.isValidPing = /*#__PURE__*/function () {\n      var _ref65 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee94(i) {\n        var _c14, n, s;\n        return _regeneratorRuntime().wrap(function _callee94$(_context94) {\n          while (1) switch (_context94.prev = _context94.next) {\n            case 0:\n              if (te(i)) {\n                _context94.next = 3;\n                break;\n              }\n              _c14 = c(\"MISSING_OR_INVALID\", \"ping() params: \".concat(i)), n = _c14.message;\n              throw new Error(n);\n            case 3:\n              s = i.topic;\n              _context94.next = 6;\n              return _this22.isValidPairingTopic(s);\n            case 6:\n            case \"end\":\n              return _context94.stop();\n          }\n        }, _callee94);\n      }));\n      return function (_x97) {\n        return _ref65.apply(this, arguments);\n      };\n    }(), this.isValidDisconnect = /*#__PURE__*/function () {\n      var _ref66 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee95(i) {\n        var _c15, n, s;\n        return _regeneratorRuntime().wrap(function _callee95$(_context95) {\n          while (1) switch (_context95.prev = _context95.next) {\n            case 0:\n              if (te(i)) {\n                _context95.next = 3;\n                break;\n              }\n              _c15 = c(\"MISSING_OR_INVALID\", \"disconnect() params: \".concat(i)), n = _c15.message;\n              throw new Error(n);\n            case 3:\n              s = i.topic;\n              _context95.next = 6;\n              return _this22.isValidPairingTopic(s);\n            case 6:\n            case \"end\":\n              return _context95.stop();\n          }\n        }, _callee95);\n      }));\n      return function (_x98) {\n        return _ref66.apply(this, arguments);\n      };\n    }(), this.isValidPairingTopic = /*#__PURE__*/function () {\n      var _ref67 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee96(i) {\n        var _c16, s, _c17, _s3, _c18, _s4;\n        return _regeneratorRuntime().wrap(function _callee96$(_context96) {\n          while (1) switch (_context96.prev = _context96.next) {\n            case 0:\n              if (hi(i, !1)) {\n                _context96.next = 3;\n                break;\n              }\n              _c16 = c(\"MISSING_OR_INVALID\", \"pairing topic should be a string: \".concat(i)), s = _c16.message;\n              throw new Error(s);\n            case 3:\n              if (_this22.pairings.keys.includes(i)) {\n                _context96.next = 6;\n                break;\n              }\n              _c17 = c(\"NO_MATCHING_KEY\", \"pairing topic doesn't exist: \".concat(i)), _s3 = _c17.message;\n              throw new Error(_s3);\n            case 6:\n              if (!De(_this22.pairings.get(i).expiry)) {\n                _context96.next = 11;\n                break;\n              }\n              _context96.next = 9;\n              return _this22.deletePairing(i);\n            case 9:\n              _c18 = c(\"EXPIRED\", \"pairing topic: \".concat(i)), _s4 = _c18.message;\n              throw new Error(_s4);\n            case 11:\n            case \"end\":\n              return _context96.stop();\n          }\n        }, _callee96);\n      }));\n      return function (_x99) {\n        return _ref67.apply(this, arguments);\n      };\n    }(), this.core = e, this.logger = w(t, this.name), this.pairings = new Ct(this.core, this.logger, this.name, this.storagePrefix);\n  }\n  _createClass(_t, [{\n    key: \"context\",\n    get: function get() {\n      return v(this.logger);\n    }\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c19 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c19.message;\n        throw new Error(e);\n      }\n    }\n  }, {\n    key: \"registerRelayerEvents\",\n    value: function registerRelayerEvents() {\n      var _this23 = this;\n      this.core.relayer.on(D.message, /*#__PURE__*/function () {\n        var _ref68 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee97(e) {\n          var t, i, s;\n          return _regeneratorRuntime().wrap(function _callee97$(_context97) {\n            while (1) switch (_context97.prev = _context97.next) {\n              case 0:\n                t = e.topic, i = e.message;\n                if (!_this23.ignoredPayloadTypes.includes(_this23.core.crypto.getPayloadType(i))) {\n                  _context97.next = 3;\n                  break;\n                }\n                return _context97.abrupt(\"return\");\n              case 3:\n                _context97.next = 5;\n                return _this23.core.crypto.decode(t, i);\n              case 5:\n                s = _context97.sent;\n                if (!Ee(s)) {\n                  _context97.next = 10;\n                  break;\n                }\n                _this23.core.history.set(t, s), _this23.onRelayEventRequest({\n                  topic: t,\n                  payload: s\n                });\n                _context97.next = 15;\n                break;\n              case 10:\n                _context97.t0 = Ei(s);\n                if (!_context97.t0) {\n                  _context97.next = 15;\n                  break;\n                }\n                _context97.next = 14;\n                return _this23.core.history.resolve(s);\n              case 14:\n                _this23.onRelayEventResponse({\n                  topic: t,\n                  payload: s\n                });\n              case 15:\n              case \"end\":\n                return _context97.stop();\n            }\n          }, _callee97);\n        }));\n        return function (_x100) {\n          return _ref68.apply(this, arguments);\n        };\n      }());\n    }\n  }, {\n    key: \"registerExpirerEvents\",\n    value: function registerExpirerEvents() {\n      var _this24 = this;\n      this.core.expirer.on(m.expired, /*#__PURE__*/function () {\n        var _ref69 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee98(e) {\n          var _ci, t;\n          return _regeneratorRuntime().wrap(function _callee98$(_context98) {\n            while (1) switch (_context98.prev = _context98.next) {\n              case 0:\n                _ci = ci(e.target), t = _ci.topic;\n                _context98.t0 = t && _this24.pairings.keys.includes(t);\n                if (!_context98.t0) {\n                  _context98.next = 6;\n                  break;\n                }\n                _context98.next = 5;\n                return _this24.deletePairing(t, !0);\n              case 5:\n                _this24.events.emit(\"pairing_expire\", {\n                  topic: t\n                });\n              case 6:\n              case \"end\":\n                return _context98.stop();\n            }\n          }, _callee98);\n        }));\n        return function (_x101) {\n          return _ref69.apply(this, arguments);\n        };\n      }());\n    }\n  }]);\n  return _t;\n}();\nvar Rt = /*#__PURE__*/function (_$t) {\n  _inherits(Rt, _$t);\n  var _super6 = _createSuper(Rt);\n  function Rt(e, t) {\n    var _this25;\n    _classCallCheck(this, Rt);\n    _this25 = _super6.call(this, e, t), _this25.core = e, _this25.logger = t, _this25.records = new Map(), _this25.events = new A(), _this25.name = ht, _this25.version = ct, _this25.cached = [], _this25.initialized = !1, _this25.storagePrefix = P, _this25.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee99() {\n      return _regeneratorRuntime().wrap(function _callee99$(_context99) {\n        while (1) switch (_context99.prev = _context99.next) {\n          case 0:\n            _context99.t0 = _this25.initialized;\n            if (_context99.t0) {\n              _context99.next = 9;\n              break;\n            }\n            _this25.logger.trace(\"Initialized\");\n            _context99.next = 5;\n            return _this25.restore();\n          case 5:\n            _this25.cached.forEach(function (i) {\n              return _this25.records.set(i.id, i);\n            });\n            _this25.cached = [];\n            _this25.registerEventListeners();\n            _this25.initialized = !0;\n          case 9:\n          case \"end\":\n            return _context99.stop();\n        }\n      }, _callee99);\n    })), _this25.set = function (i, s, n) {\n      if (_this25.isInitialized(), _this25.logger.debug(\"Setting JSON-RPC request history record\"), _this25.logger.trace({\n        type: \"method\",\n        method: \"set\",\n        topic: i,\n        request: s,\n        chainId: n\n      }), _this25.records.has(s.id)) return;\n      var a = {\n        id: s.id,\n        topic: i,\n        request: {\n          method: s.method,\n          params: s.params || null\n        },\n        chainId: n\n      };\n      _this25.records.set(a.id, a), _this25.events.emit(C.created, a);\n    }, _this25.resolve = /*#__PURE__*/function () {\n      var _ref71 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee100(i) {\n        var s;\n        return _regeneratorRuntime().wrap(function _callee100$(_context100) {\n          while (1) switch (_context100.prev = _context100.next) {\n            case 0:\n              if (!(_this25.isInitialized(), _this25.logger.debug(\"Updating JSON-RPC response history record\"), _this25.logger.trace({\n                type: \"method\",\n                method: \"update\",\n                response: i\n              }), !_this25.records.has(i.id))) {\n                _context100.next = 2;\n                break;\n              }\n              return _context100.abrupt(\"return\");\n            case 2:\n              _context100.next = 4;\n              return _this25.getRecord(i.id);\n            case 4:\n              s = _context100.sent;\n              typeof s.response > \"u\" && (s.response = ve(i) ? {\n                error: i.error\n              } : {\n                result: i.result\n              }, _this25.records.set(s.id, s), _this25.events.emit(C.updated, s));\n            case 6:\n            case \"end\":\n              return _context100.stop();\n          }\n        }, _callee100);\n      }));\n      return function (_x102) {\n        return _ref71.apply(this, arguments);\n      };\n    }(), _this25.get = /*#__PURE__*/function () {\n      var _ref72 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee101(i, s) {\n        return _regeneratorRuntime().wrap(function _callee101$(_context101) {\n          while (1) switch (_context101.prev = _context101.next) {\n            case 0:\n              _this25.isInitialized();\n              _this25.logger.debug(\"Getting record\");\n              _this25.logger.trace({\n                type: \"method\",\n                method: \"get\",\n                topic: i,\n                id: s\n              });\n              _context101.next = 5;\n              return _this25.getRecord(s);\n            case 5:\n              return _context101.abrupt(\"return\", _context101.sent);\n            case 6:\n            case \"end\":\n              return _context101.stop();\n          }\n        }, _callee101);\n      }));\n      return function (_x103, _x104) {\n        return _ref72.apply(this, arguments);\n      };\n    }(), _this25.delete = function (i, s) {\n      _this25.isInitialized(), _this25.logger.debug(\"Deleting record\"), _this25.logger.trace({\n        type: \"method\",\n        method: \"delete\",\n        id: s\n      }), _this25.values.forEach(function (n) {\n        if (n.topic === i) {\n          if (typeof s < \"u\" && n.id !== s) return;\n          _this25.records.delete(n.id), _this25.events.emit(C.deleted, n);\n        }\n      });\n    }, _this25.exists = /*#__PURE__*/function () {\n      var _ref73 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee102(i, s) {\n        return _regeneratorRuntime().wrap(function _callee102$(_context102) {\n          while (1) switch (_context102.prev = _context102.next) {\n            case 0:\n              _this25.isInitialized();\n              if (!_this25.records.has(s)) {\n                _context102.next = 9;\n                break;\n              }\n              _context102.next = 4;\n              return _this25.getRecord(s);\n            case 4:\n              _context102.t1 = _context102.sent.topic;\n              _context102.t2 = i;\n              _context102.t0 = _context102.t1 === _context102.t2;\n              _context102.next = 10;\n              break;\n            case 9:\n              _context102.t0 = !1;\n            case 10:\n              return _context102.abrupt(\"return\", _context102.t0);\n            case 11:\n            case \"end\":\n              return _context102.stop();\n          }\n        }, _callee102);\n      }));\n      return function (_x105, _x106) {\n        return _ref73.apply(this, arguments);\n      };\n    }(), _this25.on = function (i, s) {\n      _this25.events.on(i, s);\n    }, _this25.once = function (i, s) {\n      _this25.events.once(i, s);\n    }, _this25.off = function (i, s) {\n      _this25.events.off(i, s);\n    }, _this25.removeListener = function (i, s) {\n      _this25.events.removeListener(i, s);\n    }, _this25.logger = w(t, _this25.name);\n    return _this25;\n  }\n  _createClass(Rt, [{\n    key: \"context\",\n    get: function get() {\n      return v(this.logger);\n    }\n  }, {\n    key: \"storageKey\",\n    get: function get() {\n      return this.storagePrefix + this.version + \"//\" + this.name;\n    }\n  }, {\n    key: \"size\",\n    get: function get() {\n      return this.records.size;\n    }\n  }, {\n    key: \"keys\",\n    get: function get() {\n      return Array.from(this.records.keys());\n    }\n  }, {\n    key: \"values\",\n    get: function get() {\n      return Array.from(this.records.values());\n    }\n  }, {\n    key: \"pending\",\n    get: function get() {\n      var e = [];\n      return this.values.forEach(function (t) {\n        if (typeof t.response < \"u\") return;\n        var i = {\n          topic: t.topic,\n          request: we(t.request.method, t.request.params, t.id),\n          chainId: t.chainId\n        };\n        return e.push(i);\n      }), e;\n    }\n  }, {\n    key: \"setJsonRpcRecords\",\n    value: function () {\n      var _setJsonRpcRecords = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee103(e) {\n        return _regeneratorRuntime().wrap(function _callee103$(_context103) {\n          while (1) switch (_context103.prev = _context103.next) {\n            case 0:\n              _context103.next = 2;\n              return this.core.storage.setItem(this.storageKey, e);\n            case 2:\n            case \"end\":\n              return _context103.stop();\n          }\n        }, _callee103, this);\n      }));\n      function setJsonRpcRecords(_x107) {\n        return _setJsonRpcRecords.apply(this, arguments);\n      }\n      return setJsonRpcRecords;\n    }()\n  }, {\n    key: \"getJsonRpcRecords\",\n    value: function () {\n      var _getJsonRpcRecords = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee104() {\n        return _regeneratorRuntime().wrap(function _callee104$(_context104) {\n          while (1) switch (_context104.prev = _context104.next) {\n            case 0:\n              _context104.next = 2;\n              return this.core.storage.getItem(this.storageKey);\n            case 2:\n              return _context104.abrupt(\"return\", _context104.sent);\n            case 3:\n            case \"end\":\n              return _context104.stop();\n          }\n        }, _callee104, this);\n      }));\n      function getJsonRpcRecords() {\n        return _getJsonRpcRecords.apply(this, arguments);\n      }\n      return getJsonRpcRecords;\n    }()\n  }, {\n    key: \"getRecord\",\n    value: function getRecord(e) {\n      this.isInitialized();\n      var t = this.records.get(e);\n      if (!t) {\n        var _c20 = c(\"NO_MATCHING_KEY\", \"\".concat(this.name, \": \").concat(e)),\n          i = _c20.message;\n        throw new Error(i);\n      }\n      return t;\n    }\n  }, {\n    key: \"persist\",\n    value: function () {\n      var _persist5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee105() {\n        return _regeneratorRuntime().wrap(function _callee105$(_context105) {\n          while (1) switch (_context105.prev = _context105.next) {\n            case 0:\n              _context105.next = 2;\n              return this.setJsonRpcRecords(this.values);\n            case 2:\n              this.events.emit(C.sync);\n            case 3:\n            case \"end\":\n              return _context105.stop();\n          }\n        }, _callee105, this);\n      }));\n      function persist() {\n        return _persist5.apply(this, arguments);\n      }\n      return persist;\n    }()\n  }, {\n    key: \"restore\",\n    value: function () {\n      var _restore3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee106() {\n        var e, _c21, t;\n        return _regeneratorRuntime().wrap(function _callee106$(_context106) {\n          while (1) switch (_context106.prev = _context106.next) {\n            case 0:\n              _context106.prev = 0;\n              _context106.next = 3;\n              return this.getJsonRpcRecords();\n            case 3:\n              e = _context106.sent;\n              if (!(typeof e > \"u\" || !e.length)) {\n                _context106.next = 6;\n                break;\n              }\n              return _context106.abrupt(\"return\");\n            case 6:\n              if (!this.records.size) {\n                _context106.next = 9;\n                break;\n              }\n              _c21 = c(\"RESTORE_WILL_OVERRIDE\", this.name), t = _c21.message;\n              throw this.logger.error(t), new Error(t);\n            case 9:\n              this.cached = e, this.logger.debug(\"Successfully Restored records for \".concat(this.name)), this.logger.trace({\n                type: \"method\",\n                method: \"restore\",\n                records: this.values\n              });\n              _context106.next = 15;\n              break;\n            case 12:\n              _context106.prev = 12;\n              _context106.t0 = _context106[\"catch\"](0);\n              this.logger.debug(\"Failed to Restore records for \".concat(this.name)), this.logger.error(_context106.t0);\n            case 15:\n            case \"end\":\n              return _context106.stop();\n          }\n        }, _callee106, this, [[0, 12]]);\n      }));\n      function restore() {\n        return _restore3.apply(this, arguments);\n      }\n      return restore;\n    }()\n  }, {\n    key: \"registerEventListeners\",\n    value: function registerEventListeners() {\n      var _this26 = this;\n      this.events.on(C.created, function (e) {\n        var t = C.created;\n        _this26.logger.info(\"Emitting \".concat(t)), _this26.logger.debug({\n          type: \"event\",\n          event: t,\n          record: e\n        }), _this26.persist();\n      }), this.events.on(C.updated, function (e) {\n        var t = C.updated;\n        _this26.logger.info(\"Emitting \".concat(t)), _this26.logger.debug({\n          type: \"event\",\n          event: t,\n          record: e\n        }), _this26.persist();\n      }), this.events.on(C.deleted, function (e) {\n        var t = C.deleted;\n        _this26.logger.info(\"Emitting \".concat(t)), _this26.logger.debug({\n          type: \"event\",\n          event: t,\n          record: e\n        }), _this26.persist();\n      });\n    }\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c22 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c22.message;\n        throw new Error(e);\n      }\n    }\n  }]);\n  return Rt;\n}($t);\nvar St = /*#__PURE__*/function (_Kt) {\n  _inherits(St, _Kt);\n  var _super7 = _createSuper(St);\n  function St(e, t) {\n    var _this27;\n    _classCallCheck(this, St);\n    _this27 = _super7.call(this, e, t), _this27.core = e, _this27.logger = t, _this27.expirations = new Map(), _this27.events = new A(), _this27.name = ut, _this27.version = lt, _this27.cached = [], _this27.initialized = !1, _this27.storagePrefix = P, _this27.init = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee107() {\n      return _regeneratorRuntime().wrap(function _callee107$(_context107) {\n        while (1) switch (_context107.prev = _context107.next) {\n          case 0:\n            _context107.t0 = _this27.initialized;\n            if (_context107.t0) {\n              _context107.next = 9;\n              break;\n            }\n            _this27.logger.trace(\"Initialized\");\n            _context107.next = 5;\n            return _this27.restore();\n          case 5:\n            _this27.cached.forEach(function (i) {\n              return _this27.expirations.set(i.target, i);\n            });\n            _this27.cached = [];\n            _this27.registerEventListeners();\n            _this27.initialized = !0;\n          case 9:\n          case \"end\":\n            return _context107.stop();\n        }\n      }, _callee107);\n    })), _this27.has = function (i) {\n      try {\n        var s = _this27.formatTarget(i);\n        return typeof _this27.getExpiration(s) < \"u\";\n      } catch (_unused6) {\n        return !1;\n      }\n    }, _this27.set = function (i, s) {\n      _this27.isInitialized();\n      var n = _this27.formatTarget(i),\n        a = {\n          target: n,\n          expiry: s\n        };\n      _this27.expirations.set(n, a), _this27.checkExpiry(n, a), _this27.events.emit(m.created, {\n        target: n,\n        expiration: a\n      });\n    }, _this27.get = function (i) {\n      _this27.isInitialized();\n      var s = _this27.formatTarget(i);\n      return _this27.getExpiration(s);\n    }, _this27.del = function (i) {\n      if (_this27.isInitialized(), _this27.has(i)) {\n        var s = _this27.formatTarget(i),\n          n = _this27.getExpiration(s);\n        _this27.expirations.delete(s), _this27.events.emit(m.deleted, {\n          target: s,\n          expiration: n\n        });\n      }\n    }, _this27.on = function (i, s) {\n      _this27.events.on(i, s);\n    }, _this27.once = function (i, s) {\n      _this27.events.once(i, s);\n    }, _this27.off = function (i, s) {\n      _this27.events.off(i, s);\n    }, _this27.removeListener = function (i, s) {\n      _this27.events.removeListener(i, s);\n    }, _this27.logger = w(t, _this27.name);\n    return _this27;\n  }\n  _createClass(St, [{\n    key: \"context\",\n    get: function get() {\n      return v(this.logger);\n    }\n  }, {\n    key: \"storageKey\",\n    get: function get() {\n      return this.storagePrefix + this.version + \"//\" + this.name;\n    }\n  }, {\n    key: \"length\",\n    get: function get() {\n      return this.expirations.size;\n    }\n  }, {\n    key: \"keys\",\n    get: function get() {\n      return Array.from(this.expirations.keys());\n    }\n  }, {\n    key: \"values\",\n    get: function get() {\n      return Array.from(this.expirations.values());\n    }\n  }, {\n    key: \"formatTarget\",\n    value: function formatTarget(e) {\n      if (typeof e == \"string\") return ui(e);\n      if (typeof e == \"number\") return li(e);\n      var _c23 = c(\"UNKNOWN_TYPE\", \"Target type: \".concat(typeof e)),\n        t = _c23.message;\n      throw new Error(t);\n    }\n  }, {\n    key: \"setExpirations\",\n    value: function () {\n      var _setExpirations = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee108(e) {\n        return _regeneratorRuntime().wrap(function _callee108$(_context108) {\n          while (1) switch (_context108.prev = _context108.next) {\n            case 0:\n              _context108.next = 2;\n              return this.core.storage.setItem(this.storageKey, e);\n            case 2:\n            case \"end\":\n              return _context108.stop();\n          }\n        }, _callee108, this);\n      }));\n      function setExpirations(_x108) {\n        return _setExpirations.apply(this, arguments);\n      }\n      return setExpirations;\n    }()\n  }, {\n    key: \"getExpirations\",\n    value: function () {\n      var _getExpirations = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee109() {\n        return _regeneratorRuntime().wrap(function _callee109$(_context109) {\n          while (1) switch (_context109.prev = _context109.next) {\n            case 0:\n              _context109.next = 2;\n              return this.core.storage.getItem(this.storageKey);\n            case 2:\n              return _context109.abrupt(\"return\", _context109.sent);\n            case 3:\n            case \"end\":\n              return _context109.stop();\n          }\n        }, _callee109, this);\n      }));\n      function getExpirations() {\n        return _getExpirations.apply(this, arguments);\n      }\n      return getExpirations;\n    }()\n  }, {\n    key: \"persist\",\n    value: function () {\n      var _persist6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee110() {\n        return _regeneratorRuntime().wrap(function _callee110$(_context110) {\n          while (1) switch (_context110.prev = _context110.next) {\n            case 0:\n              _context110.next = 2;\n              return this.setExpirations(this.values);\n            case 2:\n              this.events.emit(m.sync);\n            case 3:\n            case \"end\":\n              return _context110.stop();\n          }\n        }, _callee110, this);\n      }));\n      function persist() {\n        return _persist6.apply(this, arguments);\n      }\n      return persist;\n    }()\n  }, {\n    key: \"restore\",\n    value: function () {\n      var _restore4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee111() {\n        var e, _c24, t;\n        return _regeneratorRuntime().wrap(function _callee111$(_context111) {\n          while (1) switch (_context111.prev = _context111.next) {\n            case 0:\n              _context111.prev = 0;\n              _context111.next = 3;\n              return this.getExpirations();\n            case 3:\n              e = _context111.sent;\n              if (!(typeof e > \"u\" || !e.length)) {\n                _context111.next = 6;\n                break;\n              }\n              return _context111.abrupt(\"return\");\n            case 6:\n              if (!this.expirations.size) {\n                _context111.next = 9;\n                break;\n              }\n              _c24 = c(\"RESTORE_WILL_OVERRIDE\", this.name), t = _c24.message;\n              throw this.logger.error(t), new Error(t);\n            case 9:\n              this.cached = e, this.logger.debug(\"Successfully Restored expirations for \".concat(this.name)), this.logger.trace({\n                type: \"method\",\n                method: \"restore\",\n                expirations: this.values\n              });\n              _context111.next = 15;\n              break;\n            case 12:\n              _context111.prev = 12;\n              _context111.t0 = _context111[\"catch\"](0);\n              this.logger.debug(\"Failed to Restore expirations for \".concat(this.name)), this.logger.error(_context111.t0);\n            case 15:\n            case \"end\":\n              return _context111.stop();\n          }\n        }, _callee111, this, [[0, 12]]);\n      }));\n      function restore() {\n        return _restore4.apply(this, arguments);\n      }\n      return restore;\n    }()\n  }, {\n    key: \"getExpiration\",\n    value: function getExpiration(e) {\n      var t = this.expirations.get(e);\n      if (!t) {\n        var _c25 = c(\"NO_MATCHING_KEY\", \"\".concat(this.name, \": \").concat(e)),\n          i = _c25.message;\n        throw this.logger.error(i), new Error(i);\n      }\n      return t;\n    }\n  }, {\n    key: \"checkExpiry\",\n    value: function checkExpiry(e, t) {\n      var i = t.expiry;\n      be(i) - Date.now() <= 0 && this.expire(e, t);\n    }\n  }, {\n    key: \"expire\",\n    value: function expire(e, t) {\n      this.expirations.delete(e), this.events.emit(m.expired, {\n        target: e,\n        expiration: t\n      });\n    }\n  }, {\n    key: \"checkExpirations\",\n    value: function checkExpirations() {\n      var _this28 = this;\n      this.core.relayer.connected && this.expirations.forEach(function (e, t) {\n        return _this28.checkExpiry(t, e);\n      });\n    }\n  }, {\n    key: \"registerEventListeners\",\n    value: function registerEventListeners() {\n      var _this29 = this;\n      this.core.heartbeat.on(H.pulse, function () {\n        return _this29.checkExpirations();\n      }), this.events.on(m.created, function (e) {\n        var t = m.created;\n        _this29.logger.info(\"Emitting \".concat(t)), _this29.logger.debug({\n          type: \"event\",\n          event: t,\n          data: e\n        }), _this29.persist();\n      }), this.events.on(m.expired, function (e) {\n        var t = m.expired;\n        _this29.logger.info(\"Emitting \".concat(t)), _this29.logger.debug({\n          type: \"event\",\n          event: t,\n          data: e\n        }), _this29.persist();\n      }), this.events.on(m.deleted, function (e) {\n        var t = m.deleted;\n        _this29.logger.info(\"Emitting \".concat(t)), _this29.logger.debug({\n          type: \"event\",\n          event: t,\n          data: e\n        }), _this29.persist();\n      });\n    }\n  }, {\n    key: \"isInitialized\",\n    value: function isInitialized() {\n      if (!this.initialized) {\n        var _c26 = c(\"NOT_INITIALIZED\", this.name),\n          e = _c26.message;\n        throw new Error(e);\n      }\n    }\n  }]);\n  return St;\n}(Kt);\nvar ur = Object.defineProperty,\n  Tt = Object.getOwnPropertySymbols,\n  lr = Object.prototype.hasOwnProperty,\n  dr = Object.prototype.propertyIsEnumerable,\n  Pt = function Pt(r, e, t) {\n    return e in r ? ur(r, e, {\n      enumerable: !0,\n      configurable: !0,\n      writable: !0,\n      value: t\n    }) : r[e] = t;\n  },\n  xt = function xt(r, e) {\n    for (var t in e || (e = {})) lr.call(e, t) && Pt(r, t, e[t]);\n    if (Tt) {\n      var _iterator5 = _createForOfIteratorHelper(Tt(e)),\n        _step5;\n      try {\n        for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n          var t = _step5.value;\n          dr.call(e, t) && Pt(r, t, e[t]);\n        }\n      } catch (err) {\n        _iterator5.e(err);\n      } finally {\n        _iterator5.f();\n      }\n    }\n    return r;\n  };\nvar Y = /*#__PURE__*/function (_kt) {\n  _inherits(Y, _kt);\n  var _super8 = _createSuper(Y);\n  function Y(e) {\n    var _this30;\n    _classCallCheck(this, Y);\n    _this30 = _super8.call(this, e), _this30.protocol = ae, _this30.version = $e, _this30.name = G, _this30.events = new A(), _this30.initialized = !1, _this30.on = function (i, s) {\n      return _this30.events.on(i, s);\n    }, _this30.once = function (i, s) {\n      return _this30.events.once(i, s);\n    }, _this30.off = function (i, s) {\n      return _this30.events.off(i, s);\n    }, _this30.removeListener = function (i, s) {\n      return _this30.events.removeListener(i, s);\n    }, _this30.projectId = e === null || e === void 0 ? void 0 : e.projectId, _this30.relayUrl = (e === null || e === void 0 ? void 0 : e.relayUrl) || he;\n    var t = typeof (e === null || e === void 0 ? void 0 : e.logger) < \"u\" && typeof (e === null || e === void 0 ? void 0 : e.logger) != \"string\" ? e.logger : ue(le({\n      level: (e === null || e === void 0 ? void 0 : e.logger) || Ke.logger\n    }));\n    _this30.logger = w(t, _this30.name), _this30.heartbeat = new zt(), _this30.crypto = new gt(_assertThisInitialized(_this30), _this30.logger, e === null || e === void 0 ? void 0 : e.keychain), _this30.history = new Rt(_assertThisInitialized(_this30), _this30.logger), _this30.expirer = new St(_assertThisInitialized(_this30), _this30.logger), _this30.storage = e != null && e.storage ? e.storage : new At(xt(xt({}, ke), e === null || e === void 0 ? void 0 : e.storageOptions)), _this30.relayer = new ft({\n      core: _assertThisInitialized(_this30),\n      logger: _this30.logger,\n      relayUrl: _this30.relayUrl,\n      projectId: _this30.projectId\n    }), _this30.pairing = new _t(_assertThisInitialized(_this30), _this30.logger);\n    return _this30;\n  }\n  _createClass(Y, [{\n    key: \"context\",\n    get: function get() {\n      return v(this.logger);\n    }\n  }, {\n    key: \"start\",\n    value: function () {\n      var _start = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee112() {\n        return _regeneratorRuntime().wrap(function _callee112$(_context112) {\n          while (1) switch (_context112.prev = _context112.next) {\n            case 0:\n              _context112.t0 = this.initialized;\n              if (_context112.t0) {\n                _context112.next = 4;\n                break;\n              }\n              _context112.next = 4;\n              return this.initialize();\n            case 4:\n            case \"end\":\n              return _context112.stop();\n          }\n        }, _callee112, this);\n      }));\n      function start() {\n        return _start.apply(this, arguments);\n      }\n      return start;\n    }()\n  }, {\n    key: \"initialize\",\n    value: function () {\n      var _initialize = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee113() {\n        return _regeneratorRuntime().wrap(function _callee113$(_context113) {\n          while (1) switch (_context113.prev = _context113.next) {\n            case 0:\n              this.logger.trace(\"Initialized\");\n              _context113.prev = 1;\n              _context113.next = 4;\n              return this.crypto.init();\n            case 4:\n              _context113.next = 6;\n              return this.history.init();\n            case 6:\n              _context113.next = 8;\n              return this.expirer.init();\n            case 8:\n              _context113.next = 10;\n              return this.relayer.init();\n            case 10:\n              _context113.next = 12;\n              return this.heartbeat.init();\n            case 12:\n              _context113.next = 14;\n              return this.pairing.init();\n            case 14:\n              this.initialized = !0;\n              this.logger.info(\"Core Initialization Success\");\n              _context113.next = 21;\n              break;\n            case 18:\n              _context113.prev = 18;\n              _context113.t0 = _context113[\"catch\"](1);\n              throw this.logger.warn(\"Core Initialization Failure at epoch \".concat(Date.now()), _context113.t0), this.logger.error(_context113.t0.message), _context113.t0;\n            case 21:\n            case \"end\":\n              return _context113.stop();\n          }\n        }, _callee113, this, [[1, 18]]);\n      }));\n      function initialize() {\n        return _initialize.apply(this, arguments);\n      }\n      return initialize;\n    }()\n  }], [{\n    key: \"init\",\n    value: function () {\n      var _init2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee114(e) {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee114$(_context114) {\n          while (1) switch (_context114.prev = _context114.next) {\n            case 0:\n              t = new Y(e);\n              _context114.next = 3;\n              return t.initialize();\n            case 3:\n              return _context114.abrupt(\"return\", t);\n            case 4:\n            case \"end\":\n              return _context114.stop();\n          }\n        }, _callee114);\n      }));\n      function init(_x109) {\n        return _init2.apply(this, arguments);\n      }\n      return init;\n    }()\n  }]);\n  return Y;\n}(kt);\nvar gr = Y;\nexport { G as CORE_CONTEXT, Ke as CORE_DEFAULT, ae as CORE_PROTOCOL, ke as CORE_STORAGE_OPTIONS, P as CORE_STORAGE_PREFIX, $e as CORE_VERSION, oe as CRYPTO_CLIENT_SEED, Be as CRYPTO_CONTEXT, je as CRYPTO_JWT_TTL, gr as Core, gt as Crypto, ut as EXPIRER_CONTEXT, Hs as EXPIRER_DEFAULT_TTL, m as EXPIRER_EVENTS, lt as EXPIRER_STORAGE_VERSION, St as Expirer, ht as HISTORY_CONTEXT, C as HISTORY_EVENTS, ct as HISTORY_STORAGE_VERSION, Rt as JsonRpcHistory, Ve as KEYCHAIN_CONTEXT, qe as KEYCHAIN_STORAGE_VERSION, dt as KeyChain, Ge as MESSAGES_CONTEXT, Ye as MESSAGES_STORAGE_VERSION, pt as MessageTracker, at as PAIRING_CONTEXT, Js as PAIRING_DEFAULT_TTL, N as PAIRING_RPC_OPTS, ot as PAIRING_STORAGE_VERSION, nt as PENDING_SUB_RESOLUTION_TIMEOUT, He as PUBLISHER_CONTEXT, Je as PUBLISHER_DEFAULT_TTL, _t as Pairing, Ze as RELAYER_CONTEXT, We as RELAYER_DEFAULT_LOGGER, Xe as RELAYER_DEFAULT_PROTOCOL, he as RELAYER_DEFAULT_RELAY_URL, D as RELAYER_EVENTS, M as RELAYER_PROVIDER_EVENTS, et as RELAYER_RECONNECT_TIMEOUT, tt as RELAYER_SDK_VERSION, Gs as RELAYER_STORAGE_OPTIONS, Qe as RELAYER_SUBSCRIBER_SUFFIX, ft as Relayer, it as STORE_STORAGE_VERSION, st as SUBSCRIBER_CONTEXT, Ys as SUBSCRIBER_DEFAULT_TTL, I as SUBSCRIBER_EVENTS, rt as SUBSCRIBER_STORAGE_VERSION, Ct as Store, bt as Subscriber, Y as default };","map":{"version":3,"sources":[],"names":[],"mappings":"","sourcesContent":["import Ot,{EventEmitter as A}from\"events\";import ue from\"pino\";import At from\"@walletconnect/keyvaluestorage\";import{HEARTBEAT_EVENTS as H,HeartBeat as zt}from\"@walletconnect/heartbeat\";import{generateChildLogger as w,getLoggerContext as v,getDefaultLoggerOptions as le}from\"@walletconnect/logger\";import{IMessageTracker as Nt,IPublisher as Ut,ISubscriber as Lt,IRelayer as Ft,IStore as Mt,IJsonRpcHistory as $t,IExpirer as Kt,ICore as kt}from\"@walletconnect/types\";import{safeJsonStringify as Bt,safeJsonParse as jt}from\"@walletconnect/safe-json\";import*as k from\"@walletconnect/relay-auth\";import{getInternalError as c,mapToObj as de,objToMap as ge,generateKeyPair as Vt,generateRandomBytes32 as X,deriveSymKey as qt,hashKey as Gt,validateEncoding as Yt,isTypeOneEnvelope as pe,encrypt as Jt,validateDecoding as Ht,decrypt as Xt,deserialize as Wt,decodeTypeByte as Zt,hashMessage as B,getRelayProtocolName as W,createExpiringPromise as j,getRelayProtocolApi as V,isUndefined as Z,getSdkError as L,isValidArray as Qt,formatRelayRpcUrl as ei,isProposalStruct as ti,isSessionStruct as ii,TYPE_1 as si,calcExpiry as Q,formatUri as ri,parseUri as ni,createDelayedPromise as ai,engineEvent as ee,isExpired as De,isValidParams as te,isValidUrl as oi,isValidString as hi,parseExpirerTarget as ci,formatTopicTarget as ui,formatIdTarget as li}from\"@walletconnect/utils\";import{ONE_DAY as z,SIX_HOURS as di,ONE_SECOND as gi,THIRTY_DAYS as ie,FIVE_SECONDS as pi,THIRTY_SECONDS as ye,Watch as Di,toMiliseconds as be,FIVE_MINUTES as me}from\"@walletconnect/time\";import{JsonRpcProvider as yi}from\"@walletconnect/jsonrpc-provider\";import{isJsonRpcRequest as Ee,formatJsonRpcResult as fe,formatJsonRpcRequest as we,formatJsonRpcError as bi,isJsonRpcResult as mi,isJsonRpcError as ve,isJsonRpcResponse as Ei}from\"@walletconnect/jsonrpc-utils\";import fi from\"@walletconnect/jsonrpc-ws-connection\";import wi from\"lodash.isequal\";function vi(r,e){if(r.length>=255)throw new TypeError(\"Alphabet too long\");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var s=0;s<r.length;s++){var n=r.charAt(s),a=n.charCodeAt(0);if(t[a]!==255)throw new TypeError(n+\" is ambiguous\");t[a]=s}var o=r.length,h=r.charAt(0),d=Math.log(o)/Math.log(256),l=Math.log(256)/Math.log(o);function g(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError(\"Expected Uint8Array\");if(u.length===0)return\"\";for(var y=0,O=0,E=0,_=u.length;E!==_&&u[E]===0;)E++,y++;for(var R=(_-E)*l+1>>>0,b=new Uint8Array(R);E!==_;){for(var S=u[E],x=0,f=R-1;(S!==0||x<O)&&f!==-1;f--,x++)S+=256*b[f]>>>0,b[f]=S%o>>>0,S=S/o>>>0;if(S!==0)throw new Error(\"Non-zero carry\");O=x,E++}for(var T=R-O;T!==R&&b[T]===0;)T++;for(var K=h.repeat(y);T<R;++T)K+=r.charAt(b[T]);return K}function U(u){if(typeof u!=\"string\")throw new TypeError(\"Expected String\");if(u.length===0)return new Uint8Array;var y=0;if(u[y]!==\" \"){for(var O=0,E=0;u[y]===h;)O++,y++;for(var _=(u.length-y)*d+1>>>0,R=new Uint8Array(_);u[y];){var b=t[u.charCodeAt(y)];if(b===255)return;for(var S=0,x=_-1;(b!==0||S<E)&&x!==-1;x--,S++)b+=o*R[x]>>>0,R[x]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error(\"Non-zero carry\");E=S,y++}if(u[y]!==\" \"){for(var f=_-E;f!==_&&R[f]===0;)f++;for(var T=new Uint8Array(O+(_-f)),K=O;f!==_;)T[K++]=R[f++];return T}}}function J(u){var y=U(u);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:g,decodeUnsafe:U,decode:J}}var Ii=vi,Ci=Ii;const Ie=r=>{if(r instanceof Uint8Array&&r.constructor.name===\"Uint8Array\")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error(\"Unknown type, must be binary type\")},_i=r=>new TextEncoder().encode(r),Ri=r=>new TextDecoder().decode(r);class Si{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error(\"Unknown type, must be binary type\")}}class Ti{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error(\"Invalid prefix character\");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e==\"string\"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error(\"Can only multibase decode strings\")}or(e){return Ce(this,e)}}class Pi{constructor(e){this.decoders=e}or(e){return Ce(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ce=(r,e)=>new Pi({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class xi{constructor(e,t,i,s){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=s,this.encoder=new Si(e,t,i),this.decoder=new Ti(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const q=({name:r,prefix:e,encode:t,decode:i})=>new xi(r,e,t,i),F=({prefix:r,name:e,alphabet:t})=>{const{encode:i,decode:s}=Ci(t,e);return q({prefix:r,name:e,encode:i,decode:n=>Ie(s(n))})},Oi=(r,e,t,i)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let n=r.length;for(;r[n-1]===\"=\";)--n;const a=new Uint8Array(n*t/8|0);let o=0,h=0,d=0;for(let l=0;l<n;++l){const g=s[r[l]];if(g===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<t|g,o+=t,o>=8&&(o-=8,a[d++]=255&h>>o)}if(o>=t||255&h<<8-o)throw new SyntaxError(\"Unexpected end of data\");return a},Ai=(r,e,t)=>{const i=e[e.length-1]===\"=\",s=(1<<t)-1;let n=\"\",a=0,o=0;for(let h=0;h<r.length;++h)for(o=o<<8|r[h],a+=8;a>t;)a-=t,n+=e[s&o>>a];if(a&&(n+=e[s&o<<t-a]),i)for(;n.length*t&7;)n+=\"=\";return n},p=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>q({prefix:e,name:r,encode(s){return Ai(s,i,t)},decode(s){return Oi(s,i,t,r)}}),zi=q({prefix:\"\\0\",name:\"identity\",encode:r=>Ri(r),decode:r=>_i(r)});var Ni=Object.freeze({__proto__:null,identity:zi});const Ui=p({prefix:\"0\",name:\"base2\",alphabet:\"01\",bitsPerChar:1});var Li=Object.freeze({__proto__:null,base2:Ui});const Fi=p({prefix:\"7\",name:\"base8\",alphabet:\"01234567\",bitsPerChar:3});var Mi=Object.freeze({__proto__:null,base8:Fi});const $i=F({prefix:\"9\",name:\"base10\",alphabet:\"0123456789\"});var Ki=Object.freeze({__proto__:null,base10:$i});const ki=p({prefix:\"f\",name:\"base16\",alphabet:\"0123456789abcdef\",bitsPerChar:4}),Bi=p({prefix:\"F\",name:\"base16upper\",alphabet:\"0123456789ABCDEF\",bitsPerChar:4});var ji=Object.freeze({__proto__:null,base16:ki,base16upper:Bi});const Vi=p({prefix:\"b\",name:\"base32\",alphabet:\"abcdefghijklmnopqrstuvwxyz234567\",bitsPerChar:5}),qi=p({prefix:\"B\",name:\"base32upper\",alphabet:\"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\",bitsPerChar:5}),Gi=p({prefix:\"c\",name:\"base32pad\",alphabet:\"abcdefghijklmnopqrstuvwxyz234567=\",bitsPerChar:5}),Yi=p({prefix:\"C\",name:\"base32padupper\",alphabet:\"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=\",bitsPerChar:5}),Ji=p({prefix:\"v\",name:\"base32hex\",alphabet:\"0123456789abcdefghijklmnopqrstuv\",bitsPerChar:5}),Hi=p({prefix:\"V\",name:\"base32hexupper\",alphabet:\"0123456789ABCDEFGHIJKLMNOPQRSTUV\",bitsPerChar:5}),Xi=p({prefix:\"t\",name:\"base32hexpad\",alphabet:\"0123456789abcdefghijklmnopqrstuv=\",bitsPerChar:5}),Wi=p({prefix:\"T\",name:\"base32hexpadupper\",alphabet:\"0123456789ABCDEFGHIJKLMNOPQRSTUV=\",bitsPerChar:5}),Zi=p({prefix:\"h\",name:\"base32z\",alphabet:\"ybndrfg8ejkmcpqxot1uwisza345h769\",bitsPerChar:5});var Qi=Object.freeze({__proto__:null,base32:Vi,base32upper:qi,base32pad:Gi,base32padupper:Yi,base32hex:Ji,base32hexupper:Hi,base32hexpad:Xi,base32hexpadupper:Wi,base32z:Zi});const es=F({prefix:\"k\",name:\"base36\",alphabet:\"0123456789abcdefghijklmnopqrstuvwxyz\"}),ts=F({prefix:\"K\",name:\"base36upper\",alphabet:\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\"});var is=Object.freeze({__proto__:null,base36:es,base36upper:ts});const ss=F({name:\"base58btc\",prefix:\"z\",alphabet:\"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz\"}),rs=F({name:\"base58flickr\",prefix:\"Z\",alphabet:\"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ\"});var ns=Object.freeze({__proto__:null,base58btc:ss,base58flickr:rs});const as=p({prefix:\"m\",name:\"base64\",alphabet:\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",bitsPerChar:6}),os=p({prefix:\"M\",name:\"base64pad\",alphabet:\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",bitsPerChar:6}),hs=p({prefix:\"u\",name:\"base64url\",alphabet:\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_\",bitsPerChar:6}),cs=p({prefix:\"U\",name:\"base64urlpad\",alphabet:\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=\",bitsPerChar:6});var us=Object.freeze({__proto__:null,base64:as,base64pad:os,base64url:hs,base64urlpad:cs});const _e=Array.from(\"\\u{1F680}\\u{1FA90}\\u2604\\u{1F6F0}\\u{1F30C}\\u{1F311}\\u{1F312}\\u{1F313}\\u{1F314}\\u{1F315}\\u{1F316}\\u{1F317}\\u{1F318}\\u{1F30D}\\u{1F30F}\\u{1F30E}\\u{1F409}\\u2600\\u{1F4BB}\\u{1F5A5}\\u{1F4BE}\\u{1F4BF}\\u{1F602}\\u2764\\u{1F60D}\\u{1F923}\\u{1F60A}\\u{1F64F}\\u{1F495}\\u{1F62D}\\u{1F618}\\u{1F44D}\\u{1F605}\\u{1F44F}\\u{1F601}\\u{1F525}\\u{1F970}\\u{1F494}\\u{1F496}\\u{1F499}\\u{1F622}\\u{1F914}\\u{1F606}\\u{1F644}\\u{1F4AA}\\u{1F609}\\u263A\\u{1F44C}\\u{1F917}\\u{1F49C}\\u{1F614}\\u{1F60E}\\u{1F607}\\u{1F339}\\u{1F926}\\u{1F389}\\u{1F49E}\\u270C\\u2728\\u{1F937}\\u{1F631}\\u{1F60C}\\u{1F338}\\u{1F64C}\\u{1F60B}\\u{1F497}\\u{1F49A}\\u{1F60F}\\u{1F49B}\\u{1F642}\\u{1F493}\\u{1F929}\\u{1F604}\\u{1F600}\\u{1F5A4}\\u{1F603}\\u{1F4AF}\\u{1F648}\\u{1F447}\\u{1F3B6}\\u{1F612}\\u{1F92D}\\u2763\\u{1F61C}\\u{1F48B}\\u{1F440}\\u{1F62A}\\u{1F611}\\u{1F4A5}\\u{1F64B}\\u{1F61E}\\u{1F629}\\u{1F621}\\u{1F92A}\\u{1F44A}\\u{1F973}\\u{1F625}\\u{1F924}\\u{1F449}\\u{1F483}\\u{1F633}\\u270B\\u{1F61A}\\u{1F61D}\\u{1F634}\\u{1F31F}\\u{1F62C}\\u{1F643}\\u{1F340}\\u{1F337}\\u{1F63B}\\u{1F613}\\u2B50\\u2705\\u{1F97A}\\u{1F308}\\u{1F608}\\u{1F918}\\u{1F4A6}\\u2714\\u{1F623}\\u{1F3C3}\\u{1F490}\\u2639\\u{1F38A}\\u{1F498}\\u{1F620}\\u261D\\u{1F615}\\u{1F33A}\\u{1F382}\\u{1F33B}\\u{1F610}\\u{1F595}\\u{1F49D}\\u{1F64A}\\u{1F639}\\u{1F5E3}\\u{1F4AB}\\u{1F480}\\u{1F451}\\u{1F3B5}\\u{1F91E}\\u{1F61B}\\u{1F534}\\u{1F624}\\u{1F33C}\\u{1F62B}\\u26BD\\u{1F919}\\u2615\\u{1F3C6}\\u{1F92B}\\u{1F448}\\u{1F62E}\\u{1F646}\\u{1F37B}\\u{1F343}\\u{1F436}\\u{1F481}\\u{1F632}\\u{1F33F}\\u{1F9E1}\\u{1F381}\\u26A1\\u{1F31E}\\u{1F388}\\u274C\\u270A\\u{1F44B}\\u{1F630}\\u{1F928}\\u{1F636}\\u{1F91D}\\u{1F6B6}\\u{1F4B0}\\u{1F353}\\u{1F4A2}\\u{1F91F}\\u{1F641}\\u{1F6A8}\\u{1F4A8}\\u{1F92C}\\u2708\\u{1F380}\\u{1F37A}\\u{1F913}\\u{1F619}\\u{1F49F}\\u{1F331}\\u{1F616}\\u{1F476}\\u{1F974}\\u25B6\\u27A1\\u2753\\u{1F48E}\\u{1F4B8}\\u2B07\\u{1F628}\\u{1F31A}\\u{1F98B}\\u{1F637}\\u{1F57A}\\u26A0\\u{1F645}\\u{1F61F}\\u{1F635}\\u{1F44E}\\u{1F932}\\u{1F920}\\u{1F927}\\u{1F4CC}\\u{1F535}\\u{1F485}\\u{1F9D0}\\u{1F43E}\\u{1F352}\\u{1F617}\\u{1F911}\\u{1F30A}\\u{1F92F}\\u{1F437}\\u260E\\u{1F4A7}\\u{1F62F}\\u{1F486}\\u{1F446}\\u{1F3A4}\\u{1F647}\\u{1F351}\\u2744\\u{1F334}\\u{1F4A3}\\u{1F438}\\u{1F48C}\\u{1F4CD}\\u{1F940}\\u{1F922}\\u{1F445}\\u{1F4A1}\\u{1F4A9}\\u{1F450}\\u{1F4F8}\\u{1F47B}\\u{1F910}\\u{1F92E}\\u{1F3BC}\\u{1F975}\\u{1F6A9}\\u{1F34E}\\u{1F34A}\\u{1F47C}\\u{1F48D}\\u{1F4E3}\\u{1F942}\"),ls=_e.reduce((r,e,t)=>(r[t]=e,r),[]),ds=_e.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function gs(r){return r.reduce((e,t)=>(e+=ls[t],e),\"\")}function ps(r){const e=[];for(const t of r){const i=ds[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Ds=q({prefix:\"\\u{1F680}\",name:\"base256emoji\",encode:gs,decode:ps});var ys=Object.freeze({__proto__:null,base256emoji:Ds}),bs=Se,Re=128,ms=127,Es=~ms,fs=Math.pow(2,31);function Se(r,e,t){e=e||[],t=t||0;for(var i=t;r>=fs;)e[t++]=r&255|Re,r/=128;for(;r&Es;)e[t++]=r&255|Re,r>>>=7;return e[t]=r|0,Se.bytes=t-i+1,e}var ws=se,vs=128,Te=127;function se(r,i){var t=0,i=i||0,s=0,n=i,a,o=r.length;do{if(n>=o)throw se.bytes=0,new RangeError(\"Could not decode varint\");a=r[n++],t+=s<28?(a&Te)<<s:(a&Te)*Math.pow(2,s),s+=7}while(a>=vs);return se.bytes=n-i,t}var Is=Math.pow(2,7),Cs=Math.pow(2,14),_s=Math.pow(2,21),Rs=Math.pow(2,28),Ss=Math.pow(2,35),Ts=Math.pow(2,42),Ps=Math.pow(2,49),xs=Math.pow(2,56),Os=Math.pow(2,63),As=function(r){return r<Is?1:r<Cs?2:r<_s?3:r<Rs?4:r<Ss?5:r<Ts?6:r<Ps?7:r<xs?8:r<Os?9:10},zs={encode:bs,decode:ws,encodingLength:As},Pe=zs;const xe=(r,e,t=0)=>(Pe.encode(r,e,t),e),Oe=r=>Pe.encodingLength(r),re=(r,e)=>{const t=e.byteLength,i=Oe(r),s=i+Oe(t),n=new Uint8Array(s+t);return xe(r,n,0),xe(t,n,i),n.set(e,s),new Ns(r,t,e,n)};class Ns{constructor(e,t,i,s){this.code=e,this.size=t,this.digest=i,this.bytes=s}}const Ae=({name:r,code:e,encode:t})=>new Us(r,e,t);class Us{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?re(this.code,t):t.then(i=>re(this.code,i))}else throw Error(\"Unknown type, must be binary type\")}}const ze=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Ls=Ae({name:\"sha2-256\",code:18,encode:ze(\"SHA-256\")}),Fs=Ae({name:\"sha2-512\",code:19,encode:ze(\"SHA-512\")});var Ms=Object.freeze({__proto__:null,sha256:Ls,sha512:Fs});const Ne=0,$s=\"identity\",Ue=Ie,Ks=r=>re(Ne,Ue(r)),ks={code:Ne,name:$s,encode:Ue,digest:Ks};var Bs=Object.freeze({__proto__:null,identity:ks});new TextEncoder,new TextDecoder;const Le={...Ni,...Li,...Mi,...Ki,...ji,...Qi,...is,...ns,...us,...ys};({...Ms,...Bs});function js(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(r):new Uint8Array(r)}function Fe(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}const Me=Fe(\"utf8\",\"u\",r=>\"u\"+new TextDecoder(\"utf8\").decode(r),r=>new TextEncoder().encode(r.substring(1))),ne=Fe(\"ascii\",\"a\",r=>{let e=\"a\";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=js(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Vs={utf8:Me,\"utf-8\":Me,hex:Le.base16,latin1:ne,ascii:ne,binary:ne,...Le};function qs(r,e=\"utf8\"){const t=Vs[e];if(!t)throw new Error(`Unsupported encoding \"${e}\"`);return(e===\"utf8\"||e===\"utf-8\")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r,\"utf8\"):t.decoder.decode(`${t.prefix}${r}`)}const ae=\"wc\",$e=2,G=\"core\",P=`${ae}@${2}:${G}:`,Ke={name:G,logger:\"error\"},ke={database:\":memory:\"},Be=\"crypto\",oe=\"client_ed25519_seed\",je=z,Ve=\"keychain\",qe=\"0.3\",Ge=\"messages\",Ye=\"0.3\",Je=di,He=\"publisher\",Xe=\"irn\",We=\"error\",he=\"wss://relay.walletconnect.com\",Ze=\"relayer\",D={message:\"relayer_message\",connect:\"relayer_connect\",disconnect:\"relayer_disconnect\",error:\"relayer_error\",connection_stalled:\"relayer_connection_stalled\",transport_closed:\"relayer_transport_closed\",publish:\"relayer_publish\"},Qe=\"_subscription\",M={payload:\"payload\",connect:\"connect\",disconnect:\"disconnect\",error:\"error\"},et=gi,Gs={database:\":memory:\"},tt=\"2.5.2\",it=\"0.3\",I={created:\"subscription_created\",deleted:\"subscription_deleted\",expired:\"subscription_expired\",disabled:\"subscription_disabled\",sync:\"subscription_sync\",resubscribed:\"subscription_resubscribed\"},Ys=ie,st=\"subscription\",rt=\"0.3\",nt=pi*1e3,at=\"pairing\",ot=\"0.3\",Js=ie,N={wc_pairingDelete:{req:{ttl:z,prompt:!1,tag:1e3},res:{ttl:z,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ye,prompt:!1,tag:1002},res:{ttl:ye,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:z,prompt:!1,tag:0},res:{ttl:z,prompt:!1,tag:0}}},C={created:\"history_created\",updated:\"history_updated\",deleted:\"history_deleted\",sync:\"history_sync\"},ht=\"history\",ct=\"0.3\",ut=\"expirer\",m={created:\"expirer_created\",deleted:\"expirer_deleted\",expired:\"expirer_expired\",sync:\"expirer_sync\"},lt=\"0.3\",Hs=z;class dt{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=Ve,this.version=qe,this.initialized=!1,this.storagePrefix=P,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<\"u\"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()},this.get=i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>\"u\"){const{message:n}=c(\"NO_MATCHING_KEY\",`${this.name}: ${i}`);throw new Error(n)}return s},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=w(t,this.name)}get context(){return v(this.logger)}get storageKey(){return this.storagePrefix+this.version+\"//\"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,de(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<\"u\"?ge(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}}class gt{constructor(e,t,i){this.core=e,this.logger=t,this.name=Be,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),n=k.generateKeyPair(s);return k.encodeIss(n.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=Vt();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const n=await this.getClientSeed(),a=k.generateKeyPair(n),o=X(),h=je;return await k.signJWT(o,s,h,a)},this.generateSharedKey=(s,n,a)=>{this.isInitialized();const o=this.getPrivateKey(s),h=qt(o,n);return this.setSymKey(h,a)},this.setSymKey=async(s,n)=>{this.isInitialized();const a=n||Gt(s);return await this.keychain.set(a,s),a},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,n,a)=>{this.isInitialized();const o=Yt(a),h=Bt(n);if(pe(o)){const U=o.senderPublicKey,J=o.receiverPublicKey;s=await this.generateSharedKey(U,J)}const d=this.getSymKey(s),{type:l,senderPublicKey:g}=o;return Jt({type:l,symKey:d,message:h,senderPublicKey:g})},this.decode=async(s,n,a)=>{this.isInitialized();const o=Ht(n,a);if(pe(o)){const l=o.receiverPublicKey,g=o.senderPublicKey;s=await this.generateSharedKey(l,g)}const h=this.getSymKey(s),d=Xt({symKey:h,encoded:n});return jt(d)},this.core=e,this.logger=w(t,this.name),this.keychain=i||new dt(this.core,this.logger)}get context(){return v(this.logger)}getPayloadType(e){const t=Wt(e);return Zt(t.type)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e=\"\";try{e=this.keychain.get(oe)}catch{e=X(),await this.keychain.set(oe,e)}return qs(e,\"base16\")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}}class pt extends Nt{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=Ge,this.version=Ye,this.initialized=!1,this.storagePrefix=P,this.init=async()=>{if(!this.initialized){this.logger.trace(\"Initialized\");try{const i=await this.getRelayerMessages();typeof i<\"u\"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:\"method\",method:\"restore\",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,s)=>{this.isInitialized();const n=B(s);let a=this.messages.get(i);return typeof a>\"u\"&&(a={}),typeof a[n]<\"u\"||(a[n]=s,this.messages.set(i,a),await this.persist()),n},this.get=i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>\"u\"&&(s={}),s},this.has=(i,s)=>{this.isInitialized();const n=this.get(i),a=B(s);return typeof n[a]<\"u\"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=w(e,this.name),this.core=t}get context(){return v(this.logger)}get storageKey(){return this.storagePrefix+this.version+\"//\"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,de(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<\"u\"?ge(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}}class Xs extends Ut{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new A,this.name=He,this.queue=new Map,this.publishTimeout=1e4,this.publish=async(i,s,n)=>{this.logger.debug(\"Publishing Payload\"),this.logger.trace({type:\"method\",method:\"publish\",params:{topic:i,message:s,opts:n}});try{const a=n?.ttl||Je,o=W(n),h=n?.prompt||!1,d=n?.tag||0,l={topic:i,message:s,opts:{ttl:a,relay:o,prompt:h,tag:d}},g=B(s);this.queue.set(g,l);try{await await j(this.rpcPublish(i,s,a,o,h,d),this.publishTimeout),this.relayer.events.emit(D.publish,l)}catch{this.logger.debug(\"Publishing Payload stalled\"),this.relayer.events.emit(D.connection_stalled);return}this.onPublish(g,l),this.logger.debug(\"Successfully Published Payload\"),this.logger.trace({type:\"method\",method:\"publish\",params:{topic:i,message:s,opts:n}})}catch(a){throw this.logger.debug(\"Failed to Publish Payload\"),this.logger.error(a),a}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.relayer=e,this.logger=w(t,this.name),this.registerEventListeners()}get context(){return v(this.logger)}rpcPublish(e,t,i,s,n,a){var o,h,d,l;const g={method:V(s.protocol).publish,params:{topic:e,message:t,ttl:i,prompt:n,tag:a}};return Z((o=g.params)==null?void 0:o.prompt)&&((h=g.params)==null||delete h.prompt),Z((d=g.params)==null?void 0:d.tag)&&((l=g.params)==null||delete l.tag),this.logger.debug(\"Outgoing Relay Payload\"),this.logger.trace({type:\"message\",direction:\"outgoing\",request:g}),this.relayer.request(g)}onPublish(e,t){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:i,opts:s}=e;await this.publish(t,i,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(H.pulse,()=>{this.checkQueue()})}}class Ws{constructor(){this.map=new Map,this.set=(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>\"u\"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const s=i.filter(n=>n!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Zs=Object.defineProperty,Qs=Object.defineProperties,er=Object.getOwnPropertyDescriptors,Dt=Object.getOwnPropertySymbols,tr=Object.prototype.hasOwnProperty,ir=Object.prototype.propertyIsEnumerable,yt=(r,e,t)=>e in r?Zs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$=(r,e)=>{for(var t in e||(e={}))tr.call(e,t)&&yt(r,t,e[t]);if(Dt)for(var t of Dt(e))ir.call(e,t)&&yt(r,t,e[t]);return r},ce=(r,e)=>Qs(r,er(e));class bt extends Lt{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new Ws,this.events=new A,this.name=st,this.version=rt,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel=\"pending_sub_watch_label\",this.pollingInterval=20,this.storagePrefix=P,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace(\"Initialized\"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(i,s)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug(\"Subscribing Topic\"),this.logger.trace({type:\"method\",method:\"subscribe\",params:{topic:i,opts:s}});try{const n=W(s),a={topic:i,relay:n};this.pending.set(i,a);const o=await this.rpcSubscribe(i,n);return this.onSubscribe(o,a),this.logger.debug(\"Successfully Subscribed Topic\"),this.logger.trace({type:\"method\",method:\"subscribe\",params:{topic:i,opts:s}}),o}catch(n){throw this.logger.debug(\"Failed to Subscribe Topic\"),this.logger.error(n),n}},this.unsubscribe=async(i,s)=>{await this.restartToComplete(),this.isInitialized(),typeof s?.id<\"u\"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((s,n)=>{const a=new Di;a.start(this.pendingSubscriptionWatchLabel);const o=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(o),a.stop(this.pendingSubscriptionWatchLabel),s(!0)),a.elapsed(this.pendingSubscriptionWatchLabel)>=nt&&(clearInterval(o),a.stop(this.pendingSubscriptionWatchLabel),n(!1))},this.pollingInterval)}),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=w(t,this.name),this.clientId=\"\"}get context(){return v(this.logger)}get storageKey(){return this.storagePrefix+this.version+\"//\"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,i){this.logger.debug(\"Unsubscribing Topic\"),this.logger.trace({type:\"method\",method:\"unsubscribe\",params:{topic:e,id:t,opts:i}});try{const s=W(i);await this.rpcUnsubscribe(e,t,s);const n=L(\"USER_DISCONNECTED\",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug(\"Successfully Unsubscribed Topic\"),this.logger.trace({type:\"method\",method:\"unsubscribe\",params:{topic:e,id:t,opts:i}})}catch(s){throw this.logger.debug(\"Failed to Unsubscribe Topic\"),this.logger.error(s),s}}async rpcSubscribe(e,t){const i={method:V(t.protocol).subscribe,params:{topic:e}};this.logger.debug(\"Outgoing Relay Payload\"),this.logger.trace({type:\"payload\",direction:\"outgoing\",request:i});try{await await j(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug(\"Outgoing Relay Subscribe Payload stalled\"),this.relayer.events.emit(D.connection_stalled)}return B(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,i={method:V(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug(\"Outgoing Relay Payload\"),this.logger.trace({type:\"payload\",direction:\"outgoing\",request:i});try{return await await j(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug(\"Outgoing Relay Payload stalled\"),this.relayer.events.emit(D.connection_stalled)}}rpcUnsubscribe(e,t,i){const s={method:V(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug(\"Outgoing Relay Payload\"),this.logger.trace({type:\"payload\",direction:\"outgoing\",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,ce($({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,$({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug(\"Setting subscription\"),this.logger.trace({type:\"method\",method:\"setSubscription\",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,$({},t)),this.topicMap.set(t.topic,e),this.events.emit(I.created,t)}getSubscription(e){this.logger.debug(\"Getting subscription\"),this.logger.trace({type:\"method\",method:\"getSubscription\",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=c(\"NO_MATCHING_KEY\",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug(\"Deleting subscription\"),this.logger.trace({type:\"method\",method:\"deleteSubscription\",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(I.deleted,ce($({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(I.sync)}async reset(){if(!this.cached.length)return;const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<e;t++){const i=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}this.events.emit(I.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>\"u\"||!e.length)return;if(this.subscriptions.size){const{message:t}=c(\"RESTORE_WILL_OVERRIDE\",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:\"method\",method:\"restore\",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const t=await this.rpcBatchSubscribe(e);Qt(t)&&this.onBatchSubscribe(t.map((i,s)=>ce($({},e[s]),{id:i})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(H.pulse,async()=>{await this.checkPending()}),this.relayer.on(D.connect,async()=>{await this.onConnect()}),this.relayer.on(D.disconnect,()=>{this.onDisconnect()}),this.events.on(I.created,async e=>{const t=I.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,data:e}),await this.persist()}),this.events.on(I.deleted,async e=>{const t=I.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),e())},this.pollingInterval)})}}var sr=Object.defineProperty,mt=Object.getOwnPropertySymbols,rr=Object.prototype.hasOwnProperty,nr=Object.prototype.propertyIsEnumerable,Et=(r,e,t)=>e in r?sr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ar=(r,e)=>{for(var t in e||(e={}))rr.call(e,t)&&Et(r,t,e[t]);if(mt)for(var t of mt(e))nr.call(e,t)&&Et(r,t,e[t]);return r};class ft extends Ft{constructor(e){super(e),this.protocol=\"wc\",this.version=2,this.events=new A,this.name=Ze,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=[\"socket hang up\",\"socket stalled\"],this.request=async t=>{this.logger.debug(\"Publishing Request Payload\");try{return await this.toEstablishConnection(),await this.provider.request(t)}catch(i){throw this.logger.debug(\"Failed to Publish Request\"),this.logger.error(i),i}},this.core=e.core,this.logger=typeof e.logger<\"u\"&&typeof e.logger!=\"string\"?w(e.logger,this.name):ue(le({level:e.logger||We})),this.messages=new pt(this.logger,e.core),this.subscriber=new bt(this,this.logger),this.publisher=new Xs(this,this.logger),this.relayUrl=e?.relayUrl||he,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace(\"Initialized\"),await this.createProvider(),await Promise.all([this.messages.init(),this.transportOpen(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return v(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now()})}async subscribe(e,t){this.isInitialized();let i=\"\";return await Promise.all([new Promise(s=>{this.subscriber.once(I.created,n=>{n.topic===e&&s()})}),new Promise(async s=>{i=await this.subscriber.subscribe(e,t),s()})]),i}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(D.transport_closed))}async transportOpen(e){if(!this.reconnecting){this.relayUrl=e||this.relayUrl,this.transportExplicitlyClosed=!1,this.reconnecting=!0;try{await Promise.all([new Promise(t=>{this.initialized||t(),this.subscriber.once(I.resubscribed,()=>{t()})}),await Promise.race([new Promise(async(t,i)=>{await j(this.provider.connect(),5e3,\"socket stalled\").catch(s=>i(s)).then(()=>t()).finally(()=>this.removeListener(D.transport_closed,this.rejectTransportOpen))}),new Promise(t=>this.once(D.transport_closed,this.rejectTransportOpen))])])}catch(t){this.logger.error(t);const i=t;if(!this.isConnectionStalled(i.message))throw t;this.events.emit(D.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(e){this.transportExplicitlyClosed||(this.relayUrl=e||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}isConnectionStalled(e){return this.staleConnectionErrors.some(t=>e.includes(t))}rejectTransportOpen(){throw new Error(\"closeTransport called before connection was established\")}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new yi(new fi(ei({sdkVersion:tt,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:t,message:i}=e;await this.messages.set(t,i)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;return await this.subscriber.isSubscribed(t)?this.messages.has(t,i):!0}async onProviderPayload(e){if(this.logger.debug(\"Incoming Relay Payload\"),this.logger.trace({type:\"payload\",direction:\"incoming\",payload:e}),Ee(e)){if(!e.method.endsWith(Qe))return;const t=e.params,{topic:i,message:s,publishedAt:n}=t.data,a={topic:i,message:s,publishedAt:n};this.logger.debug(\"Emitting Relayer Payload\"),this.logger.trace(ar({type:\"event\",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(D.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=fe(e.id,!0);await this.provider.connection.send(t)}registerProviderListeners(){this.provider.on(M.payload,e=>this.onProviderPayload(e)),this.provider.on(M.connect,()=>{this.events.emit(D.connect)}),this.provider.on(M.disconnect,()=>{this.onProviderDisconnect()}),this.provider.on(M.error,e=>{this.logger.error(e),this.events.emit(D.error,e)})}registerEventListeners(){this.events.on(D.connection_stalled,async()=>{await this.restartTransport()})}onProviderDisconnect(){this.events.emit(D.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.restartTransport()},be(et))}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}async toEstablishConnection(){if(!this.connected){if(this.connecting)return await new Promise(e=>{const t=setInterval(()=>{this.connected&&(clearInterval(t),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var or=Object.defineProperty,wt=Object.getOwnPropertySymbols,hr=Object.prototype.hasOwnProperty,cr=Object.prototype.propertyIsEnumerable,vt=(r,e,t)=>e in r?or(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,It=(r,e)=>{for(var t in e||(e={}))hr.call(e,t)&&vt(r,t,e[t]);if(wt)for(var t of wt(e))cr.call(e,t)&&vt(r,t,e[t]);return r};class Ct extends Mt{constructor(e,t,i,s=P,n=void 0){super(e,t,i,s),this.core=e,this.logger=t,this.name=i,this.map=new Map,this.version=it,this.cached=[],this.initialized=!1,this.storagePrefix=P,this.init=async()=>{this.initialized||(this.logger.trace(\"Initialized\"),await this.restore(),this.cached.forEach(a=>{this.getKey&&a!==null&&!Z(a)?this.map.set(this.getKey(a),a):ti(a)?this.map.set(a.id,a):ii(a)&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)},this.set=async(a,o)=>{this.isInitialized(),this.map.has(a)?await this.update(a,o):(this.logger.debug(\"Setting value\"),this.logger.trace({type:\"method\",method:\"set\",key:a,value:o}),this.map.set(a,o),await this.persist())},this.get=a=>(this.isInitialized(),this.logger.debug(\"Getting value\"),this.logger.trace({type:\"method\",method:\"get\",key:a}),this.getData(a)),this.getAll=a=>(this.isInitialized(),a?this.values.filter(o=>Object.keys(a).every(h=>wi(o[h],a[h]))):this.values),this.update=async(a,o)=>{this.isInitialized(),this.logger.debug(\"Updating value\"),this.logger.trace({type:\"method\",method:\"update\",key:a,update:o});const h=It(It({},this.getData(a)),o);this.map.set(a,h),await this.persist()},this.delete=async(a,o)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug(\"Deleting value\"),this.logger.trace({type:\"method\",method:\"delete\",key:a,reason:o}),this.map.delete(a),await this.persist())},this.logger=w(t,this.name),this.storagePrefix=s,this.getKey=n}get context(){return v(this.logger)}get storageKey(){return this.storagePrefix+this.version+\"//\"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:i}=c(\"NO_MATCHING_KEY\",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>\"u\"||!e.length)return;if(this.map.size){const{message:t}=c(\"RESTORE_WILL_OVERRIDE\",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:\"method\",method:\"restore\",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}}class _t{constructor(e,t){this.core=e,this.logger=t,this.name=at,this.version=ot,this.events=new Ot,this.initialized=!1,this.storagePrefix=P,this.ignoredPayloadTypes=[si],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace(\"Initialized\"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=X(),s=await this.core.crypto.setSymKey(i),n=Q(me),a={protocol:Xe},o={topic:s,expiry:n,relay:a,active:!1},h=ri({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a});return await this.pairings.set(s,o),await this.core.relayer.subscribe(s),this.core.expirer.set(s,n),{topic:s,uri:h}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:s,symKey:n,relay:a}=ni(i.uri);if(this.pairings.keys.includes(s))throw new Error(`Pairing already exists: ${s}`);if(this.core.crypto.hasKeys(s))throw new Error(`Keychain already exists: ${s}`);const o=Q(me),h={topic:s,relay:a,expiry:o,active:!1};return await this.pairings.set(s,h),await this.core.crypto.setSymKey(n,s),await this.core.relayer.subscribe(s,{relay:a}),this.core.expirer.set(s,o),i.activatePairing&&await this.activate({topic:s}),h},this.activate=async({topic:i})=>{this.isInitialized();const s=Q(ie);await this.pairings.update(i,{active:!0,expiry:s}),this.core.expirer.set(i,s)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:s}=i;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,\"wc_pairingPing\",{}),{done:a,resolve:o,reject:h}=ai();this.events.once(ee(\"pairing_ping\",n),({error:d})=>{d?h(d):o()}),await a()}},this.updateExpiry=async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})},this.updateMetadata=async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,\"wc_pairingDelete\",L(\"USER_DISCONNECTED\")),await this.deletePairing(s))},this.sendRequest=async(i,s,n)=>{const a=we(s,n),o=await this.core.crypto.encode(i,a),h=N[s].req;return this.core.history.set(i,a),await this.core.relayer.publish(i,o,h),a.id},this.sendResult=async(i,s,n)=>{const a=fe(i,n),o=await this.core.crypto.encode(s,a),h=await this.core.history.get(s,i),d=N[h.request.method].res;await this.core.relayer.publish(s,o,d),await this.core.history.resolve(a)},this.sendError=async(i,s,n)=>{const a=bi(i,n),o=await this.core.crypto.encode(s,a),h=await this.core.history.get(s,i),d=N[h.request.method]?N[h.request.method].res:N.unregistered_method.res;await this.core.relayer.publish(s,o,d),await this.core.history.resolve(a)},this.deletePairing=async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,L(\"USER_DISCONNECTED\")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(s=>De(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=i=>{const{topic:s,payload:n}=i,a=n.method;if(this.pairings.keys.includes(s))switch(a){case\"wc_pairingPing\":return this.onPairingPingRequest(s,n);case\"wc_pairingDelete\":return this.onPairingDeleteRequest(s,n);default:return this.onUnknownRpcMethodRequest(s,n)}},this.onRelayEventResponse=async i=>{const{topic:s,payload:n}=i,a=(await this.core.history.get(s,n.id)).request.method;if(this.pairings.keys.includes(s))switch(a){case\"wc_pairingPing\":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(a)}},this.onPairingPingRequest=async(i,s)=>{const{id:n}=s;try{this.isValidPing({topic:i}),await this.sendResult(n,i,!0),this.events.emit(\"pairing_ping\",{id:n,topic:i})}catch(a){await this.sendError(n,i,a),this.logger.error(a)}},this.onPairingPingResponse=(i,s)=>{const{id:n}=s;setTimeout(()=>{mi(s)?this.events.emit(ee(\"pairing_ping\",n),{}):ve(s)&&this.events.emit(ee(\"pairing_ping\",n),{error:s.error})},500)},this.onPairingDeleteRequest=async(i,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(\"pairing_delete\",{id:n,topic:i})}catch(a){await this.sendError(n,i,a),this.logger.error(a)}},this.onUnknownRpcMethodRequest=async(i,s)=>{const{id:n,method:a}=s;try{if(this.registeredMethods.includes(a))return;const o=L(\"WC_METHOD_UNSUPPORTED\",a);await this.sendError(n,i,o),this.logger.error(o)}catch(o){await this.sendError(n,i,o),this.logger.error(o)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(L(\"WC_METHOD_UNSUPPORTED\",i))},this.isValidPair=i=>{if(!te(i)){const{message:s}=c(\"MISSING_OR_INVALID\",`pair() params: ${i}`);throw new Error(s)}if(!oi(i.uri)){const{message:s}=c(\"MISSING_OR_INVALID\",`pair() uri: ${i.uri}`);throw new Error(s)}},this.isValidPing=async i=>{if(!te(i)){const{message:n}=c(\"MISSING_OR_INVALID\",`ping() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidDisconnect=async i=>{if(!te(i)){const{message:n}=c(\"MISSING_OR_INVALID\",`disconnect() params: ${i}`);throw new Error(n)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async i=>{if(!hi(i,!1)){const{message:s}=c(\"MISSING_OR_INVALID\",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=c(\"NO_MATCHING_KEY\",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(De(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=c(\"EXPIRED\",`pairing topic: ${i}`);throw new Error(s)}},this.core=e,this.logger=w(t,this.name),this.pairings=new Ct(this.core,this.logger,this.name,this.storagePrefix)}get context(){return v(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(D.message,async e=>{const{topic:t,message:i}=e;if(this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const s=await this.core.crypto.decode(t,i);Ee(s)?(this.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):Ei(s)&&(await this.core.history.resolve(s),this.onRelayEventResponse({topic:t,payload:s}))})}registerExpirerEvents(){this.core.expirer.on(m.expired,async e=>{const{topic:t}=ci(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(\"pairing_expire\",{topic:t}))})}}class Rt extends $t{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new A,this.name=ht,this.version=ct,this.cached=[],this.initialized=!1,this.storagePrefix=P,this.init=async()=>{this.initialized||(this.logger.trace(\"Initialized\"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,s,n)=>{if(this.isInitialized(),this.logger.debug(\"Setting JSON-RPC request history record\"),this.logger.trace({type:\"method\",method:\"set\",topic:i,request:s,chainId:n}),this.records.has(s.id))return;const a={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:n};this.records.set(a.id,a),this.events.emit(C.created,a)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug(\"Updating JSON-RPC response history record\"),this.logger.trace({type:\"method\",method:\"update\",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>\"u\"&&(s.response=ve(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.events.emit(C.updated,s))},this.get=async(i,s)=>(this.isInitialized(),this.logger.debug(\"Getting record\"),this.logger.trace({type:\"method\",method:\"get\",topic:i,id:s}),await this.getRecord(s)),this.delete=(i,s)=>{this.isInitialized(),this.logger.debug(\"Deleting record\"),this.logger.trace({type:\"method\",method:\"delete\",id:s}),this.values.forEach(n=>{if(n.topic===i){if(typeof s<\"u\"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(C.deleted,n)}})},this.exists=async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=w(t,this.name)}get context(){return v(this.logger)}get storageKey(){return this.storagePrefix+this.version+\"//\"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<\"u\")return;const i={topic:t.topic,request:we(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:i}=c(\"NO_MATCHING_KEY\",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(C.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>\"u\"||!e.length)return;if(this.records.size){const{message:t}=c(\"RESTORE_WILL_OVERRIDE\",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:\"method\",method:\"restore\",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(C.created,e=>{const t=C.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,record:e}),this.persist()}),this.events.on(C.updated,e=>{const t=C.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,record:e}),this.persist()}),this.events.on(C.deleted,e=>{const t=C.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,record:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}}class St extends Kt{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new A,this.name=ut,this.version=lt,this.cached=[],this.initialized=!1,this.storagePrefix=P,this.init=async()=>{this.initialized||(this.logger.trace(\"Initialized\"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<\"u\"}catch{return!1}},this.set=(i,s)=>{this.isInitialized();const n=this.formatTarget(i),a={target:n,expiry:s};this.expirations.set(n,a),this.checkExpiry(n,a),this.events.emit(m.created,{target:n,expiration:a})},this.get=i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)},this.del=i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(m.deleted,{target:s,expiration:n})}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=w(t,this.name)}get context(){return v(this.logger)}get storageKey(){return this.storagePrefix+this.version+\"//\"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e==\"string\")return ui(e);if(typeof e==\"number\")return li(e);const{message:t}=c(\"UNKNOWN_TYPE\",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(m.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>\"u\"||!e.length)return;if(this.expirations.size){const{message:t}=c(\"RESTORE_WILL_OVERRIDE\",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:\"method\",method:\"restore\",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:i}=c(\"NO_MATCHING_KEY\",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}checkExpiry(e,t){const{expiry:i}=t;be(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(m.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(H.pulse,()=>this.checkExpirations()),this.events.on(m.created,e=>{const t=m.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,data:e}),this.persist()}),this.events.on(m.expired,e=>{const t=m.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,data:e}),this.persist()}),this.events.on(m.deleted,e=>{const t=m.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:\"event\",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=c(\"NOT_INITIALIZED\",this.name);throw new Error(e)}}}var ur=Object.defineProperty,Tt=Object.getOwnPropertySymbols,lr=Object.prototype.hasOwnProperty,dr=Object.prototype.propertyIsEnumerable,Pt=(r,e,t)=>e in r?ur(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xt=(r,e)=>{for(var t in e||(e={}))lr.call(e,t)&&Pt(r,t,e[t]);if(Tt)for(var t of Tt(e))dr.call(e,t)&&Pt(r,t,e[t]);return r};class Y extends kt{constructor(e){super(e),this.protocol=ae,this.version=$e,this.name=G,this.events=new A,this.initialized=!1,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||he;const t=typeof e?.logger<\"u\"&&typeof e?.logger!=\"string\"?e.logger:ue(le({level:e?.logger||Ke.logger}));this.logger=w(t,this.name),this.heartbeat=new zt,this.crypto=new gt(this,this.logger,e?.keychain),this.history=new Rt(this,this.logger),this.expirer=new St(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new At(xt(xt({},ke),e?.storageOptions)),this.relayer=new ft({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new _t(this,this.logger)}static async init(e){const t=new Y(e);return await t.initialize(),t}get context(){return v(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace(\"Initialized\");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info(\"Core Initialization Success\")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const gr=Y;export{G as CORE_CONTEXT,Ke as CORE_DEFAULT,ae as CORE_PROTOCOL,ke as CORE_STORAGE_OPTIONS,P as CORE_STORAGE_PREFIX,$e as CORE_VERSION,oe as CRYPTO_CLIENT_SEED,Be as CRYPTO_CONTEXT,je as CRYPTO_JWT_TTL,gr as Core,gt as Crypto,ut as EXPIRER_CONTEXT,Hs as EXPIRER_DEFAULT_TTL,m as EXPIRER_EVENTS,lt as EXPIRER_STORAGE_VERSION,St as Expirer,ht as HISTORY_CONTEXT,C as HISTORY_EVENTS,ct as HISTORY_STORAGE_VERSION,Rt as JsonRpcHistory,Ve as KEYCHAIN_CONTEXT,qe as KEYCHAIN_STORAGE_VERSION,dt as KeyChain,Ge as MESSAGES_CONTEXT,Ye as MESSAGES_STORAGE_VERSION,pt as MessageTracker,at as PAIRING_CONTEXT,Js as PAIRING_DEFAULT_TTL,N as PAIRING_RPC_OPTS,ot as PAIRING_STORAGE_VERSION,nt as PENDING_SUB_RESOLUTION_TIMEOUT,He as PUBLISHER_CONTEXT,Je as PUBLISHER_DEFAULT_TTL,_t as Pairing,Ze as RELAYER_CONTEXT,We as RELAYER_DEFAULT_LOGGER,Xe as RELAYER_DEFAULT_PROTOCOL,he as RELAYER_DEFAULT_RELAY_URL,D as RELAYER_EVENTS,M as RELAYER_PROVIDER_EVENTS,et as RELAYER_RECONNECT_TIMEOUT,tt as RELAYER_SDK_VERSION,Gs as RELAYER_STORAGE_OPTIONS,Qe as RELAYER_SUBSCRIBER_SUFFIX,ft as Relayer,it as STORE_STORAGE_VERSION,st as SUBSCRIBER_CONTEXT,Ys as SUBSCRIBER_DEFAULT_TTL,I as SUBSCRIBER_EVENTS,rt as SUBSCRIBER_STORAGE_VERSION,Ct as Store,bt as Subscriber,Y as default};\n//# sourceMappingURL=index.es.js.map\n"]},"metadata":{},"sourceType":"module"}