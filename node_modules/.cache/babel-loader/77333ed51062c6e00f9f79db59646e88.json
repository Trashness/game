{"ast":null,"code":"import _slicedToArray from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _regeneratorRuntime from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _toConsumableArray from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _defineProperty from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _createForOfIteratorHelper from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport { EventEmitter as R } from \"events\";\nimport { getAccountsFromNamespaces as T, getSdkError as S, isValidArray as v } from \"@walletconnect/utils\";\nimport { UniversalProvider as P } from \"@walletconnect/universal-provider\";\nvar j = \"wc\",\n  $ = \"ethereum_provider\",\n  q = \"\".concat(j, \"@\", 2, \":\").concat($, \":\"),\n  N = \"https://rpc.walletconnect.com/v1/\",\n  p = [\"eth_sendTransaction\", \"personal_sign\"],\n  D = [\"eth_accounts\", \"eth_requestAccounts\", \"eth_call\", \"eth_getBalance\", \"eth_sendRawTransaction\", \"eth_sign\", \"eth_signTransaction\", \"eth_signTypedData\", \"eth_signTypedData_v3\", \"eth_signTypedData_v4\", \"wallet_switchEthereumChain\", \"wallet_addEthereumChain\", \"wallet_getPermissions\", \"wallet_requestPermissions\", \"wallet_registerOnboarding\", \"wallet_watchAsset\", \"wallet_scanQRCode\"],\n  u = [\"chainChanged\", \"accountsChanged\"],\n  U = [\"message\", \"disconnect\", \"connect\"];\nvar Q = Object.defineProperty,\n  L = Object.defineProperties,\n  H = Object.getOwnPropertyDescriptors,\n  _ = Object.getOwnPropertySymbols,\n  G = Object.prototype.hasOwnProperty,\n  K = Object.prototype.propertyIsEnumerable,\n  y = function y(a, t, s) {\n    return t in a ? Q(a, t, {\n      enumerable: !0,\n      configurable: !0,\n      writable: !0,\n      value: s\n    }) : a[t] = s;\n  },\n  I = function I(a, t) {\n    for (var s in t || (t = {})) G.call(t, s) && y(a, s, t[s]);\n    if (_) {\n      var _iterator = _createForOfIteratorHelper(_(t)),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var s = _step.value;\n          K.call(t, s) && y(a, s, t[s]);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n    }\n    return a;\n  },\n  O = function O(a, t) {\n    return L(a, H(t));\n  };\nfunction C(a) {\n  return Number(a[0].split(\":\")[1]);\n}\nfunction w(a) {\n  return \"0x\".concat(a.toString(16));\n}\nfunction V(a) {\n  var t = a.chains,\n    s = a.optionalChains,\n    i = a.methods,\n    e = a.optionalMethods,\n    n = a.events,\n    c = a.optionalEvents,\n    h = a.rpcMap;\n  if (!v(t)) throw new Error(\"Invalid chains\");\n  var o = t,\n    r = i || p,\n    f = n || u,\n    M = _defineProperty({}, C(o), h[C(o)]),\n    E = {\n      chains: o,\n      methods: r,\n      events: f,\n      rpcMap: M\n    },\n    l = n === null || n === void 0 ? void 0 : n.filter(function (g) {\n      return !u.includes(g);\n    }),\n    d = i === null || i === void 0 ? void 0 : i.filter(function (g) {\n      return !p.includes(g);\n    });\n  if (!s && !c && !e && !(l != null && l.length) && !(d != null && d.length)) return {\n    required: E\n  };\n  var b = (l === null || l === void 0 ? void 0 : l.length) && (d === null || d === void 0 ? void 0 : d.length) || !s,\n    A = {\n      chains: _toConsumableArray(new Set(b ? o.concat(s || []) : s)),\n      methods: _toConsumableArray(new Set(r.concat(e || []))),\n      events: _toConsumableArray(new Set(f.concat(c || []))),\n      rpcMap: h\n    };\n  return {\n    required: E,\n    optional: A\n  };\n}\nvar m = /*#__PURE__*/function () {\n  function m() {\n    var _this = this;\n    _classCallCheck(this, m);\n    this.events = new R(), this.namespace = \"eip155\", this.accounts = [], this.chainId = 1, this.STORAGE_KEY = q, this.on = function (t, s) {\n      return _this.events.on(t, s), _this;\n    }, this.once = function (t, s) {\n      return _this.events.once(t, s), _this;\n    }, this.removeListener = function (t, s) {\n      return _this.events.removeListener(t, s), _this;\n    }, this.off = function (t, s) {\n      return _this.events.off(t, s), _this;\n    }, this.parseAccount = function (t) {\n      return _this.isCompatibleChainId(t) ? _this.parseAccountId(t).address : t;\n    }, this.signer = {}, this.rpc = {};\n  }\n  _createClass(m, [{\n    key: \"request\",\n    value: function () {\n      var _request = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(t) {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return this.signer.request(t, this.formatChainId(this.chainId));\n            case 2:\n              return _context.abrupt(\"return\", _context.sent);\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function request(_x) {\n        return _request.apply(this, arguments);\n      }\n      return request;\n    }()\n  }, {\n    key: \"sendAsync\",\n    value: function sendAsync(t, s) {\n      this.signer.sendAsync(t, s, this.formatChainId(this.chainId));\n    }\n  }, {\n    key: \"connected\",\n    get: function get() {\n      return this.signer.client ? this.signer.client.core.relayer.connected : !1;\n    }\n  }, {\n    key: \"connecting\",\n    get: function get() {\n      return this.signer.client ? this.signer.client.core.relayer.connecting : !1;\n    }\n  }, {\n    key: \"enable\",\n    value: function () {\n      var _enable = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.t0 = this.session;\n              if (_context2.t0) {\n                _context2.next = 4;\n                break;\n              }\n              _context2.next = 4;\n              return this.connect();\n            case 4:\n              _context2.next = 6;\n              return this.request({\n                method: \"eth_requestAccounts\"\n              });\n            case 6:\n              return _context2.abrupt(\"return\", _context2.sent);\n            case 7:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function enable() {\n        return _enable.apply(this, arguments);\n      }\n      return enable;\n    }()\n  }, {\n    key: \"connect\",\n    value: function () {\n      var _connect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(t) {\n        var _this2 = this;\n        var _V, s, i, e, n;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              if (this.signer.client) {\n                _context4.next = 2;\n                break;\n              }\n              throw new Error(\"Provider not initialized. Call init() first\");\n            case 2:\n              this.loadConnectOpts(t);\n              _V = V(this.rpc), s = _V.required, i = _V.optional;\n              _context4.prev = 4;\n              _context4.next = 7;\n              return new Promise( /*#__PURE__*/function () {\n                var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(c, h) {\n                  var o;\n                  return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n                    while (1) switch (_context3.prev = _context3.next) {\n                      case 0:\n                        _this2.rpc.showQrModal && ((o = _this2.modal) == null || o.subscribeModal(function (r) {\n                          !r.open && !_this2.signer.session && (_this2.signer.abortPairingAttempt(), h(new Error(\"Connection request reset. Please try again.\")));\n                        }));\n                        _context3.next = 3;\n                        return _this2.signer.connect(O(I({\n                          namespaces: _defineProperty({}, _this2.namespace, s)\n                        }, i && {\n                          optionalNamespaces: _defineProperty({}, _this2.namespace, i)\n                        }), {\n                          pairingTopic: t === null || t === void 0 ? void 0 : t.pairingTopic\n                        })).then(function (r) {\n                          c(r);\n                        }).catch(function (r) {\n                          h(new Error(r.message));\n                        });\n                      case 3:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }, _callee3);\n                }));\n                return function (_x3, _x4) {\n                  return _ref.apply(this, arguments);\n                };\n              }());\n            case 7:\n              e = _context4.sent;\n              if (e) {\n                _context4.next = 10;\n                break;\n              }\n              return _context4.abrupt(\"return\");\n            case 10:\n              this.setChainIds(this.rpc.chains);\n              n = T(e.namespaces, [this.namespace]);\n              this.setAccounts(n), this.events.emit(\"connect\", {\n                chainId: w(this.chainId)\n              });\n              _context4.next = 18;\n              break;\n            case 15:\n              _context4.prev = 15;\n              _context4.t0 = _context4[\"catch\"](4);\n              throw this.signer.logger.error(_context4.t0), _context4.t0;\n            case 18:\n              _context4.prev = 18;\n              this.modal && this.modal.closeModal();\n              return _context4.finish(18);\n            case 21:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[4, 15, 18, 21]]);\n      }));\n      function connect(_x2) {\n        return _connect.apply(this, arguments);\n      }\n      return connect;\n    }()\n  }, {\n    key: \"disconnect\",\n    value: function () {\n      var _disconnect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.t0 = this.session;\n              if (!_context5.t0) {\n                _context5.next = 4;\n                break;\n              }\n              _context5.next = 4;\n              return this.signer.disconnect();\n            case 4:\n              this.reset();\n            case 5:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, this);\n      }));\n      function disconnect() {\n        return _disconnect.apply(this, arguments);\n      }\n      return disconnect;\n    }()\n  }, {\n    key: \"isWalletConnect\",\n    get: function get() {\n      return !0;\n    }\n  }, {\n    key: \"session\",\n    get: function get() {\n      return this.signer.session;\n    }\n  }, {\n    key: \"registerEventListeners\",\n    value: function registerEventListeners() {\n      var _this3 = this;\n      this.signer.on(\"session_event\", function (t) {\n        var s = t.params,\n          i = s.event;\n        i.name === \"accountsChanged\" ? (_this3.accounts = _this3.parseAccounts(i.data), _this3.events.emit(\"accountsChanged\", _this3.accounts)) : i.name === \"chainChanged\" ? _this3.setChainId(_this3.formatChainId(i.data)) : _this3.events.emit(i.name, i.data), _this3.events.emit(\"session_event\", t);\n      }), this.signer.on(\"chainChanged\", function (t) {\n        var s = parseInt(t);\n        _this3.chainId = s, _this3.events.emit(\"chainChanged\", w(_this3.chainId)), _this3.persist();\n      }), this.signer.on(\"session_update\", function (t) {\n        _this3.events.emit(\"session_update\", t);\n      }), this.signer.on(\"session_delete\", function (t) {\n        _this3.reset(), _this3.events.emit(\"session_delete\", t), _this3.events.emit(\"disconnect\", O(I({}, S(\"USER_DISCONNECTED\")), {\n          data: t.topic,\n          name: \"USER_DISCONNECTED\"\n        }));\n      }), this.signer.on(\"display_uri\", function (t) {\n        var s, i;\n        _this3.rpc.showQrModal && ((s = _this3.modal) == null || s.closeModal(), (i = _this3.modal) == null || i.openModal({\n          uri: t\n        })), _this3.events.emit(\"display_uri\", t);\n      });\n    }\n  }, {\n    key: \"setHttpProvider\",\n    value: function setHttpProvider(t) {\n      this.request({\n        method: \"wallet_switchEthereumChain\",\n        params: [{\n          chainId: t.toString(16)\n        }]\n      });\n    }\n  }, {\n    key: \"isCompatibleChainId\",\n    value: function isCompatibleChainId(t) {\n      return typeof t == \"string\" ? t.startsWith(\"\".concat(this.namespace, \":\")) : !1;\n    }\n  }, {\n    key: \"formatChainId\",\n    value: function formatChainId(t) {\n      return \"\".concat(this.namespace, \":\").concat(t);\n    }\n  }, {\n    key: \"parseChainId\",\n    value: function parseChainId(t) {\n      return Number(t.split(\":\")[1]);\n    }\n  }, {\n    key: \"setChainIds\",\n    value: function setChainIds(t) {\n      var _this4 = this;\n      var s = t.filter(function (i) {\n        return _this4.isCompatibleChainId(i);\n      }).map(function (i) {\n        return _this4.parseChainId(i);\n      });\n      s.length && (this.chainId = s[0], this.events.emit(\"chainChanged\", w(this.chainId)), this.persist());\n    }\n  }, {\n    key: \"setChainId\",\n    value: function setChainId(t) {\n      if (this.isCompatibleChainId(t)) {\n        var s = this.parseChainId(t);\n        this.chainId = s, this.setHttpProvider(s);\n      }\n    }\n  }, {\n    key: \"parseAccountId\",\n    value: function parseAccountId(t) {\n      var _t$split = t.split(\":\"),\n        _t$split2 = _slicedToArray(_t$split, 3),\n        s = _t$split2[0],\n        i = _t$split2[1],\n        e = _t$split2[2];\n      return {\n        chainId: \"\".concat(s, \":\").concat(i),\n        address: e\n      };\n    }\n  }, {\n    key: \"setAccounts\",\n    value: function setAccounts(t) {\n      var _this5 = this;\n      this.accounts = t.filter(function (s) {\n        return _this5.parseChainId(_this5.parseAccountId(s).chainId) === _this5.chainId;\n      }).map(function (s) {\n        return _this5.parseAccountId(s).address;\n      }), this.events.emit(\"accountsChanged\", this.accounts);\n    }\n  }, {\n    key: \"getRpcConfig\",\n    value: function getRpcConfig(t) {\n      var _this6 = this;\n      var s, i;\n      return {\n        chains: ((s = t.chains) == null ? void 0 : s.map(function (e) {\n          return _this6.formatChainId(e);\n        })) || [\"\".concat(this.namespace, \":1\")],\n        optionalChains: t.optionalChains ? t.optionalChains.map(function (e) {\n          return _this6.formatChainId(e);\n        }) : void 0,\n        methods: (t === null || t === void 0 ? void 0 : t.methods) || p,\n        events: (t === null || t === void 0 ? void 0 : t.events) || u,\n        optionalMethods: (t === null || t === void 0 ? void 0 : t.optionalMethods) || [],\n        optionalEvents: (t === null || t === void 0 ? void 0 : t.optionalEvents) || [],\n        rpcMap: (t === null || t === void 0 ? void 0 : t.rpcMap) || this.buildRpcMap(t.chains.concat(t.optionalChains || []), t.projectId),\n        showQrModal: Boolean(t === null || t === void 0 ? void 0 : t.showQrModal),\n        qrModalOptions: (i = t === null || t === void 0 ? void 0 : t.qrModalOptions) != null ? i : void 0,\n        projectId: t.projectId,\n        metadata: t.metadata\n      };\n    }\n  }, {\n    key: \"buildRpcMap\",\n    value: function buildRpcMap(t, s) {\n      var _this7 = this;\n      var i = {};\n      return t.forEach(function (e) {\n        i[e] = _this7.getRpcUrl(e, s);\n      }), i;\n    }\n  }, {\n    key: \"initialize\",\n    value: function () {\n      var _initialize = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6(t) {\n        var _yield$import, s;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              this.rpc = this.getRpcConfig(t);\n              this.chainId = C(this.rpc.chains);\n              _context6.next = 4;\n              return P.init({\n                projectId: this.rpc.projectId,\n                metadata: this.rpc.metadata\n              });\n            case 4:\n              this.signer = _context6.sent;\n              this.registerEventListeners();\n              _context6.next = 8;\n              return this.loadPersistedSession();\n            case 8:\n              if (!this.rpc.showQrModal) {\n                _context6.next = 20;\n                break;\n              }\n              _context6.prev = 9;\n              _context6.next = 12;\n              return import(\"@web3modal/standalone\");\n            case 12:\n              _yield$import = _context6.sent;\n              s = _yield$import.Web3Modal;\n              this.modal = new s(I({\n                walletConnectVersion: 2,\n                projectId: this.rpc.projectId,\n                standaloneChains: this.rpc.chains\n              }, this.rpc.qrModalOptions));\n              _context6.next = 20;\n              break;\n            case 17:\n              _context6.prev = 17;\n              _context6.t0 = _context6[\"catch\"](9);\n              throw new Error(\"To use QR modal, please install @web3modal/standalone package\");\n            case 20:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee6, this, [[9, 17]]);\n      }));\n      function initialize(_x5) {\n        return _initialize.apply(this, arguments);\n      }\n      return initialize;\n    }()\n  }, {\n    key: \"loadConnectOpts\",\n    value: function loadConnectOpts(t) {\n      var _this8 = this;\n      if (!t) return;\n      var s = t.chains,\n        i = t.optionalChains,\n        e = t.rpcMap;\n      s && v(s) && (this.rpc.chains = s.map(function (n) {\n        return _this8.formatChainId(n);\n      }), s.forEach(function (n) {\n        _this8.rpc.rpcMap[n] = (e === null || e === void 0 ? void 0 : e[n]) || _this8.getRpcUrl(n);\n      })), i && v(i) && (this.rpc.optionalChains = [], this.rpc.optionalChains = i === null || i === void 0 ? void 0 : i.map(function (n) {\n        return _this8.formatChainId(n);\n      }), i.forEach(function (n) {\n        _this8.rpc.rpcMap[n] = (e === null || e === void 0 ? void 0 : e[n]) || _this8.getRpcUrl(n);\n      }));\n    }\n  }, {\n    key: \"getRpcUrl\",\n    value: function getRpcUrl(t, s) {\n      var i;\n      return ((i = this.rpc.rpcMap) == null ? void 0 : i[t]) || \"\".concat(N, \"?chainId=eip155:\").concat(t, \"&projectId=\").concat(s || this.rpc.projectId);\n    }\n  }, {\n    key: \"loadPersistedSession\",\n    value: function () {\n      var _loadPersistedSession = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n        var t;\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              if (this.session) {\n                _context7.next = 2;\n                break;\n              }\n              return _context7.abrupt(\"return\");\n            case 2:\n              _context7.next = 4;\n              return this.signer.client.core.storage.getItem(\"\".concat(this.STORAGE_KEY, \"/chainId\"));\n            case 4:\n              t = _context7.sent;\n              this.setChainIds(t ? [this.formatChainId(t)] : this.session.namespaces[this.namespace].accounts), this.setAccounts(this.session.namespaces[this.namespace].accounts);\n            case 6:\n            case \"end\":\n              return _context7.stop();\n          }\n        }, _callee7, this);\n      }));\n      function loadPersistedSession() {\n        return _loadPersistedSession.apply(this, arguments);\n      }\n      return loadPersistedSession;\n    }()\n  }, {\n    key: \"reset\",\n    value: function reset() {\n      this.chainId = 1, this.accounts = [];\n    }\n  }, {\n    key: \"persist\",\n    value: function persist() {\n      this.session && this.signer.client.core.storage.setItem(\"\".concat(this.STORAGE_KEY, \"/chainId\"), this.chainId);\n    }\n  }, {\n    key: \"parseAccounts\",\n    value: function parseAccounts(t) {\n      var _this9 = this;\n      return typeof t == \"string\" || t instanceof String ? [this.parseAccount(t)] : t.map(function (s) {\n        return _this9.parseAccount(s);\n      });\n    }\n  }], [{\n    key: \"init\",\n    value: function () {\n      var _init = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8(t) {\n        var s;\n        return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              s = new m();\n              _context8.next = 3;\n              return s.initialize(t);\n            case 3:\n              return _context8.abrupt(\"return\", s);\n            case 4:\n            case \"end\":\n              return _context8.stop();\n          }\n        }, _callee8);\n      }));\n      function init(_x6) {\n        return _init.apply(this, arguments);\n      }\n      return init;\n    }()\n  }]);\n  return m;\n}();\nvar Y = m;\nexport { Y as EthereumProvider, U as OPTIONAL_EVENTS, D as OPTIONAL_METHODS, u as REQUIRED_EVENTS, p as REQUIRED_METHODS, m as default };","map":{"version":3,"sources":[],"names":[],"mappings":"","sourcesContent":["import{EventEmitter as R}from\"events\";import{getAccountsFromNamespaces as T,getSdkError as S,isValidArray as v}from\"@walletconnect/utils\";import{UniversalProvider as P}from\"@walletconnect/universal-provider\";const j=\"wc\",$=\"ethereum_provider\",q=`${j}@${2}:${$}:`,N=\"https://rpc.walletconnect.com/v1/\",p=[\"eth_sendTransaction\",\"personal_sign\"],D=[\"eth_accounts\",\"eth_requestAccounts\",\"eth_call\",\"eth_getBalance\",\"eth_sendRawTransaction\",\"eth_sign\",\"eth_signTransaction\",\"eth_signTypedData\",\"eth_signTypedData_v3\",\"eth_signTypedData_v4\",\"wallet_switchEthereumChain\",\"wallet_addEthereumChain\",\"wallet_getPermissions\",\"wallet_requestPermissions\",\"wallet_registerOnboarding\",\"wallet_watchAsset\",\"wallet_scanQRCode\"],u=[\"chainChanged\",\"accountsChanged\"],U=[\"message\",\"disconnect\",\"connect\"];var Q=Object.defineProperty,L=Object.defineProperties,H=Object.getOwnPropertyDescriptors,_=Object.getOwnPropertySymbols,G=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable,y=(a,t,s)=>t in a?Q(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,I=(a,t)=>{for(var s in t||(t={}))G.call(t,s)&&y(a,s,t[s]);if(_)for(var s of _(t))K.call(t,s)&&y(a,s,t[s]);return a},O=(a,t)=>L(a,H(t));function C(a){return Number(a[0].split(\":\")[1])}function w(a){return`0x${a.toString(16)}`}function V(a){const{chains:t,optionalChains:s,methods:i,optionalMethods:e,events:n,optionalEvents:c,rpcMap:h}=a;if(!v(t))throw new Error(\"Invalid chains\");const o=t,r=i||p,f=n||u,M={[C(o)]:h[C(o)]},E={chains:o,methods:r,events:f,rpcMap:M},l=n?.filter(g=>!u.includes(g)),d=i?.filter(g=>!p.includes(g));if(!s&&!c&&!e&&!(l!=null&&l.length)&&!(d!=null&&d.length))return{required:E};const b=l?.length&&d?.length||!s,A={chains:[...new Set(b?o.concat(s||[]):s)],methods:[...new Set(r.concat(e||[]))],events:[...new Set(f.concat(c||[]))],rpcMap:h};return{required:E,optional:A}}class m{constructor(){this.events=new R,this.namespace=\"eip155\",this.accounts=[],this.chainId=1,this.STORAGE_KEY=q,this.on=(t,s)=>(this.events.on(t,s),this),this.once=(t,s)=>(this.events.once(t,s),this),this.removeListener=(t,s)=>(this.events.removeListener(t,s),this),this.off=(t,s)=>(this.events.off(t,s),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const s=new m;return await s.initialize(t),s}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,s){this.signer.sendAsync(t,s,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:\"eth_requestAccounts\"})}async connect(t){if(!this.signer.client)throw new Error(\"Provider not initialized. Call init() first\");this.loadConnectOpts(t);const{required:s,optional:i}=V(this.rpc);try{const e=await new Promise(async(c,h)=>{var o;this.rpc.showQrModal&&((o=this.modal)==null||o.subscribeModal(r=>{!r.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),h(new Error(\"Connection request reset. Please try again.\")))})),await this.signer.connect(O(I({namespaces:{[this.namespace]:s}},i&&{optionalNamespaces:{[this.namespace]:i}}),{pairingTopic:t?.pairingTopic})).then(r=>{c(r)}).catch(r=>{h(new Error(r.message))})});if(!e)return;this.setChainIds(this.rpc.chains);const n=T(e.namespaces,[this.namespace]);this.setAccounts(n),this.events.emit(\"connect\",{chainId:w(this.chainId)})}catch(e){throw this.signer.logger.error(e),e}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on(\"session_event\",t=>{const{params:s}=t,{event:i}=s;i.name===\"accountsChanged\"?(this.accounts=this.parseAccounts(i.data),this.events.emit(\"accountsChanged\",this.accounts)):i.name===\"chainChanged\"?this.setChainId(this.formatChainId(i.data)):this.events.emit(i.name,i.data),this.events.emit(\"session_event\",t)}),this.signer.on(\"chainChanged\",t=>{const s=parseInt(t);this.chainId=s,this.events.emit(\"chainChanged\",w(this.chainId)),this.persist()}),this.signer.on(\"session_update\",t=>{this.events.emit(\"session_update\",t)}),this.signer.on(\"session_delete\",t=>{this.reset(),this.events.emit(\"session_delete\",t),this.events.emit(\"disconnect\",O(I({},S(\"USER_DISCONNECTED\")),{data:t.topic,name:\"USER_DISCONNECTED\"}))}),this.signer.on(\"display_uri\",t=>{var s,i;this.rpc.showQrModal&&((s=this.modal)==null||s.closeModal(),(i=this.modal)==null||i.openModal({uri:t})),this.events.emit(\"display_uri\",t)})}setHttpProvider(t){this.request({method:\"wallet_switchEthereumChain\",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t==\"string\"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(\":\")[1])}setChainIds(t){const s=t.filter(i=>this.isCompatibleChainId(i)).map(i=>this.parseChainId(i));s.length&&(this.chainId=s[0],this.events.emit(\"chainChanged\",w(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const s=this.parseChainId(t);this.chainId=s,this.setHttpProvider(s)}}parseAccountId(t){const[s,i,e]=t.split(\":\");return{chainId:`${s}:${i}`,address:e}}setAccounts(t){this.accounts=t.filter(s=>this.parseChainId(this.parseAccountId(s).chainId)===this.chainId).map(s=>this.parseAccountId(s).address),this.events.emit(\"accountsChanged\",this.accounts)}getRpcConfig(t){var s,i;return{chains:((s=t.chains)==null?void 0:s.map(e=>this.formatChainId(e)))||[`${this.namespace}:1`],optionalChains:t.optionalChains?t.optionalChains.map(e=>this.formatChainId(e)):void 0,methods:t?.methods||p,events:t?.events||u,optionalMethods:t?.optionalMethods||[],optionalEvents:t?.optionalEvents||[],rpcMap:t?.rpcMap||this.buildRpcMap(t.chains.concat(t.optionalChains||[]),t.projectId),showQrModal:Boolean(t?.showQrModal),qrModalOptions:(i=t?.qrModalOptions)!=null?i:void 0,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,s){const i={};return t.forEach(e=>{i[e]=this.getRpcUrl(e,s)}),i}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=C(this.rpc.chains),this.signer=await P.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal)try{const{Web3Modal:s}=await import(\"@web3modal/standalone\");this.modal=new s(I({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch{throw new Error(\"To use QR modal, please install @web3modal/standalone package\")}}loadConnectOpts(t){if(!t)return;const{chains:s,optionalChains:i,rpcMap:e}=t;s&&v(s)&&(this.rpc.chains=s.map(n=>this.formatChainId(n)),s.forEach(n=>{this.rpc.rpcMap[n]=e?.[n]||this.getRpcUrl(n)})),i&&v(i)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=i?.map(n=>this.formatChainId(n)),i.forEach(n=>{this.rpc.rpcMap[n]=e?.[n]||this.getRpcUrl(n)}))}getRpcUrl(t,s){var i;return((i=this.rpc.rpcMap)==null?void 0:i[t])||`${N}?chainId=eip155:${t}&projectId=${s||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`);this.setChainIds(t?[this.formatChainId(t)]:this.session.namespaces[this.namespace].accounts),this.setAccounts(this.session.namespaces[this.namespace].accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t==\"string\"||t instanceof String?[this.parseAccount(t)]:t.map(s=>this.parseAccount(s))}}const Y=m;export{Y as EthereumProvider,U as OPTIONAL_EVENTS,D as OPTIONAL_METHODS,u as REQUIRED_EVENTS,p as REQUIRED_METHODS,m as default};\n//# sourceMappingURL=index.es.js.map\n"]},"metadata":{},"sourceType":"module"}