{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport { EventEmitter } from \"events\";\nimport { IJsonRpcProvider, isJsonRpcResponse, formatJsonRpcRequest, isJsonRpcError } from \"@walletconnect/jsonrpc-utils\";\nexport var JsonRpcProvider = /*#__PURE__*/function (_IJsonRpcProvider) {\n  _inherits(JsonRpcProvider, _IJsonRpcProvider);\n  var _super = _createSuper(JsonRpcProvider);\n  function JsonRpcProvider(connection) {\n    var _this;\n    _classCallCheck(this, JsonRpcProvider);\n    _this = _super.call(this, connection);\n    _this.events = new EventEmitter();\n    _this.hasRegisteredEventListeners = false;\n    _this.connection = _this.setConnection(connection);\n    if (_this.connection.connected) {\n      _this.registerEventListeners();\n    }\n    return _this;\n  }\n  _createClass(JsonRpcProvider, [{\n    key: \"connect\",\n    value: function () {\n      var _connect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var connection,\n          _args = arguments;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              connection = _args.length > 0 && _args[0] !== undefined ? _args[0] : this.connection;\n              _context.next = 3;\n              return this.open(connection);\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function connect() {\n        return _connect.apply(this, arguments);\n      }\n      return connect;\n    }()\n  }, {\n    key: \"disconnect\",\n    value: function () {\n      var _disconnect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return this.close();\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function disconnect() {\n        return _disconnect.apply(this, arguments);\n      }\n      return disconnect;\n    }()\n  }, {\n    key: \"on\",\n    value: function on(event, listener) {\n      this.events.on(event, listener);\n    }\n  }, {\n    key: \"once\",\n    value: function once(event, listener) {\n      this.events.once(event, listener);\n    }\n  }, {\n    key: \"off\",\n    value: function off(event, listener) {\n      this.events.off(event, listener);\n    }\n  }, {\n    key: \"removeListener\",\n    value: function removeListener(event, listener) {\n      this.events.removeListener(event, listener);\n    }\n  }, {\n    key: \"request\",\n    value: function () {\n      var _request2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(_request, context) {\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              return _context3.abrupt(\"return\", this.requestStrict(formatJsonRpcRequest(_request.method, _request.params || []), context));\n            case 1:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function request(_x, _x2) {\n        return _request2.apply(this, arguments);\n      }\n      return request;\n    }()\n  }, {\n    key: \"requestStrict\",\n    value: function () {\n      var _requestStrict = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5(request, context) {\n        var _this2 = this;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              return _context5.abrupt(\"return\", new Promise( /*#__PURE__*/function () {\n                var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(resolve, reject) {\n                  return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n                    while (1) switch (_context4.prev = _context4.next) {\n                      case 0:\n                        if (_this2.connection.connected) {\n                          _context4.next = 9;\n                          break;\n                        }\n                        _context4.prev = 1;\n                        _context4.next = 4;\n                        return _this2.open();\n                      case 4:\n                        _context4.next = 9;\n                        break;\n                      case 6:\n                        _context4.prev = 6;\n                        _context4.t0 = _context4[\"catch\"](1);\n                        reject(_context4.t0);\n                      case 9:\n                        _this2.events.on(\"\".concat(request.id), function (response) {\n                          if (isJsonRpcError(response)) {\n                            reject(response.error);\n                          } else {\n                            resolve(response.result);\n                          }\n                        });\n                        _context4.prev = 10;\n                        _context4.next = 13;\n                        return _this2.connection.send(request, context);\n                      case 13:\n                        _context4.next = 18;\n                        break;\n                      case 15:\n                        _context4.prev = 15;\n                        _context4.t1 = _context4[\"catch\"](10);\n                        reject(_context4.t1);\n                      case 18:\n                      case \"end\":\n                        return _context4.stop();\n                    }\n                  }, _callee4, null, [[1, 6], [10, 15]]);\n                }));\n                return function (_x5, _x6) {\n                  return _ref.apply(this, arguments);\n                };\n              }()));\n            case 1:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5);\n      }));\n      function requestStrict(_x3, _x4) {\n        return _requestStrict.apply(this, arguments);\n      }\n      return requestStrict;\n    }()\n  }, {\n    key: \"setConnection\",\n    value: function setConnection() {\n      var connection = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.connection;\n      return connection;\n    }\n  }, {\n    key: \"onPayload\",\n    value: function onPayload(payload) {\n      this.events.emit(\"payload\", payload);\n      if (isJsonRpcResponse(payload)) {\n        this.events.emit(\"\".concat(payload.id), payload);\n      } else {\n        this.events.emit(\"message\", {\n          type: payload.method,\n          data: payload.params\n        });\n      }\n    }\n  }, {\n    key: \"onClose\",\n    value: function onClose(event) {\n      if (event && event.code === 3000) {\n        this.events.emit(\"error\", new Error(\"WebSocket connection closed abnormally with code: \".concat(event.code, \" \").concat(event.reason ? \"(\".concat(event.reason, \")\") : \"\")));\n      }\n      this.events.emit(\"disconnect\");\n    }\n  }, {\n    key: \"open\",\n    value: function () {\n      var _open = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n        var connection,\n          _args6 = arguments;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              connection = _args6.length > 0 && _args6[0] !== undefined ? _args6[0] : this.connection;\n              if (!(this.connection === connection && this.connection.connected)) {\n                _context6.next = 3;\n                break;\n              }\n              return _context6.abrupt(\"return\");\n            case 3:\n              if (this.connection.connected) this.close();\n              if (!(typeof connection === \"string\")) {\n                _context6.next = 8;\n                break;\n              }\n              _context6.next = 7;\n              return this.connection.open(connection);\n            case 7:\n              connection = this.connection;\n            case 8:\n              this.connection = this.setConnection(connection);\n              _context6.next = 11;\n              return this.connection.open();\n            case 11:\n              this.registerEventListeners();\n              this.events.emit(\"connect\");\n            case 13:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee6, this);\n      }));\n      function open() {\n        return _open.apply(this, arguments);\n      }\n      return open;\n    }()\n  }, {\n    key: \"close\",\n    value: function () {\n      var _close = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              _context7.next = 2;\n              return this.connection.close();\n            case 2:\n            case \"end\":\n              return _context7.stop();\n          }\n        }, _callee7, this);\n      }));\n      function close() {\n        return _close.apply(this, arguments);\n      }\n      return close;\n    }()\n  }, {\n    key: \"registerEventListeners\",\n    value: function registerEventListeners() {\n      var _this3 = this;\n      if (this.hasRegisteredEventListeners) return;\n      this.connection.on(\"payload\", function (payload) {\n        return _this3.onPayload(payload);\n      });\n      this.connection.on(\"close\", function (event) {\n        return _this3.onClose(event);\n      });\n      this.connection.on(\"error\", function (error) {\n        return _this3.events.emit(\"error\", error);\n      });\n      this.connection.on(\"register_error\", function (error) {\n        return _this3.onClose();\n      });\n      this.hasRegisteredEventListeners = true;\n    }\n  }]);\n  return JsonRpcProvider;\n}(IJsonRpcProvider);\nexport default JsonRpcProvider;","map":{"version":3,"sources":["../../src/provider.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { EventEmitter } from \"events\";\nimport { IJsonRpcProvider, isJsonRpcResponse, formatJsonRpcRequest, isJsonRpcError, } from \"@walletconnect/jsonrpc-utils\";\nexport class JsonRpcProvider extends IJsonRpcProvider {\n    constructor(connection) {\n        super(connection);\n        this.events = new EventEmitter();\n        this.hasRegisteredEventListeners = false;\n        this.connection = this.setConnection(connection);\n        if (this.connection.connected) {\n            this.registerEventListeners();\n        }\n    }\n    async connect(connection = this.connection) {\n        await this.open(connection);\n    }\n    async disconnect() {\n        await this.close();\n    }\n    on(event, listener) {\n        this.events.on(event, listener);\n    }\n    once(event, listener) {\n        this.events.once(event, listener);\n    }\n    off(event, listener) {\n        this.events.off(event, listener);\n    }\n    removeListener(event, listener) {\n        this.events.removeListener(event, listener);\n    }\n    async request(request, context) {\n        return this.requestStrict(formatJsonRpcRequest(request.method, request.params || []), context);\n    }\n    async requestStrict(request, context) {\n        return new Promise(async (resolve, reject) => {\n            if (!this.connection.connected) {\n                try {\n                    await this.open();\n                }\n                catch (e) {\n                    reject(e);\n                }\n            }\n            this.events.on(`${request.id}`, response => {\n                if (isJsonRpcError(response)) {\n                    reject(response.error);\n                }\n                else {\n                    resolve(response.result);\n                }\n            });\n            try {\n                await this.connection.send(request, context);\n            }\n            catch (e) {\n                reject(e);\n            }\n        });\n    }\n    setConnection(connection = this.connection) {\n        return connection;\n    }\n    onPayload(payload) {\n        this.events.emit(\"payload\", payload);\n        if (isJsonRpcResponse(payload)) {\n            this.events.emit(`${payload.id}`, payload);\n        }\n        else {\n            this.events.emit(\"message\", {\n                type: payload.method,\n                data: payload.params,\n            });\n        }\n    }\n    onClose(event) {\n        if (event && event.code === 3000) {\n            this.events.emit(\"error\", new Error(`WebSocket connection closed abnormally with code: ${event.code} ${event.reason ? `(${event.reason})` : \"\"}`));\n        }\n        this.events.emit(\"disconnect\");\n    }\n    async open(connection = this.connection) {\n        if (this.connection === connection && this.connection.connected)\n            return;\n        if (this.connection.connected)\n            this.close();\n        if (typeof connection === \"string\") {\n            await this.connection.open(connection);\n            connection = this.connection;\n        }\n        this.connection = this.setConnection(connection);\n        await this.connection.open();\n        this.registerEventListeners();\n        this.events.emit(\"connect\");\n    }\n    async close() {\n        await this.connection.close();\n    }\n    registerEventListeners() {\n        if (this.hasRegisteredEventListeners)\n            return;\n        this.connection.on(\"payload\", (payload) => this.onPayload(payload));\n        this.connection.on(\"close\", (event) => this.onClose(event));\n        this.connection.on(\"error\", (error) => this.events.emit(\"error\", error));\n        this.connection.on(\"register_error\", (error) => this.onClose());\n        this.hasRegisteredEventListeners = true;\n    }\n}\nexport default JsonRpcProvider;\n//# sourceMappingURL=provider.js.map"]},"metadata":{},"sourceType":"module"}