{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"C:/Users/Kompa/Desktop/games/my-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport EventEmitter from \"events\";\nimport WalletConnect from \"@walletconnect/legacy-client\";\nimport QRCodeModal from \"@walletconnect/legacy-modal\";\nimport { IJsonRpcConnection } from \"@walletconnect/jsonrpc-types\";\nimport { formatJsonRpcError } from \"@walletconnect/jsonrpc-utils\";\nexport var SignerConnection = /*#__PURE__*/function (_IJsonRpcConnection) {\n  _inherits(SignerConnection, _IJsonRpcConnection);\n  var _super = _createSuper(SignerConnection);\n  function SignerConnection(opts) {\n    var _this;\n    _classCallCheck(this, SignerConnection);\n    _this = _super.call(this);\n    _this.events = new EventEmitter();\n    _this.accounts = [];\n    _this.chainId = 1;\n    _this.pending = false;\n    _this.bridge = \"https://bridge.walletconnect.org\";\n    _this.qrcode = true;\n    _this.qrcodeModalOptions = undefined;\n    _this.opts = opts;\n    _this.chainId = (opts === null || opts === void 0 ? void 0 : opts.chainId) || _this.chainId;\n    _this.wc = _this.register(opts);\n    return _this;\n  }\n  _createClass(SignerConnection, [{\n    key: \"connected\",\n    get: function get() {\n      return typeof this.wc !== \"undefined\" && this.wc.connected;\n    }\n  }, {\n    key: \"connecting\",\n    get: function get() {\n      return this.pending;\n    }\n  }, {\n    key: \"connector\",\n    get: function get() {\n      this.wc = this.register(this.opts);\n      return this.wc;\n    }\n  }, {\n    key: \"on\",\n    value: function on(event, listener) {\n      this.events.on(event, listener);\n    }\n  }, {\n    key: \"once\",\n    value: function once(event, listener) {\n      this.events.once(event, listener);\n    }\n  }, {\n    key: \"off\",\n    value: function off(event, listener) {\n      this.events.off(event, listener);\n    }\n  }, {\n    key: \"removeListener\",\n    value: function removeListener(event, listener) {\n      this.events.removeListener(event, listener);\n    }\n  }, {\n    key: \"open\",\n    value: function () {\n      var _open = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(chainId) {\n        var _this2 = this;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (!this.connected) {\n                _context.next = 3;\n                break;\n              }\n              this.onOpen();\n              return _context.abrupt(\"return\");\n            case 3:\n              return _context.abrupt(\"return\", new Promise(function (resolve, reject) {\n                _this2.on(\"error\", function (err) {\n                  reject(err);\n                });\n                _this2.on(\"open\", function () {\n                  resolve();\n                });\n                _this2.create(chainId);\n              }));\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function open(_x) {\n        return _open.apply(this, arguments);\n      }\n      return open;\n    }()\n  }, {\n    key: \"close\",\n    value: function () {\n      var _close = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(typeof this.wc === \"undefined\")) {\n                _context2.next = 2;\n                break;\n              }\n              return _context2.abrupt(\"return\");\n            case 2:\n              if (this.wc.connected) {\n                this.wc.killSession();\n              }\n              this.onClose();\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function close() {\n        return _close.apply(this, arguments);\n      }\n      return close;\n    }()\n  }, {\n    key: \"send\",\n    value: function () {\n      var _send = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(payload) {\n        var _this3 = this;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              this.wc = this.register(this.opts);\n              if (this.connected) {\n                _context3.next = 4;\n                break;\n              }\n              _context3.next = 4;\n              return this.open();\n            case 4:\n              this.sendPayload(payload).then(function (res) {\n                return _this3.events.emit(\"payload\", res);\n              }).catch(function (e) {\n                return _this3.events.emit(\"payload\", formatJsonRpcError(payload.id, e.message));\n              });\n            case 5:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n      function send(_x2) {\n        return _send.apply(this, arguments);\n      }\n      return send;\n    }()\n  }, {\n    key: \"register\",\n    value: function register(opts) {\n      if (this.wc) return this.wc;\n      this.opts = opts || this.opts;\n      this.bridge = (opts === null || opts === void 0 ? void 0 : opts.connector) ? opts.connector.bridge : (opts === null || opts === void 0 ? void 0 : opts.bridge) || \"https://bridge.walletconnect.org\";\n      this.qrcode = typeof (opts === null || opts === void 0 ? void 0 : opts.qrcode) === \"undefined\" || opts.qrcode !== false;\n      this.chainId = typeof (opts === null || opts === void 0 ? void 0 : opts.chainId) !== \"undefined\" ? opts.chainId : this.chainId;\n      this.qrcodeModalOptions = opts === null || opts === void 0 ? void 0 : opts.qrcodeModalOptions;\n      var connectorOpts = {\n        bridge: this.bridge,\n        qrcodeModal: this.qrcode ? QRCodeModal : undefined,\n        qrcodeModalOptions: this.qrcodeModalOptions,\n        storageId: opts === null || opts === void 0 ? void 0 : opts.storageId,\n        signingMethods: opts === null || opts === void 0 ? void 0 : opts.signingMethods,\n        clientMeta: opts === null || opts === void 0 ? void 0 : opts.clientMeta\n      };\n      this.wc = typeof (opts === null || opts === void 0 ? void 0 : opts.connector) !== \"undefined\" ? opts.connector : new WalletConnect(connectorOpts);\n      if (typeof this.wc === \"undefined\") {\n        throw new Error(\"Failed to register WalletConnect connector\");\n      }\n      if (this.wc.accounts.length) {\n        this.accounts = this.wc.accounts;\n      }\n      if (this.wc.chainId) {\n        this.chainId = this.wc.chainId;\n      }\n      this.registerConnectorEvents();\n      return this.wc;\n    }\n  }, {\n    key: \"onOpen\",\n    value: function onOpen(wc) {\n      this.pending = false;\n      if (wc) {\n        this.wc = wc;\n      }\n      this.events.emit(\"open\");\n    }\n  }, {\n    key: \"onClose\",\n    value: function onClose() {\n      this.pending = false;\n      if (this.wc) {\n        this.wc = undefined;\n      }\n      this.events.emit(\"close\");\n    }\n  }, {\n    key: \"onError\",\n    value: function onError(payload) {\n      var message = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"Failed or Rejected Request\";\n      var code = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : -32000;\n      var errorPayload = {\n        id: payload.id,\n        jsonrpc: payload.jsonrpc,\n        error: {\n          code: code,\n          message: message\n        }\n      };\n      this.events.emit(\"payload\", errorPayload);\n      return errorPayload;\n    }\n  }, {\n    key: \"create\",\n    value: function create(chainId) {\n      var _this4 = this;\n      this.wc = this.register(this.opts);\n      this.chainId = chainId || this.chainId;\n      if (this.connected || this.pending) return;\n      this.pending = true;\n      this.registerConnectorEvents();\n      this.wc.createSession({\n        chainId: this.chainId\n      }).then(function () {\n        return _this4.events.emit(\"created\");\n      }).catch(function (e) {\n        return _this4.events.emit(\"error\", e);\n      });\n    }\n  }, {\n    key: \"registerConnectorEvents\",\n    value: function registerConnectorEvents() {\n      var _this5 = this;\n      this.wc = this.register(this.opts);\n      this.wc.on(\"connect\", function (err) {\n        var _a, _b;\n        if (err) {\n          _this5.events.emit(\"error\", err);\n          return;\n        }\n        _this5.accounts = ((_a = _this5.wc) === null || _a === void 0 ? void 0 : _a.accounts) || [];\n        _this5.chainId = ((_b = _this5.wc) === null || _b === void 0 ? void 0 : _b.chainId) || _this5.chainId;\n        _this5.onOpen();\n      });\n      this.wc.on(\"disconnect\", function (err) {\n        if (err) {\n          _this5.events.emit(\"error\", err);\n          return;\n        }\n        _this5.onClose();\n      });\n      this.wc.on(\"modal_closed\", function () {\n        _this5.events.emit(\"error\", new Error(\"User closed modal\"));\n      });\n      this.wc.on(\"session_update\", function (error, payload) {\n        var _payload$params$ = payload.params[0],\n          accounts = _payload$params$.accounts,\n          chainId = _payload$params$.chainId;\n        if (!_this5.accounts || accounts && _this5.accounts !== accounts) {\n          _this5.accounts = accounts;\n          _this5.events.emit(\"accountsChanged\", accounts);\n        }\n        if (!_this5.chainId || chainId && _this5.chainId !== chainId) {\n          _this5.chainId = chainId;\n          _this5.events.emit(\"chainChanged\", chainId);\n        }\n      });\n    }\n  }, {\n    key: \"sendPayload\",\n    value: function () {\n      var _sendPayload = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(payload) {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              this.wc = this.register(this.opts);\n              _context4.prev = 1;\n              _context4.next = 4;\n              return this.wc.unsafeSend(payload);\n            case 4:\n              response = _context4.sent;\n              return _context4.abrupt(\"return\", this.sanitizeResponse(response));\n            case 8:\n              _context4.prev = 8;\n              _context4.t0 = _context4[\"catch\"](1);\n              return _context4.abrupt(\"return\", this.onError(payload, _context4.t0.message));\n            case 11:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[1, 8]]);\n      }));\n      function sendPayload(_x3) {\n        return _sendPayload.apply(this, arguments);\n      }\n      return sendPayload;\n    }()\n  }, {\n    key: \"sanitizeResponse\",\n    value: function sanitizeResponse(response) {\n      return typeof response.error !== \"undefined\" && typeof response.error.code === \"undefined\" ? formatJsonRpcError(response.id, response.error.message, response.error.data) : response;\n    }\n  }]);\n  return SignerConnection;\n}(IJsonRpcConnection);\nexport default SignerConnection;","map":{"version":3,"sources":["../../src/signer.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import EventEmitter from \"events\";\nimport WalletConnect from \"@walletconnect/legacy-client\";\nimport QRCodeModal from \"@walletconnect/legacy-modal\";\nimport { IJsonRpcConnection } from \"@walletconnect/jsonrpc-types\";\nimport { formatJsonRpcError } from \"@walletconnect/jsonrpc-utils\";\nexport class SignerConnection extends IJsonRpcConnection {\n    constructor(opts) {\n        super();\n        this.events = new EventEmitter();\n        this.accounts = [];\n        this.chainId = 1;\n        this.pending = false;\n        this.bridge = \"https://bridge.walletconnect.org\";\n        this.qrcode = true;\n        this.qrcodeModalOptions = undefined;\n        this.opts = opts;\n        this.chainId = (opts === null || opts === void 0 ? void 0 : opts.chainId) || this.chainId;\n        this.wc = this.register(opts);\n    }\n    get connected() {\n        return typeof this.wc !== \"undefined\" && this.wc.connected;\n    }\n    get connecting() {\n        return this.pending;\n    }\n    get connector() {\n        this.wc = this.register(this.opts);\n        return this.wc;\n    }\n    on(event, listener) {\n        this.events.on(event, listener);\n    }\n    once(event, listener) {\n        this.events.once(event, listener);\n    }\n    off(event, listener) {\n        this.events.off(event, listener);\n    }\n    removeListener(event, listener) {\n        this.events.removeListener(event, listener);\n    }\n    async open(chainId) {\n        if (this.connected) {\n            this.onOpen();\n            return;\n        }\n        return new Promise((resolve, reject) => {\n            this.on(\"error\", err => {\n                reject(err);\n            });\n            this.on(\"open\", () => {\n                resolve();\n            });\n            this.create(chainId);\n        });\n    }\n    async close() {\n        if (typeof this.wc === \"undefined\")\n            return;\n        if (this.wc.connected) {\n            this.wc.killSession();\n        }\n        this.onClose();\n    }\n    async send(payload) {\n        this.wc = this.register(this.opts);\n        if (!this.connected)\n            await this.open();\n        this.sendPayload(payload)\n            .then((res) => this.events.emit(\"payload\", res))\n            .catch(e => this.events.emit(\"payload\", formatJsonRpcError(payload.id, e.message)));\n    }\n    register(opts) {\n        if (this.wc)\n            return this.wc;\n        this.opts = opts || this.opts;\n        this.bridge = (opts === null || opts === void 0 ? void 0 : opts.connector) ? opts.connector.bridge\n            : (opts === null || opts === void 0 ? void 0 : opts.bridge) || \"https://bridge.walletconnect.org\";\n        this.qrcode = typeof (opts === null || opts === void 0 ? void 0 : opts.qrcode) === \"undefined\" || opts.qrcode !== false;\n        this.chainId = typeof (opts === null || opts === void 0 ? void 0 : opts.chainId) !== \"undefined\" ? opts.chainId : this.chainId;\n        this.qrcodeModalOptions = opts === null || opts === void 0 ? void 0 : opts.qrcodeModalOptions;\n        const connectorOpts = {\n            bridge: this.bridge,\n            qrcodeModal: this.qrcode ? QRCodeModal : undefined,\n            qrcodeModalOptions: this.qrcodeModalOptions,\n            storageId: opts === null || opts === void 0 ? void 0 : opts.storageId,\n            signingMethods: opts === null || opts === void 0 ? void 0 : opts.signingMethods,\n            clientMeta: opts === null || opts === void 0 ? void 0 : opts.clientMeta,\n        };\n        this.wc =\n            typeof (opts === null || opts === void 0 ? void 0 : opts.connector) !== \"undefined\" ? opts.connector : new WalletConnect(connectorOpts);\n        if (typeof this.wc === \"undefined\") {\n            throw new Error(\"Failed to register WalletConnect connector\");\n        }\n        if (this.wc.accounts.length) {\n            this.accounts = this.wc.accounts;\n        }\n        if (this.wc.chainId) {\n            this.chainId = this.wc.chainId;\n        }\n        this.registerConnectorEvents();\n        return this.wc;\n    }\n    onOpen(wc) {\n        this.pending = false;\n        if (wc) {\n            this.wc = wc;\n        }\n        this.events.emit(\"open\");\n    }\n    onClose() {\n        this.pending = false;\n        if (this.wc) {\n            this.wc = undefined;\n        }\n        this.events.emit(\"close\");\n    }\n    onError(payload, message = \"Failed or Rejected Request\", code = -32000) {\n        const errorPayload = {\n            id: payload.id,\n            jsonrpc: payload.jsonrpc,\n            error: { code, message },\n        };\n        this.events.emit(\"payload\", errorPayload);\n        return errorPayload;\n    }\n    create(chainId) {\n        this.wc = this.register(this.opts);\n        this.chainId = chainId || this.chainId;\n        if (this.connected || this.pending)\n            return;\n        this.pending = true;\n        this.registerConnectorEvents();\n        this.wc\n            .createSession({ chainId: this.chainId })\n            .then(() => this.events.emit(\"created\"))\n            .catch((e) => this.events.emit(\"error\", e));\n    }\n    registerConnectorEvents() {\n        this.wc = this.register(this.opts);\n        this.wc.on(\"connect\", (err) => {\n            var _a, _b;\n            if (err) {\n                this.events.emit(\"error\", err);\n                return;\n            }\n            this.accounts = ((_a = this.wc) === null || _a === void 0 ? void 0 : _a.accounts) || [];\n            this.chainId = ((_b = this.wc) === null || _b === void 0 ? void 0 : _b.chainId) || this.chainId;\n            this.onOpen();\n        });\n        this.wc.on(\"disconnect\", (err) => {\n            if (err) {\n                this.events.emit(\"error\", err);\n                return;\n            }\n            this.onClose();\n        });\n        this.wc.on(\"modal_closed\", () => {\n            this.events.emit(\"error\", new Error(\"User closed modal\"));\n        });\n        this.wc.on(\"session_update\", (error, payload) => {\n            const { accounts, chainId } = payload.params[0];\n            if (!this.accounts || (accounts && this.accounts !== accounts)) {\n                this.accounts = accounts;\n                this.events.emit(\"accountsChanged\", accounts);\n            }\n            if (!this.chainId || (chainId && this.chainId !== chainId)) {\n                this.chainId = chainId;\n                this.events.emit(\"chainChanged\", chainId);\n            }\n        });\n    }\n    async sendPayload(payload) {\n        this.wc = this.register(this.opts);\n        try {\n            const response = await this.wc.unsafeSend(payload);\n            return this.sanitizeResponse(response);\n        }\n        catch (error) {\n            return this.onError(payload, error.message);\n        }\n    }\n    sanitizeResponse(response) {\n        return typeof response.error !== \"undefined\" &&\n            typeof response.error.code === \"undefined\"\n            ? formatJsonRpcError(response.id, response.error.message, response.error.data)\n            : response;\n    }\n}\nexport default SignerConnection;\n//# sourceMappingURL=signer.js.map"]},"metadata":{},"sourceType":"module"}